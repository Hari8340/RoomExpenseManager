"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['cartesianVisuals.min.js'] || (this.parseTimeMarkers['cartesianVisuals.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('cartesianVisuals.min.js');var es6,powerbi,__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,s,n,l){return new(n=n||Promise)(function(a,t){function i(e){try{o(l.next(e))}catch(e){t(e)}}function r(e){try{o(l.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(i,r)}o((l=l.apply(e,s||[])).next())})},__generator=this&&this.__generator||function(i,r){var o,s,n,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(a){return function(e){var t=[a,e];if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,s&&(n=2&t[0]?s.return:t[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,t[1])).done)return n;switch(s=0,(t=n?[2&t[0],n.value]:t)[0]){case 0:case 1:n=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,s=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(n=0<(n=l.trys).length&&n[n.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!n||t[1]>n[0]&&t[1]<n[3]))l.label=t[1];else if(6===t[0]&&l.label<n[1])l.label=n[1],n=t;else{if(!(n&&l.label<n[2])){n[2]&&l.ops.pop(),l.trys.pop();continue}l.label=n[2],l.ops.push(t)}}t=r.call(i,l)}catch(e){t=[6,e],s=0}finally{o=n=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},__spreadArray=this&&this.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||((i=i||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))},__extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}}();!function(e){var d;((d=e.visuals||(e.visuals={})).CartesianViewModelAdapterUtils||(d.CartesianViewModelAdapterUtils={})).updatePlotResponsiveWarnings=function(e,t){var a,i,r,o,s,n=e.warningObjectCollection,l={},c=e.legendData,u=t.legendData;for(s in e.showIcon?(l.legend=new d.LegendNotRenderedWarning,l.categoryAxis=new d.AxisAndAxisLabelsNotRenderedWarning,l.valueAxis=new d.AxisAndAxisLabelsNotRenderedWarning):(c.show!==u.show?l.legend=new d.LegendNotRenderedWarning:c.position!==u.position?l.legend=new d.LegendLocationWarning:_.isEqual(c.fontProperties.size,u.fontProperties.size)||(l.legend=new d.LegendFontSizeWarning(d.CartesianWarningPropertyNames.legendFontSize)),c=e.axesData,u=t.axesData,a=c.categoryAxis,i=u.categoryAxis,o=!_.isEqual(a.labelFontProperties.size,i.labelFontProperties.size),r=!_.isEqual(a.titleFontProperties.size,i.titleFontProperties.size),a.show!==i.show?l.categoryAxis=new d.AxisAndAxisLabelsNotRenderedWarning:a.showAxisTitle!==i.showAxisTitle?l.categoryAxis=new d.AxisLabelsNotRenderedWarning:(o||r)&&(l.categoryAxis=new d.AxisFontSizeWarning(o?d.CartesianWarningPropertyNames.axisFontSize:d.CartesianWarningPropertyNames.axisTitleFontSize)),a=c.valueAxis,i=u.valueAxis,r=!_.isEqual(a.labelFontProperties.size,i.labelFontProperties.size),o=!_.isEqual(a.titleFontProperties.size,i.titleFontProperties.size),a.show!==i.show?l.valueAxis=new d.AxisAndAxisLabelsNotRenderedWarning:a.showAxisTitle!==i.showAxisTitle?l.valueAxis=new d.AxisLabelsNotRenderedWarning:(r||o)&&(l.valueAxis=new d.AxisFontSizeWarning(r?d.CartesianWarningPropertyNames.axisFontSize:d.CartesianWarningPropertyNames.axisTitleFontSize)),c=e.zoomData,u=t.zoomData,c.showOnCategoryAxis===u.showOnCategoryAxis&&c.showOnValueAxis===u.showOnValueAxis&&c.showOnValueSecAxis===u.showOnValueSecAxis||(l.zoom=new d.ZoomSlidersNotRenderedWarning)),l)n.addForVisualObject(s,{selector:null,warnings:[l[s]]})}}(powerbi=powerbi||{}),function(e){var o,s;o=e.visuals||(e.visuals={}),s=o.Units.FontSize,o.cartesianLegacyResponsiveViewportsBreakpoints={legendWidth:76,legendHeight:58,axesTitleWidth:128,axesTitleHeight:58,axesHeight:58,axesMedWidth:128,axesWidth:76,maxWidthForMediumFont:180,maxWidthForSmallFont:128},(o.CartesianLegacyResponsiveApplier||(o.CartesianLegacyResponsiveApplier={})).applyLegacyResponsiveChanges=function(e,t){var a=e,i=(r=t).axesData,a=(a.height<=o.cartesianLegacyResponsiveViewportsBreakpoints.axesTitleHeight&&(i.x.showAxisTitle=!1,i.y.showAxisTitle=!1,i.y2.showAxisTitle=!1),a.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.axesTitleWidth&&(i.y.showAxisTitle=!1,i.y2.showAxisTitle=!1),a.height<=o.cartesianLegacyResponsiveViewportsBreakpoints.axesHeight&&(i.x.show=!1),a.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.axesWidth&&(i.y.show=!1,i.y2.show=!1),a.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.axesMedWidth&&o.Legend.isLeftOrRight(r.legendData.position)&&(i.y.show=!1,i.y2.show=!1),a.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForMediumFont&&(r={x:{tickLabels:o.CartesianChart.xAxisSmallFontSizeInPx,title:o.CartesianChart.xAxisSmallFontSizeInPx},y:{tickLabels:o.CartesianChart.yAxisMediumFontSizeInPx,title:o.CartesianChart.yAxisMediumFontSizeInPx},y2:{tickLabels:o.CartesianChart.yAxisMediumFontSizeInPx,title:o.CartesianChart.yAxisMediumFontSizeInPx}},a.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForSmallFont&&(r.y.tickLabels=o.CartesianChart.yAxisSmallFontSizeInPx,r.y.title=o.CartesianChart.yAxisSmallFontSizeInPx,r.y2.tickLabels=o.CartesianChart.yAxisSmallFontSizeInPx,r.y2.title=o.CartesianChart.yAxisSmallFontSizeInPx),i.x.titleFontProperties=o.FontProperties.inherit(i.x.titleFontProperties,{size:s.createFromPx(r.x.title)}),i.y.titleFontProperties=o.FontProperties.inherit(i.y.titleFontProperties,{size:s.createFromPx(r.y.title)}),i.y2.titleFontProperties=o.FontProperties.inherit(i.y2.titleFontProperties,{size:s.createFromPx(r.y2.title)}),i.x.labelFontProperties=o.FontProperties.inherit(i.x.labelFontProperties,{size:s.createFromPx(r.x.tickLabels)}),i.y.labelFontProperties=o.FontProperties.inherit(i.y.labelFontProperties,{size:s.createFromPx(r.y.tickLabels)}),i.y2.labelFontProperties=o.FontProperties.inherit(i.y2.labelFontProperties,{size:s.createFromPx(r.y2.tickLabels)})),e),r=(i=t).legendData.position,e=a.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.legendWidth&&o.Legend.isLeftOrRight(r),r=a.height<=o.cartesianLegacyResponsiveViewportsBreakpoints.legendHeight&&o.Legend.isTopOrBottom(r);(e||r)&&(i.legendData.show=!1),a.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForMediumFont&&(e=i.legendData.fontProperties.size.pt,r=void 0,r=a.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForSmallFont?Math.min(e,o.Legend.LegendSmallFontSmallViewportInPt):Math.min(e,o.Legend.LegendMediumFontSmallViewportInPt),i.legendData.fontProperties=o.FontProperties.inherit(i.legendData.fontProperties,{size:s.createFromPt(r)}))}}(powerbi=powerbi||{}),function(e){var s;function n(e){this.viewport=e.viewport,this.cartesianData=e.cartesianData,this.dataView=e.dataView,this.responsiveFontHelper=new s.ResponsiveCartesianFontHelper}(s=e.visuals||(e.visuals={})).cartesianResponsiveBreakpoints={legendPositionWidth:210,legendPositionHeight:100,legendHeight:70,legendWidth:80,xAxesHeight:100,yAxesTitleWidth:210,yAxesWidth:100,xAxesTitleHeight:145,yAxesZoomWidth:280,xAxesZoomHeight:150,iconWidth:50,iconHeight:50},n.prototype.getData=function(){var e=s.ViewModelAdapterUtils.getResponsiveVisualProperties(this.dataView,s.cartesianChartProps),t=e.responsive,e=e.responsiveLegacy,a=this.cartesianData;return a=t||e?this.applyResponsiveChanges(this.viewport,this.cartesianData,t,e):a},n.prototype.enumerateObjectInstances=function(e,t,a){"general"===e.objectName&&this.enumerateGeneral(t,this.dataView,a)},n.prototype.getResponsiveSlice=function(e,t,a){if(t)return t=s.cartesianChartProps.general,e=s.ViewModelAdapterUtils.getResponsiveVisualProperties(e,s.cartesianChartProps),{item:new s.builder.SimpleFormattingSliceBuilder({uidBuilder:new s.builder.FormattingSliceUidBuilder(new s.builder.FormattingGroupUidBuilder(new s.builder.FormattingCardUidBuilder("visualPlaceholderCard"),"visualPlaceholderGroup"),"responsive"),control:new s.builder.ToggleSwitchBuilder({descriptor:t.responsive,value:e.responsive}).build(),localize:a}).build(),revertToDefaultDescriptors:[t.responsive]}},n.prototype.enumerateGeneral=function(e,t,a){var i={selector:null,properties:{},objectName:"general"};a&&(a=s.ViewModelAdapterUtils.getResponsiveVisualProperties(t,s.cartesianChartProps),i.properties.responsive=a.responsive),e.pushInstance(i)},n.prototype.applyResponsiveChanges=function(e,t,a,i){var r=s.ViewModelAdapterUtils.cloneData(t),o=r.legendData.position;return a?(this.applyIconResponsiveChanges(e,r),this.applyLegendResponsiveChanges(e,o,r),this.applyAxesResponsiveChanges(e,r),this.applyZoomSliderResponsiveChanges(e,r),this.applyFontSizesChanges(e,r),n.applyScrollbarChanges(e,r)):i&&s.CartesianLegacyResponsiveApplier.applyLegacyResponsiveChanges(e,r),s.CartesianViewModelAdapterUtils.updatePlotResponsiveWarnings(r,t),r},n.prototype.applyIconResponsiveChanges=function(e,t){t.showIcon=e.height<=s.cartesianResponsiveBreakpoints.iconHeight||e.width<=s.cartesianResponsiveBreakpoints.iconWidth},n.prototype.applyLegendResponsiveChanges=function(e,t,a){(e.width<s.cartesianResponsiveBreakpoints.legendPositionWidth||e.height<s.cartesianResponsiveBreakpoints.legendPositionHeight)&&s.Legend.isLeftOrRight(t)&&(a.legendData.position=s.LegendPosition.Top),(e.height<s.cartesianResponsiveBreakpoints.legendHeight||e.width<s.cartesianResponsiveBreakpoints.legendWidth)&&(a.legendData.show=!1),a.legendData.useLargeArrowHitArea=!0},n.applyScrollbarChanges=function(e,t){t.scrollbarOptions=n.ScrollbarOptions},n.prototype.applyAxesResponsiveChanges=function(e,t){e.height<s.cartesianResponsiveBreakpoints.xAxesHeight&&(t.axesData.x.show=!1),e.width<s.cartesianResponsiveBreakpoints.yAxesTitleWidth&&(t.axesData.y.showAxisTitle=!1,t.axesData.y2.showAxisTitle=!1),e.width<s.cartesianResponsiveBreakpoints.yAxesWidth&&(t.axesData.y.show=!1,t.axesData.y2.show=!1),e.height<s.cartesianResponsiveBreakpoints.xAxesTitleHeight&&(t.axesData.x.showAxisTitle=!1)},n.prototype.applyZoomSliderResponsiveChanges=function(e,t){(e.height<s.cartesianResponsiveBreakpoints.xAxesZoomHeight||e.width<s.cartesianResponsiveBreakpoints.yAxesZoomWidth)&&(t.zoomData.showOnCategoryAxis=!1,t.zoomData.showOnValueAxis=!1,t.zoomData.showOnValueSecAxis=!1)},n.prototype.applyFontSizesChanges=function(e,t){t.legendData&&t.legendData.fontProperties&&(t.legendData.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.legendData.fontProperties));t=t.axesData;t.x.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.x.labelFontProperties),t.x.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.x.titleFontProperties),t.y.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y.labelFontProperties),t.y.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y.titleFontProperties),t.y2.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y2.labelFontProperties),t.y2.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y2.titleFontProperties)},n.ScrollbarOptions={scrollbarWidth:8,scrollbarRadius:4,scrollbarClass:"responsive"},s.CartesianViewModelAdapter=n}(powerbi=powerbi||{}),function(e){var g=e.visuals||(e.visuals={}),y=e.data.DataViewConcatenateCategoricalColumns;function t(e){this.staticUpdateOptions=e}t.prototype.create=function(e){return new a(this.staticUpdateOptions,e)},g.CartesianSmallMultipleUpdateFactory=t,i.prototype.apply=function(e,t){var a,i=this.staticUpdateOptions,r=i.layerInitDataOptions,i=i.updateGlobalAxesDomains,o=this.updateOptions,s=o.isSmallMultiples,n=o.reader,l=o.dataViews,c=o.updateOptions,o=o.requestedPerMultipleAxisDomains;if(s)for(var u=g.ComboChart.isComboChart(t)?n.convertComboFrame(e.index):[n.convertFrame(e.index)],d=void 0,h=0;h<u.length;h++){var p=u[h],p=y.concatenateCategoryColumnsForVisual(p.metadata,g.StandardObjectPropertyIdentifiers.formatString,g.cartesianRoleNames.category,p.categorical,!!d);d?p.categorical.categories=d:d=null==(a=p.categorical)?void 0:a.categories,u[h]=p}else u=l;e.hasInitializedData()||e.initData(r);t=__assign(__assign({},c),{dataViews:u,multipleInfo:s?this.buildMultipleInfo(e.index):void 0});e.update(t),o&&(o.categoryAxis||o.valueAxis||o.secondaryValueAxis)&&i(e.getAxesDomains(!0,o))},i.prototype.applySynchronizedAxes=function(e,t){this.updateOptions.isSmallMultiples;e.applySynchronizedDomains(t)},i.prototype.applyResize=function(e){e.resize(this.updateOptions.updateOptions.viewport)},i.prototype.buildMultipleInfo=function(e){var a,t=this.updateOptions.reader;if(t)return a=t.getFrameNode(e),t=t.getFrameSourceColumns().map(function(e,t){return{metadata:e,value:a.levelValues[t].value}}),{identity:a.identity,sources:t,isCoreMultiple:0===e}};var a=i;function i(e,t){this.staticUpdateOptions=e,this.updateOptions=t}function n(e,t,a,i,r,o,s){this.smallMultiples=e,this.index=t,this.featureSwitches=a,this.layers=i,this.type=r,this.interactivityService=o,this.getLayerInitOptions=s,this.state=0}g.CartesianSmallMultipleUpdate=a,n.create=function(e,t,a,i,r,o,s){return new n(e,t,a,r,o,i,s)},n.prototype.getDataPoint=function(){var t,e,a;return this.dataPoint||(t=this.multipleInfo,a=_.first(t.sources).metadata.queryName,e=t.sources.map(function(e){return g.buildValueDetailsForColumnValue(e.metadata,e.value,t.identity)}),a=(new g.SelectionIdBuilder).withColumnIdentity(t.identity,a,e).createSelectionId(),this.dataPoint={selected:!1,identity:a},this.interactivityService&&this.interactivityService.applySelectionStateToData([this.dataPoint])),this.dataPoint},n.prototype.getIndex=function(){return this.index},n.prototype.isSelected=function(){return this.getDataPoint().selected},n.prototype.getState=function(){return this.state},n.prototype.initRenderer=function(e){this.renderer=e;var t=this.getLayerInitOptions(e);this.layers.forEach(function(e){return e.initRenderer(t)}),this.state|=2},n.prototype.getRenderer=function(){return this.renderer},n.prototype.initData=function(a){this.layers.forEach(function(e){var t;return null==(t=e.initData)?void 0:t.call(e,a)}),this.style=a.style,this.state|=1},n.prototype.update=function(e){this.dataViews=e.dataViews,this.multipleInfo=e.multipleInfo,this.dataPoint=void 0,this.adapterFactory=e.adapterFactory;var t=this.layers;return this.responsiveData=void 0,this.data=g.CartesianChart.converter({layerStyle:this.style,chartType:this.type,dataViews:e.dataViews,categoryAxisTitleOnByDefault:e.categoryAxisTitleOnByDefault,valueAxisTitleOnByDefault:e.valueAxisTitleOnByDefault,layers:t,featureSwitches:this.featureSwitches,hasDataChanged:null!=e.operationKind,multipleInfo:e.multipleInfo}),this.data},n.prototype.isVisible=function(){return!!(2&this.state)},n.prototype.hasInitializedData=function(){return!!(1&this.state)},n.prototype.getMultipleInfo=function(){return this.multipleInfo},n.prototype.applySynchronizedDomains=function(e){var t,a,i,r,o,s=this.data&&this.data.axesData;e&&s&&(a=s.categoryAxis,i=s.valueAxis,s=s.secondaryValueAxis,r=e.categoryAxis,o=e.valueAxis,e=e.secondaryValueAxis,(t=function(e,t){e&&(t.includeDomains=t.includeDomains||[]).push(g.AxisHelper.createScalarDomainOptions(e,1))})(r,a),this.featureSwitches.smallMultiplesUnsharedAxes&&(!this.data.axesData.y.sharedAxis&&this.data.axesData.y.scaleToFit||!this.data.axesData.x.sharedAxis&&this.data.axesData.x.scaleToFit)||(t(o,i),t(e,s)))},n.prototype.resize=function(e){this.adapterFactory&&this.data&&(!1==!!this.smallMultiples||this.featureSwitches.smallMultiplesResponsive||!this.smallMultiples.isSmallMultiples()?(e=this.adapterFactory.createCartesianAdapter({cartesianData:this.data,dataView:this.dataViews[0],viewport:e,isCoreMultiple:!this.multipleInfo||this.multipleInfo.isCoreMultiple}),this.responsiveData=e.getData()):this.responsiveData=this.data)},n.prototype.getCapabilities=function(){var r={domainAggregateRoles:[],supportedDomainAggregates:void 0},o={domainAggregateRoles:[],supportedDomainAggregates:void 0},s={domainAggregateRoles:[],supportedDomainAggregates:void 0};return this.layers.forEach(function(e){function t(e,t){e&&e.domainAggregateRole&&(t.domainAggregateRoles.push(e.domainAggregateRole),void 0===t.supportedDomainAggregates?t.supportedDomainAggregates=e.supportedDomainAggregates:t.supportedDomainAggregates&=e.supportedDomainAggregates)}var e=e.getCartesianVisualCapabilities(),e=(e.axesCapabilities,e.axesCapabilities),a=e.categoryAxis,i=e.valueAxis,e=e.secondaryValueAxis;t(a,r),t(i,o),t(e,s)}),{axesCapabilities:{categoryAxis:_.isEmpty(r.domainAggregateRoles)?void 0:__assign(__assign({},r),{domainAggregateRoles:_.uniq(r.domainAggregateRoles)}),valueAxis:_.isEmpty(o.domainAggregateRoles)?void 0:__assign(__assign({},o),{domainAggregateRoles:_.uniq(o.domainAggregateRoles)}),secondaryValueAxis:_.isEmpty(s.domainAggregateRoles)?void 0:__assign(__assign({},s),{domainAggregateRoles:_.uniq(s.domainAggregateRoles)})}}},n.prototype.getAxesDomains=function(e,t){for(var a={},i=0;i<this.layers.length;i++){var r=this.layers[i];r.getAxesDomains&&((r=r.getAxesDomains(e,t)).categoryAxis&&(a.categoryAxis=g.AxisHelper.mergeDomains(a.categoryAxis||g.DefaultDomain,r.categoryAxis)),r.valueAxis&&(0<i&&g.ComboChart.isComboChart(this.type)?a.secondaryValueAxis=g.AxisHelper.mergeDomains(a.secondaryValueAxis||g.DefaultDomain,r.valueAxis):a.valueAxis=g.AxisHelper.mergeDomains(a.valueAxis||g.DefaultDomain,r.valueAxis)),r.secondaryValueAxis)&&(a.secondaryValueAxis=g.AxisHelper.mergeDomains(a.secondaryValueAxis||g.DefaultDomain,r.secondaryValueAxis))}return a},n.prototype.getData=function(){return this.responsiveData||this.data},n.prototype.clearSelection=function(){for(var e=0,t=this.layers.length;e<t;e++)this.layers[e].onClearSelection()},n.prototype.updateLayers=function(){this.layers.forEach(function(e){return e.render(!0)})},n.prototype.destroy=function(){this.renderer&&this.renderer.destroy()},g.CartesianSmallMultiple=n}(powerbi=powerbi||{}),function(l){var p;function e(e,t,a,i){this.type=e,this.featureSwitches=t,this.layerFactory=a,this.getLayerInitRendererOptions=i,this.multiples=[]}p=l.visuals||(l.visuals={}),e.prototype.init=function(e,t){var a=this;this.rowLoadMoreDataHandler=new p.SimpleLoadMoreDataHandler(e.host),this.updateFactory=new p.CartesianSmallMultipleUpdateFactory({layerInitDataOptions:e,updateGlobalAxesDomains:function(e){return a.updateGlobalAxesDomains(e)}}),this.interactivityService=t,this.multiples=[]},e.prototype.getObjects=function(){return this.reader?this.reader.getObjects():void 0},e.prototype.getCoreMultiple=function(){return this.coreMultiple||(this.coreMultiple=p.CartesianSmallMultiple.create(this,0,this.featureSwitches,this.interactivityService,this.layerFactory(),this.type,this.getLayerInitRendererOptions)),this.coreMultiple},e.prototype.getShouldResetRowMultipleScrollPosition=function(){return this.shouldResetRowMultipleScrollPosition},e.prototype.get=function(e){if(!this.isSmallMultiples())return this.getCoreMultiple();this.multipleUpdate;var t=this.multiples[e];if(!t)for(var a=this,i=this.multiples.length;i<=e;i++){var r=i;t=a.multiples[r]=p.CartesianSmallMultiple.create(a,r,a.featureSwitches,a.interactivityService,a.layerFactory(),a.type,a.getLayerInitRendererOptions),(r=a.multipleUpdate).apply(t,a.type),a.isSmallMultiples()&&r.applySynchronizedAxes(t,a.axesDomains),r.applyResize(t)}return t},e.prototype.clear=function(){this.getMultiples(!0).forEach(function(e){return e.destroy()}),this.multiples=[],this.coreMultiple=void 0,this.axesDomains=void 0,this.shouldResetRowMultipleScrollPosition=void 0,this.multipleUpdate=void 0},e.prototype.resize=function(t){this.getMultiples(!0).forEach(function(e){return e.resize(t)})},e.prototype.update=function(e){var t,a=e.dataViews,i=(this.updateOptions=e,this.isSmallMultiples(a)),r=(this.shouldResetRowMultipleScrollPosition=!e.preserveScrollPosition,this.getCoreMultiple());i?(this.reader=p.DataViewMultipleReader.create(a[0],p.StandardObjectPropertyIdentifiers.formatString),this.updateFactory.create({dataViews:e.dataViews,isSmallMultiples:i,reader:this.reader,requestedPerMultipleAxisDomains:void 0,updateOptions:e}).apply(r,this.type),e.preserveScrollPosition&&!e.formatMode||(this.lastUpdatedFrameIndex=0,this.axesDomains=void 0,this.requestPerMultipleAxisDomains=this.updateSynchronizedDomainsFromAggregates()),t=this.reader.getFrameCount(),this.rowLoadMoreDataHandler.updateDataView(e.dataViews[0])):(this.reader=void 0,this.lastUpdatedFrameIndex=0,this.axesDomains=void 0,t=1,this.rowLoadMoreDataHandler.updateDataView(void 0)),this.rowLoadMoreDataHandler.onLoadMoreDataCompleted(),this.multipleUpdate=this.updateFactory.create({dataViews:e.dataViews,isSmallMultiples:i,reader:this.reader,requestedPerMultipleAxisDomains:this.requestPerMultipleAxisDomains,updateOptions:e}),this.updateMultiples(t)},e.prototype.updateMultiples=function(e){for(var t,a,i=this,r=this.multiples,o=this.multipleUpdate,s=this.updateOptions.dataViews,n=this.isSmallMultiples(s),l=this.getCoreMultiple(),c=this.requestPerMultipleAxisDomains,u={startIndex:this.lastUpdatedFrameIndex,endIndex:e},d=this,h=u.startIndex;h<u.endIndex;h++)t=h,a=void 0,(a=!(a=n?r[t]:l)&&c?r[t]=p.CartesianSmallMultiple.create(d,t,d.featureSwitches,d.interactivityService,d.layerFactory(),d.type,d.getLayerInitRendererOptions):a)&&o.apply(a,d.type);this.getMultiples(!0).forEach(function(e){e&&(n&&o.applySynchronizedAxes(e,i.axesDomains),o.applyResize(e))}),this.lastUpdatedFrameIndex=u.endIndex},e.prototype.updateSynchronizedDomainsFromAggregates=function(){var e,t=this.getCoreMultiple(),a=t.getCapabilities().axesCapabilities,i=a.categoryAxis,r=a.valueAxis,o=a.secondaryValueAxis,s={categoryAxis:!!(2&i.supportedDomainAggregates),valueAxis:!!(2&r.supportedDomainAggregates),secondaryValueAxis:!!(o&&2&o.supportedDomainAggregates)},i={categoryAxis:!!(1&i.supportedDomainAggregates),valueAxis:!!(1&r.supportedDomainAggregates),secondaryValueAxis:!!(o&&1&o.supportedDomainAggregates)},a=((s.categoryAxis||s.valueAxis||s.secondaryValueAxis)&&(r=this.getTopLevelDomains(a))&&(e={categoryAxis:s.categoryAxis?r.categoryAxis:void 0,valueAxis:s.valueAxis?r.valueAxis:void 0,secondaryValueAxis:s.secondaryValueAxis?r.secondaryValueAxis:void 0}),this.axesDomains=e,null==(o=t.getData())?void 0:o.axesData),s=a&&this.featureSwitches.smallMultiplesUnsharedAxes&&!a.valueAxis.sharedAxis,r={categoryAxis:i.categoryAxis&&(!e||_.isEmpty(e.categoryAxis)),valueAxis:i.valueAxis&&(!e||_.isEmpty(e.valueAxis)||s),secondaryValueAxis:i.secondaryValueAxis&&(!e||_.isEmpty(e.secondaryValueAxis))};return _.every(r,function(e){return!e})?void 0:r},e.prototype.isSmallMultiples=function(e){return!(!e&&!this.updateOptions)&&(e=e||this.updateOptions.dataViews,p.CartesianChart.isSmallMultiples(e,this.featureSwitches.cartesianMultiples))},e.prototype.clearSelection=function(e){this.getMultiples(!0).forEach(function(e){return e.clearSelection()}),this.executeActionForMultiplesInRange(function(e){return e.updateLayers()},e,!1)},e.prototype.checkIfNoLabelsCanBeRendered=function(){return _.every(this.getMultiples(),function(e){return e.isVisible()&&e.getRenderer().noLabelsCanBeRendered})},e.prototype.scrollTo=function(t,e){this.executeActionForMultiplesInRange(function(e){return e.getRenderer().axesRenderer.scrollTo(t)},e,!1)},e.prototype.shouldScrollTo=function(t,e){return!!this.getValueForFirstMultipleInRange(function(e){return e.getRenderer().axesRenderer.shouldScrollTo(t)},e,!1)},e.prototype.scrollBy=function(t,e){this.executeActionForMultiplesInRange(function(e){return e.getRenderer().axesRenderer.scrollBy(t)},e,!1)},e.prototype.scrollDelta=function(t,e){this.executeActionForMultiplesInRange(function(e){return e.getRenderer().axesRenderer.scrollDelta(t)},e,!1)},e.prototype.clearRenderingTimeout=function(){this.getMultiples().forEach(function(e){return e.isVisible()&&e.getRenderer().axesRenderer.clearRenderingTimeout()})},e.prototype.updateScrollbarExtent=function(t,e){this.executeActionForMultiplesInRange(function(e){return e.getRenderer().axesRenderer.setExtent(t)},e,!1)},e.prototype.executeActionForMultiplesInRange=function(t,e,a){a=this.getMultiples(a,e);_.isEmpty(a)||a.forEach(function(e){return t(e)})},e.prototype.getValueForFirstMultipleInRange=function(e,t,a){a=this.getMultiples(a,t);if(!_.isEmpty(a))return e(a[0])},e.prototype.getFrameCount=function(){return this.isSmallMultiples()?this.reader.getFrameCount():1},e.prototype.updateGlobalAxesDomains=function(e){var t=this.axesDomains=this.axesDomains||{};e.categoryAxis&&(t.categoryAxis=p.AxisHelper.mergeDomains(t.categoryAxis||p.DefaultDomain,e.categoryAxis)),e.valueAxis&&(t.valueAxis=p.AxisHelper.mergeDomains(t.valueAxis||p.DefaultDomain,e.valueAxis)),e.secondaryValueAxis&&(t.secondaryValueAxis=p.AxisHelper.mergeDomains(t.secondaryValueAxis||p.DefaultDomain,e.secondaryValueAxis))},e.prototype.getTopLevelDomains=function(e){function t(e){var t,a=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t in e)for(var i=0,r=e[t];i<r.length;i++)!function(e){var t=e.min,e=e.max;if(!(_.isDate(t)||_.isNumber(t)&&isFinite(t))||!(_.isDate(e)||_.isNumber(e)&&isFinite(e)))return;l.isDateWithEpochValue(t)&&l.isDateWithEpochValue(e)&&(t=t.epochTimeStamp,e=e.epochTimeStamp),a=p.AxisHelper.mergeDomains(a,[+t,+e])}(r[i]);return a}var a,i,r,o=this.reader,s=e.categoryAxis,n=e.valueAxis,e=e.secondaryValueAxis;return 2&s.supportedDomainAggregates&&(a=(s=o.getTopLevelAggregates(s.domainAggregateRoles))?t(s):void 0),2&n.supportedDomainAggregates&&(i=(s=o.getTopLevelAggregates(n.domainAggregateRoles))?t(s):void 0),e&&2&e.supportedDomainAggregates&&(r=(n=e&&o.getTopLevelAggregates(e.domainAggregateRoles))?t(n):void 0),a||i||r?{categoryAxis:a,valueAxis:i,secondaryValueAxis:r}:void 0},e.prototype.getMultiples=function(e,t){void 0===e&&(e=!1);var a=[],i=this.isSmallMultiples();return i&&!e||(e=this.getCoreMultiple())&&a.push(e),i&&(e=this.multiples,t&&(e=e.slice(t.startIndex,Math.min(t.endIndex,e.length))),a.push.apply(a,e)),a},p.CartesianSmallMultiples=e}(powerbi=powerbi||{}),function(A){var P=A.visuals||(A.visuals={}),s=P.AxisDataModel.AxesData,g=jsCommon.CssConstants,y=A.visuals.DataViewConcatenateUtil,c=A.data.DataViewRoleWildcard,e=A.visuals.LoadMoreDataStatus,u=A.visuals.OnObjectUtil,S=A.data.Selector,t=(P.INTERACTIVITY_RIGHT_MARGIN=6,P.DefaultDomain=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],P.MultiplesLayoutMinColumns=1,P.MultiplesLayoutMaxColumns=6,P.MultiplesLayoutMinRows=1,P.MultiplesLayoutMaxRows=6,P.MultiplesLayoutMinGridlinesWidth=1,P.MultiplesLayoutMaxGridlinesWidth=12,P.MultiplesSubheaderDefaults=function(){return{FontFamily:P.Font.Family.regular.css,FontPointSize:8,ColorName:"foregroundNeutralSecondary",TextClassName:"title",Vertical:0,Horizontal:0,Show:!0,TitleWrap:!1,bold:!1,italic:!1,underline:!1}},P.CartesianWarningPropertyNames={axisFontSize:"fontSize",axisTitleFontSize:"titleFontSize",legendFontSize:"fontSize"},v.shouldYAxisBeCategorical=function(e){switch(e){case 6:case 5:case 7:return!0}return!1},v.isSmallMultiples=function(e,t){var a;return!!t&&!(_.size(e)<1||(a=null==(t=null==(t=null==(t=null==(t=null==(t=e[0])?void 0:t.matrix)?void 0:t.rows)?void 0:t.levels)?void 0:t[0])?void 0:t.sources,_.size(a)<1)||_.isEmpty(e[0].matrix.rows.root.children))&&_.every(a,function(e){return A.data.DataRoleHelper.hasRole(e,P.cartesianRoleNames.rows)})},v.prototype.init=function(e){var t=this,a=((this.visualInitOptions=e).featureSwitches&&!this.featureSwitches&&(this.featureSwitches=e.featureSwitches),e.element),i=(this.currentViewport=e.viewport,this.hostServices=e.host,this.eventManager=new jsCommon.BubblingEventManager(d3.select(a.get(0))),this.categoryLoadMoreDataHandler=new O(null,this.hostServices,v.LoadMoreThreshold),this.behaviorFactory&&(this.interactivityService=P.createInteractivityService(this.hostServices)),this.tooltipService=P.createTooltipService(e.host),this.visualInitOptions.style),r=A.Prototype.inherit(i),o=(r.colorPalette=A.Prototype.inherit(i.colorPalette),r.colorPalette.dataColors=new I(i.colorPalette.dataColors),this.layerStyle=r,s.createDefault(i)),i=(this.axisZoom=new P.AxisZoom(a,this.hostServices,this.axes.isScrollable&&!!e.interactivity,this.featureSwitches),this.axes.init({axesData:o,axisZoom:this.axisZoom,isYAxisCategorical:v.shouldYAxisBeCategorical(this.type),interactivityService:this.interactivityService}),this.legend=P.createLegend(a,e.interactivity&&e.interactivity.isInteractiveLegend,13!==this.type?this.interactivityService:void 0,this.axes.isScrollable,void 0,i,this.hostServices),A.Prototype.inherit(e));i.style=r,i.chartType=this.type,i.services={tooltips:this.tooltipService},this.multiples.init(i,this.interactivityService),this.layoutBuilder.init(e,this.tooltipService,this.legend,o,this.interactivityService,this.layerStyle,this.multiples.rowLoadMoreDataHandler,this.eventManager),this.layout=this.layoutBuilder.create(this.visualInitOptions.element),this.isMobileChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.featureSwitches.onObject&&(o=null!=(i=null==(r=this.hostServices)?void 0:r.getSubSelectionService())?i:P.SubSelectionRegionOutlineRenderer.createWithDefaultHost(),this.subSelectionHelper=P.HtmlSubSelectionHelper.createHtmlSubselectionHelper({hostElement:a.get(0),hostServices:this.hostServices,renderer:o,selectorCallback:function(e){return t.getSelectorsByColumnSubSelection(e)},customOutlineCallback:function(e){return t.getSubSelectionCustomOutlines(e)},customElementCallback:function(e){return t.getSubSelectionCustomElements(e)},subSelectionMetadataCallback:function(e){return t.getSubSelectionMetadata(e)}}),this.interactivityService.setSubSelectionHelper(this.subSelectionHelper))},v.prototype.isPlayAxis=function(){var e;return!(!this.dataViews||!this.dataViews[0])&&(e=this.dataViews[0],10===this.type)&&(this.hasAnimator||this.isMobileChart)&&A.data.DataRoleHelper.hasRoleInDataView(e,"Play")},v.prototype.hasBreakdownRole=function(){var e;return!(!this.dataViews||!this.dataViews[0])&&(e=this.dataViews[0],13===this.type)&&A.data.DataRoleHelper.hasRoleInDataView(e,"Breakdown")},v.getDataBoundReferenceLines=function(e,t,a){var i=[],r=[];if(e)if(e.matrix&&e.matrix.valueSources){var o=e.matrix;if(o.valueSources&&r.push.apply(r,e.matrix.valueSources||[]),o.rows&&o.rows.levels)for(var s=0,n=o.rows.levels;s<n.length;s++){var l=n[s];r.push.apply(r,l.sources||[])}}else if(e.categorical&&e.categorical.values){o=_.head(e.categorical.values.grouped());if(o)for(var c=0,u=o.values;c<u.length;c++){var d=u[c];r.push(d.source)}}for(var h=0;h<r.length;h++){var p=r[h],g=P.ColorHelper.getDataColorByIndex(a,h,P.ForegroundColorName),y=A.DataViewObjects.getUserDefinedObjects(p.objects,"referenceLine"),m=v.getCartesianRoleKind(p,t);i.push.apply(i,P.ReferenceLineHelper.readDataView(y,g,"referenceLine",m,a,void 0,p)||[])}return i},v.getCartesianRoleKind=function(e,t){var a=e.roles;if(t.getAxisLocationForRole&&a)for(var i in a)if(a[i])return t.getAxisLocationForRole(i);return 1},v.converter=function(e){return(new P.CartesianChartConverter).convert(e)},v.prototype.updateInternal=function(p,g){return __awaiter(this,void 0,A.Promise,function(){var t,a,i,r,o,s,n,l,c,u,d,h;return __generator(this,function(e){switch(e.label){case 0:return(t=this.dataViews=p.dataViews,h=this.featureSwitches.onObject&&p.formatMode,a=p.operationKind===A.VisualDataChangeOperationKind.Append||null!=p.resizeMode||h,this.currentViewport=p.viewport,t)?(d=this.layerFactory.layerMetadata,u=_.some(d,function(e){return!!e.categoryAxisTitleOnByDefault}),d=_.some(d,function(e){return!!e.valueAxisTitleOnByDefault}),r=this.multiples.isSmallMultiples(t),(c=r&&t[0])?(l=c.metadata.objects,o=this.layerStyle,n=v.getMultiplesLayout(l,o),l=v.getMultiplesSubheader(l,o),o=n.columnCount,s=n.rowCount,this.viewModelAdapterFactory.setSmallMultiplesOptions({viewport:this.currentViewport,isSmallMultiples:r,columns:o,rows:s}),this.smallMultiplesViewModelAdapter=this.viewModelAdapterFactory.createSmallMultiplesAdapter({dataView:c,multiplesLayout:n,multiplesSubheader:l,viewport:this.currentViewport})):(this.viewModelAdapterFactory.setSmallMultiplesOptions({viewport:this.currentViewport,isSmallMultiples:r,columns:void 0,rows:void 0}),this.smallMultiplesViewModelAdapter=void 0),r!==this.multiples.isSmallMultiples()&&this.multiples.clear(),null!=g?(o=this.multiples.getCoreMultiple(),s=o.layers,_.isEmpty(t)||(c=v.getLayerDataViews(t),this.cartesianVisualCapabilities=v.getCartesianVisualCapabilities(s),r&&this.cartesianVisualCapabilities&&(this.cartesianVisualCapabilities.supportsHierarchicalCategoryAxis=!1),2===(i=this.categoryAxisRenderMode=v.getRenderMode(c,this.cartesianVisualCapabilities,this.featureSwitches.easierHierarchicalAxis))&&(t=t.map(function(e){return y.concatenateCategories(e,P.columnChartProps.general.formatString,P.cartesianRoleNames.category)}))),this.multiples.update({dataViews:t,operationKind:g,categoryAxisTitleOnByDefault:u,valueAxisTitleOnByDefault:d,viewport:this.currentViewport,adapterFactory:this.viewModelAdapterFactory,preserveScrollPosition:a,formatMode:h}),this.cartesianData=this.originalCartesianData=o.getData()):(this.multiples.resize(this.currentViewport),this.cartesianData=this.multiples.getCoreMultiple().getData()),null==g&&this.cartesianData&&this.cartesianData.axesData?this.axes.updateResize(this.cartesianData.axesData,this.cartesianData.scrollbarOptions.scrollbarWidth):null!=g&&(_.isEmpty(t)||((n=t[0]).metadata&&(this.background={image:A.DataViewObjects.getValue(n.metadata.objects,P.scatterChartProps.plotArea.image),transparency:A.DataViewObjects.getValue(n.metadata.objects,P.scatterChartProps.plotArea.transparency,P.visualBackgroundHelper.getDefaultTransparency())}),this.categoryLoadMoreDataHandler.update(i,r),this.axes.update(n.categorical?n.categorical.categories:null,this.cartesianData.axesData,i,this.cartesianData.scrollbarOptions.scrollbarWidth)),this.categoryLoadMoreDataHandler.onLoadMoreDataCompleted()),this.cartesianData&&this.cartesianData.zoomData&&this.axisZoom.update({dataViews:t,zoomData:this.cartesianData.zoomData,hasSmallMultiples:r,hasScalarCategoryAxis:this.categoryAxisIsScalar().isScalar,hasYAxisCategorical:this.axes.isYAxisCategorical}),l=!this.hasSetData||p.suppressAnimations||r,[4,this.render(l,a,p.resizeMode)]):[2];case 1:return e.sent(),this.hasSetData=this.hasSetData||!_.isEmpty(t),this.updateWarnings(this.cartesianData.warningObjectCollection),c=p.type&A.VisualUpdateType.Data||p.type&A.VisualUpdateType.ResizeEnd||p.type&A.VisualUpdateType.FormattingSubSelectionChange,u=p.type&A.VisualUpdateType.FormattingSubSelectionChange,this.subSelectionHelper&&c&&(this.subSelectionHelper.updateOutlinesFromSubSelections(p.subSelections,!0),this.hostServices.alertScreenReader)&&u&&(d=this.subSelectionHelper.getLabelsFromSubSelections(p.subSelections,["aria-label"]),h=(null==d?void 0:d.length)&&d.join(" "))&&this.hostServices.alertScreenReader(h),[2]}})})},v.getMultiplesLayout=function(e,t){var e=A.DataViewObjects.getObject(e,P.SmallMultiplesUtils.LayoutObjectName),a=e,i=v.getLayoutDefaults(t),t=P.ColorHelper.create(t),r=(a&&a.layoutType)===P.smallMultiplesLayout.auto?{layoutType:0,rowCount:i.rowCount,columnCount:i.columnCount}:{layoutType:1,rowCount:a&&a.rowCount||i.rowCount,columnCount:a&&a.columnCount||i.columnCount};return r.backgroundColor=t.getColorForPropertyNameWithDefaultColor(e,P.StandardObjectPropertyIdentifiers.smallMultiplesBackgroundColor.propertyName,i.backgroundColor,!0),r.backgroundTransparency=(a&&void 0!==a.backgroundTransparency?a:i).backgroundTransparency,r.gridLineType=a&&a.gridLineType||i.gridLineType,r.gridLineStyle=a&&a.gridLineStyle||i.gridLineStyle,r.gridLineColor=t.getColorForPropertyNameWithDefaultColor(e,P.StandardObjectPropertyIdentifiers.smallMultiplesGridLineColor.propertyName,i.gridLineColor),r.gridLineWidth=(a&&void 0!==a.gridLineWidth?a:i).gridLineWidth,v.applyPadding(r,a,i),r},v.getLayoutDefaults=function(e){var t={layoutType:0,rowCount:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultRowCount,columnCount:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultColumnCount,backgroundColor:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultBackgroundColor,backgroundTransparency:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultBackgroundTransparency,gridLineType:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultGridLineType,gridLineStyle:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultGridLineStyle,gridLineWidth:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultGridLineWidth,gridPadding:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding,advancedPaddingOptions:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultAdvancedPaddingOptions,columnPaddingInner:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding,columnPaddingOuter:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding,rowPaddingInner:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding,rowPaddingOuter:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding};return t.gridLineColor=P.ColorHelper.getThemeColor(e,P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultGridLineColorName),t},v.getCartesianVisualCapabilities=function(e){for(var t,a=0,i=e.length;a<i;a++){var r=e[a].getCartesianVisualCapabilities();t?t.supportsHierarchicalCategoryAxis=t.supportsHierarchicalCategoryAxis&&r.supportsHierarchicalCategoryAxis:t=A.Prototype.inherit(r)}return t},v.getRenderMode=function(e,t,a){for(var i=0,r=e;i<r.length;i++){var o,s=r[i];null!=s&&(s=new d(s,null==t?void 0:t.supportsHierarchicalCategoryAxis,a).getRenderModes(),o=o?_.intersection(o,s):s)}return _.head(o)},v.getCategoryValueType=function(e){e=_.find(e,function(e){return e.getCategoryValueType});if(e)return e.getCategoryValueType()},v.applyPadding=function(e,t,a){e.gridPadding=(t&&void 0!==t.gridPadding?t:a).gridPadding,e.advancedPaddingOptions=(t&&void 0!==t.advancedPaddingOptions?t:a).advancedPaddingOptions;var i=t&&t.advancedPaddingOptions,r={gridPadding:e.gridPadding,gridLineSettings:e.gridLineType};i&&void 0!==t.columnPaddingInner?e.columnPaddingInner=t.columnPaddingInner:e.columnPaddingInner=v.getPaddingFromGridPaddingAndDefaults(r,1),i&&void 0!==t.columnPaddingOuter?e.columnPaddingOuter=t.columnPaddingOuter:(r.defaultPadding=a.columnPaddingOuter,e.columnPaddingOuter=v.getPaddingFromGridPaddingAndDefaults(r,0)),i&&void 0!==t.rowPaddingInner?e.rowPaddingInner=t.rowPaddingInner:e.rowPaddingInner=v.getPaddingFromGridPaddingAndDefaults(r,2),i&&void 0!==t.rowPaddingOuter?e.rowPaddingOuter=t.rowPaddingOuter:(r.defaultPadding=a.rowPaddingOuter,e.rowPaddingOuter=v.getPaddingFromGridPaddingAndDefaults(r,0))},v.getPaddingFromGridPaddingAndDefaults=function(e,t){var a=e.gridPadding,i=e.gridLineSettings,r=e.defaultPadding;switch(t){case 0:return P.GridLayout.typeHasOuterGridLines(i)?a:r;case 1:return P.GridLayout.typeHasVerticalGridLines(i)?a:v.floatSafeHalf(a);case 2:return P.GridLayout.typeHasHorizontalGridLines(i)?a:v.floatSafeHalf(a)}},v.floatSafeHalf=function(e){return e%2==0?e/2:Math.ceil(e/2)},v.prototype.isSmallMultiples=function(){return v.isSmallMultiples(this.dataViews,this.featureSwitches.cartesianMultiples)},v.prototype.showLayoutCard=function(){return this.isSmallMultiples()},v.prototype.supportsResponsive=function(){return this.featureSwitches.smallMultiplesResponsive||!this.isSmallMultiples()},v.prototype.enumerateLayout=function(e){var t,a;this.showLayoutCard()&&(t={selector:null,properties:{},validValues:{rowCount:{numberRange:{min:P.MultiplesLayoutMinRows,max:P.MultiplesLayoutMaxRows}},columnCount:{numberRange:{min:P.MultiplesLayoutMinColumns,max:P.MultiplesLayoutMaxColumns}}},objectName:P.SmallMultiplesUtils.LayoutObjectName},0===(a=v.getMultiplesLayout(this.dataViews[0].metadata.objects,this.layerStyle)).layoutType?t.properties.layoutType=P.smallMultiplesLayout.auto:(t.properties.rowCount=a.rowCount,t.properties.columnCount=a.columnCount),e.pushInstance(t),t={selector:{data:[c.fromRoles([P.cartesianRoleNames.rows])]},properties:{backgroundColor:a.backgroundColor},propertyInstanceKind:{backgroundColor:3},altConstantValueSelector:null,objectName:P.SmallMultiplesUtils.LayoutObjectName},e.pushInstance(t,!1),t={selector:null,properties:{backgroundTransparency:a.backgroundTransparency,gridLineType:a.gridLineType},validValues:{gridLineWidth:{numberRange:{min:P.MultiplesLayoutMinGridlinesWidth,max:P.MultiplesLayoutMaxGridlinesWidth}}},objectName:P.SmallMultiplesUtils.LayoutObjectName},a.gridLineType!==P.gridLineType.none&&(t.properties.gridLineColor=a.gridLineColor,t.properties.gridLineWidth=a.gridLineWidth,t.properties.gridLineStyle=a.gridLineStyle),a.advancedPaddingOptions||(t.properties.gridPadding=a.gridPadding),t.properties.advancedPaddingOptions=a.advancedPaddingOptions,a.advancedPaddingOptions&&(t.properties.columnPaddingInner=a.columnPaddingInner,t.properties.columnPaddingOuter=a.columnPaddingOuter,t.properties.rowPaddingInner=a.rowPaddingInner,t.properties.rowPaddingOuter=a.rowPaddingOuter),e.pushInstance(t,!1))},v.prototype.showSmallMultiplesCard=function(){return this.isSmallMultiples()},v.prototype.getSmallMultiplesCard=function(){var i,r,o,e,s,n,l=this;if(10!==this.type&&13!==this.type)return i=function(e){return l.hostServices.getLocalizedString(e)},r=P.StandardObjectIdentifiers.smallMultiplesLayout,o=P.StandardObjectIdentifiers.subheader,e=new P.builder.FormattingCardBuilder(new P.builder.FormattingCardUidBuilder("smallMultiples"),"Role_DisplayName_SmallMultiples",[r.rowCount,r.columnCount,r.gridPadding,r.advancedPaddingOptions,r.columnPaddingInner,r.columnPaddingOuter,r.rowPaddingInner,r.rowPaddingOuter,r.gridLineType,r.gridLineStyle,r.gridLineColor,r.gridLineWidth,r.backgroundColor,r.backgroundTransparency,o.show,o.fontFamily,o.fontSize,o.fontColor,o.underline,o.bold,o.italic,o.position,o.alignment,o.titleWrap],i),this.showSmallMultiplesCard()?(s=v.getMultiplesLayout(this.dataViews[0].metadata.objects,this.layerStyle),n=v.getMultiplesSubheader(this.dataViews[0].metadata.objects,this.layerStyle),e.withDescription("Small_Multiples_Layout_Description").addGroup("layout",function(e){e.withDisplayName("Small_Multiples_LayoutGroup").addSimpleSlice("rowCount",new P.builder.NumUpDownBuilder({descriptor:r.rowCount,value:s.rowCount,options:{minValue:{type:0,value:P.MultiplesLayoutMinRows},maxValue:{type:1,value:P.MultiplesLayoutMaxRows}}}).build()).addSimpleSlice("columnCount",new P.builder.NumUpDownBuilder({descriptor:r.columnCount,value:s.columnCount,options:{minValue:{type:0,value:P.MultiplesLayoutMinColumns},maxValue:{type:1,value:P.MultiplesLayoutMaxColumns}}}).build());var t=s.advancedPaddingOptions,a={minValue:{type:0,value:0},maxValue:{type:1,value:40}};e.addSimpleSlice("gridPadding",new P.builder.NumUpDownBuilder({descriptor:r.gridPadding,value:s.gridPadding,options:a}).build(),function(e){return e.withDisabled(t).withCustomDisplayName("Small_Multiples_All_Padding")}).addSimpleSlice("advancedPadding",new P.builder.ToggleSwitchBuilder({descriptor:r.advancedPaddingOptions,value:s.advancedPaddingOptions}).build(),function(e){return e.withCustomDisplayName("Small_Multiples_Customize_Padding")}),t&&e.addSimpleSlice("columnPaddingInner",new P.builder.SliderBuilder({descriptor:r.columnPaddingInner,value:s.columnPaddingInner,options:a,localize:i}).build()).addSimpleSlice("columnPaddingOuter",new P.builder.SliderBuilder({descriptor:r.columnPaddingOuter,value:s.columnPaddingOuter,options:a,localize:i}).build()).addSimpleSlice("rowPaddingInner",new P.builder.SliderBuilder({descriptor:r.rowPaddingInner,value:s.rowPaddingInner,options:a,localize:i}).build()).addSimpleSlice("rowPaddingOuter",new P.builder.SliderBuilder({descriptor:r.rowPaddingOuter,value:s.rowPaddingOuter,options:a,localize:i}).build())}),e.addGroup("border",function(e){var t=s.gridLineType!==P.gridLineType.none;e.withDisplayName("Visual_Border").addSimpleSlice("gridLineType",new P.builder.DropdownBuilder({descriptor:r.gridLineType,value:s.gridLineType}).build()).addSimpleSlice("gridLineStyle",new P.builder.DropdownBuilder({descriptor:r.gridLineStyle,value:s.gridLineStyle}).build(),function(e){return e.withDisabled(!t)}).addSimpleSlice("gridLineColor",new P.builder.ColorPickerBuilder({descriptor:r.gridLineColor,value:{value:s.gridLineColor}}).build(),function(e){return e.withDisabled(!t)}).addSimpleSlice("gridLineWidth",new P.builder.NumUpDownBuilder({descriptor:r.gridLineWidth,value:s.gridLineWidth,options:{minValue:{type:0,value:P.MultiplesLayoutMinGridlinesWidth},maxValue:{type:1,value:P.MultiplesLayoutMaxGridlinesWidth}}}).build(),function(e){return e.withDisabled(!t)})}),e.addGroup("title",function(e){e.withDisplayName("Title"),l.featureSwitches.smallMultiplesResponsive&&e.addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:o.show,value:!!l.showSubheaderCard()&&n.show}).build()});var t=n.fontProperties,a=(new P.builder.FontControlBuilder).withFontFamily({descriptor:o.fontFamily,value:t.family}).withFontSizeProperties({descriptor:o.fontSize,value:t.size.pt}),a=(l.featureSwitches.enableBIU&&a.withBold({descriptor:o.bold,value:n.labelBold}).withItalic({descriptor:o.italic,value:n.labelItalic}).withUnderline({descriptor:o.underline,value:n.labelUnderline}),a.build());e.addSimpleSlice("position",function(){var e;switch(n.vertical){default:case 0:e=P.verticalPosition.top;break;case 1:e=P.verticalPosition.bottom}return new P.builder.DropdownBuilder({descriptor:o.position,value:e}).build()}).addCompositeSlice("font","Font",a).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},o.fontColor),{instanceKind:3,selector:{data:[c.fromRoles([P.cartesianRoleNames.rows])]},altConstantValueSelector:null}),value:{value:t.color}}).build()).addSimpleSlice("alignment",function(){var e;switch(n.horizontal){default:case 0:e=P.horizontalPosition.left;break;case 1:e=P.horizontalPosition.center;break;case 2:e=P.horizontalPosition.right}return new P.builder.AlignmentGroupBuilder({descriptor:o.alignment,value:e,mode:"horizontalAlignment"}).build()}),l.featureSwitches.smallMultiplesSubheaderFormatting&&e.addSimpleSlice("titleWrap",new P.builder.ToggleSwitchBuilder({descriptor:o.titleWrap,value:n.titleWrap}).build(),function(e){return e.withCustomDisplayName("TextWrap")})}),e.addGroup("background",function(e){e.withDisplayName("Visual_Background").addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},r.backgroundColor),{selector:{data:[c.fromRoles([P.cartesianRoleNames.rows])]},altConstantValueSelector:null,instanceKind:3}),value:{value:s.backgroundColor},isNoFillItemSupported:!0}).build(),function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("transparency",P.builder.SliderBuilder.getTransparencySliderBuilder({descriptor:r.backgroundTransparency,value:s.backgroundTransparency,localize:i}).build(),function(e){return e.withCustomDisplayName("Transparency")})})):e.withDisabled(!0,"Visual_SmallMultipleCard_DisabledReason"),e.build()},v.getMultiplesSubheader=function(e,t){var e=A.DataViewObjects.getObject(e,"subheader"),a=P.MultiplesSubheaderDefaults(),i=P.ColorHelper.create(t),i=P.FontProperties.createFromObjectOrStyle(e,{family:"fontFamily",size:"fontSize",color:"fontColor",bold:"bold",italic:"italic",underline:"underline"},i,t,a.ColorName,a.TextClassName,{color:P.ColorHelper.getThemeColor(t,a.ColorName),size:P.Units.FontSize.createFromPt(a.FontPointSize),family:a.FontFamily,weight:g.normalValue,style:g.normalValue,textDecoration:g.noneValue}),t={top:0,bottom:2,left:5,right:0},r=i.size.px+t.top+t.bottom,o=a.Vertical,s=a.Horizontal,n=a.TitleWrap,a=a.Show,l=!1,c=!1,u=!1;if(e){switch(e.position){case P.verticalPosition.top:o=0;break;case P.verticalPosition.bottom:o=1}switch(e.alignment){case P.horizontalPosition.left:s=0;break;case P.horizontalPosition.center:s=1;break;case P.horizontalPosition.right:s=2}n=e.titleWrap,void 0!==e.show&&(a=e.show),void 0!==e.bold&&(l=e.bold),void 0!==e.italic&&(c=e.italic),void 0!==e.underline&&(u=e.underline)}return{fontProperties:i,show:a,height:r,margins:t,vertical:o,horizontal:s,titleWrap:n,labelBold:l,labelItalic:c,labelUnderline:u}},v.prototype.showSubheaderCard=function(){return this.isSmallMultiples()},v.prototype.enumerateSubheader=function(e){if(this.showSubheaderCard()){var t,a,i=v.getMultiplesSubheader(this.dataViews[0].metadata.objects,this.layerStyle);switch(i.horizontal){default:case 0:t=P.horizontalPosition.left;break;case 1:t=P.horizontalPosition.center;break;case 2:t=P.horizontalPosition.right}switch(i.vertical){default:case 0:a=P.verticalPosition.top;break;case 1:a=P.verticalPosition.bottom}var r={objectName:P.SmallMultiplesUtils.SubheaderObjectName,selector:null,properties:{}};this.featureSwitches.smallMultiplesResponsive&&(r.properties.show=i.show),r.properties.fontFamily=i.fontProperties.family,r.properties.fontSize=i.fontProperties.size.pt,e.pushInstance(r),r={objectName:P.SmallMultiplesUtils.SubheaderObjectName,selector:{data:[c.fromRoles([P.cartesianRoleNames.rows])]},properties:{fontColor:i.fontProperties.color},propertyInstanceKind:{fontColor:3},altConstantValueSelector:null},e.pushInstance(r,!1),r={objectName:P.SmallMultiplesUtils.SubheaderObjectName,selector:null,properties:{alignment:t,position:a}},this.featureSwitches.smallMultiplesSubheaderFormatting&&(r.properties.titleWrap=i.titleWrap),e.pushInstance(r,!1)}},v.getLayerDataViews=function(e){return _.isEmpty(e)?[]:_.filter(e,function(e){return!P.TrendLineHelper.isDataViewForRegression(e)&&!P.ForecastHelper.isDataViewForForecast(e)&&!P.AnomalyDetectionVisualPlugin.isDataViewForAnomalyDetection(e)})},v.prototype.render=function(t,a,i){return __awaiter(this,void 0,A.Promise,function(){return __generator(this,function(e){return[2,this.layout.render(this.multiples,this.currentViewport,this.categoryLoadMoreDataHandler,this.background,this.axisZoom,this.trimOrdinalDataOnOverflow,t,3===this.categoryAxisRenderMode,a,this.formatMode,this.subSelectionHelper,i)]})})},v.prototype.updateWarnings=function(e){if(!_.isEmpty(this.dataViews)){var t=this.dataViews,a=P.getInvalidValueWarnings(t,!1,!1,!1,["Tooltips"],!0);if(_.isEmpty(a)||e.add.apply(e,a||[]),this.axes.addWarnings(e),this.multiples.checkIfNoLabelsCanBeRendered()){var a={selector:null,warnings:[new P.DataLabelsNotRenderedWarning]};e.addForVisualObject("labels",a)}else{e.removeForVisualObject("labels");for(var i=0,r=null==(a=this.multiples.getCoreMultiple())?void 0:a.layers;i<r.length;i++){var o=r[i];o.addWarnings&&o.addWarnings(e)}}for(var s=[],n=null==(a=this.cartesianVisualCapabilities)?void 0:a.supportsHierarchicalCategoryAxis,l=0,c=t;l<c.length;l++){var u=c[l];new d(u,n,this.featureSwitches.easierHierarchicalAxis).addObjectWarnings(s)}_.isEmpty(s)||(a=this.cartesianData.warningObjectCollection).addForVisualObject.apply(a,__spreadArray(["categoryAxis"],s,!1)),this.hostServices.setWarnings(this.cartesianData.warningObjectCollection.complete())}},v.prototype.update=function(a){return __awaiter(this,void 0,A.Promise,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.featureSwitches.onObject&&(t=this.multiples.isSmallMultiples(a.dataViews),this.formatMode&&t&&(this.subSelectionHelper.setFormatMode(!1),this.interactivityService.setFormatMode(!1),this.formatMode=!1),a.formatMode===this.formatMode||t||(this.subSelectionHelper.setFormatMode(a.formatMode),this.interactivityService.setFormatMode(a.formatMode),this.formatMode=a.formatMode)),null==a.resizeMode?[3,2]:[4,this.updateInternal(a)];case 1:return e.sent(),[3,4];case 2:return[4,this.updateInternal(a,null!=a.operationKind?a.operationKind:A.VisualDataChangeOperationKind.Create)];case 3:e.sent(),e.label=4;case 4:return[2]}})})},v.prototype.destroy=function(){this.multiples&&this.multiples.clear(),this.layout&&this.layout.destroy(),this.axisZoom&&(this.axisZoom.destroy(),this.axisZoom=void 0)},v.prototype.onViewModeChanged=function(e){this.layout.viewMode=e},v.prototype.scrollTo=function(e){var t=this.layout.getVisibleMultiples();this.multiples.scrollTo(e,t)},v.prototype.scrollRowsTo=function(e){this.layout.scrollRowsTo(e)},v.prototype.enumerateObjectInstances=function(e){var t=new P.ObjectEnumerationBuilder,a=this.getLayers();if(e.objectName===P.SmallMultiplesUtils.LayoutObjectName)this.enumerateLayout(t);else if("subheader"===e.objectName)this.enumerateSubheader(t);else if("legend"===e.objectName){if(!this.shouldShowLegendCard())return;for(var i={enumeration:t,legendData:this.originalCartesianData.legendData},r=0,o=a;r<o.length;r++)(s=o[r]).enumerateCustomLegend?s.enumerateCustomLegend(i):P.Legend.enumerate(i,this.featureSwitches)}else"categoryAxis"===e.objectName&&this.axes.hasCategoryAxis()?this.enumerateCategoryAxis(t):"valueAxis"===e.objectName?this.enumerateValueAxis(t):"y2Axis"===e.objectName?this.enumerateValueAxis(t,"y2Axis"):e.objectName===P.ReferenceLineHelper.xAxisRefLineObjectName?(c=this.categoryAxisIsScalar().isScalar,P.CartesianChartConverter.supportsStaticReferenceLines(this.dataViews,a)&&c&&(0===this.type&&this.featureSwitches.lineChartVerticalReferenceLine||0!==this.type&&this.featureSwitches.xAxisRefLineImprovements)&&(c=v.getCategoryValueType(a),this.enumerateReferenceLines(t,e.objectName,c))):e.objectName===P.ReferenceLineHelper.y1AxisRefLineObjectName?this.enumerateReferenceLines(t,e.objectName):"referenceLine"===e.objectName?P.CartesianChartConverter.supportsDataBoundReferenceLines(this.dataViews,a)&&this.enumerateReferenceLines(t,e.objectName):"trend"===e.objectName?P.CartesianChartConverter.supportsTrendLines(this.dataViews,a)&&P.TrendLineHelper.enumerateObjectInstances(t,this.originalCartesianData.trendLines,this.layerStyle):"plotArea"===e.objectName?P.visualBackgroundHelper.enumeratePlot(t,this.background):"zoom"===e.objectName&&this.axisZoom.enumerateObjectInstances(t);if("dataPoint"===e.objectName&&P.ComboChart.isComboChart(this.type))P.ComboChart.enumerateDataPoints(t,e,a);else for(var s,n=0,l=a;n<l.length;n++)(s=l[n]).enumerateObjectInstances&&s.enumerateObjectInstances(t,e);var c=this.supportsResponsive();return this.dataViews&&this.dataViews[0]&&(a=this.dataViews[0],this.viewModelAdapterFactory)&&this.viewModelAdapterFactory.createCartesianAdapter({cartesianData:void 0,dataView:a,viewport:void 0,isCoreMultiple:void 0}).enumerateObjectInstances(e,t,c),this.smallMultiplesViewModelAdapter&&this.smallMultiplesViewModelAdapter.enumerateObjectInstances(e,t,c),t.complete()},v.prototype.getSelectorsByColumnSubSelection=function(e){for(var t=0,a=this.getLayers();t<a.length;t++){var i=a[t];if(i.getSelectorsByColumnFromSubselectedElement){i=i.getSelectorsByColumnFromSubselectedElement(e);if(i)return i}}return{}},v.prototype.getSubSelectionCustomOutlines=function(e){for(var t=0,a=this.getLayers();t<a.length;t++){var i=a[t];if(i.getSubSelectionCustomOutlines){i=i.getSubSelectionCustomOutlines(e);if(i)return i}}return[]},v.prototype.getSubSelectionCustomElements=function(e){for(var t=0,a=this.getLayers();t<a.length;t++){var i=a[t];if(i.getSubSelectionCustomElements){i=i.getSubSelectionCustomElements(e);if(i)return i}}return[]},v.prototype.getSubSelectionMetadata=function(e){for(var t=0,a=this.getLayers();t<a.length;t++){var i=a[t];if(i.getSubSelectionMetadata){i=i.getSubSelectionMetadata(e);if(i)return i}}return null},v.prototype.getSubSelectionStyles=function(e){if(this.featureSwitches.onObject){var t,a=_.first(e).visualObjects;if(0<a.length){null!=(a=a[0])&&a.selectorsByColumn&&(t=S.normalizeSelector(S.convertSelectorsByColumnToSelector(a.selectorsByColumn)));var i=1===this.getLayers().length&&this.cartesianData.legendData.dataPoints.length<=1;switch(a.objectName){case"legend-title":return P.Legend.getLegendTitleSubSelectionStyles();case"x-axis-zoom-slider":case"y1-axis-zoom-slider":case"y2-axis-zoom-slider":return;case"legend-items":return P.Legend.getLegendItemsSubSelectionStyles(this.hostServices);case"horizontal-gridlines":var r="".concat("Visual","-").concat("gridlines"),o="".concat("gridlines","-").concat("horizontal");return u.getShapeSubSelectionStyles(r,o,"".concat(o,"-color"),this.hostServices,!0);case"vertical-gridlines":r="".concat("Visual","-").concat("gridlines"),o="".concat("gridlines","-").concat("vertical");return u.getShapeSubSelectionStyles(r,o,"".concat(o,"-color"),this.hostServices,!0);case"series-labels":var r="".concat("Visual","-").concat("seriesLabels"),o="".concat("seriesLabels-applySettingsTo-series","--").concat("values"),s="".concat("seriesLabels-applySettingsTo-series","--").concat("background");return u.getFontOnlyTextSubSelectionStyles(this.hostServices,{fontReference:{cardUid:r,groupUid:i?void 0:o,sliceUid:"".concat(o,"-font")},fontColorReference:{cardUid:r,groupUid:i?void 0:o,sliceUid:"".concat(o,"-seriesColor")},backgroundReference:{cardUid:r,groupUid:i?void 0:s,sliceUid:"".concat(s,"-backgroundColor")}},i?void 0:t);case"x-axis-title":return P.CartesianChartOnObjectUtil.getAxisTitleSubSelectionStyles(!1,!this.axes.isYAxisCategorical,this.hostServices);case"y1-axis-title":return P.CartesianChartOnObjectUtil.getAxisTitleSubSelectionStyles(!1,this.axes.isYAxisCategorical,this.hostServices);case"y2-axis-title":return P.CartesianChartOnObjectUtil.getAxisTitleSubSelectionStyles(!0,this.axes.isYAxisCategorical,this.hostServices);case"x-axis-values":return P.CartesianChartOnObjectUtil.getAxisValuesSubSelectionStyles(!1,!this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);case"y1-axis-values":return P.CartesianChartOnObjectUtil.getAxisValuesSubSelectionStyles(!1,this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);case"y2-axis-values":return P.CartesianChartOnObjectUtil.getAxisValuesSubSelectionStyles(!0,this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);default:for(var n=0,l=this.getLayers();n<l.length;n++){var c=l[n];if(c.getSubSelectionStyles){c=c.getSubSelectionStyles(e);if(c)return c}}}}}},v.prototype.getSubSelectionShortcuts=function(e,t){if(this.featureSwitches.onObject&&!t){var a=_.first(e).visualObjects;if(0<a.length){var i,r=a[0],o=this.getLayers(),s=o.length<=1&&this.cartesianData.legendData.dataPoints.length<=1,n={key:"Delete",nextValue:!1};switch(s||_.isEmpty(r.selectorsByColumn)||(i=S.normalizeSelector(S.convertSelectorsByColumnToSelector(r.selectorsByColumn))),r.objectName){case"legend-title":return P.Legend.getLegendTitleShortcuts(this.hostServices);case"legend-items":return P.Legend.getLegendItemsShortcuts({hostServices:this.hostServices,showSort:!0});case"data-labels":var l=s?"".concat("Visual","-").concat("labels"):"".concat("labels-applySettingsTo-series","--showSeries"),c={sourceUid:"".concat("labels","-").concat("applySettingsTo","-series--background-enableBackground"),selector:i};return[{type:2,sourceUid:l,disabledLabel:this.hostServices.getLocalizedString("Delete"),selector:i,keyboardShortcuts:[n]},{type:0,excludedResetSourceUids:[{sourceUid:l,selector:i}],relatedResetSourceUids:[c]},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("labels")}],label:this.hostServices.getLocalizedString("Format_Data_Labels")}];case"horizontal-gridlines":l="".concat("gridlines","-").concat("horizontal");return[{type:2,sourceUid:l,disabledLabel:this.hostServices.getLocalizedString("Delete"),keyboardShortcuts:[n]},{type:0},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("gridlines"),groupUid:l}],label:this.hostServices.getLocalizedString("Format_Gridlines")}];case"vertical-gridlines":c="".concat("gridlines","-").concat("vertical");return[{type:2,sourceUid:c,disabledLabel:this.hostServices.getLocalizedString("Delete"),keyboardShortcuts:[n]},{type:0},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("gridlines"),groupUid:c}],label:this.hostServices.getLocalizedString("Format_Gridlines")}];case"series-labels":l=s?"".concat("Visual","-").concat("seriesLabels"):"".concat("seriesLabels","-").concat("applySettingsTo","-series--showSeries");return[{type:2,sourceUid:l,disabledLabel:this.hostServices.getLocalizedString("Delete"),selector:i,keyboardShortcuts:[n]},{type:0,relatedResetSourceUids:[{sourceUid:"".concat("seriesLabels","-").concat("applySettingsTo","-series--").concat("background","-enableBackground"),selector:i}],excludedResetSourceUids:[{sourceUid:l,selector:i}]},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("seriesLabels")}],label:this.hostServices.getLocalizedString("Format_Series_Labels")}];case"total-labels":c="".concat("Visual","-").concat("totals"),l="".concat("totals","-").concat("values");return[{type:2,sourceUid:c,disabledLabel:this.hostServices.getLocalizedString("Delete"),keyboardShortcuts:[n]},{type:0,excludedResetSourceUids:[{sourceUid:c}]},{type:1,destinationUids:[{cardUid:c,groupUid:l}],label:this.hostServices.getLocalizedString("Format_Total_Labels")}];case"x-axis-title":return P.CartesianChartOnObjectUtil.getAxisTitleSubSelectionShortcuts(!1,!this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);case"y1-axis-title":return P.CartesianChartOnObjectUtil.getAxisTitleSubSelectionShortcuts(!1,this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);case"y2-axis-title":return P.CartesianChartOnObjectUtil.getAxisTitleSubSelectionShortcuts(!0,this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);case"x-axis-values":return P.CartesianChartOnObjectUtil.getAxisValuesSubSelectionShortcuts(!1,!this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.categoryAxisIsScalar().supportedType,this.hostServices);case"y1-axis-values":return P.CartesianChartOnObjectUtil.getAxisValuesSubSelectionShortcuts(!1,this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.categoryAxisIsScalar().supportedType,this.hostServices);case"y2-axis-values":return P.CartesianChartOnObjectUtil.getAxisValuesSubSelectionShortcuts(!0,this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.categoryAxisIsScalar().supportedType,this.hostServices);case"x-axis-zoom-slider":case"y1-axis-zoom-slider":case"y2-axis-zoom-slider":var c="".concat("Visual","-").concat("zoom"),l="".concat("zoom","-").concat("default"),u="".concat(l,"-labels"),d="".concat(l,"-tooltips"),h="y2-axis-zoom-slider"===r.objectName,p="x-axis-zoom-slider"===r.objectName,g="".concat(l,"-");return[{type:2,sourceUid:g+=h?"valueSecAxis":!!p==!!this.axes.isYAxisCategorical?"valueAxis":"categoryAxis",disabledLabel:this.hostServices.getLocalizedString("Delete"),keyboardShortcuts:[n]},{type:0,excludedResetSourceUids:[{sourceUid:"".concat(l,"-valueSecAxis")}]},{type:2,sourceUid:u,enabledLabel:this.hostServices.getLocalizedString("Format_AddSliderLabels")},{type:2,sourceUid:d,enabledLabel:this.hostServices.getLocalizedString("Format_AddSliderTooltips")},{type:1,destinationUids:[{cardUid:c,groupUid:l}],label:this.hostServices.getLocalizedString("Format_ZoomSlider")}];default:for(var y=0,m=o;y<m.length;y++){var v=m[y];if(v.getSubSelectionShortcuts){v=v.getSubSelectionShortcuts(e,t);if(v)return v}}}}}},v.prototype.getSubSelectables=function(e){for(var t=this.subSelectionHelper.getAllSubSelectables(e),a=0,i=this.getLayers();a<i.length;a++){var r=i[a];r.getDisambiguationSubSelectables&&t.push.apply(t,r.getDisambiguationSubSelectables(this.subSelectionHelper,e))}return t},v.prototype.getNextSubSelectable=function(e,t){return this.subSelectionHelper.getNextSubSelectable(e,t)},v.prototype.getFormattingModel=function(){for(var r=this,e=function(e){for(var t,a=[],i=1;i<arguments.length;i++)a[i-1]=arguments[i];return(t=r.hostServices).getLocalizedString.apply(t,__spreadArray([e],a,!1))},t=!(13===this.type),a=new P.builder.FormattingModelBuilder(function(){return r.customizeFormattingCard(r.getCategoryAxisCard())},function(){return r.customizeFormattingCard(r.getValueAxisCard())},function(){return r.getSecondaryValueAxisCard()},function(){return r.getLegendCard()},function(){return r.getSmallMultiplesCard()},function(){return r.getGridlinesCard()},function(){return r.axisZoom.getZoomCard(t)}).build(),i=a&&a.cards?a.cards:[],o=this.getLayers(),s={categoryAxisData:this.originalCartesianData.axesData.categoryAxis},n=[],l=0,c=o;l<c.length;l++){var u=c[l];if(!u.getFormattingCards)return;n.push(u.getFormattingCards(s))}P.ComboChart.isComboChart(this.type)?(o=P.ComboChart.sortComboChartFormattingCards(P.ComboChart.mergeFormattingCards(n,this.type,e),this.type,this.featureSwitches.comboChartError),i.push.apply(i,o)):1===n.length&&i.push.apply(i,n[0].card);o=P.visualBackgroundHelper.getBackgroundCard(this.background,e);return o&&i.push(o),a},v.prototype.customizeFormattingCard=function(e){if(e)for(var t=e,a=0,i=this.getLayers();a<i.length;a++){var r=i[a];return t=r.customizeFormattingCard?r.customizeFormattingCard(e):t}},v.prototype.resolveFormattingPlaceholder=function(e){if(P.builder.isVisualFormattingSlicePlaceholder(e)){var t=e.name;if("responsive"===t)return this.getResponsiveSlice();for(var a=0,i=this.getLayers();a<i.length;a++){var r=i[a],r=r.resolveFormattingPlaceholder&&r.resolveFormattingPlaceholder(e);if(r)return r}}},v.prototype.getResponsiveSlice=function(){function e(e){return t.hostServices.getLocalizedString(e)}var t=this,a=this.supportsResponsive(),i=this.dataViews&&this.dataViews[0];if(i)return this.smallMultiplesViewModelAdapter?this.smallMultiplesViewModelAdapter.getResponsiveSlice(i,a,e):this.viewModelAdapterFactory?this.viewModelAdapterFactory.createCartesianAdapter({cartesianData:void 0,dataView:i,viewport:void 0,isCoreMultiple:void 0}).getResponsiveSlice(i,a,e):void 0},v.prototype.getCategoryAxisCard=function(){var i,o,s,r,e,n,l,t,a,c,u,d,h=this,p=this.axes;if(p.hasCategoryAxis())return i=function(e){return h.hostServices.getLocalizedString(e)},o=P.cartesianChartProps.categoryAxis,s=this.originalCartesianData.axesData.categoryAxis,e=(r=p.isYAxisCategorical)?"Visual_YAxis_Hyphen":"Visual_XAxis_Hyphen",(e=new P.builder.FormattingCardBuilder(new P.builder.FormattingCardUidBuilder("categoryAxis"),e,[o.show,o.axisType,o.start,o.end,o.fontFamily,o.fontSize,o.bold,o.italic,o.underline,o.labelColor,o.labelDisplayUnits,o.labelPrecision,o.maxMarginFactor,o.showAxisTitle,o.titleText,o.axisStyle,o.titleFontFamily,o.titleFontSize,o.titleBold,o.titleItalic,o.titleUnderline,o.titleColor,o.concatenateLabels,o.show,o.invertAxis,o.logAxisScale,o.switchAxisPosition],i)).addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:o.show,value:s.show}).build()}),a=this.categoryAxisIsScalar(),n=a.isScalar,a.supportedType===P.axisType.both&&e.addGroup("type",function(e){e.addSimpleSlice("type",new P.builder.DropdownBuilder({descriptor:o.axisType,value:n?P.axisType.scalar:P.axisType.categorical}).build())}),n&&e.addGroup("range",function(e){e.withDisplayName("Visual_Axis_Range");var t,a,i=P.AxisHelper.getMergedUserDomains(s),r=i[0],i=i[1];p.isCategoryAxisDateTime()?(t=r&&A.PBIFormattingDate.fromTimeValue(r),a=i&&A.PBIFormattingDate.fromTimeValue(i),e.addSimpleSlice("min",new P.builder.DatePickerBuilder({descriptor:__assign(__assign({},o.start),{propertyTypes:{dateTime:!0},instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:t,placeholder:"",validators:{max:{type:1,value:a}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MinValue")}).addSimpleSlice("max",new P.builder.DatePickerBuilder({descriptor:__assign(__assign({},o.end),{propertyTypes:{dateTime:!0},instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:a,placeholder:"",validators:{min:{type:0,value:t}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MaxValue")})):e.addSimpleSlice("min",new P.builder.NumUpDownBuilder({descriptor:__assign(__assign({},o.start),{propertyTypes:{numeric:!0},instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:r,options:{maxValue:{type:1,value:i}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MinValue")}).addSimpleSlice("max",new P.builder.NumUpDownBuilder({descriptor:__assign(__assign({},o.end),{propertyTypes:{numeric:!0},instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:i,options:{minValue:{type:0,value:r}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MaxValue")}),e.addSimpleSlice("logAxisScale",new P.builder.ToggleSwitchBuilder({descriptor:o.logAxisScale,value:s.logAxisScale}).build(),function(e){return e.withDisabled(!h.isLogAxisScaleAllowed(!1)).withCustomDescriptionIf(function(){return!h.isLogAxisScaleAllowed(!1)},"Visual_LogarithmicScaleDescription")}),e.addSimpleSlice("invertAxis",new P.builder.ToggleSwitchBuilder({descriptor:o.invertAxis,value:s.invertAxis}).build(),function(e){return e.withCustomDisplayName("Visual_InvertRange")})}),l=s.labelFontProperties,t=s.titleFontProperties,a=(new P.builder.FontControlBuilder).withFontFamily({descriptor:o.fontFamily,value:l.family}).withFontSizeProperties({descriptor:o.fontSize,value:l.size.pt}),c=(new P.builder.FontControlBuilder).withFontFamily({descriptor:o.titleFontFamily,value:t.family}).withFontSizeProperties({descriptor:o.titleFontSize,value:t.size.pt}),this.featureSwitches.enableBIU&&(a.withBold({descriptor:o.bold,value:l.weight===g.boldValue}).withItalic({descriptor:o.italic,value:l.style===g.italicValue}).withUnderline({descriptor:o.underline,value:l.textDecoration===g.underlineValue}),c.withBold({descriptor:o.titleBold,value:t.weight===g.boldValue}).withItalic({descriptor:o.titleItalic,value:t.style===g.italicValue}).withUnderline({descriptor:o.titleUnderline,value:t.textDecoration===g.underlineValue})),u=a.build(),d=c.build(),e.addGroup(n?"valuesScalar":"values",function(e){var t,a;e.withDisplayName("Role_DisplayName_Values").addCompositeSlice("font","Font",u).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},o.labelColor),{instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:{value:l.color}}).build()),n?e.addSimpleSlice("displayUnits",new P.builder.DropdownBuilder({descriptor:o.labelDisplayUnits,value:s.labelDisplayUnits}).build(),function(e){return e.withAliasName("Decimal")}).addSimpleSlice("precision",new P.builder.NumUpDownBuilder({descriptor:o.labelPrecision,value:s.labelPrecision,options:{minValue:{type:0,value:0},maxValue:{type:1,value:P.DataLabelViewModel.MaxLabelPrecision}}}).build()):(a=r?"Visual_Max_AreaWidth":"Visual_Max_AreaHeight",e.addSimpleSlice(r?"maxAreaWidth":"maxAreaHeight",new P.builder.SliderBuilder({descriptor:o.maxMarginFactor,value:Math.round(100*s.maxMarginFactor),options:{minValue:{type:0,value:15},maxValue:{type:1,value:50},unitSymbol:P.visualLocKeys.PercentLocKey},localize:i}).build(),function(e){return e.withCustomDisplayName(a)})),r&&e.addSimpleSlice("switchAxisPosition",new P.builder.ToggleSwitchBuilder({descriptor:o.switchAxisPosition,value:s.switchAxisPosition}).build(),function(e){return e.withCustomDisplayName("Visual_SwitchAxisPosition")}),null!=(t=h.cartesianVisualCapabilities)&&t.supportsHierarchicalCategoryAxis&&!n&&e.addSimpleSlice("concatenateLabels",new P.builder.ToggleSwitchBuilder({descriptor:o.concatenateLabels,value:s.concatenateLabels}).build())}).addGroup("title",function(e){e.withDisplayName("Visual_Title").withInheritDisabled(!1).addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:o.showAxisTitle,value:s.showAxisTitle}).build()}).addSimpleSlice("text",new P.builder.TextInputBuilder({descriptor:o.titleText,value:s.titleText,placeholder:""}).build(),function(e){return e.withCustomDisplayName("Visual_Title_Text")}).addSimpleSlice("style",function(){var e=p.categoryAxisHasUnitType?[P.axisStyle.showTitleOnly,P.axisStyle.showUnitOnly,P.axisStyle.showBoth]:[P.axisStyle.showTitleOnly];return new P.builder.DropdownBuilder({descriptor:o.axisStyle,value:s.axisStyle,filterValues:e}).build()}).addCompositeSlice("font","Font",d).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},o.titleColor),{instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:{value:t.color}}).build(),function(e){return e.withCustomDisplayName("Generic_Color")})}),e.build()},v.prototype.getValueAxisCard=function(){var i,r,o,t,a,s,e,n,l,c,u=this,d=null==(d=this.originalCartesianData)?void 0:d.axesData;if(d&&d.isValueAxisSet&&!d.isValueAxisDisabled&&9!==this.type)return i=this.axes,r=P.cartesianChartProps.valueAxis,o=this.originalCartesianData.axesData.valueAxis,d=(t=i.isYAxisCategorical)?"Visual_XAxis_Hyphen":"Visual_YAxis_Hyphen",d=new P.builder.FormattingCardBuilder(new P.builder.FormattingCardUidBuilder("valueAxis"),d,[r.show,r.start,r.end,r.invertAxis,r.sharedAxis,r.scaleToFit,r.fontFamily,r.fontSize,r.bold,r.italic,r.underline,r.labelColor,r.labelDisplayUnits,r.labelPrecision,r.showAxisTitle,r.titleText,r.axisStyle,r.titleFontFamily,r.titleFontSize,r.titleBold,r.titleItalic,r.titleUnderline,r.titleColor,r.logAxisScale,r.switchAxisPosition],function(e){return u.hostServices.getLocalizedString(e)}),a=o.labelFontProperties,s=o.titleFontProperties,e=(new P.builder.FontControlBuilder).withFontFamily({descriptor:r.fontFamily,value:a.family}).withFontSizeProperties({descriptor:r.fontSize,value:a.size.pt}),n=(new P.builder.FontControlBuilder).withFontFamily({descriptor:r.titleFontFamily,value:s.family}).withFontSizeProperties({descriptor:r.titleFontSize,value:s.size.pt}),this.featureSwitches.enableBIU&&(e.withBold({descriptor:r.bold,value:o.labelBold}).withItalic({descriptor:r.italic,value:o.labelItalic}).withUnderline({descriptor:r.underline,value:o.labelUnderline}),n.withBold({descriptor:r.titleBold,value:o.titleBold}).withItalic({descriptor:r.titleItalic,value:o.titleItalic}).withUnderline({descriptor:r.titleUnderline,value:o.titleUnderline})),l=e.build(),c=n.build(),d.addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:r.show,value:o.show}).build()}).addGroup("range",function(e){var t=P.AxisHelper.getMergedUserDomains(o),a=t[0],t=t[1];e.withDisplayName("Visual_Axis_Range").withInheritDisabled(!1).addSimpleSlice("min",new P.builder.NumUpDownBuilder({descriptor:__assign(__assign({},r.start),{propertyTypes:{numeric:!0},instanceKind:u.featureSwitches.expressionBasedFormatting?3:1}),value:a,options:{maxValue:{type:1,value:t}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MinValue")}).addSimpleSlice("max",new P.builder.NumUpDownBuilder({descriptor:__assign(__assign({},r.end),{propertyTypes:{numeric:!0},instanceKind:u.featureSwitches.expressionBasedFormatting?3:1}),value:t,options:{minValue:{type:0,value:a}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MaxValue")}),13!==u.type&&e.addSimpleSlice("logAxisScale",new P.builder.ToggleSwitchBuilder({descriptor:r.logAxisScale,value:o.logAxisScale}).build(),function(e){return e.withDisabled(!u.isLogAxisScaleAllowed(!0)).withCustomDescriptionIf(function(){return!u.isLogAxisScaleAllowed(!0)},"Visual_LogarithmicScaleDescription")}),e.addSimpleSlice("invertAxis",new P.builder.ToggleSwitchBuilder({descriptor:r.invertAxis,value:o.invertAxis}).build(),function(e){return e.withCustomDisplayName("Visual_InvertRange")}),u.isSmallMultiples()&&u.featureSwitches.smallMultiplesUnsharedAxes&&e.addSimpleSlice("sharedAxis",new P.builder.ToggleSwitchBuilder({descriptor:r.sharedAxis,value:o.sharedAxis}).build(),function(e){i.isYAxisCategorical&&e.withCustomDisplayName("Visual_Shared_XAxis")}).addSimpleSlice("scaleToFit",new P.builder.ToggleSwitchBuilder({descriptor:r.scaleToFit,value:o.scaleToFit}).build(),function(e){return e.withDisabled(o.sharedAxis)})}).addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values").addCompositeSlice("font","Font",l).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},r.labelColor),{instanceKind:u.featureSwitches.expressionBasedFormatting?3:1}),value:{value:a.color}}).build()),7!==u.type&&8!==u.type&&e.addSimpleSlice("displayUnits",new P.builder.DropdownBuilder({descriptor:r.labelDisplayUnits,value:o.labelDisplayUnits}).build(),function(e){return e.withAliasName("Decimal")}).addSimpleSlice("precision",new P.builder.NumUpDownBuilder({descriptor:r.labelPrecision,value:o.labelPrecision,options:{minValue:{type:0,value:0},maxValue:{type:1,value:P.DataLabelViewModel.MaxLabelPrecision}}}).build()),t||e.addSimpleSlice("switchAxisPosition",new P.builder.ToggleSwitchBuilder({descriptor:r.switchAxisPosition,value:o.switchAxisPosition}).build(),function(e){return e.withCustomDisplayName("Visual_SwitchAxisPosition")})}).addGroup("title",function(e){e.withDisplayName("Visual_Title").withInheritDisabled(!1).addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:r.showAxisTitle,value:o.showAxisTitle}).build()}).addSimpleSlice("text",new P.builder.TextInputBuilder({descriptor:r.titleText,value:o.titleText,placeholder:""}).build(),function(e){return e.withCustomDisplayName("Visual_Title_Text")}).addSimpleSlice("style",function(){var e=i.valueAxisHasUnitType?[P.axisStyle.showTitleOnly,P.axisStyle.showUnitOnly,P.axisStyle.showBoth]:[P.axisStyle.showTitleOnly];return new P.builder.DropdownBuilder({descriptor:r.axisStyle,value:o.axisStyle,filterValues:e}).build()}).addCompositeSlice("font","Font",c).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},r.titleColor),{instanceKind:u.featureSwitches.expressionBasedFormatting?3:1}),value:{value:s.color}}).build(),function(e){return e.withCustomDisplayName("Generic_Color")})}),d.build()},v.prototype.getSecondaryValueAxisCard=function(){var e,t,i,a,r,o,s,n,l,c,u,d,h=this,p=null==(p=this.originalCartesianData)?void 0:p.axesData;if(p&&p.isValueAxisSet&&!p.isValueAxisDisabled){switch(this.type){case 0:case 1:e=!0,t=P.cartesianChartProps.y2Axis.show,i=P.cartesianChartProps.y2Axis;break;case 14:case 15:case 16:case 17:e=!0,t=P.cartesianChartProps.valueAxis.secShow,i=P.cartesianChartProps.valueAxis;break;default:e=!1}if(e)return a=this.axes,r=this.originalCartesianData.axesData,o=r.y2,p=new P.builder.FormattingCardBuilder(new P.builder.FormattingCardUidBuilder("y2Axis"),"Visual_Y2Axis_Hyphen",__assign(__assign({},i),{alignZeros:P.cartesianChartProps.valueAxis.alignZeros}),function(e){return h.hostServices.getLocalizedString(e)}),s=o.labelFontProperties,n=o.titleFontProperties,l=(new P.builder.FontControlBuilder).withFontFamily({descriptor:i.secFontFamily,value:s.family}).withFontSizeProperties({descriptor:i.secFontSize,value:s.size.pt}),c=(new P.builder.FontControlBuilder).withFontFamily({descriptor:i.secTitleFontFamily,value:n.family}).withFontSizeProperties({descriptor:i.secTitleFontSize,value:n.size.pt}),this.featureSwitches.enableBIU&&(l.withBold({descriptor:i.secBold,value:o.labelBold}).withItalic({descriptor:i.secItalic,value:o.labelItalic}).withUnderline({descriptor:i.secUnderline,value:o.labelUnderline}),c.withBold({descriptor:i.secTitleBold,value:o.titleBold}).withItalic({descriptor:i.secTitleItalic,value:o.titleItalic}).withUnderline({descriptor:i.secTitleUnderline,value:o.titleUnderline})),u=l.build(),d=c.build(),p.addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:t,value:o.show}).build()}).addGroup("range",function(e){var t=P.AxisHelper.getMergedUserDomains(o),a=t[0],t=t[1];e.withDisplayName("Visual_Axis_Range").addSimpleSlice("min",new P.builder.NumUpDownBuilder({descriptor:__assign(__assign({},i.secStart),{instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:a,options:{maxValue:{type:1,value:t}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MinValue")}).addSimpleSlice("max",new P.builder.NumUpDownBuilder({descriptor:__assign(__assign({},i.secEnd),{instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:t,options:{minValue:{type:0,value:a}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MaxValue")}),e.addSimpleSlice("logAxisScale",new P.builder.ToggleSwitchBuilder({descriptor:i.secLogAxisScale,value:o.logAxisScale}).build(),function(e){return e.withDisabled(!h.isLogAxisScaleAllowed(!0,!0)).withCustomDescriptionIf(function(){return!h.isLogAxisScaleAllowed(!0,!0)},"Visual_LogarithmicScaleDescription")}),P.ComboChart.isComboChart(h.type)&&e.addSimpleSlice("alignZeroes",new P.builder.ToggleSwitchBuilder({descriptor:P.cartesianChartProps.valueAxis.alignZeros,value:r.valueAxis.alignZeros}).build())}).addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values").addCompositeSlice("font","Font",u).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:i.secLabelColor,value:{value:s.color}}).build()),7!==h.type&&8!==h.type&&e.addSimpleSlice("displayUnits",new P.builder.DropdownBuilder({descriptor:i.secLabelDisplayUnits,value:o.labelDisplayUnits}).build(),function(e){return e.withAliasName("Decimal")}).addSimpleSlice("precision",new P.builder.NumUpDownBuilder({descriptor:i.secLabelPrecision,value:o.labelPrecision,options:{minValue:{type:0,value:0},maxValue:{type:1,value:P.DataLabelViewModel.MaxLabelPrecision}}}).build())}).addGroup("title",function(e){e.withDisplayName("Visual_Title").withInheritDisabled(!1).addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:i.secShowAxisTitle,value:o.showAxisTitle}).build()}).addSimpleSlice("text",new P.builder.TextInputBuilder({descriptor:i.secTitleText,value:o.titleText,placeholder:""}).build(),function(e){return e.withCustomDisplayName("Visual_Title_Text")}).addSimpleSlice("style",function(){var e=a.valueAxisHasUnitType?[P.axisStyle.showTitleOnly,P.axisStyle.showUnitOnly,P.axisStyle.showBoth]:[P.axisStyle.showTitleOnly];return new P.builder.DropdownBuilder({descriptor:i.secAxisStyle,value:o.axisStyle,filterValues:e}).build()}).addCompositeSlice("font","Font",d).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:i.secTitleColor,value:{value:n.color}}).build(),function(e){return e.withCustomDisplayName("Generic_Color")})}),p.build()}},v.prototype.getLegendCard=function(){for(var e={legendData:this.originalCartesianData.legendData},t=0,a=this.getLayers();t<a.length;t++){var i=a[t];i.customizeLegendFormattingModelOptions&&(e=i.customizeLegendFormattingModelOptions(e))}var r=this.featureSwitches.onObject?"Visual_LegendCard_DisabledReasonNew":14===this.type?"Visual_LegendCard_ComboLineClustered_DisabledReason":15===this.type?"Visual_LegendCard_ComboLineStacked_DisabledReason":"Visual_LegendCard_DisabledReason";return P.Legend.getLegendFormattingModel(e,this.hostServices,this.featureSwitches,!this.shouldShowLegendCard(),r)},v.prototype.getGridlinesCard=function(){var t,a,i,r,o=this,e=this.axes,s=e.hasCategoryAxis(),e=e.isYAxisCategorical,n=this.originalCartesianData.axesData,l=3===this.categoryAxisRenderMode,l=this.categoryAxisIsScalar().isScalar||l,s=(e?(t=P.cartesianChartProps.categoryAxis,a=n.categoryAxis,s&&(i=P.cartesianChartProps.valueAxis,9!==this.type)&&(r=n.valueAxis)):(t=P.cartesianChartProps.valueAxis,9!==this.type&&(a=n.valueAxis),s&&13!==this.type&&(i=P.cartesianChartProps.categoryAxis,r=n.categoryAxis)),new P.builder.FormattingCardBuilder(new P.builder.FormattingCardUidBuilder("gridlines"),"Visual_Gridline_Show",[P.cartesianChartProps.categoryAxis.gridlineShow,P.cartesianChartProps.categoryAxis.gridlineStyle,P.cartesianChartProps.categoryAxis.gridlineColor,P.cartesianChartProps.categoryAxis.gridlineThickness,P.cartesianChartProps.valueAxis.gridlineShow,P.cartesianChartProps.valueAxis.gridlineStyle,P.cartesianChartProps.valueAxis.gridlineColor,P.cartesianChartProps.valueAxis.gridlineThickness],function(e){return o.hostServices.getLocalizedString(e)}));return 9!==this.type||l?((a&&!e||e&&l)&&s.addGroup("horizontal",function(e){return c(e,t,a,"Visual_LabelOrientation_Horizontal",o.featureSwitches)}),(r&&e||!e&&l)&&s.addGroup("vertical",function(e){return c(e,i,r,"Visual_LabelOrientation_Vertical",o.featureSwitches)})):s.withDisabled(!0,"Visual_Ribbon_Chart_Gridlines_DisabledReason"),s.build();function c(e,t,a,i,r){e.withDisplayName(i).addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:t.gridlineShow,value:!!a.show&&a.gridlineShow}).build()},function(e){return e.withDisabled(!a.show)}).addSimpleSlice("style",new P.builder.DropdownBuilder({descriptor:t.gridlineStyle,value:a.gridlineStyle}).build(),function(e){return e.withCustomDisplayName("Style")}).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},t.gridlineColor),{instanceKind:r.expressionBasedFormatting?3:1}),value:{value:a.gridlineColor}}).build(),function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("width",new P.builder.NumUpDownBuilder({descriptor:t.gridlineThickness,value:a.gridlineThickness,options:{minValue:{type:0,value:1},maxValue:{type:1,value:4},unitSymbol:P.visualLocKeys.PixelUnitSymbol}}).build(),function(e){return e.withCustomDisplayName("Visual_General_Properties_Width")})}},v.prototype.getTelemetryInformation=function(){for(var e,t={},a=(this.isSmallMultiples()&&(e=v.getMultiplesLayout(this.dataViews[0].metadata.objects,this.layerStyle),t.smallMultiples={layout:{type:e.layoutType,rows:e.rowCount,columns:e.columnCount}}),this.getLayers()),i=0;i<a.length;i++){var r=a[i];_.isFunction(r.getTelemetryInformation)&&(r=r.getTelemetryInformation())&&(t[i.toString()]=r)}if(!_.isEmpty(t))return t},v.prototype.getLayers=function(){var e=this.multiples.getCoreMultiple();return 1&e.getState()?e.layers:[]},v.prototype.enumerateReferenceLines=function(e,t,a){var i=P.ColorHelper.getDataColorByIndex(this.layerStyle,0,P.ForegroundColorName),r=_.filter(this.originalCartesianData.referenceLines,function(e){return e.type===t});P.ReferenceLineHelper.enumerateObjectInstances(e,r,i,t,this.originalCartesianData.axesData.isValueAxisDisabled,a,this.featureSwitches)},v.prototype.shouldShowLegendCard=function(){var e,t=null==(e=this.multiples.getCoreMultiple())?void 0:e.layers,a=this.dataViews;if(this.cartesianData.legendData.isGradientLegend)return!0;if(t&&a)for(var i=t.length,r=0,o=0;o<i;o++){if(t[o].hasLegend())return!0;var s=a[o];if(s&&s.categorical&&s.categorical.values&&0<s.categorical.values.length&&1<++r)return!0}return!1},v.prototype.isLogAxisScaleAllowed=function(e,t){void 0===t&&(t=!1);var a=this.axes.isYAxisCategorical;return this.axes.isLogScaleAllowed((e=void 0===e?!1:e)?a?0:t?2:1:a?1:0)},v.prototype.categoryAxisIsScalar=function(){var e=this.originalCartesianData.axesData.categoryAxis,t=3===this.categoryAxisRenderMode?P.axisType.categorical:P.axisType.both,a=!1,i=null==(i=this.multiples.getCoreMultiple())?void 0:i.layers;return{isScalar:a=t===P.axisType.both&&i&&i[0].getSupportedCategoryAxisType?(t=i[0].getSupportedCategoryAxisType())===P.axisType.scalar||(a=P.CartesianHelper.isScalar(t===P.axisType.both,e))&&(i&&i[0].getVisualCategoryAxisIsScalar?i[0].getVisualCategoryAxisIsScalar():0===this.categoryAxisRenderMode):a,supportedType:t}},v.prototype.enumerateCategoryAxis=function(e){var t,a,i,r,o,s,n,l,c=this;this.originalCartesianData&&this.originalCartesianData.axesData&&this.originalCartesianData.axesData.isCategoryAxisSet&&(t=this.originalCartesianData.axesData.categoryAxis,a=P.cartesianChartProps.categoryAxis,i=3===this.categoryAxisRenderMode,r=(s=this.categoryAxisIsScalar()).isScalar,s=s.supportedType,(o={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisStyle:this.axes.categoryAxisHasUnitType?[P.axisStyle.showTitleOnly,P.axisStyle.showUnitOnly,P.axisStyle.showBoth]:[P.axisStyle.showTitleOnly]},propertyTypes:{},propertyInstanceKind:{start:this.featureSwitches.expressionBasedFormatting?3:1,end:this.featureSwitches.expressionBasedFormatting?3:1,titleColor:this.featureSwitches.expressionBasedFormatting?3:1,gridlineColor:this.featureSwitches.expressionBasedFormatting?3:1,labelColor:this.featureSwitches.expressionBasedFormatting?3:1}}).properties[a.show.propertyName]=t.show,this.axes.isYAxisCategorical&&(o.properties[a.switchAxisPosition.propertyName]=t.switchAxisPosition),s===P.axisType.both&&(o.properties[a.axisType.propertyName]=r?P.axisType.scalar:P.axisType.categorical),r&&(this.isLogAxisScaleAllowed(!1)&&(o.properties[a.logAxisScale.propertyName]=t.logAxisScale),l=(s=P.AxisHelper.getMergedUserDomains(t))[0],s=s[1],o.properties[a.start.propertyName]=l,o.properties[a.end.propertyName]=s,o.properties[a.invertAxis.propertyName]=t.invertAxis),o.properties[a.labelColor.propertyName]=P.AxisDataModel.toColorFill(t.labelFontProperties.color),o.properties[a.fontSize.propertyName]=t.labelFontProperties.size.pt,o.properties[a.fontFamily.propertyName]=t.labelFontProperties.family,this.featureSwitches.enableBIU&&(o.properties[a.bold.propertyName]=t.labelBold,o.properties[a.italic.propertyName]=t.labelItalic,o.properties[a.underline.propertyName]=t.labelUnderline),r&&(o.properties[a.labelDisplayUnits.propertyName]=t.labelDisplayUnits,o.properties[a.labelPrecision.propertyName]=t.labelPrecision,l={numberRange:{min:0,max:P.DataLabelViewModel.MaxLabelPrecision}},o.validValues[a.labelPrecision.propertyName]=l),this.axes.isCategoryAxisDateTime()?(o.propertyTypes[a.start.propertyName]={dateTime:!0},o.propertyTypes[a.end.propertyName]={dateTime:!0}):(o.propertyTypes[a.start.propertyName]={numeric:!0},o.propertyTypes[a.end.propertyName]={numeric:!0}),r||(o.properties[a.preferredCategoryWidth.propertyName]=t.preferredCategoryWidth,o.properties[a.maxMarginFactor.propertyName]=Math.round(100*t.maxMarginFactor),o.validValues[a.maxMarginFactor.propertyName]={numberRange:{min:15,max:50},unitSymbol:P.visualLocKeys.PercentLocKey},9!==this.type&&(n=t.innerPadding,o.properties[a.innerPadding.propertyName]=void 0!==n?Math.round(100*n):void 0,o.validValues[a.innerPadding.propertyName]={numberRange:{min:0,max:50},unitSymbol:P.visualLocKeys.PercentLocKey})),_.find([9,10],function(e){return e===c.type})||(n=t.innerPadding,o.properties[a.innerPadding.propertyName]=void 0!==n?Math.round(100*n):void 0,o.validValues[a.innerPadding.propertyName]={numberRange:{min:0,max:50},unitSymbol:P.visualLocKeys.PercentLocKey}),null!=(s=this.cartesianVisualCapabilities)&&s.supportsHierarchicalCategoryAxis&&!r&&(l=a.concatenateLabels.propertyName,o.properties[l]=t.concatenateLabels),o.properties[a.showAxisTitle.propertyName]=t.showAxisTitle,o.properties[a.showAxisTitle.propertyName]&&(o.properties[a.axisStyle.propertyName]=t.axisStyle,o.properties[a.titleColor.propertyName]=P.AxisDataModel.toColorFill(t.titleFontProperties.color),o.properties[a.titleText.propertyName]=t.titleText,o.properties[a.titleFontSize.propertyName]=t.titleFontProperties.size.pt,o.properties[a.titleFontFamily.propertyName]=t.titleFontProperties.family,this.featureSwitches.enableBIU)&&(o.properties[a.titleBold.propertyName]=t.titleBold,o.properties[a.titleItalic.propertyName]=t.titleItalic,o.properties[a.titleUnderline.propertyName]=t.titleUnderline),(r||i)&&(o.properties[a.gridlineShow.propertyName]=t.gridlineShow,t.gridlineShow)&&(o.properties[a.gridlineColor.propertyName]=P.AxisDataModel.toColorFill(t.gridlineColor),o.properties[a.gridlineThickness.propertyName]=t.gridlineThickness,o.validValues.gridlineThickness=["1","2","3","4"],o.properties[a.gridlineStyle.propertyName]=t.gridlineStyle),e.pushInstance(o))},v.prototype.enumerateValueAxis=function(e,t){var a,i,r,o,s,n;void 0===t&&(t="valueAxis"),this.originalCartesianData&&this.originalCartesianData.axesData&&this.originalCartesianData.axesData.isValueAxisSet&&!this.originalCartesianData.axesData.isValueAxisDisabled&&("y2Axis"===t&&2===this.type||(a={numberRange:{min:0,max:P.DataLabelViewModel.MaxLabelPrecision}},n=this.originalCartesianData.axesData.valueAxis,i=P.cartesianChartProps.valueAxis,r={selector:null,properties:{},objectName:t,validValues:{axisStyle:this.axes.valueAxisHasUnitType?[P.axisStyle.showTitleOnly,P.axisStyle.showUnitOnly,P.axisStyle.showBoth]:[P.axisStyle.showTitleOnly],secAxisStyle:this.axes.secondaryValueAxisHasUnitType?[P.axisStyle.showTitleOnly,P.axisStyle.showUnitOnly,P.axisStyle.showBoth]:[P.axisStyle.showTitleOnly]},propertyTypes:{},propertyInstanceKind:{start:this.featureSwitches.expressionBasedFormatting?3:1,end:this.featureSwitches.expressionBasedFormatting?3:1,titleColor:this.featureSwitches.expressionBasedFormatting?3:1,gridlineColor:this.featureSwitches.expressionBasedFormatting?3:1,labelColor:this.featureSwitches.expressionBasedFormatting?3:1,secStart:this.featureSwitches.expressionBasedFormatting?3:1,secEnd:this.featureSwitches.expressionBasedFormatting?3:1}},(t="y2Axis"===t)||(r.properties[i.show.propertyName]=n.show,r.properties[i.axisLabel.propertyName]=n.axisLabel,this.axes.isYAxisCategorical||(r.properties[i.switchAxisPosition.propertyName]=n.switchAxisPosition),this.isLogAxisScaleAllowed(!0)&&(r.properties[i.logAxisScale.propertyName]=n.logAxisScale),o=(s=P.AxisHelper.getMergedUserDomains(n))[0],s=s[1],r.properties[i.start.propertyName]=o,r.properties[i.end.propertyName]=s,r.propertyTypes[i.start.propertyName]={numeric:!0},r.propertyTypes[i.end.propertyName]={numeric:!0},r.properties[i.invertAxis.propertyName]=n.invertAxis,r.properties[i.labelColor.propertyName]=P.AxisDataModel.toColorFill(n.labelFontProperties.color),r.properties[i.fontSize.propertyName]=n.labelFontProperties.size.pt,r.properties[i.fontFamily.propertyName]=n.labelFontProperties.family,this.featureSwitches.enableBIU&&(r.properties[i.bold.propertyName]=n.labelBold,r.properties[i.italic.propertyName]=n.labelItalic,r.properties[i.underline.propertyName]=n.labelUnderline),7!==this.type&&8!==this.type&&(r.properties[i.labelDisplayUnits.propertyName]=n.labelDisplayUnits,r.properties[i.labelPrecision.propertyName]=n.labelPrecision,r.validValues[i.labelPrecision.propertyName]=a),this.featureSwitches.waterfallTotals&&13===this.type&&!this.hasBreakdownRole()&&(r.properties[i.totalsEnabled.propertyName]=n.totalsEnabled),r.properties[i.showAxisTitle.propertyName]=n.showAxisTitle,r.properties[i.showAxisTitle.propertyName]&&(r.properties[i.axisStyle.propertyName]=n.axisStyle,r.properties[i.titleColor.propertyName]=P.AxisDataModel.toColorFill(n.titleFontProperties.color),r.properties[i.titleText.propertyName]=n.titleText,r.properties[i.titleFontSize.propertyName]=n.titleFontProperties.size.pt,r.properties[i.titleFontFamily.propertyName]=n.titleFontProperties.family,this.featureSwitches.enableBIU)&&(r.properties[i.titleBold.propertyName]=n.titleBold,r.properties[i.titleItalic.propertyName]=n.titleItalic,r.properties[i.titleUnderline.propertyName]=n.titleUnderline),r.properties[i.gridlineShow.propertyName]=n.gridlineShow,n.gridlineShow&&(r.properties[i.gridlineColor.propertyName]=P.AxisDataModel.toColorFill(n.gridlineColor),r.properties[i.gridlineThickness.propertyName]=n.gridlineThickness,r.validValues.gridlineThickness=["1","2","3","4"],r.properties[i.gridlineStyle.propertyName]=n.gridlineStyle)),o=this.originalCartesianData.axesData.y2,t?r.properties[i.show.propertyName]=o.show:r.properties[i.secShow.propertyName]=o.show,(s=t||P.ComboChart.isComboChart(this.type)&&o.show)&&!t&&(r.properties[i.alignZeros.propertyName]=n.alignZeros,r.properties.secAxisLabel=""),n=(t=P.AxisHelper.getMergedUserDomains(o))[0],t=t[1],r.properties[i.secStart.propertyName]=n,r.properties[i.secEnd.propertyName]=t,r.propertyTypes[i.secStart.propertyName]={numeric:!0},r.propertyTypes[i.secEnd.propertyName]={numeric:!0},s&&(r.properties[i.secInvertAxis.propertyName]=o.invertAxis,this.isLogAxisScaleAllowed(!0,!0)&&(r.properties[i.secLogAxisScale.propertyName]=o.logAxisScale),r.properties[i.secLabelColor.propertyName]=P.AxisDataModel.toColorFill(o.labelFontProperties.color),r.properties[i.secFontSize.propertyName]=o.labelFontProperties.size.pt,r.properties[i.secFontFamily.propertyName]=o.labelFontProperties.family,this.featureSwitches.enableBIU&&(r.properties[i.secBold.propertyName]=o.labelBold,r.properties[i.secItalic.propertyName]=o.labelItalic,r.properties[i.secUnderline.propertyName]=o.labelUnderline),r.properties[i.secLabelDisplayUnits.propertyName]=o.labelDisplayUnits,r.properties[i.secLabelPrecision.propertyName]=o.labelPrecision,r.validValues[i.secLabelPrecision.propertyName]=a),r.properties[i.secShowAxisTitle.propertyName]=o.showAxisTitle,s&&r.properties[i.secShowAxisTitle.propertyName]&&(r.properties[i.secAxisStyle.propertyName]=o.axisStyle,r.properties[i.secTitleColor.propertyName]=P.AxisDataModel.toColorFill(o.titleFontProperties.color),r.properties[i.secTitleText.propertyName]=o.titleText,r.properties[i.secTitleFontSize.propertyName]=o.titleFontProperties.size.pt,this.featureSwitches.enableBIU&&(r.properties[i.secTitleBold.propertyName]=o.titleBold,r.properties[i.secTitleItalic.propertyName]=o.titleItalic,r.properties[i.secTitleUnderline.propertyName]=o.titleUnderline),r.properties[i.secTitleFontFamily.propertyName]=o.titleFontProperties.family),e.pushInstance(r)))},v.prototype.onClearSelection=function(){this.hasSetData&&this.multiples.clearSelection(this.layout.getVisibleMultiples())},v.prototype.onRestoreSelection=function(e){return!!this.interactivityService&&this.interactivityService.restoreSelection(e.selection)},v.prototype.createLayers=function(){return this.layerFactory.createLayers({type:this.type,interactivityService:this.interactivityService,isScrollable:this.axes.isScrollable,tooltipsEnabled:this.tooltipsEnabled,featureSwitches:this.featureSwitches})},v.prototype.getLayerRendererInitOptions=function(e){var t=this;return{animator:e.animator,svg:e.axesRenderer.getLayerContainer(),labelsContext:e.axesRenderer.getDataLabelContainers().foreground,cartesianHost:{updateLegend:function(e){return t.legend.drawLegend(e,t.currentViewport,{isHierarchicalAxis:3===t.categoryAxisRenderMode,titleSliceUid:"".concat("legend","-").concat("title","-titleText")})},triggerRender:function(e){return t.render(e,!1)}},eventManager:this.eventManager,useManagedTabIndex:this.useManagedTabIndex()}},v.prototype.useManagedTabIndex=function(){return this.isSmallMultiples()},v.prototype.onDataViewObjectChanged=function(e){if(!this.featureSwitches.onObject)return e;for(var t,a=[],i=0,r=this.getLayers();i<r.length;i++){var o=r[i];o.getDataViewObjectLayerChanges&&a.push(o.getDataViewObjectLayerChanges(e))}if(_.isEmpty(a))return e;if(1<a.length){for(var s=[],n=[],l=0;l<a.length;l++){n[l]=[];for(var c=0,u=a[l];c<u.length;c++){var d=u[c];(d.required?s:n[l]).push(d)}}for(var h=n[0],p=1;p<n.length;p++)h=_.intersectionWith(h,n[p],_.isEqual);t=P.DataViewObjectChangeHelper.applyDataViewObjectsBehaviorChanges(e,__spreadArray(__spreadArray([],h,!0),s,!0))}else t=P.DataViewObjectChangeHelper.applyDataViewObjectsBehaviorChanges(e,_.first(a));return t},v.MinScalarRectThickness=2,v.LoadMoreThreshold=1,v.xAxisSmallFontSizeInPx=9,v.yAxisSmallFontSizeInPx=9,v.yAxisMediumFontSizeInPx=11,v);function v(e){var t=this,a=!1;this.trimOrdinalDataOnOverflow=!0,this.featureSwitches={},e&&(this.tooltipsEnabled=e.tooltipsEnabled,this.type=e.chartType,this.featureSwitches=e.featureSwitches||{},void 0!==e.trimOrdinalDataOnOverflow&&(this.trimOrdinalDataOnOverflow=e.trimOrdinalDataOnOverflow),e.isScrollable&&(a=e.isScrollable),e.behaviorFactory)&&(this.behaviorFactory=e.behaviorFactory),this.hasAnimator=!(null==e||!e.animator),this.axes=new P.CartesianAxes(a,i.ScrollbarWidth,this.trimOrdinalDataOnOverflow),this.viewModelAdapterFactory=new P.ResponsiveCartesianAdapterFactory(this.featureSwitches.smallMultiplesResponsive),this.layerFactory=new R(this.type,this.viewModelAdapterFactory),this.layoutBuilder=new P.CartesianChartLayoutBuilder(e,this.behaviorFactory,this.featureSwitches,this.axes,this.type,function(){return t.isPlayAxis()},a,function(){return t.smallMultiplesViewModelAdapter}),this.multiples=new P.CartesianSmallMultiples(this.type,this.featureSwitches,function(){return t.createLayers()},function(e){return t.getLayerRendererInitOptions(e)})}function a(){this.navigationLayers=[],this.currentNavigationLayerIndex=0}P.CartesianChart=t,a.prototype.updateScrollCallbacks=function(e){this.scrollCallbacks=e},a.prototype.clearNavigationLayers=function(){this.navigationLayers=[]},a.prototype.addNavigationLayer=function(e){this.navigationLayers.push(e)},a.prototype.getFirstElement=function(){this.currentNavigationLayerIndex=0;var e,t=this.navigationLayers[this.currentNavigationLayerIndex].getFirstElement();return{element:e=t?t.element||this.getNextDataPoint(t.targetCategoryIndex,t.targetSeriesIndex,P.DataDirection.NextSeries).element:e}},a.prototype.getNextDataPoint=function(e,t,a){e=this.composeLayerPointInfo(e,t);return this.getNextDataPointWithStartData(e,a,e)},a.prototype.getNextDataPointWithStartData=function(a,i,r){var o=this,s=a.categoryIndex,n=a.seriesIndex,l=this.navigationLayers[this.currentNavigationLayerIndex],c=l.getNextDataPoint(s,n,i),e=c.targetCategoryIndex,u=i===P.DataDirection.NextSeries||i===P.DataDirection.NextCategory,d=this.navigationLayers.length;if(1<d&&c.targetCategoryIndex!==s){var t=s,h=0,p=u?1:-1;do{switch(i){case P.DataDirection.NextSeries:case P.DataDirection.PreviousSeries:this.currentNavigationLayerIndex+=p,this.layerRollOverCheck(this.currentNavigationLayerIndex,d)?(this.currentNavigationLayerIndex=this.currentNavigationLayerIndex<0?d-1:0,l=this.navigationLayers[this.currentNavigationLayerIndex],c=l.getFirstElement(e,!u),t=e=_.isFinite(c.targetCategoryIndex)?c.targetCategoryIndex:e,h++):(l=this.navigationLayers[this.currentNavigationLayerIndex],c=l.getFirstElement(t,!u));break;case P.DataDirection.NextCategory:case P.DataDirection.PreviousCategory:h=d}}while(!c.element&&h<d&&(!this.layerRollOverCheck(this.currentNavigationLayerIndex+p,d)||h<d-1))}if(!c.element&&null!=e&&this.shouldScroll(e)){this.getPendingFocusElement=function(){if(o.getPendingFocusElement=void 0,i===P.DataDirection.NextSeries?o.currentNavigationLayerIndex=0:i===P.DataDirection.PreviousSeries&&(o.currentNavigationLayerIndex=d-1),l=o.navigationLayers[o.currentNavigationLayerIndex],!(c=l.getNextDataPoint(s,n,i)).element)for(var e=o.currentNavigationLayerIndex;o.currentNavigationLayerIndex++,o.currentNavigationLayerIndex>=o.navigationLayers.length&&(o.currentNavigationLayerIndex=0),!(c=o.navigationLayers[o.currentNavigationLayerIndex].getNextDataPoint(s,n,i)).element&&o.currentNavigationLayerIndex!==e;);var t;return(o.shouldFindNextPoint(c,a,r,u)?(t=o.composeLayerPointInfo(c.targetCategoryIndex,c.targetSeriesIndex),o.getNextDataPointWithStartData(t,i,r)):c).element};var g=e-s;g<0?this.scrollCallbacks.scrollTo(e):this.scrollCallbacks.scrollBy(g)}else if(this.shouldFindNextPoint(c,a,r,u))return g=this.composeLayerPointInfo(c.targetCategoryIndex,c.targetSeriesIndex),this.getNextDataPointWithStartData(g,i,r);return c},a.prototype.shouldScroll=function(e){return!!this.scrollCallbacks&&this.scrollCallbacks.shouldScrollTo(e)},a.prototype.layerRollOverCheck=function(e,t){return t<=e||e<0},a.prototype.composeLayerPointInfo=function(e,t){return{categoryIndex:e,seriesIndex:t,layerIndex:this.currentNavigationLayerIndex}},a.prototype.shouldFindNextPoint=function(e,t,a,i){if(e.element&&!e.noShape||null===e.targetCategoryIndex||null===e.targetSeriesIndex)return!1;var r=this.composeLayerPointInfo(e.targetCategoryIndex,e.targetSeriesIndex);switch(this.compareLayerPointInfo(a,r,i)){case 1:if(0<=this.compareLayerPointInfo(t,r,i)&&0<this.compareLayerPointInfo(a,t,i))return!1;break;case 0:return!1;case-1:if(0<this.compareLayerPointInfo(a,t,i))return!1;if(0<=this.compareLayerPointInfo(t,r,i))return!1}return!0},a.prototype.compareLayerPointInfo=function(e,t,a){return e.categoryIndex>t.categoryIndex?a?1:-1:e.categoryIndex<t.categoryIndex?a?-1:1:e.seriesIndex>t.seriesIndex?a?1:-1:e.seriesIndex<t.seriesIndex?a?-1:1:e.layerIndex>t.layerIndex?a?1:-1:e.layerIndex<t.layerIndex?a?-1:1:0},P.CartesianChartNavigationHelper=a,n.prototype.processDataView=function(e,t){var a,i,r,o,s;this.renderModes=[],e&&e.metadata&&e.categorical&&!_.isEmpty(e.categorical.categories)?(s=e.metadata,o=e.categorical.categories,a=_.head(o),i=P.ScalarUtils.getScalarKeys(a),r=P.CartesianHelper.hasCategoryHierarchy(e),a=P.ScalarUtils.shouldDrawScalar(s.objects,P.columnChartProps.categoryAxis.axisType,a.source.type,i,r),r&&(i=n.areNonLeafLevelsFilteredToUniqueValue(o),r=A.DataViewObjects.getValue(s.objects,P.cartesianChartProps.categoryAxis.concatenateLabels,P.CartesianHelper.DefaultConcatenateLabelsValue),!i||!r&&t)?(o=n.isSortedByCategoryFirst(e),s=_.some(e.categorical.categories,function(e){return e.source&&e.source.identityExprs}),e=t&&!r&&s&&(o||i||this.easierHierarchicalAxis),this.renderModes.unshift(2),e&&this.renderModes.unshift(3),r||s||(this.warnings=[{selector:null,warnings:[new P.NoIdentityExprWarning]}])):this.renderModes.unshift(1),a&&this.renderModes.unshift(0)):this.renderModes.push(2)},n.prototype.getRenderMode=function(){return _.head(this.renderModes)},n.prototype.getRenderModes=function(){return this.renderModes},n.prototype.addObjectWarnings=function(e){this.warnings&&e.push.apply(e,this.warnings||[])},n.isSortedByCategoryFirst=function(e){return!(!e||!e.categorical||_.isEmpty(e.categorical.categories)||!e.metadata||_.isEmpty(e.metadata.columns))&&_.every(e.categorical.categories,function(e,t){e=e.source;return e&&null!=e.sort&&e.sortOrder===t})},n.areNonLeafLevelsFilteredToUniqueValue=function(e){if(_.isEmpty(e))return!1;for(var t=e.length-1,a=0;a<t;a++){var i=e[a].source;if(!i||!A.DataViewObjects.getValue(i.objects,P.cartesianChartProps.filters.filteredToUniqueValue,!1))return!1}return!0};var d=n;function n(e,t,a){this.easierHierarchicalAxis=a,this.processDataView(e,t)}P.CartesianAxisRenderModeSelector=d,L.filterDataToViewport=function(e){if(e&&e.scrollScale){var t=e.scrollScale,a=e.mainAxisScale,i=P.AxisHelper.invertOrdinalScale(t,e.extent.start),r=i+e.visibleCategoryCount,o=e.axesLayout.axes.y1.orientation,p=t.domain().slice(i,r);if(!_.isEqual(p,a.domain())){if(p&&0<p.length){for(var s=0,n=e.layers;s<n.length;s++)n[s].setFilteredData(p[0],p[p.length-1]+1);a.domain(p);var g=e.axesLayout.axes,t=void 0,l=((t=e.axesLayout.isXScrollBarVisible?g.x:g.y1).axis.scale(a),t.scale(a),t.axis.ticks(p.length),t.axis.tickValues(p),P.SvgCartesianAxes.getTickFormatter(t.axis));if(t.values=_.map(p,function(e){return l(e)}),!_.isEmpty(g.hierStack))for(var y=g.x.isCategoryAxis,m=o===P.AxisOrientation.left,v=e.axesLayout.tickLabelMargins,S=P.CartesianAxes.getLeafHeight(y?v.xMax:m?v.yLeft:v.yRight,v.stackHeight,g.hierStack.length),c=0;c<g.hierStack.length;c++)!function(e){var t=g.hierStack[e],a=P.AxisHelper.getCategoryThickness(t.scale),i=t.values,r=L.setLabelsAtEdges(p,i);if(t.axis.ticks(p.length),t.axis.tickValues(p),t.axis.tickFormat(function(e){e=i[r[p.indexOf(e)]];return e===P.CartesianAxes.hierarchyPlaceholder?"":_.isString(e)?e:"".concat(e)}),0===e)return;for(var o=[],s=[],n=[],l=void 0,c=0;c<r.length;c++){var u,d=p[c],h=r[c];t.values[h]!==P.CartesianAxes.hierarchyPlaceholder?(null!=l&&(o[l]=P.CartesianAxes.getMaxCategoryWidth(u=d-l,a),s[l]=P.CartesianAxes.getHierarchyLineStyleInfo({levelIndex:e,stackHeight:v.stackHeight,leafHeight:S,categorySpanCount:u,categoryWidth:a},y,!m)),n[d]=i[h],l=d):n[d]=P.CartesianAxes.hierarchyPlaceholder}null!=l&&(u=p[r.length-1]-l+1,o[l]=P.CartesianAxes.getMaxCategoryWidth(u,a),s[l]=P.CartesianAxes.getHierarchyLineStyleInfo({levelIndex:e,stackHeight:v.stackHeight,leafHeight:S,categorySpanCount:u,categoryWidth:a},y,!m)),t.categoryLabelMaxWidths=o,t.lineStyleInfo=s,t.adjustedValues=n}(c)}return{startIndex:i,endIndex:r-1}}}},L.prototype.destroy=function(){this.scrollbar.remove()},L.prototype.render=function(e,t,a,i,r,o,s,n,l,c,u,d){var h=this,p=e.plotArea,g=(this.axisScale=null,e.isXScrollBarVisible||e.isYScrollBarVisible),y=P.CartesianChartConverter.isLineComboChart(l)?P.CartesianChartConverter.getMaximumSeriesSettings(t):P.CartesianChartConverter.getDefaultLineChartSeriesLabelSettings(),m=e.margin,v=!0;P.ComboChart.isComboChart(l)&&!c&&(v=!1);var S,f,b,x,C,w,D,l=e.viewport.width-(m.left+m.right),c=y.seriesPosition===P.labelSeriesPosition.right?m.left:m.left+this.getSeriesWidth(l,y,v);(s||g)&&(D=(w=(C=this.cartesianAxes.isYAxisCategorical?(this.axisScale=e.axes.y1.scale,S=e.viewport.width,f=e.margin.top,D=e.axes.y1.categoryThickness,b=e.axes.y1.outerPaddingRatio,x=e.axes.y1.innerPaddingRatio,w=D*b,p.height):(this.axisScale=e.axes.x.scale,S=c,f=e.viewport.height,D=e.axes.x.categoryThickness,b=e.axes.x.outerPaddingRatio,x=e.axes.x.innerPaddingRatio,w=D*b,p.width),Math.max(1,A.Double.floorWithPrecision((C-2*w)/D))),C)),g?(this.scrollScale=this.axisScale.copy(),this.scrollScale.range([0,D]).paddingInner(.1).paddingOuter(0),this.extentLength=this.scrollScale(w-1)+this.scrollScale.bandwidth(),this.scrollHandler=new M({visibleScale:this.axisScale,fullScale:this.scrollScale,onScroll:function(e){e=h.scrollScale(e);h.scrollbar.setExtent({start:e,end:null}),h.scrollbar.refreshExtentAndVisual()}}),this.axisScale.range([0,C]).paddingInner(x).paddingOuter(b),this.scrollbar.setOrientation(e.isXScrollBarVisible),this.scrollbar.setScale(this.scrollScale,n),this.scrollbar.scrollBarLength=D,this.scrollbar.setExtentLength(this.extentLength),o||this.scrollbar.setExtent({start:0,end:null}),this.renderVisualOptions={axesLayout:e,layers:t,categoryLoadMoreDataHandler:s,mainAxisScale:this.axisScale,renderDelegate:i,scrollScale:this.scrollScale,visibleCategoryCount:w,animateCategoryAxis:this.animateCategoryAxis,animateValueAxis:this.animateValueAxis},this.scrollbar.render(S,f,function(){return h.onRefreshVisual(function(e,t){return L.renderVisual(h.renderVisualOptions,e,t,r)},d)},u,d),o&&s?(m=s.viewportDataRange?s.viewportDataRange.startIndex:0,this.scrollTo(m)):L.renderVisual(this.renderVisualOptions,this.scrollbar.getExtent(),a,r)):(s&&(s.resetViewport(w),s.shouldLoadMoreData())&&s.loadMoreData(),this.scrollbar.remove(),i(t,e,a,this.animateCategoryAxis,this.animateValueAxis,r))},L.prototype.getSeriesWidth=function(e,t,a){return t&&t.show&&a?t.seriesMaximumWidth/100*e:0},L.prototype.scrollDelta=function(e){this.scrollHandler.scrollDelta(e)},L.prototype.scrollTo=function(e){this.scrollHandler.scrollTo(e)},L.prototype.shouldScrollTo=function(e){var t;return!!this.scrollHandler&&(t=this.axisScale.domain(),!_.isEmpty(t))&&(e<t[0]||e>t[t.length-1])},L.prototype.setExtent=function(e){this.scrollbar.setExtent(e),this.scrollbar.refreshExtentAndVisual()},L.prototype.scrollBy=function(e){var t=this.axisScale.domain();_.isEmpty(t)||this.scrollHandler.scrollTo(t[0]+e)},L.prototype.clearRenderingTimeout=function(){this.scrollbar&&this.scrollbar.clearRenderingTimeout()},L.prototype.onRefreshVisual=function(e,t){e(this.scrollbar.getExtent(),!0),t&&t.refreshOutlines()},L.setLabelsAtEdges=function(e,t){if(e.length<=1||t[e[0]]!==P.CartesianAxes.hierarchyPlaceholder)return e;var a=e[0],e=e.slice();if(a<t.length&&0<=a){for(;t[a]===P.CartesianAxes.hierarchyPlaceholder&&0<=a;a--);e[0]=a}return e},L.renderVisual=function(e,t,a,i){var r,t=L.filterDataToViewport({mainAxisScale:e.mainAxisScale,layers:e.layers,scrollScale:e.scrollScale,extent:t,visibleCategoryCount:e.visibleCategoryCount,axesLayout:e.axesLayout,animateCategoryAxis:e.animateCategoryAxis,animateValueAxis:e.animateValueAxis});t&&(e.categoryLoadMoreDataHandler&&((r=e.categoryLoadMoreDataHandler).viewportDataRange=t,r.shouldLoadMoreData())&&r.loadMoreData(),e.renderDelegate(e.layers,e.axesLayout,a,e.animateCategoryAxis,e.animateValueAxis,i))},L.ScrollbarWidth=10;var i=L;function L(e,t,a,i){this.cartesianAxes=e,this.scrollbar=t,this.animateCategoryAxis=a,this.animateValueAxis=i}P.ScrollableAxes=i,r.prototype.scrollDelta=function(e){_.isEmpty(this.visibleScale.domain())||(this.totalScrollDistance<0&&0<e||0<this.totalScrollDistance&&e<0?this.totalScrollDistance=e:this.totalScrollDistance+=e,e=r.getStepSize(this.visibleScale),Math.abs(this.totalScrollDistance)>=e?(this.extendScrollTimeout&&this.extendScrollTimeout.cancel(),e=this.getNewStartIndex(this.totalScrollDistance),this.scrollTo(e),this.totalScrollDistance=0):this.extendScrollTimeout())},r.prototype.scrollTo=function(e){e=this.clampIndex(e);this.onScroll(e)},r.getStepSize=function(e){var t=_.map(e.domain(),e);return 1<t.length?t[1]-t[0]:(t=e.range())[1]-t[0]},r.prototype.getNewStartIndex=function(e){var t=0<=e,a=(e=t?e:-e,this.visibleScale),i=_.map(a.domain(),a),r=a.domain(),o=r[0],i=i[0]+e;return(t?1:-1)*(a.range()[1]<i?r.length:P.AxisHelper.invertOrdinalScale(a,i)-o)+o},r.prototype.clampIndex=function(e){var t=this.fullScale.domain(),a=_.head(t),t=_.last(t);return Math.max(a,Math.min(t,e))},r.prototype.onTimeout=function(){this.totalScrollDistance=0},r.defaultTimeoutMs=1e3;var M=r;function r(e){e.visibleScale,e.fullScale,e.onScroll,this.visibleScale=e.visibleScale,this.fullScale=e.fullScale,this.onScroll=e.onScroll;e=jsCommon.Utility.valueOrDefault(e.timeout,r.defaultTimeoutMs);this.extendScrollTimeout=_.debounce(this.onTimeout,e),this.totalScrollDistance=0}P.AxisScrollHandler=M,l.prototype.create=function(e,t){return new P.ScatterChart(__assign(__assign({},e),{viewModelAdapterFactory:t&&{create:function(e){return t.createLayerAdapter(2,e)}}}))};var o=l;function l(){this.categoryAxisTitleOnByDefault=!0,this.valueAxisTitleOnByDefault=!0}p.prototype.create=function(e,t){return new P.WaterfallChart(__assign(__assign({},e),{viewModelAdapterFactory:t&&{create:function(e){return t.createLayerAdapter(3,e)}}}))};var h=p;function p(){}f.prototype.create=function(e,t){return new P.DataDotChart(e)};var m=f;function f(){}x.prototype.create=function(e,t){return new P.ColumnChart({interactivityService:e.interactivityService,isScrollable:e.isScrollable,tooltipsEnabled:e.tooltipsEnabled,featureSwitches:e.featureSwitches,chartType:this.type,viewModelAdapterFactory:t&&{create:function(e){return t.createLayerAdapter(5,e)}}})};var b=x;function x(e){this.type=e}w.prototype.create=function(e,t){return new P.Histogram(e)};var C=w;function w(){}V.prototype.create=function(e,t){e={interactivityService:e.interactivityService,isScrollable:e.isScrollable,tooltipsEnabled:e.tooltipsEnabled,chartType:this.type,featureSwitches:e.featureSwitches,viewModelAdapterFactory:t&&{create:function(e){return t.createLayerAdapter(0,e)}}};return this.inComboChart&&(e.chartType=8|e.chartType),new P.LineChart(e)};var D=V;function V(e,t){this.type=e,this.inComboChart=t}T.prototype.create=function(e,t){return e.isScrollable=!1,new P.RealTimeLineChart(e)};var B=T;function T(){}F.prototype.createLayers=function(e){var t=this,a={isScrollable:null!=e.isScrollable&&e.isScrollable,interactivityService:e.interactivityService,tooltipsEnabled:e.tooltipsEnabled,featureSwitches:e.featureSwitches};return _.map(this.layerMetadata,function(e){return e.create(a,t.viewModelAdapterFactory)})},F.initLayerMetadata=function(e){var t=[];switch(e){case 1:t.push(new D(2,!1));break;case 0:t.push(new D(1,!1));break;case 2:t.push(new D(16,!1));break;case 18:t.push(new B);break;case 10:t.push(new o);break;case 13:t.push(new h);break;case 12:t.push(new m);break;case 4:t.push(new b(20));break;case 3:t.push(new b(12));break;case 8:t.push(new b(52));break;case 6:t.push(new b(18));break;case 5:t.push(new b(10));break;case 7:t.push(new b(50));break;case 9:t.push(new b(68));break;case 11:t.push(new b(F.getComboColumnType())),t.push(new D(1,!0));break;case 14:t.push(new b(12)),t.push(new D(1,!0));break;case 15:t.push(new b(20)),t.push(new D(1,!0));break;case 16:t.push(new b(12)),t.push(new m);break;case 17:t.push(new b(20)),t.push(new m);break;case 19:t.push(new C)}return t},F.getComboColumnType=function(e){var t=12;if(e){var a=e.general;if(a){switch(a.visualType1){case"Column":t=12;break;case"ColumnStacked":t=20;break;default:"Unsupported cartesian chart type ".concat(a.visualType1)}a.visualType2}}return t};var R=F;function F(e,t){this.viewModelAdapterFactory=t,this.layerMetadata=F.initLayerMetadata(e)}k.prototype.getAllColors=function(){return this.palette.getAllColors()},k.prototype.getColorScaleByKey=function(e){return this.setPreferredScale(e),this.preferredScale},k.prototype.getNewColorScale=function(){return this.preferredScale},k.prototype.getColorByIndex=function(e){return this.palette.getColorByIndex(e)},k.prototype.getSentimentColors=function(){return this.palette.getSentimentColors()},k.prototype.getGradientColors=function(){return this.palette.getGradientColors()},k.prototype.getBasePickerColors=function(){return this.palette.getBasePickerColors()},k.prototype.clearPreferredScale=function(){this.preferredScale=this.palette.getNewColorScale(),this.rotated=!1},k.prototype.rotateScale=function(){this.preferredScale=this.preferredScale.clone(),this.preferredScale.clearAndRotateScale(),this.rotated=!0},k.prototype.setPreferredScale=function(e){this.rotated||(this.preferredScale=this.palette.getColorScaleByKey(e))};var I=k;function k(e){this.palette=e,this.clearPreferredScale()}P.SharedColorPalette=I,N.prototype.update=function(e,t){this.enabled=!t&&0!==e},N.prototype.resetViewport=function(e){this.viewportDataRange={startIndex:0,endIndex:e}},N.prototype.setScale=function(e){e=e&&e.domain&&e.domain().length;e&&(this.loadMoreThresholdIndex=e-1-this.loadMoreThreshold)},N.prototype.isLoadingMoreData=function(){return this.loadingMoreData},N.prototype.onLoadMoreDataCompleted=function(){this.loadingMoreData=!1},N.prototype.shouldLoadMoreData=function(){var e=this.viewportDataRange;return!(!this.enabled||!e||this.isLoadingMoreData())&&e.endIndex>=this.loadMoreThresholdIndex},N.prototype.loadMoreData=function(){return this.isLoadingMoreData()?e.WaitingForData:(this.loadingMoreData=!0,this.hostServices.loadMoreData(),e.TriggeredLoadMore)};var O=N;function N(e,t,a){void 0===a&&(a=0),this.enabled=!1,this.loadMoreThreshold=a,this.hostServices=t,this.setScale(e)}P.CartesianCategoryLoadMoreDataHandler=O}(powerbi=powerbi||{}),function(e){var u=e.visuals||(e.visuals={}),i=jsCommon.BrowserUtils,s={rectangle:{name:"rectangle",directionMode:0},centerBasedRectangle:{name:"centerBasedRectangle",directionMode:1},edgeBasedRectangle:{name:"edgeBasedRectangle",directionMode:2}};function t(e,t){this.behaviorFactories=e,this.featureSwitches=t}t.prototype.create=function(){var e=this.behaviorFactories.map(function(e){return e.create()});return new a(e,this.featureSwitches)},u.CartesianChartBehaviorFactory=t,c.prototype.bindEvents=function(e,t,a,i){for(var r,o,s=this.behaviors,n=0,l=s.length;n<l;n++)s[n].bindEvents(e.layerOptions[n],t,a,i);this.axesLayout=e.axesLayout,this.categorySubRangeCount=e.categorySubRangeCount,this.verticalCategoryAxis=e.verticalCategoryAxis,this.selectionHandler=t,i?e.clearCatcher.on("click",null):e.clearCatcher.on("click",function(){u.InteractivityUtils.handleClearSelection(t)}),a&&(r=a.dataPointNavigationManager,o=a.pointSourceKey,r.isEmpty(o)||this.registerFocusKeyHandler(e.root,e.layerOptions))},c.prototype.renderSelection=function(e){for(var t=0,a=this.behaviors;t<a.length;t++)a[t].renderSelection(e)},c.prototype.renderFocus=function(e){for(var t=0,a=this.behaviors;t<a.length;t++)a[t].renderFocus(e)},c.prototype.lassoSelectRect=function(e,t){var a,i=[],r=this.getLassoSelectDirectionMode(),o=this.getScaledRegion(t,r);if(void 0!==r){for(var s=0,n=this.behaviors;s<n.length;s++){var l=n[s];a=void 0,(l=l).lassoSelectRectLayer&&l.getLassoSelectDirectionMode&&(a=c.getRectResultKeys(l.getLassoSelectDirectionMode()),a=o[a[0]],i.push.apply(i,l.lassoSelectRectLayer(a)))}u.InteractivityUtils.lassoSelectPoints(e,i,this.selectionHandler)}},c.prototype.getLassoSelectDirectionMode=function(){for(var a=[],e=0,t=this.behaviors;e<t.length;e++)!function(e){var t;e.getLassoSelectDirectionMode&&(t=e.getLassoSelectDirectionMode(),_.some(a,function(e){return e===t})||a.push(t))}(t[e]);if(0!==a.length)return 1===a.length?a[0]:3},c.getRectResultKeys=function(e){return 0===e?[s.rectangle.name]:1===e?[s.centerBasedRectangle.name]:2===e?[s.edgeBasedRectangle.name]:[s.centerBasedRectangle.name,s.edgeBasedRectangle.name]},c.prototype.getScaledRegion=function(e,t){for(var a={},i=0,r=c.getRectResultKeys(t);i<r.length;i++){var o=r[i];a[o]={dataSpace:this.getScaledRegionInternal(e,s[o].directionMode),pixelValue:e}}return a},c.prototype.getScaledRegionInternal=function(e,t){var a=e.left-this.axesLayout.margin.left,i=e.top-this.axesLayout.margin.top,r=e.right-this.axesLayout.margin.left,e=e.bottom-this.axesLayout.margin.top,o=2===t?this.categorySubRangeCount:void 0,s=0===t||this.verticalCategoryAxis?0:-1,n=0===t||this.verticalCategoryAxis?0:1,l=0!==t&&this.verticalCategoryAxis?-1:0,c=0!==t&&this.verticalCategoryAxis?1:0,a={left:this.axesLayout.axes.x.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.x.scale,r,n,t,o):u.AxisHelper.invertScale(this.axesLayout.axes.x.scale,a,s,t,o),top:this.axesLayout.axes.y1.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.y1.scale,e,c,t,o):u.AxisHelper.invertScale(this.axesLayout.axes.y1.scale,i,l,t,o),right:this.axesLayout.axes.x.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.x.scale,a,s,t,o):u.AxisHelper.invertScale(this.axesLayout.axes.x.scale,r,n,t,o),bottom:this.axesLayout.axes.y1.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.y1.scale,i,l,t,o):u.AxisHelper.invertScale(this.axesLayout.axes.y1.scale,e,c,t,o)};return this.axesLayout.axes.y2&&_.assign(a,{top2:this.axesLayout.axes.y2.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.y2.scale,e,c,t,o):u.AxisHelper.invertScale(this.axesLayout.axes.y2.scale,i,l,t,o),bottom2:this.axesLayout.axes.y2.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.y2.scale,i,l,t,o):u.AxisHelper.invertScale(this.axesLayout.axes.y2.scale,e,c,t,o)}),a},c.prototype.registerFocusKeyHandler=function(e,a){e.on("keydown.cartesian",function(){var e,t=d3.event;27===t.keyCode&&_.some(a,function(e){return $.contains(e.root.node(),t.target)})&&(t.preventDefault(),t.stopPropagation(),e=_.find(a,function(e){return $(e.root.node()).is(":tabbable")}),i.focus(e.root.node()))})};var a=c;function c(e,t){this.behaviors=e}u.CartesianChartBehavior=a}(powerbi=powerbi||{}),function(he){var pe=he.visuals||(he.visuals={});function ge(){this.existingTooltips=[]}Object.defineProperty(ge.prototype,"displayNames",{get:function(){var e;return this._displayNames||(e=this.options.hostServices,this._displayNames={negative:e.getLocalizedString("Visual_TotalTooltipNegative"),positive:e.getLocalizedString("Visual_TotalTooltipPositive"),net:e.getLocalizedString("Visual_TotalTooltipNet"),simple:e.getLocalizedString("Visual_Total")}),this._displayNames},enumerable:!1,configurable:!0}),ge.prototype.convert=function(e){for(var t,a,i=(this.options=e).dataView,r=e.style,o=e.is100PercentStacked,o=void 0!==o&&o,s=e.isScalar,s=void 0!==s&&s,n=e.dataViewMetadata,n=void 0===n?null:n,l=e.multipleInfo,c=e.chartType,u=e.interactivityService,d=e.tooltipsEnabled,d=void 0===d||d,h=e.hostServices,p=e.ribbonChart,g=e.isCombo,y=e.buildCategories,e=e.supportsTotalLabels,m=pe.CartesianHelper.getCategoryAxisProperties(n,!1),v=pe.CartesianHelper.getPreferredCategoryWidth(m),S=pe.CartesianHelper.getReverseStackOrder(m),s=pe.CartesianHelper.isScalar(s,m),m=i.categorical,f=new O(i,r),y=pe.converterHelper.getPivotedCategories(m,pe.columnChartProps.general.formatString,y),b=y.categories,y=y.categoryFormatter,m=pe.CartesianHelper.getScalarKeyinfo(m,s).category.source,x=pe.ColumnChart.getDefaultColumnLabelSettings(r,g),C=(n&&n.objects&&(L=n.objects.labels,pe.DataLabelViewModel.updateLabelSettingsFromLabelsObjectWithLabelDensity(L,x,!pe.ColumnChart.isBar(c),r,g)),__assign(__assign({},x),{show:!1})),w=(e&&n&&n.objects&&(w=n.objects.totals)&&pe.DataLabelViewModel.updateLabelSettingsFromLabelsObject(w,C,!1,r,g),this.totalLabelsSettings=C,p&&(t=pe.ColumnChart.getRibbonsUtils().getRibbonOptionsFromDataviewObjects(n,pe.columnChartProps,S)),f.getLegend()),D=w.legend.dataPoints,A=w.seriesSources,P=pe.ColumnChart.getDefaultLineChartSeriesLabelSettings(r),n=(n&&n.objects&&(L=n.objects.seriesLabels,pe.DataLabelViewModel.updateSeriesLabelSettingsFromLabelsObject(L,P,r,g),P.defaultSeriesWidth=P.defaultSeriesWidth?-1:null,P.seriesMaximumWidth=P.defaultSeriesWidth?-1:P.seriesMaximumWidth),this.createDataPoints({dataView:i,categories:b,legend:D,converterStrategy:f,defaultDataLabelsSettings:x,defaultSeriesSettings:P,totalLabelsSettings:C,is100PercentStacked:o,isScalar:s,isCombo:!!g,style:r,chartType:c,categoryMetadata:m,multipleInfo:l,tooltipsEnabled:d,ribbonChart:p,hostServices:h,ribbonOptions:t,supportsTotalLabels:e,reverseStackOrder:S})),L=n.series,M=(pe.canSupportOutsidePosition(c,L.length)?null!=x.position&&_.includes(pe.clusteredValidLabelPositionOptions,x.position)||(x.position=pe.labelPosition.auto):null!=x.position&&_.includes(pe.stackedValidLabelPositionOptions,x.position)||(x.position=pe.labelPosition.auto),[]),V=0,T=D.length;V<T;V++)M.push(A[V]);if(u){for(var F=0,I=L;F<I.length;F++){var k=I[F];u.applySelectionStateToData(k.data)}u.applySelectionStateToData(w.legend.dataPoints)}return r.isHighContrast&&(a={visible:!0,color:pe.ColorHelper.getThemeColor(r,pe.ForegroundColorName),width:pe.CartesianHelper.defaultLineStrokeWidth}),{categories:b,categoryIdentities:n.categoryIdentities,categoryFormatter:y,preferredCategoryWidth:v,series:L,totals:n.totals,hasPositive:n.hasPositive,hasNegative:n.hasNegative,hasNetPositive:n.hasNetPositive,hasNetNegative:n.hasNetNegative,hasY2Role:he.data.DataRoleHelper.hasRoleInDataView(i,"Y2"),valuesMetadata:M,legendData:w.legend,hasHighlights:n.hasHighlights,valuesMetadataBySeries:n.valuesMetadataBySeries,categoryMetadata:m,scalarCategoryAxis:s,dataLabelsSettings:x,seriesLabelSetings:P,totalLabelsSettings:C,hasDynamicSeries:n.hasDynamicSeries,isMultiMeasure:n.isMultiMeasure,ribbonChartData:p?{ribbonChartDataPoints:n.ribbonChartDataPoints,ribbonOptions:t}:void 0,strokeSettings:a,multipleIdentity:n.multipleIdentity}},ge.prototype.createDataPoints=function(R){var n,ne,le=this,H=R.dataView,U=H.categorical,j=pe.columnChartProps.general.formatString,z=pe.cartesianRoleNames.y,E=he.data.createDataViewCategoricalReaderAdvanced(H,{staticSeriesRoleNames:[z],colorOptions:{valueRole:z,visualStyle:R.style},formatStringProp:j,errorRangeProp:pe.ErrorObjectProps.errorRange}),W=U&&U.values?U.values.grouped():void 0,G=R.categories.length,Y=E.data.hasValues(z)?E.data.getSeriesCount():void 0,X=[],K=[],q=R.chartType,p=pe.ColumnChart.isStacked(q,Y);if(Y<1||G<1)return{series:X,totals:K,hasPositive:!1,hasNegative:!1,hasNetPositive:!1,hasNetNegative:!1,valuesMetadataBySeries:[],categoryIdentities:[],ribbonChartDataPoints:null,hasHighlights:!1,hasDynamicSeries:!1,isMultiMeasure:!1};for(var g,Z,$,e=U.categories,e=(R.categoryMetadata,_.isEmpty(e)?null:_.last(e).source),e=pe.AxisHelper.getCategoryValueType(e),ce=pe.AxisHelper.isDateTime(e),J=[],y=[],Q=[],ee=[],te=[],l=[],ae=!(!U.values||!U.values.source),e=!ae&&1<Y,ie=R.multipleInfo,re=(ie&&(Z=_.first(ie.sources).metadata.queryName,$=ie.sources.map(function(e){return pe.buildValueDetailsForColumnValue(e.metadata,e.value,ie.identity)}),g=(new pe.SelectionIdBuilder).withColumnIdentity(ie.identity,Z,$).createSelectionId()),!1),oe=E.data.hasHighlights(),t=R.converterStrategy,a=0;a<Y;a++){for(var m=[],v=[],i=0;i<G;i++){var S,r=t.getValueBySeriesAndCategory(a,i),o=t.getFormatStringBySeriesAndCategory(a,i);m[i]={value:r,formatString:o},oe&&(o=t.getHighlightBySeriesAndCategory(a,i),S=t.getHighlightFormatStringBySeriesAndCategory(a,i),v[i]={value:o,formatString:S},null==r||null==o||0<=r&&0<=o&&he.Double.greaterOrEqualWithPrecision(r,o)||r<=0&&o<=0&&he.Double.lessOrEqualWithPrecision(r,o)||(re=!0))}J.push(m),oe&&y.push(v)}re&&!pe.canSupportOutsidePosition(q,Y)&&(oe=re=!1,J=y);for(var ue=R.defaultDataLabelsSettings.fontProperties.color,de=this.totalLabelsSettings.fontProperties.color,f=function(e){for(var L=e,M=null!=(n=se.options.featureSwitches)&&n.flipStackOrder&&R.reverseStackOrder?Y-e-1:e,V=[],e=R.legend[L],T=void 0,t=void 0,a=((E.data.hasSeries()||R.isCombo)&&(i=void 0,a=(i=R.isCombo&&!E.data.hasSeries()?E.objects.getValueMetadataObjects(z,M):E.objects.getSeriesDataObjects(M))&&i.labels,i=i&&i.seriesLabels,(T=he.Prototype.inherit(R.defaultDataLabelsSettings)).show=R.defaultDataLabelsSettings.show&&(null==(n=R.defaultDataLabelsSettings.showByDefault)||n),a&&pe.DataLabelViewModel.updateLabelSettingsFromLabelsObjectWithLabelDensity(a,T,void 0,R.style,R.isCombo),(t=he.Prototype.inherit(R.defaultSeriesSettings)).show=R.defaultSeriesSettings.show&&(null==(n=R.defaultSeriesSettings.showByDefault)||n),i)&&pe.DataLabelViewModel.updateSeriesLabelSettingsFromLabelsObject(i,t,R.style,R.isCombo),e.color),i=E.columns.getValueColumnBySeries(M),F=ee[M]=E.columns.getValueMetadataColumn(z,M),t=t||R.defaultSeriesSettings,r=_.findIndex(ee,F),I=(-1!==r&&(l[r]?l[r].usedInSeriesIndices.push(M):l[r]={metadataColumn:F,usedInSeriesIndices:[M],valueSelector:(new pe.SelectionIdBuilder).withMeasure(F.queryName,i).createSelectionId()}),pe.UncertaintyHelper.convertErrorMetadata(p?{}:F.objects,R.style,a,M,__assign(__assign({},R.defaultDataLabelsSettings),{show:!1}),{isCombo:R.isCombo,hideBand:!0,valueAxisHorizontal:pe.ColumnChart.isBar(q),staticObjects:E.objects.getStaticObjects()})),k=I.hasUncertainty,r={displayName:e.label,key:"series".concat(M),index:M,data:V,identity:e.identity,color:a,labelSettings:T,uncertainty:I,type:F.type,seriesSettings:t},O=(X.push(r),pe.GradientUtils.getGradientMeasureIndex(U)),N=pe.GradientUtils.getGradientValueColumn(U),B=pe.valueFormatter.getLocalizedString("Percentage"),o=function(o){var s=pe.AxisHelper.normalizeNonFiniteNumber(J[M][o].value),n=J[M][o].formatString;if(null==s&&0<L)return"continue";var l=s,e=R.categories[o];if(ce&&null!=e&&!(e instanceof Date))return"continue";var c,t=void 0,t=e instanceof Date?e.epochTimeStamp:e;if(R.isScalar&&(null==t||isNaN(t)))return"continue";k&&(c=pe.UncertaintyHelper.convertCategoricalDataPoint(E.data,o,M,s));var u,d,h,p,a,e=void 0,g=R.is100PercentStacked,i=(g&&(e=pe.StackedUtil.getStackedMultiplier(_.map(J,function(e){return _.map(e,function(e){return e.value})}),o)),s),r=(te[M]||(te[M]=[]),te[M][o]=s<0),y=(e&&(s*=r?e.neg:e.pos),K[o]||(K[o]={positive:0,negative:0,net:0,categoryValue:t,categoryIndex:o,dynamicFormatString:n}),pe.DataLabelUtil.determineTotalLabelFillColor({defaultColor:de,categoricalDataReader:E,categoryIndex:o,seriesIndex:L})),m=pe.DataLabelUtil.isAssignedColor(y)?y.color:ue,v=(se.totalLabelsSettings.fontProperties=pe.DataLabelUtil.updateFontPropertiesColor(m,se.totalLabelsSettings.fontProperties),K[o].labelFill=y.color,Math.abs(s)),m=void 0,y=(r?(m=K[o].negative,isNaN(v)||(K[o].negative-=v,K[o].net-=v)):(isNaN(v)||(K[o].positive+=v,K[o].net+=v),m=K[o].positive),W&&W.length>M&&W[M].values?W[M]:null),S=_.isEmpty(U.categories)?null:U.categories[0],y=ge.createIdentities(U,S,o,y,E.columns.getValueColumn(z,M),F,ie,Z,$),f=y.identity,y=y.identityKey,b=(Q[o]||(Q[o]=function(){return pe.CartesianHelper.getCategoryIdentity(o,S)}),E.colors.createBySeries(M,o)),x=0===O?null:N,C=void 0,w=void 0,D=void 0,e=(oe&&(u=E.data.getHighlight(z,o,M),d=E.data.getHighlightFormatString(z,o,M),C=null!==(p=u)?(k&&(h=pe.UncertaintyHelper.convertCategoricalDataPoint(E.data,o,M,u,!0)),g&&(u*=0<u?e.pos:e.neg),Math.abs(u)):0,w=function(e,t,a,i,r){0<a?e-=i-r:(null===a||0===a)&&0<t&&(e-=i);return e}(m,s,u,v,C),D=pe.SelectionId.createWithHighlight(f)),R.tooltipsEnabled&&(a=new pe.LazyTooltipBuilder).withLazyValues(function(){var e,t,a=[],i=(ie&&(i=pe.TooltipBuilder.withMultipleColumnAndValues(ie.sources.map(function(e){return e.metadata}),ie.sources.map(function(e){return e.value}),!0,pe.FormattingStrategies.defaultFormatter(j)))&&a.push(i()),S&&(i=pe.CategoryLevelUtils.getCategoryLevels(H.categorical.categories,o,j),e=pe.CategoryLevelUtils.concatenateCategoryLevels(i),132===q&&(e=pe.Histogram.buildTooltipCategories(i,o,G)),a.push({displayName:e.displayName,value:e.value})),!ae||S&&S.source===U.values.source||a.push({displayName:U.values.source.displayName,value:pe.converterHelper.formatFromMetadataColumn(W[M].name,U.values.source,j)}),function(e){return pe.converterHelper.formatFromMetadataColumn(e,F,j,!1,n)}),r=(null!=l&&(e=void 0,r=i(l),e=g?(t=pe.valueFormatter.format(v,B),"".concat(r," (").concat(t,")")):r,t=I.tooltips,!k||oe||!t.show||t.format!==pe.errorFormat.range||(r=pe.UncertaintyHelper.getTooltipItems(c,s,I,i,R.hostServices,{overrideDisplayName:F.displayName}),_.isEmpty(r))?a.push({displayName:F.displayName,value:e}):a.push(r[0])),oe&&(i=function(e){return pe.converterHelper.formatFromMetadataColumn(e,F,j,!1,d)},e=function(e,t,a,i,r,o,s){var n,l;null!=e&&null!=t&&(t=pe.valueFormatter.format(t,i),l=pe.converterHelper.formatFromMetadataColumn(e,r,o,!1,a),n="".concat(l," (").concat(t,")"));if(s)return n;return l}(p,u,d,B,F,j,g))&&(t=I.tooltips,!k||!t.show||t.format!==pe.errorFormat.range||(r=pe.UncertaintyHelper.getTooltipItems(c,s,I,i,R.hostServices,{overrideDisplayName:pe.ToolTipComponent.localizationOptions.highlightedValueDisplayName}),_.isEmpty(r))?a.push({displayName:pe.ToolTipComponent.localizationOptions.highlightedValueDisplayName,value:e}):a.push(r[0])),k&&I.tooltips.format!==pe.errorFormat.range&&(t=oe?h:c)&&a.push.apply(a,pe.UncertaintyHelper.getTooltipItems(t,l,I,i,R.hostServices,{hideMarker:!0})),x&&null!=x.values[o]&&a.push({displayName:x.source.displayName,value:pe.converterHelper.formatFromMetadataColumn(x.values[o],x.source,j,!1,he.DataViewObjects.getValue(null==(e=x.objects)?void 0:e[o],j))}),pe.TooltipBuilder.addTooltipMeasures(E,a,o,ae?M:void 0,j),le.getTotalTooltip(M,o,te,K,ee,j));return r&&a.push(r),a}),null!=(ne=X[L].labelSettings)?ne:R.defaultDataLabelsSettings),A=void 0,r=(pe.ColumnChart.isStacked(q,Y)&&(A=function(e,t,a,i,r){for(var o=!(e&&t===a-1&&1!==a),s=t+1;s<a;s++){var n=pe.AxisHelper.normalizeNonFiniteNumber(r[s][i].value);if(null!==n&&((!e||0===t)&&0<n||e&&0!==t)){o=!1;break}}return o}(r,M,Y,o,J)),pe.DataLabelUtil.determineDataLabelFillColor({defaultColor:ue,seriesColor:null==T?void 0:T.fontProperties.color,categoricalDataReader:E,categoryIndex:o,seriesIndex:L})),P=se.options.featureSwitches.measureDrivenDataLabels?pe.DataLabelUtil.extractDynamicLabel({categoricalDataReader:E,categoryIndex:o,seriesIndex:L,hasHighlights:oe,enabled:e.showDynamicLabels}):void 0,i=(P&&(P.enabled=!!se.options.featureSwitches.measureDrivenDataLabels&&P.enabled),{categoryValue:t,value:s,position:m,valueAbsolute:v,valueOriginal:i,seriesIndex:L,labelSettings:e,uncertainty:c,categoryIndex:o,color:b,selected:!1,originalValue:s,originalPosition:m,originalValueAbsolute:v,identity:f,key:y,get tooltipInfo(){return a&&a.getTooltipItems()},get formattedTooltip(){return a&&a.getFormattedTooltipItems()},labelFill:r.color,labelFormatString:n||F.format,lastSeries:A,chartType:q,dynamicLabelValue:oe?void 0:P});V.push(i),oe&&(f={categoryValue:t,value:u,position:w,valueAbsolute:C,valueOriginal:p,seriesIndex:L,labelSettings:e,uncertainty:h,categoryIndex:o,color:b,selected:!1,highlight:!0,originalValue:s,originalPosition:m,originalValueAbsolute:v,drawThinner:re,identity:D,key:D.getKey(),get tooltipInfo(){return a&&a.getTooltipItems()},get formattedTooltip(){return a&&a.getFormattedTooltipItems()},labelFormatString:d||F.format,labelFill:r.color,lastSeries:A,chartType:q,dynamicLabelValue:P},V.push(f))},s=0;s<G;s++)o(s)},se=this,s=0;s<Y;s++)f(s);for(var c,b=!1,x=!1,u=!1,d=!1,C=0,w=K;C<w.length;C++){var h=w[C];h&&(b=b||0<h.positive,x=x||h.negative<0,u=u||0<h.net,d=d||h.net<0)}return this.hasNetPositive=u,this.hasNetNegative=d,1<Y&&1<G&&R.ribbonChart&&(c=pe.ColumnChart.getRibbonsUtils().createRibbonChartDataPoints({dataView:H,columnSeries:X,hasHighlights:oe,hasDynamicSeries:ae,ribbonChartDataPoints:c,categoryCount:G,formatStringProp:j,reader:E,hostServices:R.hostServices,ribbonOptions:R.ribbonOptions})),{series:X,totals:K,hasPositive:b,hasNegative:x,hasNetPositive:u,hasNetNegative:d,valuesMetadataBySeries:l,categoryIdentities:Q,ribbonChartDataPoints:c,hasHighlights:oe,hasDynamicSeries:ae,isMultiMeasure:e,multipleIdentity:g}},ge.createIdentities=function(e,t,a,i,r,o,s,n,l){var c=e.originalCategories||[t],t=pe.SelectionIdBuilder.builder().withCategory(c,a,null==(c=null==t?void 0:t.source)?void 0:c.queryName,!0).withSeries(e.values,i,!0).withMeasure(o.queryName,r,a),c=(t=s?t.withColumnIdentity(s.identity,n,l):t).createSelectionId();return{identity:c,identityKey:c.getKey()}},ge.prototype.getTotalTooltip=function(e,t,a,i,r,o){var s=this.options;if(s.tooltipsEnabled&&s.supportsTotalLabels&&this.totalLabelsSettings.show)return s=a[e][t],this.existingTooltips[t]||(this.existingTooltips[t]={}),this.totalLabelsSettings.showPositiveAndNegative?(this.existingTooltips[t][a=s?"negative":"positive"]||(this.existingTooltips[t][a]={displayName:this.displayNames[a],value:pe.converterHelper.formatFromMetadataColumn(i[t][a],r[e],o,!1)}),this.existingTooltips[t][a]):(this.existingTooltips[t].net||(this.existingTooltips[t].net={displayName:this.hasNetPositive&&this.hasNetNegative?this.displayNames.net:this.displayNames.simple,value:pe.converterHelper.formatFromMetadataColumn(i[t].net,r[e],o,!1)}),this.existingTooltips[t].net)},pe.ColumnChartConverter=ge,e.prototype.getLegend=function(){var e=[],t=[],a=[],i=!1,r=this.reader;if(this.dataView&&this.dataView.values){for(var o=r.columns.getSeriesCount(pe.cartesianRoleNames.y),s=pe.columnChartProps.general.formatString,n=r.columns.hasDynamicSeries(),l=0;l<o;l++){var c=r.columns.getValueMetadataColumnBySeries(l),u=r.objects.getSeriesDataObjects(l);t.push(c),a.push(u);var u=(u=new pe.SelectionIdBuilder).withMeasure(c.queryName),u=(u=n?u.withSeries(r.columns.getSeriesValueColumns(),r.columns.getSeriesValueColumnGroup(l),!0):u).createSelectionId(),d=pe.converterHelper.getFormattedLegendLabel(c,this.dataView.values,s),h=r.colors.createBySeries(l);e.push({icon:pe.LegendIcon.Box,color:h,label:d,identity:u,selected:!1,index:l}),void 0!==c.groupName&&(i=!0)}var p=this.dataView.values,p=p&&p.source?p.source.displayName:""}var g=pe.Legend.getDefaultLegendData(this.visualStyle);return g.title=p,g.dataPoints=e,g.grouped=i,{legend:g,seriesSources:t,seriesObjects:a}},e.prototype.getValueBySeriesAndCategory=function(e,t){return this.reader.data.getValue("Y",t,e)},e.prototype.getHighlightBySeriesAndCategory=function(e,t){return this.reader.data.getHighlight("Y",t,e)},e.prototype.getFormatStringBySeriesAndCategory=function(e,t){return this.reader.data.getFormatString("Y",t,e)},e.prototype.getHighlightFormatStringBySeriesAndCategory=function(e,t){return this.reader.data.getHighlightFormatString("Y",t,e)};var O=e;function e(e,t){this.visualStyle=t,this.dataView=e&&e.categorical,this.reader=he.data.createDataViewCategoricalReaderAdvanced(e,{staticSeriesRoleNames:[pe.cartesianRoleNames.y],colorOptions:{valueRole:pe.cartesianRoleNames.y,visualStyle:t},formatStringProp:pe.columnChartProps.general.formatString})}pe.ColumnChartConverterHelper=O}(powerbi=powerbi||{}),function(u){var m=u.visuals||(u.visuals={}),h=u.visuals.builder,e=jsCommon.CssConstants.createClassAndSelector,d=u.data.DataViewWildcard,a=jsCommon.DOMConstants,i=jsCommon.EnumExtensions,s=u.visuals.OnObjectUtil,n=m.shapes.Rect,p=u.data.Selector,g="Auto",r=(m.clusteredValidLabelPositionOptions=[g,m.labelPosition.outsideEnd,m.labelPosition.insideEnd,m.labelPosition.insideCenter,m.labelPosition.insideBase],m.stackedValidLabelPositionOptions=[g,m.labelPosition.insideCenter,m.labelPosition.insideEnd,m.labelPosition.insideBase],m.innerPaddingMin=0,m.innerPaddingMax=50,m.preferredCategoryWidthMin=20,m.preferredCategoryWidthMax=180,y.prototype.initData=function(e){this.currentViewport=e.viewport,this.element=e.element,this.hostService=e.host,this.interactivity=e.interactivity,this.isComboChart=m.ComboChart.isComboChart(e.chartType),this.style=e.style,this.tooltipService=e.services.tooltips,this.featureSwitches=e.featureSwitches,this.animationOptions=e.animation},y.prototype.initRenderer=function(e){var t;this.animator=e.animator,this.cartesianVisualHost=e.cartesianHost,this.svg=e.svg,this.svg.classed("columnChart",!0),this.unclippedGraphicsContext=this.svg.append("g").classed("columnChartUnclippedGraphicsContext",!0),this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("mainGraphicsContext",!0),this.useManagedTabIndex=e.useManagedTabIndex,this.interactivityService&&(t=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attrs({"aria-label":this.hostService.getLocalizedString("Visual_Plot"),"data-automation-type":"mainGraphicsContext","aria-multiselectable":"true",role:"listbox"}).classed(m.SetFocusRingClassName,!t),e.useManagedTabIndex?(this.mainGraphicsContext.classed(m.managedTabIndexElement.class,!0),this.mainGraphicsContext.attr(a.skipChildrenFocusAttribute,!0)):this.mainGraphicsContext.attrs({tabindex:0,focusable:!0}))},Object.defineProperty(y.prototype,"availableWidth",{get:function(){return Math.max(0,this.currentViewport.width-(this.margin.left+this.margin.right))},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"availableHeight",{get:function(){return Math.max(0,this.currentViewport.height-(this.margin.top+this.margin.bottom))},enumerable:!1,configurable:!0}),y.prototype.getCategoryLayout=function(e,t,a,i,r){var o=this.getVisualCategoryAxisIsScalar();return m.CartesianChartLayout.getLayout(this.data,{availableWidth:Math.max(0,y.isBar(this.chartType)?this.availableHeight:this.availableWidth),categoryCount:e,preferredCategoryWidth:null!=(e=null==(e=this.data)?void 0:e.preferredCategoryWidth)?e:null,domain:null==(e=m.AxisHelper.createDomain(this.data.series,m.AxisHelper.getCategoryValueType(null==(e=this.data)?void 0:e.categoryMetadata),o,[t.includeDomain]))?void 0:e.domain,isScalar:o,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:a,outerPaddingRatio:i,innerPaddingRatio:r})},y.getDefaultColumnLabelSettings=function(e,t){void 0===t&&(t=!1);var a=m.DataLabelViewModel.getDefaultLabelSettings({style:e,textClassName:"smallLightLabel",noColor:!0});return a.position=null,a.labelDensity=m.DataLabelViewModel.defaultLabelDensity,a.labelOrientation=1,t?(a.enableBackground=!0,a.backgroundColor=m.ColorHelper.getThemeColor(e,m.BackgroundColorName),a.backgroundTransparency=m.DataLabelViewModel.defaultComboChartLabelBackgroundOpacity):a.enableBackground=!1,a},y.getDefaultLineChartSeriesLabelSettings=function(e){var t=m.ColorHelper.getThemeColor(e,m.DataLabelViewModel.DefaultLabelColorName);return{show:!1,seriesColor:t,seriesPosition:m.labelSeriesPosition.right,fontProperties:m.DataLabelViewModel.getDefaultLabelSettings({style:e,labelColor:t,textClassName:"smallLightLabel"}).fontProperties,seriesWordWrap:!1,seriesMaximumWidth:20,defaultSeriesWidth:20,showLabelPerSeries:!1,enableBackground:!1}},y.converter=function(e){return(new m.ColumnChartConverter).convert(e)},y.sliceSeries=function(e,t,a){void 0===a&&(a=0);var i=[];if(e&&0<e.length)for(var r=0,o=e.length;r<o;r++)(i[r]=u.Prototype.inherit(e[r])).data=e[r].data.filter(function(e){return e.categoryIndex>=a&&e.categoryIndex<t});return i},y.getInteractiveColumnChartDomElement=function(e){return e.children("svg").get(0)},y.prototype.setData=function(e,t){var a,i,r=y.isStacked100(this.chartType);this.data=this.originalData={categories:[],categoryFormatter:null,series:[],totals:[],valuesMetadata:[],legendData:null,hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,dataLabelsSettings:y.getDefaultColumnLabelSettings(this.style),seriesLabelSetings:y.getDefaultLineChartSeriesLabelSettings(this.style),hasDynamicSeries:!1,isMultiMeasure:!1},0<e.length&&(e=this.dataView=e[0])&&e.categorical&&(i=(i=e.categorical.categories)&&0<i.length?i[0].source:null,i=m.AxisHelper.getCategoryValueType(i),a=m.CartesianHelper.hasCategoryHierarchy(e),i=m.ScalarUtils.shouldDrawScalar(e.metadata?e.metadata.objects:null,m.columnChartProps.categoryAxis.axisType,i,void 0,a),this.data=this.originalData=y.converter({dataView:e,style:this.style,is100PercentStacked:r,isScalar:i,dataViewMetadata:e.metadata,multipleInfo:t,chartType:this.chartType,interactivityService:this.interactivityService,tooltipsEnabled:this.tooltipsEnabled,hostServices:this.hostService,ribbonChart:this.ribbonChart,isCombo:this.isComboChart,buildCategories:void 0,supportsTotalLabels:!t&&this.supportsTotalLabels(),featureSwitches:this.featureSwitches}))},y.getChartStrategy=function(e,t){switch(e){case 10:return new m.ClusteredBarChartStrategy;case 12:return new m.ClusteredColumnChartStrategy;case 18:return new(y.isStacked(e,t)?m.StackedBarChartStrategy:m.ClusteredBarChartStrategy);case 50:return new m.StackedBarChartStrategy;case 20:return new(y.isStacked(e,t)?m.StackedColumnChartStrategy:m.ClusteredColumnChartStrategy);default:return new m.StackedColumnChartStrategy}},y.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&1<this.data.series.length)},y.prototype.getSeriesSettings=function(){return u.Prototype.inherit(this.data).seriesLabelSetings},y.prototype.enumerateObjectInstances=function(e,t){var a;switch(t.objectName){case"dataPoint":this.dataView&&!m.GradientUtils.hasGradientRole(this.dataView.categorical)&&this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e);break;case"seriesLabels":null!=(a=this.featureSwitches)&&a.lineChartSeriesLabels&&this.enumerateSeriesDataLabels(e);break;case"totals":this.supportsTotalLabels()&&this.enumerateTotalLabels(e);break;case"ribbonChart":y.getRibbonsUtils().enumerateRibbonChart(e,this.data.ribbonChartData,this.ribbonChart)}},y.prototype.getFormattingCards=function(e){var t=this;return{card:[function(){return t.ribbonChart?y.getRibbonsUtils().getRibbonChartCard(t.getRibbonDataPointFormattingOptions(e.categoryAxisData)):t.getDataPointCard(e.categoryAxisData)},function(){return t.getLabelsCard()},function(){return t.getTotalsCard()},function(){return t.getErrorBarsCard()}].reduce(function(e,t){t=t();return t&&e.push(t),e},[]),type:5}},y.prototype.getDataPointCard=function(i){var r=this;if(this.dataView&&!m.GradientUtils.hasGradientRole(this.dataView.categorical)){var o=function(e){return r.hostService.getLocalizedString(e)},s=this.originalData;if(s){var e,n=s.series.length;if(0!==n)return(e=new m.builder.FormattingCardBuilder(new m.builder.FormattingCardUidBuilder("bars"),y.isColumn(this.chartType)?"Role_DisplayName_Columns":"Visual_Bars_Title",[m.columnChartProps.dataPoint.fill,m.columnChartProps.dataPoint.showAllDataPoints,m.cartesianChartProps.categoryAxis.innerPadding,m.cartesianChartProps.categoryAxis.preferredCategoryWidth,m.cartesianChartProps.categoryAxis.reverseStackOrder],o)).addGroup("colors",function(e){var t,a;e.withDisplayName("Visual_Colors"),s.hasDynamicSeries||1<n||!s.categoryMetadata?(t=y.isStacked(r.chartType,n)||y.isStacked100(r.chartType),a={groupBuilder:e,dataPoints:s.series,seriesColorProps:m.columnChartProps.dataPoint,localize:o,featureSwitches:r.featureSwitches},u.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(a),r.featureSwitches&&r.featureSwitches.flipStackOrder&&t&&e.addSimpleSlice("Visual_ReverseStackOrder",new h.ToggleSwitchBuilder({descriptor:(r.isComboChart?m.comboChartObjectProps:m.cartesianChartProps).categoryAxis.reverseStackOrder,value:i.reverseStackOrder}).build())):(a={groupBuilder:e,colorProps:m.columnChartProps.dataPoint,featureSwitches:r.featureSwitches,hostService:r.hostService,options:{dataView:r.dataView,style:r.style,categories:_.map(s.series[0].data,function(e){var t,a=(a=null==(a=null==(t=s.categoryIdentities)?void 0:t[e.categoryIndex])?void 0:a.call(t))||e.identity;return{color:e.color,displayName:s.categoryFormatter.format(s.categories[e.categoryIndex]),identity:a}}),fillInstanceKind:3,multipleRole:s.multipleIdentity?m.columnRoleNames.rows:void 0}},u.colorEnumerationHelperModuleFactory().appendCategoryColorSlicesToGroup(a))}),this.getVisualCategoryAxisIsScalar()||e.addGroup("spacing",function(e){var t=i.innerPadding;e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerPadding",new m.builder.SliderBuilder({descriptor:m.cartesianChartProps.categoryAxis.innerPadding,value:void 0!==t?Math.round(100*t):void 0,options:{minValue:{type:0,value:m.innerPaddingMin},maxValue:{type:1,value:m.innerPaddingMax},unitSymbol:"Numeric_Pixel"},localize:o}).build()).addSimpleSlice("categoryWidth",new m.builder.NumUpDownBuilder({descriptor:m.cartesianChartProps.categoryAxis.preferredCategoryWidth,value:i.preferredCategoryWidth,options:{minValue:{type:0,value:m.preferredCategoryWidthMin},maxValue:{type:1,value:m.preferredCategoryWidthMax},unitSymbol:"Numeric_Pixel"}}).build())}),e.build()}}},y.prototype.getLabelsCard=function(){function o(e){return s.hostService.getLocalizedString(e)}var s=this,n=this.originalData,e=n.dataLabelsSettings,l=n.series.length,c=1<l||!n.categoryMetadata||this.isComboChart,t=n.dataLabelsSettings.position!==m.labelPosition.outsideEnd,u=S(this.chartType,n.series.length)?m.clusteredValidLabelPositionOptions:m.stackedValidLabelPositionOptions,a=(e.position&&u.indexOf(e.position)<0&&(e.position=g),__assign(__assign({},m.columnChartProps.labels),{position:m.columnChartProps.labels.labelPosition,precision:m.columnChartProps.labels.labelPrecision,displayUnits:m.columnChartProps.labels.labelDisplayUnits,labelBackgroundColor:m.columnChartProps.labels.backgroundColor,labelBackgroundTransparency:m.columnChartProps.labels.backgroundTransparency,showDynamicLabels:m.columnChartProps.labels.showDynamicLabels,dynamicLabelValue:m.columnChartProps.labels.dynamicLabelValue})),i=(y.isColumn(this.chartType)||delete a.labelOrientation,new m.builder.FormattingCardBuilder(new m.builder.FormattingCardUidBuilder("labels"),"Visual_DataPointsLabels",a,o)),r=this.getLabelSettingsOptions(void 0,e,null,c,u,t),d={cardBuilder:i,dataLabelsProps:a,featureSwitches:this.featureSwitches,includeAltConstantValueSelector:!0,hostServices:this.hostService,options:r,individualSelector:this.getLabelIndividualSelector(!1)};return a.show&&i.addTopLevelToggle("show",function(){return new h.ToggleSwitchBuilder({descriptor:a.show,value:r.dataLabelsSettings.show}).build()}),i.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",o("All"),function(e){return m.DataLabelViewModel.createDataLabelsFormattingContainers(d,e)}),c)for(var t=0;t<l;t++){var a=n.series[t],i=a.labelSettings||n.dataLabelsSettings,r=(i.position&&u.indexOf(i.position)<0&&(i.position=g),a.identity.getSelector());d.includeAltConstantValueSelector=!1,d.selector=n.hasDynamicSeries?p.normalizeSelector(r):r,d.individualSelector=s.getLabelIndividualSelector(!0),d.options=s.getLabelSettingsOptions(void 0,i,r,void 0,u,n.hasDynamicSeries),d.displayDisabledSlices=((i={}).labelOverflow=!0,i),e.addContainerItem(a.displayName,a.displayName,function(e){return m.DataLabelViewModel.createDataLabelsFormattingContainers(d,e)})}})}),i.build()},y.prototype.getTotalsCard=function(){var e,t,a=this,i=this.originalData.totalLabelsSettings;if(i&&!y.isClustered(this.chartType)&&!this.ribbonChart&&!y.isStacked100(this.chartType))return e=__assign(__assign({},m.columnChartProps.totals),{precision:m.columnChartProps.totals.labelPrecision,displayUnits:m.columnChartProps.totals.labelDisplayUnits}),t=new m.builder.FormattingCardBuilder(new m.builder.FormattingCardUidBuilder("totals"),"Visual_DataTotalLabels",e,function(e){return a.hostService.getLocalizedString(e)}),this.supportsTotalLabels()?(i={cardBuilder:t,dataLabelsProps:e,featureSwitches:this.featureSwitches,hostServices:this.hostService,options:this.getTotalLabelSettingsOptions(void 0,i),individualSelector:this.getLabelIndividualSelector(!1)},m.DataLabelViewModel.getDataLabelsFormattingModel(i)):(i=!(!this.data||!this.data.multipleIdentity),t.withDisabled(!0,i?"Visual_Totals_DisabledReason_SmallMultiples":"Visual_Totals_DisabledReason"),t.addTopLevelToggle("show",function(){return new h.ToggleSwitchBuilder({descriptor:e.show,value:!1}).build()}),t.build())},y.prototype.getLabelIndividualSelector=function(e){return m.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:this.featureSwitches,hasCategories:null!=_.first(this.originalData.categories),hasDynamicSeries:this.originalData.hasDynamicSeries,hasSeriesSelector:e})},y.prototype.getErrorBarsCard=function(){var n=this;if(!this.isStacked()&&!this.ribbonChart){var l,e,c=this.originalData;if(c&&c.series&&0!==c.series.length)return l=function(e){return n.hostService.getLocalizedString(e)},e=[(e=m.StandardObjectIdentifiers.error).enabled,e.errorRange,e.barShow,e.barMatchSeriesColor,e.barColor,e.barWidth,e.barBorderColor,e.barBorderSize,e.markerShape,e.markerSize,e.labelShow,e.labelFontFamily,e.labelFontSize,e.labelBold,e.labelItalic,e.labelUnderline,e.labelColor,e.labelMatchSeriesColor,e.labelFormat,e.labelBackground,e.labelBackgroundColor,e.labelBackgroundTransparency,e.showMarkerByDefault,e.tooltipShow,e.tooltipFormat],(e=new m.builder.FormattingCardBuilder(new m.builder.FormattingCardUidBuilder("errorBars"),"Visual_Error_Bars",e,l,!0,!0)).addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1),e.addContainer("measure",function(s){s.withDisplayName("Series");for(var e=0,t=c.valuesMetadataBySeries;e<t.length;e++)!function(e){var t,a,i,r,o=_.first(e.usedInSeriesIndices);null!=o&&(t=e.metadataColumn,o=c.series[o],a=__assign({},e.valueSelector.getSelector()),i=__assign(__assign({},a),{data:[d.create()],highlightMatching:1}),r={localize:l,uncertainty:o.uncertainty,targetMeasure:e.metadataColumn.expr,measureSelector:a,dataPointSelector:i,featureSwitches:n.featureSwitches,uncertaintyOptions:{isCombo:n.isComboChart,hideBand:!0}},s.addContainerItem(t.queryName,t.displayName,function(e){return m.UncertaintyHelper.getFormattingContainer(r,e)}))}(t[e])})}),e.build()}},y.prototype.getRibbonDataPointFormattingOptions=function(e){var t=this,i=this.originalData;if(i){var a=i.series.length;if(0!==a)return{localize:function(e){return t.hostService.getLocalizedString(e)},categoryAxisData:e,ribbonChartData:this.data.ribbonChartData,data:i,colorOptions:{groupBuilder:void 0,colorProps:m.columnChartProps.dataPoint,featureSwitches:this.featureSwitches,hostService:this.hostService,options:{dataView:this.dataView,style:this.style,categories:_.map(i.series[0].data,function(e){var t,a=(a=null==(a=null==(t=i.categoryIdentities)?void 0:t[e.categoryIndex])?void 0:a.call(t))||e.identity;return{color:e.color,displayName:i.categoryFormatter.format(i.categories[e.categoryIndex]),identity:a}}),fillInstanceKind:3,multipleRole:i.multipleIdentity?m.columnRoleNames.rows:void 0}}}}},y.prototype.getSubSelectionStyles=function(e){var t,e=_.first(e).visualObjects;if(0<e.length){(e=e[0])&&e.selectorsByColumn&&(t=p.normalizeSelector(p.convertSelectorsByColumnToSelector(e.selectorsByColumn)));var a=1===this.data.series.length;switch(e.objectName){case"columns":var i="".concat("Visual","-").concat("bars"),r="".concat("bars","-").concat("colors"),o="".concat(r,"-").concat("datapoint");return a&&this.data.categoryMetadata&&!this.data.hasDynamicSeries&&(o="".concat(r,"-defaultColor"),t={data:[u.data.DataViewWildcard.create(1)]}),s.getShapeSubSelectionStyles(i,r,o,this.hostService,!1,!0,t);case"data-labels":return s.getDataLabelsSubSelectionStyles({hostServices:this.hostService,omitSelectorForSingleSeries:a,individualSelector:this.getLabelIndividualSelector(!a),selector:t,repetitionSelector:void 0,inContainer:!0});case"total-labels":return s.getTotalLabelsSubSelectionStyles(this.hostService,this.getLabelIndividualSelector(!1),void 0);default:return}}},y.prototype.getSubSelectionShortcuts=function(e,t){if(!t){t=_.first(e).visualObjects;if(0<t.length){var a,e=t[0],t=!this.showLabelPerSeries(),t=(t||_.isEmpty(e.selectorsByColumn)||(a=p.normalizeSelector(p.convertSelectorsByColumnToSelector(e.selectorsByColumn))),t?"".concat("Visual","-").concat("labels"):"".concat("labels-applySettingsTo-series","--showSeries")),i="".concat("Visual","-").concat("totals"),r=y.isBar(this.chartType);if("columns"===e.objectName){e=[{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("bars"),groupUid:"".concat("bars","-").concat("colors")}],label:this.hostService.getLocalizedString(r?"Format_Bars":"Format_Columns")}];return this.supportsTotalLabels()&&e.unshift({type:2,sourceUid:i,enabledLabel:this.hostService.getLocalizedString("Format_AddTotalLabels")}),e.unshift({type:0,excludedResetSourceUids:[{sourceUid:i},{sourceUid:t,selector:a}]},{type:2,sourceUid:t,enabledLabel:this.hostService.getLocalizedString("Format_AddDataLabels"),selector:a}),e}}}},y.prototype.enumerateDataLabels=function(e){var t=this.originalData,a=t.dataLabelsSettings,i=t.series.length,r=1<i||!t.categoryMetadata||this.isComboChart,o=t.dataLabelsSettings.position!==m.labelPosition.outsideEnd,s=S(this.chartType,t.series.length)?m.clusteredValidLabelPositionOptions:m.stackedValidLabelPositionOptions;if(m.DataLabelViewModel.enumerateDataLabels(this.getLabelSettingsOptions(e,a,null,r,s,o),this.featureSwitches),r&&a.showLabelPerSeries)for(var n=0;n<i;n++){var l=t.series[n],c=l.identity.getSelector();t.hasDynamicSeries&&(c=p.normalizeSelector(c)),e.pushContainer({displayName:l.displayName}),m.DataLabelViewModel.enumerateDataLabels(this.getLabelSettingsOptions(e,null!=(l=l.labelSettings)?l:t.dataLabelsSettings,c,void 0,s),this.featureSwitches),e.popContainer()}},y.prototype.showSeriesCard=function(){return!(this.isComboChart&&!this.data.hasY2Role)},y.prototype.enumerateSeriesDataLabels=function(e){var t,a;this.showSeriesCard()&&(t=this.originalData.seriesLabelSetings,a=this.showLabelPerSeries(),m.DataLabelViewModel.enumerateSeriesDataLabels(this.getSeriesLabelSettingsOptions(e,t,null,a),this.featureSwitches))},y.prototype.getLabelSettingsOptions=function(e,t,a,i,r,o,s){var n=!!a;return{enumeration:e,dataLabelsSettings:t,show:!0,position:!_.isEmpty(r),positionObject:r,labelOrientation:!y.isBar(this.chartType)&&!n,displayUnits:!y.isStacked100(this.chartType),precision:!0,selector:a,showAll:i,fontSize:!0,fontFamily:!0,labelDensity:this.data&&this.data.scalarCategoryAxis,labelOverflow:!n&&o,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0,showDynamicLabels:!s||this.isComboChart}},y.prototype.getSeriesLabelSettingsOptions=function(e,t,a,i){return{enumeration:e,show:!0,seriesLabelsSettings:t,seriesColor:t.seriesColor,seriesPosition:t.seriesPosition,selector:a,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,fontProperties:t.fontProperties,seriesWordWrap:t.seriesWordWrap,seriesMaximumWidth:t.seriesMaximumWidth,defaultSeriesWidth:t.defaultSeriesWidth,showAll:i,fontSize:!0,fontFamily:!0,bold:!0,italic:!0,underline:!0}},y.prototype.showLabelPerSeries=function(){var e=this.originalData;return 1<e.series.length||!e.categoryMetadata||this.isComboChart},y.prototype.enumerateTotalLabels=function(e){var t=this.originalData.totalLabelsSettings;t&&m.DataLabelViewModel.enumerateDataLabels(this.getTotalLabelSettingsOptions(e,t),this.featureSwitches)},y.prototype.getTotalLabelSettingsOptions=function(e,t){return{enumeration:e,dataLabelsSettings:t,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,showPositiveAndNegative:!0,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0}},y.prototype.enumerateDataPoints=function(e){var t,i=this.originalData;i&&0!==(t=i.series.length)&&(i.hasDynamicSeries||1<t||!i.categoryMetadata?u.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:i.series},this.featureSwitches):u.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:e,dataView:this.dataView,style:this.style,categories:_.map(i.series[0].data,function(e){var t,a=(a=null==(a=null==(t=i.categoryIdentities)?void 0:t[e.categoryIndex])?void 0:a.call(t))||e.identity;return{color:e.color,displayName:i.categoryFormatter.format(i.categories[e.categoryIndex]),identity:a}}),fillInstanceKind:3,multipleRole:i.multipleIdentity?m.columnRoleNames.rows:void 0},this.featureSwitches))},y.prototype.calculateAxesProperties=function(o){var s,t,n=this,e=(this.currentViewport=o.viewport,this.viewModelAdapterFactory&&this.originalData&&(e=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=e.getData()),this.data),l=(this.margin=o.margin,this.ribbonChart?y.ribbonChartInnerPaddingRatio:o.innerPaddingRatio),a=null!=(a=null==(a=null==e?void 0:e.categories)?void 0:a.length)?a:0,c=e?this.getCategoryLayout(a,o.categoryAxisOptions,o.trimOrdinalDataOnOverflow,o.outerPaddingRatio,l):this.getEmptyChartLayout(),e=this.adjustLayoutForScroll(e,a,o.trimOrdinalDataOnOverflow,c),u=(this.updateColumnChart(e,c),y.isBar(this.chartType)),d=y.isStacked100(this.chartType),h=u?(s=o.valueAxisOptions,o.categoryAxisOptions):(s=o.categoryAxisOptions,o.valueAxisOptions),i=function(e,t,a){void 0===t&&(t={});var i,r="x"===e?s:h,a=__assign(((i={is100Pct:d,forcedTickCount:o.forcedTickCount,axisZoom:o.axisZoom,logAxisScale:r.logAxisScale,axisDisplayUnits:r.displayUnits,axisPrecision:r.precision,outerPaddingRatio:"x"===e?u?0:c.outerPaddingRatio:u?c.outerPaddingRatio:0,margin:o.margin,innerPaddingRatio:l,invertAxis:r.invertAxis,switchAxisPosition:r.switchAxisPosition})["x"===e?"includeXDomain":"includeYDomain"]=null!=a?a:r.includeDomain,i),t);return"x"===e?n.strategy.createXAxis(a):n.strategy.createYAxis(a)},r=i("x"),p=i("y"),a=(null==(a=e.totalLabelsSettings)?void 0:a.show)&&this.supportsTotalLabels(),g=(null==(g=e.dataLabelsSettings)?void 0:g.show)&&y.isClustered(this.chartType);return(a||g)&&(t=y.adjustDomainForLabels(u,e,r,p),a=function(e){return i(e,{skipAxisZoomUpdate:!0,outerPaddingRatio:0},m.AxisHelper.mergeScalarAxisDomains(m.AxisHelper.createScalarDomainOptions(t,0,[!0,!0]),("x"===e?s:h).includeDomain,m.AxisHelper.createScalarDomainOptions(("x"===e?r:p).scale.domain(),0)))},u?r=a("x"):p=a("y")),[r,p]},y.prototype.setAxesLayout=function(e){this.currentViewport=e.layout.viewport,this.viewModelAdapterFactory&&this.originalData&&(a=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=a.getData()),this.xAxisProperties=e.layout.axes.x,this.yAxisProperties=e.layout.axes.y1,this.margin=e.layout.margin;var t,a=y.isBar(this.chartType)?this.yAxisProperties:this.xAxisProperties,a=this.data?{categoryCount:_.isEmpty(a.categoryIdentities)?0:a.categoryIdentities.length,categoryThickness:a.categoryThickness,outerPaddingRatio:a.outerPaddingRatio,innerPaddingRatio:a.innerPaddingRatio,isScalar:this.getVisualCategoryAxisIsScalar()}:this.getEmptyChartLayout();this.data=this.adjustLayoutForScroll(this.data,null!=(t=null==(t=null==(t=this.data)?void 0:t.categories)?void 0:t.length)?t:0,e.trimOrdinalDataOnOverflow,a),this.updateColumnChart(this.data,a)},y.prototype.getAxesDomains=function(e,t){var a,i={};return this.data&&(t.categoryAxis&&this.data.scalarCategoryAxis&&(a=m.AxisHelper.createDomain(this.data.series,null!=(a=null==(a=this.data.categoryMetadata)?void 0:a.type)?a:u.ValueType.fromDescriptor({text:!0}),this.data.scalarCategoryAxis,void 0))&&(m.AxisHelper.assertScalarDomain(a.domain),i.categoryAxis=[a.domain[0],a.domain[1]]),t.valueAxis)&&(a=y.isStacked100(this.chartType),t=void 0,a=(t=this.isStacked()||this.ribbonChart?[(a=m.StackedUtil.calcValueDomain(this.data.series,a)).min,a.max]:m.AxisHelper.createUncertaintyAwareValueDomain(this.data.series,e)||m.emptyDomain)[0],e=t[1],void 0!==a)&&void 0!==e&&(i.valueAxis=[a,e]),i},y.prototype.getEmptyChartLayout=function(){return{categoryCount:0,categoryThickness:m.CartesianHelper.MinOrdinalRectThickness,outerPaddingRatio:0,innerPaddingRatio:0,isScalar:!1}},y.prototype.updateColumnChart=function(e,t){var a=this.getPreferredPlotArea(t.isScalar,t.categoryCount,t.categoryThickness,t.outerPaddingRatio),a={height:a.height,width:a.width,duration:0,hostService:this.hostService,unclippedGraphicsContext:this.unclippedGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,margin:this.margin,layout:t,animator:this.animator,interactivityService:this.interactivityService,viewportHeight:this.availableHeight,viewportWidth:this.availableWidth,is100Pct:y.isStacked100(this.chartType),isComboChart:this.isComboChart};this.strategy=y.getChartStrategy(this.chartType,this.data&&this.data.series.length),this.strategy.setData(e),this.applyInteractivity(a),this.strategy.setupVisualProps(a),this.strategy.setAxisProperties(this.xAxisProperties,this.yAxisProperties)},y.prototype.adjustLayoutForScroll=function(e,t,a,i){return this.scrolledData=void 0,e&&!i.isScalar&&!this.isScrollable&&a&&(a=Math.min(t,i.categoryCount))!==t&&((e=this.scrolledData=u.Prototype.inherit(e)).series=y.sliceSeries(e.series,a),e.categories=e.categories.slice(0,a),e.categoryIdentities)&&(e.categoryIdentities=e.categoryIdentities.slice(0,a)),e},y.adjustDomainForLabels=function(e,t,a,i){var r,o,s,n,l,i=e?a:i,c=i.dataDomain;if(c&&null!=c[0]&&null!=c[1])return n=c[0].toString(),o=c[1].toString(),r=i.scale,s="",0<t.series.length&&0<t.series[0].data.length&&(s=t.series[0].data[0].labelFormatString),l=m.DataLabelViewModel.createColumnFormatterCacheManager(),a=m.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(a,t.totalLabelsSettings),l=l.getOrCreate(s,t.totalLabelsSettings,a.units,t.totalLabelsSettings.precision),s=m.DataLabelRenderer.getLabelFormattedText(l.format(n)),a=m.DataLabelRenderer.getLabelFormattedText(l.format(o)),n=m.FontProperties.toTextProperties(t.totalLabelsSettings.fontProperties,s),l=m.FontProperties.toTextProperties(t.totalLabelsSettings.fontProperties,a),a=s=o=void 0,a=e?(o=u.TextMeasurementService.measureSvgTextWidth(n),s=u.TextMeasurementService.measureSvgTextWidth(l),i.invertAxis?-1:1):(o=u.TextMeasurementService.estimateSvgTextHeight(n),s=u.TextMeasurementService.estimateSvgTextHeight(l),i.invertAxis?1:-1),e=r(c[0])-a*(o+m.DataLabelViewModel.labelMargin),n=r(c[1])+a*(s+m.DataLabelViewModel.labelMargin),l=!1,[(t.totalLabelsSettings.showPositiveAndNegative?(l=t.hasPositive,t.hasNegative):(l=t.hasNetPositive,t.hasNetNegative))?r.invert(e):void 0,l?r.invert(n):void 0]},y.prototype.getPreferredPlotArea=function(e,t,a,i){var r={height:this.availableHeight,width:this.availableWidth};return this.isScrollable&&!e&&(e=m.CartesianChartLayout.getPreferredCategorySpan(t,a,i),y.isBar(this.chartType)?r.height=Math.max(e,r.height):r.width=Math.max(e,r.width)),r},y.prototype.isMobileInteractiveLegend=function(){var e=!(!this.data||!this.data.multipleIdentity);return this.interactivity&&this.interactivity.isInteractiveLegend&&!e},y.prototype.applyInteractivity=function(e){var t,a=this;this.interactivity&&(this.interactivity.dragDataPoint&&(e.onDragStart=function(e){e.identity&&a.hostService.onDragStart({event:d3.event,data:{data:e.identity.getSelector()}})}),this.isMobileInteractiveLegend())&&(e=function(){var e=d3.mouse(a.mainGraphicsContext.node()),t=e[0],e=e[1],t=a.strategy.getClosestColumnIndex(t,e);a.selectColumn(t)},t=y.getInteractiveColumnChartDomElement(this.element),this.svg.on("click",e),d3.select(t).on("click",e).style("touch-action","none"),e=d3.drag().on("drag",e),this.svg.call(e),d3.select(t).call(e))},y.prototype.selectLastSelectedColumnOrDefault=function(e){void 0===e&&(e=!1);var t=void 0===this.lastInteractiveSelectedColumnIndex?m.CartesianHelper.findMaxCategoryIndex(this.data.series):this.lastInteractiveSelectedColumnIndex;this.selectColumn(t,e)},y.prototype.selectColumn=function(e,t){var a;!(t=void 0!==t&&t)&&this.lastInteractiveSelectedColumnIndex===e||(a=this.createInteractiveLegendDataPoints(e),this.strategy.selectColumn(e,this.lastInteractiveSelectedColumnIndex,t),this.cartesianVisualHost.updateLegend(a),this.lastInteractiveSelectedColumnIndex=e)},y.prototype.createInteractiveLegendDataPoints=function(e){var t=this.data,a=m.Legend.getDefaultLegendData(this.style);if(t&&!_.isEmpty(t.series)){for(var i=m.columnChartProps.general.formatString,r=[],o=t.categories&&t.categories[e],s=t.series,n=t.legendData&&t.legendData.dataPoints,l=new m.ColumnChartConverterHelper(this.dataView,this.style),c=0,u=s.length;c<u;c++){var d,h=l.getValueBySeriesAndCategory(c,e),p=t.valuesMetadata[c],g=m.converterHelper.getFormattedLegendLabel(p,this.dataView.categorical.values,i),y=void 0;y=1===s.length?(d=s[0]).data.length>e&&d.data[e].color:n.length>c&&n[c].color,r.push({color:y,icon:m.LegendIcon.Box,label:g,category:t.categoryFormatter?t.categoryFormatter.format(o):o,measure:m.valueFormatter.format(h,m.valueFormatter.getFormatString(p,i)),identity:m.SelectionId.createNull(),selected:!1,index:c})}a.dataPoints=r}return a},y.prototype.overrideXScale=function(e){this.xAxisProperties=e},y.prototype.render=function(e,t,a){this.featureSwitches.onObject&&a&&(s=null!=(s=this.currentViewport.scale)?s:1,s={formatMode:a,elementRestrictOptions:{margin:{top:this.margin.top*s,right:this.margin.right*s,bottom:this.margin.bottom*s,left:this.margin.left*s}}});var i,r,e=this.strategy.drawColumns(!e,this.style,{onObjectOptions:s}),o=this.data,s=this.xAxisProperties.isCategoryAxis&&0===this.xAxisProperties.innerPaddingRatio||this.yAxisProperties.isCategoryAxis&&0===this.yAxisProperties.innerPaddingRatio,n=(this.mainGraphicsContext.attr("height",this.availableHeight).attr("width",this.availableWidth).classed("withCrispEdges",s),this.tooltipsEnabled&&!a?(this.tooltipService.addTooltip(e.eventGroup,function(e){return null==(e=e.data)?void 0:e.tooltipInfo},function(e){var t;return(null==(t=e.data)?void 0:t.identity)&&[e.data.identity]}),e.ribbonChartEventGroup&&this.tooltipService.addTooltip(e.ribbonChartEventGroup,function(e){return null==(e=e.data)?void 0:e.tooltipInfo},function(){return[m.SelectionId.createNull()]})):(this.tooltipService.removeTooltips(e.eventGroup),e.ribbonChartEventGroup&&this.tooltipService.removeTooltips(e.ribbonChartEventGroup)),[]),s=this.strategy.getColumnWidth(),a=this.strategy.getCategoryWidth?this.strategy.getCategoryWidth():s,l=y.isBar(this.chartType);if(this.interactivityService){for(var c=0,u=o.series.length;c<u;c++)n=n.concat(o.series[c].data);i={datapoints:n,columnChartDrawInfo:e,hasHighlights:o.hasHighlights,root:this.mainGraphicsContext,showLabel:o.dataLabelsSettings.show,bandsTransparency:this.data.ribbonChartData?this.data.ribbonChartData.ribbonOptions.bandsTransparency:30,visualInstanceId:this.hostService.instanceId,hitTester:new v({dataPoints:n,isScalar:o.scalarCategoryAxis,hasCategories:!!o.categoryIdentities&&0<o.categoryIdentities.length,isBar:l,isClustered:y.isClustered(this.chartType),categoryAxisScale:this.strategy.getCategoryAxisScale(),columnWidth:s,categoryWidth:a,seriesLength:o.series.length}),useManagedTabIndex:this.useManagedTabIndex},r={navigationStrategy:1<o.series.length?m.DataPointNavigationStrategy.CategoryFirst:m.DataPointNavigationStrategy.CategoryOnly,helper:this}}return this.isMobileInteractiveLegend()&&this.selectLastSelectedColumnOrDefault(!0),m.SVGUtil.flushAllD3TransitionsIfNeeded(this.animationOptions),{dataPoints:n,behaviorOptions:i,navigationOptions:r,labelDataPoints:[],labelDataPointGroups:e.labelDataPointGroups,labelsAreNumeric:!0,labelOrientation:o.dataLabelsSettings.labelOrientation,animateLabels:e.animateLabels,categorySubRangeCount:Math.round(a/s),verticalCategoryAxis:l}},y.prototype.getFirstElement=function(e,t){void 0===t&&(t=!1);var a,i,r,o=(this.scrolledData||this.data).series;return _.isEmpty(o)?null:(e=null!=e?e:o[0].data[0].categoryIndex,0<=(a=t?this.findSeriesIndex(o.length-1,e,!1):this.findSeriesIndex(0,e,!0))?(i=this.data.series[a].data[e],r=this.getDataPointElement(a,e)):a=t?o.length-1:0,{element:r,targetCategoryIndex:e,targetSeriesIndex:a,noShape:i&&0===i.valueAbsolute})},y.prototype.getNextDataPoint=function(e,t,a){switch(a=!y.isBar(this.chartType)||this.getVisualCategoryAxisIsScalar()||a!==m.DataDirection.NextSeries&&a!==m.DataDirection.PreviousSeries?a:a===m.DataDirection.NextSeries?m.DataDirection.PreviousSeries:m.DataDirection.NextSeries){case m.DataDirection.NextCategory:e=this.findCategoryIndex(this.data.series[t].data,e,!0);break;case m.DataDirection.PreviousCategory:e=this.findCategoryIndex(this.data.series[t].data,e,!1);break;case m.DataDirection.NextSeries:(t=this.findSeriesIndex(t+1,e,!0))<0&&(e=this.loopIndex(e+1,this.data.categories.length),t=this.findSeriesIndex(0,e,!0));break;case m.DataDirection.PreviousSeries:(t=0<t?this.findSeriesIndex(t-1,e,!1):-1)<0&&(e=this.loopIndex(e-1,this.data.categories.length),t=this.findSeriesIndex(this.data.series.length-1,e,!1))}if(0<=t&&0<=e)var i=this.data.series[t].data,i=(i=this.data.hasHighlights?i.filter(function(e){return!e.highlight}):i)[e],r=this.getDataPointElement(t,e);else if(e<0)switch(a){case m.DataDirection.NextCategory:e=this.loopIndex(e+1,this.data.categories.length);break;case m.DataDirection.PreviousCategory:e=this.loopIndex(e-1,this.data.categories.length)}else switch(a){case m.DataDirection.NextSeries:t=0;break;case m.DataDirection.PreviousSeries:t=this.data.series.length-1}return this.isInViewport(r)?{element:r,targetCategoryIndex:e,targetSeriesIndex:t,noShape:i&&0===i.valueAbsolute}:this.getNextDataPoint(e,t,a)},y.prototype.getSelectorsByColumnFromSubselectedElement=function(e){switch(d3.select(e).attr(m.SubSelectableObjectNameAttribute)){case"columns":var t=d3.select(e).datum().seriesIndex,a=this.data.series;if(!_.isEmpty(a)&&0<=t){a=a[t],a=null==(t=null==a?void 0:a.identity)?void 0:t.getSelectorsByColumn();if(a)return a}case"data-labels":case"series-labels":t=m.DataLabelUtil.getLabelSeriesSelectorsByColumn(e,this.data.series);if(t)return t;default:return}},y.prototype.isInViewport=function(e){var t;return!e||(e=e.getBBox(),t=this.currentViewport,0<e.y+e.height&&e.y<t.height&&0<e.x+e.width&&e.x<t.width)},y.prototype.getDataPointElement=function(t,a){var e=y.isColumn(this.chartType)?".column":".bar";return this.mainGraphicsContext.selectAll(e).filter(function(e){return e.categoryIndex===a&&e.seriesIndex===t}).node()},y.prototype.findSeriesIndex=function(e,t,a){return(a?_.findIndex:_.findLastIndex)(this.data.series,function(e){return _.some(e.data,function(e){return e.categoryIndex===t&&null!=e.value})},e)},y.prototype.findCategoryIndex=function(e,t,a){var a=a?1:-1,i=_.findIndex(e,function(e){return e.categoryIndex===t});return i<0?i:e[this.loopIndex(i+a,e.length)].categoryIndex},y.prototype.loopIndex=function(e,t){return t<=e?0:e<0?t-1:e},y.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},y.prototype.getCategoryValueType=function(){return m.AxisHelper.getCategoryValueType(this.data.categoryMetadata)},y.prototype.getVisualCategoryAxisIsScalar=function(){return!!this.data&&this.data.scalarCategoryAxis},y.prototype.getSupportedCategoryAxisType=function(){var e=m.AxisHelper.getCategoryValueType(null==(e=this.data)?void 0:e.categoryMetadata);return m.AxisHelper.isOrdinal(e)?m.axisType.categorical:m.axisType.both},y.prototype.setFilteredData=function(e,t){var a=this.scrolledData=u.Prototype.inherit(this.data);return a.series=y.sliceSeries(a.series,t,e),a.categories=a.categories.slice(e,t),this.strategy.setData(a),a},y.prototype.supportsTotalLabels=function(){return!!(!this.data||!this.data.multipleIdentity)&&this.isStacked()&&!y.isStacked100(this.chartType)},y.prototype.supportsTrendLine=function(){var e,t;return!this.data.multipleIdentity&&(e=this.dataView,e=u.data.createDataViewCategoricalReader(e),t=this.getVisualCategoryAxisIsScalar(),12===this.chartType)&&t&&e.data.hasValues("Y")},y.prototype.supportsStaticReferenceLines=function(){return 68!==this.chartType},y.prototype.supportsValueAxis=function(){return 68!==this.chartType},y.prototype.isStacked=function(){return y.isStacked(this.chartType,this.data&&this.data.series.length)},y.isBar=function(e){return i.hasFlag(e,2)},y.isColumn=function(e){return i.hasFlag(e,4)},y.isClustered=function(e){return i.hasFlag(e,8)},y.isStacked=function(e,t){return i.hasFlag(e,16)&&(1!==t||y.isStacked100(e))},y.isStacked100=function(e){return i.hasFlag(e,48)},y.isRibbon=function(e){return i.hasFlag(e,64)},y.isHistogram=function(e){return i.hasFlag(e,128)},y.prototype.getCartesianVisualCapabilities=function(){var e;return{supportsHierarchicalCategoryAxis:!0,supportsValueAxis:this.supportsValueAxis(),axesCapabilities:{categoryAxis:{domainAggregateRole:m.columnRoleNames.category,supportedDomainAggregates:null!=(e=this.data)&&e.scalarCategoryAxis?3:0},valueAxis:{domainAggregateRole:m.columnRoleNames.y,supportedDomainAggregates:this.supportsValueAxis()&&!this.isStacked()?3:1}}}},y.prototype.getStaticSeriesRole=function(){return"Y"},y.getRibbonsUtils=function(){return u.ribbonChartUtilsModuleFactory()},y.prototype.addWarnings=function(e){var t;null!=(t=this.viewModelAdapter)&&t.addWarnings(e)},y.prototype.getDataViewObjectLayerChanges=function(e){var t,a;return this.featureSwitches.onObject?(t=this.isComboChart?m.comboChartObjectProps:m.columnChartProps,a=this.data.series.map(function(e){return{selector:e.identity.getSelector(),value:null==(e=e.labelSettings)?void 0:e.show}}),a=[m.SeriesLevelToggleBehavior.create(t.labels.backgroundColor,this.data.dataLabelsSettings.enableBackground).onToggleEnabled(m.AddDataViewObjectChange.createBooleanDataViewObjectChange(t.labels.enableBackground,!0,{inheritSelector:!0})),m.TopLevelToggleBehavior.create(t.labels.backgroundColor,this.data.dataLabelsSettings.enableBackground).onToggleEnabled(m.AddDataViewObjectChange.createBooleanDataViewObjectChange(t.labels.enableBackground,!0)),m.SeriesLevelToggleBehavior.create(t.labels.showSeries,this.data.dataLabelsSettings.show,a).onToggleEnabled(m.AddDataViewObjectChange.createBooleanDataViewObjectChange(t.labels.showByDefault,!1),m.AddDataViewObjectChange.createBooleanDataViewObjectChange(t.labels.show,!0)).onToggleDisabled(m.AddDataViewObjectChange.createRevertToDefaultDataViewObjectChange("labels")),m.TopLevelToggleBehavior.create(t.labels.show,this.data.dataLabelsSettings.show).onToggleDisabled(m.AddDataViewObjectChange.createRevertToDefaultDataViewObjectChange("labels")),m.TopLevelToggleBehavior.create(t.totals.backgroundColor,this.data.totalLabelsSettings.enableBackground).onToggleEnabled(m.AddDataViewObjectChange.createBooleanDataViewObjectChange(t.totals.enableBackground,!0)).onToggleDisabled(m.AddDataViewObjectChange.createRevertToDefaultDataViewObjectChange("totals"))],m.DataViewObjectChangeHelper.getDataViewObjectsBehaviorChanges(e,a)):[]},y.RibbonChartItemClasses=e("ribbonChartArea"),y.RibbonChartLayerClasses=e("ribbonChartLayer"),y.ribbonChartInnerPaddingRatio=.6,y.DefaultZeroScalarDomain=[0,1],y);function y(e){var t=e.chartType;this.chartType=t,this.isScrollable=e.isScrollable,this.tooltipsEnabled=e.tooltipsEnabled,this.interactivityService=e.interactivityService,this.ribbonChart=68===this.chartType,this.viewModelAdapterFactory=e.viewModelAdapterFactory}m.ColumnChart=r,t.prototype.queryRegion=function(e){var t,a,i,r,o=this,s=[],e=e.dataSpace;return(this.isScalar||this.hasCategories&&!_.some([e.bottom,e.left,e.right,e.top],function(e){return void 0===e}))&&(r=(this.isBar?(a=this.isScalar?(t=e.bottom.value,e.top.value):(t=this.getAdjustedCategoryIndex(e.top.value,e.top.seriesIndex,this.seriesLength),this.getAdjustedCategoryIndex(e.bottom.value,e.bottom.seriesIndex,this.seriesLength)),i=e.left.value,e.right):(a=this.isScalar?(t=e.left.value,e.right.value):(t=this.getAdjustedCategoryIndex(e.left.value,e.left.seriesIndex,this.seriesLength),this.getAdjustedCategoryIndex(e.right.value,e.right.seriesIndex,this.seriesLength)),i=e.bottom.value,e.top)).value,s=_.filter(this.dataPoints,function(e){return 0!==e.valueAbsolute&&t<=a&&i<=r&&n.overlappingRange(t,a,o.getAreaCategoryBound(e,!1),o.getAreaCategoryBound(e,!0))&&n.overlappingRange(i,r,o.getAreaValueLowerBound(e),o.getAreaValueUpperBound(e))})),s},t.prototype.getAreaValueLowerBound=function(e){return this.isClustered?Math.min(0,e.value):e.position-e.valueAbsolute},t.prototype.getAreaValueUpperBound=function(e){return this.isClustered?Math.max(0,e.value):e.position},t.prototype.getAreaCategoryBound=function(e,t){var a,i;return this.isScalar?(t=(t=this.isBar?!t:t)?this.columnWidth:0,a=this.isClustered?e.seriesIndex:0,i=this.categoryAxisScale(e.categoryValue)-this.categoryWidth/2,m.AxisHelper.invertScale(this.categoryAxisScale,i+a*this.columnWidth+t,0,0,void 0).value):this.getAdjustedCategoryIndex(e.categoryIndex,e.seriesIndex,this.seriesLength)},t.prototype.getAdjustedCategoryIndex=function(e,t,a){return this.isClustered?e*a+t:e};var v=t;function t(e){this.categoryAxisScale=e.categoryAxisScale,this.categoryWidth=e.categoryWidth,this.columnWidth=e.columnWidth,this.dataPoints=e.dataPoints,this.hasCategories=e.hasCategories,this.isBar=e.isBar,this.isClustered=e.isClustered,this.isScalar=e.isScalar,this.seriesLength=e.seriesLength}function S(e,t){return!r.isStacked(e,t)&&!r.isRibbon(e)}m.ColumnChartHitTester=v,m.canSupportOutsidePosition=S}(powerbi=powerbi||{}),function(e){var l,t;function a(e){return t.call(this,e)||this}l=e.visuals||(e.visuals={}),t=l.BaseAnimator,__extends(a,t),a.prototype.animate=function(e){var t={failed:!0,shapes:null},a=e.viewModel,i=this.previousViewModel;return a.categories.length*a.series.length>l.AnimatorCommon.MaxDataPointsToAnimate||i&&i.categories.length!==a.categories.length||(i&&(a.hasHighlights&&!i.hasHighlights?t=this.animateNormalToHighlighted(e):a.hasHighlights&&i.hasHighlights?t=this.animateHighlightedToHighlighted(e):!a.hasHighlights&&i.hasHighlights&&(t=this.animateHighlightedToNormal(e))),this.previousViewModel=a),t},a.prototype.animateNormalToHighlighted=function(e){var t=e.viewModel,a=e.itemCS,i=e.layout,r=e.series.selectAll(a.selector).data(function(e){return e.data},function(e){return e.key}),o=e.interactivityService&&e.interactivityService.hasSelection(),s=t.hasHighlights,n=r.enter().append("rect").attr("class",function(e){return a.class.concat(e.highlight?" highlight":"")}).attrs(i.shapeLayoutWithoutHighlights).merge(r),i=(n.style("fill",function(e){return e.color}).attr("aria-hidden",function(e){return!!e.highlight||null}).style("fill-opacity",function(e){return l.ColumnUtil.getFillOpacity(e.selected,e.highlight,o,s)}).transition().duration(this.animationDuration).attrs(i.shapeLayout),r.exit().remove(),l.ColumnUtil.drawUncertainty(t,e.isBar,e.mainGraphicsContext,e.valueAxisProps,e.layout,e.columnWidth,e.interactivityService));return{failed:!1,shapes:n,uncertaintyShapes:i}},a.prototype.animateHighlightedToHighlighted=function(e){return{failed:!1,shapes:this.animateDefaultShapes(e.viewModel,e.series,e.layout,e.itemCS,e.interactivityService&&e.interactivityService.hasSelection()),uncertaintyShapes:l.ColumnUtil.drawUncertainty(e.viewModel,e.isBar,e.mainGraphicsContext,e.valueAxisProps,e.layout,e.columnWidth,e.interactivityService)}},a.prototype.animateHighlightedToNormal=function(e){var t=e.itemCS,a=e.series.selectAll(t.selector).data(function(e){return e.data},function(e){return e.key}),i=e.interactivityService&&e.interactivityService.hasSelection(),r=a.enter().append("rect").attr("class",function(e){return t.class.concat(e.highlight?" highlight":"")}).merge(a),a=(r.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return l.ColumnUtil.getFillOpacity(e.selected,e.highlight,e.selected,!e.selected)}).attr("aria-hidden",function(e){return!!e.highlight||null}).transition().duration(this.animationDuration).attrs(e.layout.shapeLayout).transition().duration(0).style("fill-opacity",function(e){return l.ColumnUtil.getFillOpacity(e.selected,e.highlight,i,!1)}),a.exit().transition().duration(this.animationDuration).attrs(i?e.layout.zeroShapeLayout:e.layout.shapeLayoutWithoutHighlights).remove(),l.ColumnUtil.drawUncertainty(e.viewModel,e.isBar,e.mainGraphicsContext,e.valueAxisProps,e.layout,e.columnWidth,e.interactivityService));return{failed:!1,shapes:r,uncertaintyShapes:a}},a.prototype.animateDefaultShapes=function(t,e,a,i,r){var e=e.selectAll(i.selector).data(function(e){return e.data},function(e){return e.key}),o=e.enter().append("rect").attr("class",function(e){return i.class.concat(e.highlight?" highlight":"")}).merge(e);return o.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return l.ColumnUtil.getFillOpacity(e.selected,e.highlight,r,t.hasHighlights)}).attr("aria-hidden",function(e){return!!e.highlight||null}).transition().duration(this.animationDuration).attrs(a.shapeLayout),e.exit().remove(),o},l.WebColumnChartAnimator=a}(powerbi=powerbi||{}),function(e){var n=e.visuals||(e.visuals={}),l=jsCommon.BrowserUtils,c=jsCommon.DOMConstants.mouseClickEventName;function t(){}t.prototype.create=function(){return new a},n.ColumnChartWebBehaviorFactory=t,i.prototype.bindEvents=function(e,a,t,i){var r=this,o=(this.options=e,this.hitTester=e.hitTester,e.columnChartDrawInfo.eventGroup),s=e.root;i?(o&&(o.on(c,null),o.on("keydown.select",null),n.InteractivityUtils.removeStandardContextMenuHandler(o)),n.InteractivityUtils.removeStandardInteractivityHandlers(s)):(t&&(i=t.dataPointNavigationManager,t=t.pointSourceKey,i.isEmpty(t)||(n.InteractivityUtils.appendUseElementForFocus(s,e.visualInstanceId,t),n.InteractivityUtils.registerEnterPlotAreaHandler(s,i,t),n.InteractivityUtils.registerDataPointNavigationHandler(s,i,t),n.InteractivityUtils.registerClearCatcherShortcut(s,a))),o.on(c,function(){return r.handleSelection(a)}).on("keydown.select",function(){var e=d3.event.keyCode;32!==e&&13!==e||r.handleSelection(a)},!0),o.on("contextmenu",function(){var t,e=d3.event;l.isCtrlOrMeta(e)||(e.preventDefault(),n.EventBubblingUtil.markAsHandled(e),t=n.InteractivityUtils.getPositionOfLastInputEvent(),n.InteractivityUtils.tryToSelectD3Target(function(e){return a.handleContextMenu(e,t)}))}))},i.prototype.renderSelection=function(t){var e,a=this.options,i=a.columnChartDrawInfo;i.ribbonChartEventGroup&&(e=(100-a.bandsTransparency)/100,e=n.ColumnUtil.getFillOpacity(!1,!1,t,a.hasHighlights,e),i.ribbonChartEventGroup.style("fill-opacity",e).style("stroke-opacity",e)),i.shapesSelection.attr("aria-selected",function(e){return e.selected}).style("fill-opacity",function(e){return n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,a.hasHighlights)}).style("stroke-opacity",function(e){return n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,a.hasHighlights)}),i.uncertaintyShapes&&(null!=(e=i.uncertaintyShapes.bars)&&e.each(function(e){e.uncertainty.bar;d3.select(this).selectAll(n.ColumnUtil.UncertaintyBar.selector).style("fill-opacity",function(e){return t?n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,a.hasHighlights):null}).style("stroke-opacity",function(e){return t?n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,a.hasHighlights):null})}),null!=(e=i.uncertaintyShapes.markerPaths)&&e.style("opacity",t?n.ColumnUtil.getFillOpacity(!1,!0,t,a.hasHighlights):null),null!=(i=(e=i.uncertaintyShapes).updateActiveHighlightMarkers))&&i.call(e,t,a.hasHighlights)},i.prototype.renderFocus=function(e){var t="".concat(n.CurrentFocusDataPointId,"-").concat(this.options.visualInstanceId);this.options.root.select("#".concat(t)).attr("id",null),e&&(e.setAttribute("id",t),(t=this.options.root.select("#".concat(t))).empty()||(t.attr("aria-label",function(e){return e.formattedTooltip}),l.focus(e)))},i.prototype.lassoSelectRectLayer=function(e){return this.hitTester.queryRegion(e)},i.prototype.getLassoSelectDirectionMode=function(){return 2},i.prototype.handleSelection=function(t){n.InteractivityUtils.tryToSelectD3Target(function(e){return n.InteractivityUtils.handleSelection(e,t)},!this.options.useManagedTabIndex)};var a=i;function i(){}n.ColumnChartWebBehavior=a}(powerbi=powerbi||{}),function(e){var p;function d(){}function h(){}p=e.visuals||(e.visuals={}),d.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.hostService=e.hostService,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight},d.prototype.setData=function(e){this.data=e},d.prototype.setAxisProperties=function(e,t){this.xProps=e,this.yProps=t,e&&this.setSeriesOffsetScale(e.innerPaddingRatio)},d.prototype.createXAxis=function(e){var t=e.includeXDomain,a=e.logAxisScale,i=e.axisDisplayUnits,r=e.axisPrecision,o=e.margin,s=this.width,n=p.AxisHelper.hasForcedDomain(t),s=p.ColumnUtil.getCategoryAxis(this.data,s,this.categoryLayout,!1,e.axisZoom,[t],a,i,r,o,n,e.innerPaddingRatio,e.invertAxis,p.AxisOrientation.bottom);return this.setSeriesOffsetScale(e.innerPaddingRatio),s},d.prototype.createYAxis=function(e){e.is100Pct;var t=e.forcedTickCount,a=e.includeYDomain,i=e.logAxisScale,r=e.axisDisplayUnits,o=e.axisPrecision,s=e.outerPaddingRatio,n=e.margin,l=this.viewportHeight,c=p.AxisHelper.createUncertaintyAwareValueDomain(this.data.series)||p.emptyDomain,u=p.AxisHelper.getAxisFormatString(this.data.series),a=p.AxisHelper.mergeScalarAxisDomains(a,p.AxisHelper.createScalarDomainOptions(c,0)),c=p.AxisHelper.scaleShouldClamp(a&&a.domain,c),d=p.AxisHelper.hasForcedDomain(a);return p.AxisHelper.createAxis({pixelSpan:l,domainOptions:a,axisZoom:e.axisZoom,zeroScalarDomain:p.ColumnChart.DefaultZeroScalarDomain,metaDataColumn:this.data.valuesMetadata,formatString:null!=u?u:p.valueFormatter.getFormatString(this.data.valuesMetadata[0],p.columnChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:t,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,logAxisScale:i,axisDisplayUnits:r,axisPrecision:o,shouldClamp:c,outerPaddingRatio:s,margin:n,preventNice:d,includeZero:p.AxisHelper.shouldIncludeZero(a),skipAxisZoomUpdate:e.skipAxisZoomUpdate,invertAxis:e.invertAxis,orientation:e.switchAxisPosition?p.AxisOrientation.right:p.AxisOrientation.left})},d.prototype.createLabelDataPoints=function(e){return p.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.yProps,!1,!0,e,this.yProps.invertAxis)},d.prototype.createUncertaintyLabels=function(e){return p.ColumnUtil.createUncertaintyLabels(this.data,this.layout,this.getColumnWidth(),this.yProps,!1,e,this.hostService)},d.prototype.getColumnWidth=function(){return this.getCategoryWidth()/this.data.series.length},d.prototype.getCategoryWidth=function(){return this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio)},d.prototype.getCategoryAxisScale=function(){return this.xProps.scale},d.prototype.drawColumns=function(e,t,a){var i,r,o,s=this.data,n=(this.columnsCenters=null,this.getCategoryWidth()),n={columnWidth:this.getColumnWidth(),categoryWidth:n,xScale:this.xProps.scale,yScale:this.yProps.scale,seriesOffsetScale:this.seriesOffsetScale,isScalar:this.categoryLayout.isScalar,margin:this.margin,invertAxis:this.yProps.invertAxis},l=this.layout=d.getLayout(s,n),c=s.dataLabelsSettings,u=[],c=(c&&c.show&&(u=this.createLabelDataPoints(t)),_.filter(s.series,function(e){return null==(e=e.uncertainty)?void 0:e.labels.show})),c=(_.isEmpty(c)||(u=u.concat(this.createUncertaintyLabels(t))),p.ColumnUtil.drawSeries(s,this.graphicsContext.mainGraphicsContext,n));return this.animator&&e&&(r=(i=this.animator.animate({viewModel:s,series:c,valueAxisProps:this.yProps,isBar:!1,columnWidth:this.getColumnWidth(),layout:l,itemCS:d.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}})).shapes,o=i.uncertaintyShapes),this.animator&&e&&!i.failed||(o=p.ColumnUtil.drawUncertainty(s,!1,this.graphicsContext.mainGraphicsContext,this.yProps,this.layout,this.getColumnWidth(),this.interactivityService),r=p.ColumnUtil.drawDefaultShapes(s,c,l,d.classes.item,!this.animator,this.interactivityService,this.hostService,!1,a.onObjectOptions),p.ColumnUtil.orderColumnChartShapes(this.graphicsContext.mainGraphicsContext)),p.ColumnUtil.applyInteractivity(r,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:r,uncertaintyShapes:o,viewport:{height:this.height,width:this.width},axisOptions:n,labelDataPointGroups:u,animateLabels:i&&!i.failed}},d.prototype.selectColumn=function(e,t,a){p.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,d.classes.item.selector,e,t,a),this.moveHandle(e)},d.prototype.getClosestColumnIndex=function(e,t){return p.ColumnUtil.getClosestColumnIndex(e,this.getColumnsCenters())},d.prototype.getColumnsCenters=function(){var t,e,a=this;return this.columnsCenters||(e=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),0<this.data.series.length&&(t=0,this.categoryLayout.isScalar||(t=e/2),e=this.data.series[0],this.columnsCenters=e.data.map(function(e){return a.xProps.scale(a.categoryLayout.isScalar?e.categoryValue:e.categoryIndex)+t}))),this.columnsCenters},d.prototype.setSeriesOffsetScale=function(e){var t=this.data.series.length,e=this.categoryLayout.categoryThickness*(1-e)/t;this.seriesOffsetScale=d3.scaleBand().domain(this.data.series.map(function(e){return e.index.toString()})).range([0,t*e])},d.prototype.moveHandle=function(e){var t,a=this.getColumnsCenters(),i=d3.select(".interactive-hover-line");i.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(i.node().parentElement)),!a||a.length<=1?this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove():(i=a[e],this.columnSelectionLineHandle?((t=this.columnSelectionLineHandle).select("line").attrs({x1:i,x2:i}),t.select("circle").attrs({cx:i})):((t=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g")).append("line").classed("interactive-hover-line",!0).attrs({x1:i,x2:i,y1:0,y2:this.height}),t.append("circle").attrs({cx:i,cy:this.height,r:"6px"}).classed("drag-handle",!0)))},d.getLayout=function(e,t){var a=t.columnWidth,i=.5*a,r=i/2,o=t.isScalar,s=t.xScale,n=t.yScale,l=t.seriesOffsetScale,c=t.invertAxis,u=n(0),d=0;return o&&(d=t.categoryWidth/2),{shapeLayout:{width:function(e){return e.drawThinner?i:a},x:function(e){return s(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d+(e.drawThinner?r:0)},y:function(e){e=c?Math.min(0,e.value):Math.max(0,e.value);return u+p.AxisHelper.diffScaled(n,e,0)},height:function(e){return Math.abs(p.AxisHelper.diffScaled(n,0,e.value))}},shapeLayoutWithoutHighlights:{width:function(e){return a},x:function(e){return s(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d},y:function(e){e=c?Math.min(0,e.originalValue):Math.max(0,e.originalValue);return u+p.AxisHelper.diffScaled(n,e,0)},height:function(e){return Math.abs(p.AxisHelper.diffScaled(n,0,e.originalValue))}},zeroShapeLayout:{width:function(e){return e.drawThinner?i:a},x:function(e){return s(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d+(e.drawThinner?r:0)},y:function(e){return u},height:function(e){return 0}},uncertaintyLayout:{lower:function(e){e=e.uncertainty&&e.uncertainty.lower;if(null!=e)return n(e)},upper:function(e){e=e.uncertainty&&e.uncertainty.upper;if(null!=e)return n(e)}}}},d.classes={item:{class:"column",selector:".column"}},p.ClusteredColumnChartStrategy=d,h.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.hostService=e.hostService,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight},h.prototype.setData=function(e){this.data=e},h.prototype.setAxisProperties=function(e,t){this.xProps=e,(this.yProps=t)&&this.setSeriesOffsetScale(t.innerPaddingRatio)},h.prototype.createYAxis=function(e){var t=e.includeYDomain,a=e.logAxisScale,i=e.axisDisplayUnits,r=e.axisPrecision,o=e.margin,s=this.height,n=p.AxisHelper.hasForcedDomain(t),s=p.ColumnUtil.getCategoryAxis(this.data,s,this.categoryLayout,!0,e.axisZoom,[t],a,i,r,o,n,e.innerPaddingRatio,e.invertAxis,e.switchAxisPosition?p.AxisOrientation.right:p.AxisOrientation.left);return this.setSeriesOffsetScale(e.innerPaddingRatio),s},h.prototype.createXAxis=function(e){e.is100Pct;var t=e.forcedTickCount,a=e.includeXDomain,i=e.logAxisScale,r=e.axisDisplayUnits,o=e.axisPrecision,s=e.outerPaddingRatio,n=e.margin,l=e.invertAxis,c=this.width,u=p.AxisHelper.createUncertaintyAwareValueDomain(this.data.series)||p.emptyDomain,d=p.AxisHelper.getAxisFormatString(this.data.series),a=p.AxisHelper.mergeScalarAxisDomains(a,p.AxisHelper.createScalarDomainOptions(u,0)),u=p.AxisHelper.scaleShouldClamp(a&&a.domain,u),h=p.AxisHelper.hasForcedDomain(a),c=p.AxisHelper.createAxis({pixelSpan:c,domainOptions:a,axisZoom:e.axisZoom,zeroScalarDomain:p.ColumnChart.DefaultZeroScalarDomain,metaDataColumn:this.data.valuesMetadata,formatString:null!=d?d:p.valueFormatter.getFormatString(this.data.valuesMetadata[0],p.columnChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:t,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,logAxisScale:i,axisDisplayUnits:r,axisPrecision:o,shouldClamp:u,outerPaddingRatio:s,margin:n,preventNice:h,includeZero:p.AxisHelper.shouldIncludeZero(a),skipAxisZoomUpdate:e.skipAxisZoomUpdate,invertAxis:l,orientation:p.AxisOrientation.bottom});return c.axis.tickSizeInner(-this.viewportHeight).tickSizeOuter(0),c},h.prototype.createLabelDataPoints=function(e){return p.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.xProps,!0,!0,e,this.xProps.invertAxis)},h.prototype.createUncertaintyLabels=function(e){return p.ColumnUtil.createUncertaintyLabels(this.data,this.layout,this.getColumnWidth(),this.xProps,!0,e,this.hostService)},h.prototype.getColumnWidth=function(){return this.getCategoryWidth()/this.data.series.length},h.prototype.getCategoryWidth=function(){return this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio)},h.prototype.getCategoryAxisScale=function(){return this.yProps.scale},h.prototype.drawColumns=function(e,t,a){var i,r,o,s=this.data,n=(this.barsCenters=null,this.getCategoryWidth()),n={columnWidth:this.getColumnWidth(),categoryWidth:n,xScale:this.xProps.scale,yScale:this.yProps.scale,seriesOffsetScale:this.seriesOffsetScale,isScalar:this.categoryLayout.isScalar,margin:this.margin,invertAxis:this.xProps.invertAxis},l=this.layout=h.getLayout(s,n),c=s.dataLabelsSettings,u=[],c=(c&&c.show&&(u=this.createLabelDataPoints(t)),_.filter(s.series,function(e){return null==(e=e.uncertainty)?void 0:e.labels.show})),c=(_.isEmpty(c)||(u=u.concat(this.createUncertaintyLabels(t))),p.ColumnUtil.drawSeries(s,this.graphicsContext.mainGraphicsContext,n));return this.animator&&e&&(o=(i=this.animator.animate({viewModel:s,series:c,valueAxisProps:this.xProps,columnWidth:this.getColumnWidth(),isBar:!0,layout:l,itemCS:h.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}})).shapes),this.animator&&e&&!i.failed||(r=p.ColumnUtil.drawUncertainty(s,!0,this.graphicsContext.mainGraphicsContext,this.xProps,this.layout,this.getColumnWidth(),this.interactivityService),o=p.ColumnUtil.drawDefaultShapes(s,c,l,h.classes.item,!this.animator,this.interactivityService,this.hostService,!0,a.onObjectOptions),p.ColumnUtil.orderColumnChartShapes(this.graphicsContext.mainGraphicsContext)),p.ColumnUtil.applyInteractivity(o,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:o,uncertaintyShapes:r,viewport:{height:this.height,width:this.width},axisOptions:n,labelDataPointGroups:u,animateLabels:i&&!i.failed}},h.prototype.selectColumn=function(e,t,a){p.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,h.classes.item.selector,e,t,a),this.moveHandle(e)},h.prototype.getClosestColumnIndex=function(e,t){return p.ColumnUtil.getClosestColumnIndex(t,this.getBarsCenters())},h.prototype.getBarsCenters=function(){var t,e,a=this;return this.barsCenters||(e=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),0<this.data.series.length&&(t=0,this.categoryLayout.isScalar||(t=e/2),e=this.data.series[0],this.barsCenters=e.data.map(function(e){return a.yProps.scale(a.categoryLayout.isScalar?e.categoryValue:e.categoryIndex)+t}))),this.barsCenters},h.prototype.setSeriesOffsetScale=function(e){var t=this.data.series.length,e=this.categoryLayout.categoryThickness*(1-e)/t;this.seriesOffsetScale=d3.scaleBand().domain(this.data.series.map(function(e){return e.index.toString()})).range([0,t*e])},h.prototype.moveHandle=function(e){var t,a=this.getBarsCenters(),i=d3.select(".interactive-hover-line");i.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(i.node().parentElement)),!a||a.length<=1?null!=(i=this.columnSelectionLineHandle)&&i.remove():(i=a[e],this.columnSelectionLineHandle?((t=this.columnSelectionLineHandle).select("line").attrs({y1:i,y2:i}),t.select("circle").attrs({cy:i})):((t=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g")).append("line").classed("interactive-hover-line",!0).attrs({x1:0,x2:this.width,y1:i,y2:i}),t.append("circle").attrs({cx:0,cy:i,r:"6px"}).classed("drag-handle",!0)))},h.getLayout=function(e,t){var a=t.columnWidth,i=.5*a,r=i/2,o=t.isScalar,s=t.xScale,n=t.yScale,l=t.seriesOffsetScale,c=t.invertAxis,u=s(0),d=0;return o&&(d=t.categoryWidth/2),{shapeLayout:{width:function(e){return Math.abs(p.AxisHelper.diffScaled(s,0,e.value))},x:function(e){e=c?Math.max(0,e.value):Math.min(0,e.value);return u+p.AxisHelper.diffScaled(s,e,0)},y:function(e){return n(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d+(e.drawThinner?r:0)},height:function(e){return e.drawThinner?i:a}},shapeLayoutWithoutHighlights:{width:function(e){return Math.abs(p.AxisHelper.diffScaled(s,0,e.originalValue))},x:function(e){e=c?Math.max(0,e.originalValue):Math.min(0,e.originalValue);return u+p.AxisHelper.diffScaled(s,e,0)},y:function(e){return n(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d},height:function(e){return a}},zeroShapeLayout:{width:function(e){return 0},x:function(e){e=c?Math.max(0,e.value):Math.min(0,e.value);return u+p.AxisHelper.diffScaled(s,e,0)},y:function(e){return n(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d+(e.drawThinner?r:0)},height:function(e){return e.drawThinner?i:a}},uncertaintyLayout:{lower:function(e){e=e.uncertainty&&e.uncertainty.lower;if(null!=e)return s(e)},upper:function(e){e=e.uncertainty&&e.uncertainty.upper;if(null!=e)return s(e)}}}},h.classes={item:{class:"bar",selector:".bar"}},p.ClusteredBarChartStrategy=h}(powerbi=powerbi||{}),function(e){var g;function u(){}function d(){}g=e.visuals||(e.visuals={}),u.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight},u.prototype.setData=function(e){this.data=e},u.prototype.setAxisProperties=function(e,t){this.xProps=e,this.yProps=t},u.prototype.createXAxis=function(e){var t=e.includeXDomain,a=e.logAxisScale,i=e.axisDisplayUnits,r=e.axisPrecision,o=e.margin,s=this.width,n=g.AxisHelper.hasForcedDomain(t);return g.ColumnUtil.getCategoryAxis(this.data,s,this.categoryLayout,!1,e.axisZoom,[t],a,i,r,o,n,e.innerPaddingRatio,e.invertAxis,g.AxisOrientation.bottom)},u.prototype.createYAxis=function(e){var t=e.is100Pct,a=e.forcedTickCount,i=e.includeYDomain,r=e.logAxisScale,o=e.axisDisplayUnits,s=e.axisPrecision,n=e.outerPaddingRatio,l=e.margin,c=this.viewportHeight,u=g.StackedUtil.calcValueDomain(this.data.series,t),d=g.AxisHelper.getAxisFormatString(this.data.series),u=[u.min,u.max],h=g.AxisHelper.mergeScalarAxisDomains(i,g.AxisHelper.createScalarDomainOptions(u,0)),u=g.AxisHelper.scaleShouldClamp(h&&h.domain,u),p=this.data.valuesMetadata[0],d=t?this.graphicsContext.hostService.getLocalizedString("Percentage"):null!=d?d:g.valueFormatter.getFormatString(p,g.columnChartProps.general.formatString),p=g.AxisHelper.hasForcedDomain(h);return g.AxisHelper.createAxis({pixelSpan:c,domainOptions:h,axisZoom:e.axisZoom,zeroScalarDomain:g.ColumnChart.DefaultZeroScalarDomain,metaDataColumn:this.data.valuesMetadata,formatString:d,outerPadding:0,outerPaddingRatio:n,isScalar:!0,isVertical:!0,forcedTickCount:a,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,logAxisScale:r,axisDisplayUnits:o,axisPrecision:s,is100Pct:t,shouldClamp:u,margin:l,preventNice:p,includeZero:g.AxisHelper.shouldIncludeZero(i),skipAxisZoomUpdate:e.skipAxisZoomUpdate,invertAxis:e.invertAxis,orientation:e.switchAxisPosition?g.AxisOrientation.right:g.AxisOrientation.left})},u.prototype.createLabelDataPoints=function(e){return g.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.yProps,!1,!1,e,this.yProps.invertAxis)},u.prototype.createTotalLabelDataPoints=function(e){var t=g.CartesianHelper.getFirstMetadataColumn(this.data.valuesMetadata),t=g.valueFormatter.getFormatString(t,g.columnChartProps.general.formatString);return g.ColumnUtil.createTotalLabelDataPoints(this.data,this.layout,this.graphicsContext,this.yProps,!1,e,t,this.yProps.invertAxis)},u.prototype.getColumnWidth=function(){return this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio)},u.prototype.getCategoryAxisScale=function(){return this.xProps.scale},u.prototype.drawColumns=function(e,t,a){var i,r,o=this.data,s=(this.columnsCenters=null,{columnWidth:this.getColumnWidth(),xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin,invertAxis:this.yProps.invertAxis}),n=this.layout=u.getLayout(o,s),l=o.dataLabelsSettings,c=[],l=(l&&l.show&&(c=c.concat(this.createLabelDataPoints(t))),o.totalLabelsSettings),l=(l&&l.show&&!this.graphicsContext.is100Pct&&(c=c.concat(this.createTotalLabelDataPoints(t))),g.ColumnUtil.drawSeries(o,this.graphicsContext.mainGraphicsContext,s)),e=(this.animator&&e&&(r=(i=this.animator.animate({viewModel:o,series:l,layout:n,itemCS:u.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}})).shapes),this.animator&&e&&!i.failed||(g.ColumnUtil.drawUncertainty(o,!1,this.graphicsContext.mainGraphicsContext,void 0,void 0,void 0),r=g.ColumnUtil.drawDefaultShapes(o,l,n,u.classes.item,!this.animator,this.interactivityService,this.graphicsContext.hostService,!1,a.onObjectOptions)),this.data.ribbonChartData);return n=(l=e&&e.ribbonChartDataPoints?(o=g.ColumnChart.getRibbonsUtils().getRibbonChartAreaLayout(this.layout,e.ribbonChartDataPoints,!0),{graphicsContext:this.graphicsContext.mainGraphicsContext,layout:o,ribbonChartAreaSelector:g.ColumnChart.RibbonChartItemClasses,ribbonChartGroupSelector:g.ColumnChart.RibbonChartLayerClasses,isColumn:!0,colorBands:e.ribbonOptions.colorBands,bandsTransparency:e.ribbonOptions.bandsTransparency,showBorder:e.ribbonOptions.showBorder,style:t,interactivityService:this.interactivityService}):{graphicsContext:this.graphicsContext.mainGraphicsContext,layout:[],ribbonChartAreaSelector:g.ColumnChart.RibbonChartItemClasses,ribbonChartGroupSelector:g.ColumnChart.RibbonChartLayerClasses,isColumn:!0,colorBands:!1,bandsTransparency:u.defaultBandsTransparency,showBorder:!1,style:t,interactivityService:this.interactivityService},g.ColumnChart.getRibbonsUtils().drawRibbonChartAreaSmooth(l)),g.ColumnUtil.applyInteractivity(r,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,ribbonChartEventGroup:n,shapesSelection:r,viewport:{height:this.height,width:this.width},axisOptions:s,labelDataPointGroups:c,animateLabels:i&&!i.failed}},u.prototype.selectColumn=function(e,t,a){g.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,u.classes.item.selector,e,t,a),this.moveHandle(e)},u.prototype.getClosestColumnIndex=function(e,t){return g.ColumnUtil.getClosestColumnIndex(e,this.getColumnsCenters())},u.prototype.getColumnsCenters=function(){var t,e,a=this;return this.columnsCenters||(e=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),0<this.data.series.length&&(t=0,this.categoryLayout.isScalar||(t=e/2),e=this.data.series[0],this.columnsCenters=e.data.map(function(e){return a.xProps.scale(a.categoryLayout.isScalar?e.categoryValue:e.categoryIndex)+t}))),this.columnsCenters},u.prototype.moveHandle=function(e){var t,a=this.getColumnsCenters(),i=d3.select(".interactive-hover-line");i.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(i.node().parentElement)),!a||a.length<=1?this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove():(i=a[e],this.columnSelectionLineHandle?((t=this.columnSelectionLineHandle).select("line").attrs({x1:i,x2:i}),t.select("circle").attrs({cx:i})):((t=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g")).append("line").classed("interactive-hover-line",!0).attrs({x1:i,x2:i,y1:0,y2:this.height}),t.append("circle").attrs({cx:i,cy:this.height,r:"6px"}).classed("drag-handle",!0)))},u.getLayout=function(e,t){var a=t.columnWidth,i=t.isScalar,r=t.xScale,o=t.yScale,s=t.invertAxis,n=i?a/2:0;return{shapeLayout:{width:function(e){return a},x:function(e){return r(i?e.categoryValue:e.categoryIndex)-n},y:function(e){return o(s?e.position-e.valueAbsolute:e.position)},height:function(e){return Math.abs(o(e.position-e.valueAbsolute)-o(e.position))}},shapeLayoutWithoutHighlights:{width:function(e){return a},x:function(e){return r(i?e.categoryValue:e.categoryIndex)-n},y:function(e){return o(s?e.originalPosition-e.originalValueAbsolute:e.originalPosition)},height:function(e){return Math.abs(o(e.originalPosition-e.originalValueAbsolute)-o(e.originalPosition))}},zeroShapeLayout:{width:function(e){return a},x:function(e){return r(i?e.categoryValue:e.categoryIndex)-n},y:function(e){return 0<=e.value?o(e.position-e.valueAbsolute):o(e.position)},height:function(e){return 0}}}},u.classes={item:{class:"column",selector:".column"},highlightItem:{class:"highlightColumn",selector:".highlightColumn"}},u.defaultBandsTransparency=30,g.StackedColumnChartStrategy=u,d.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.isComboChart=e.isComboChart},d.prototype.setData=function(e){this.data=e},d.prototype.setAxisProperties=function(e,t){this.xProps=e,this.yProps=t},d.prototype.createYAxis=function(e){var t=e.includeYDomain,a=e.logAxisScale,i=e.axisDisplayUnits,r=e.axisPrecision,o=e.margin,s=this.height,n=g.AxisHelper.hasForcedDomain(t);return g.ColumnUtil.getCategoryAxis(this.data,s,this.categoryLayout,!0,e.axisZoom,[t],a,i,r,o,n,e.innerPaddingRatio,e.invertAxis,e.switchAxisPosition?g.AxisOrientation.right:g.AxisOrientation.left)},d.prototype.createXAxis=function(e){var t=e.is100Pct,a=e.forcedTickCount,i=e.includeXDomain,r=e.logAxisScale,o=e.axisDisplayUnits,s=e.axisPrecision,n=e.outerPaddingRatio,l=e.margin,c=this.width,u=g.StackedUtil.calcValueDomain(this.data.series,t),d=g.AxisHelper.getAxisFormatString(this.data.series),u=[u.min,u.max],i=g.AxisHelper.mergeScalarAxisDomains(i,g.AxisHelper.createScalarDomainOptions(u,0)),u=g.AxisHelper.scaleShouldClamp(i&&i.domain,u),h=this.data.valuesMetadata[0],d=t?this.graphicsContext.hostService.getLocalizedString("Percentage"):null!=d?d:g.valueFormatter.getFormatString(h,g.columnChartProps.general.formatString),h=g.AxisHelper.hasForcedDomain(i),c=g.AxisHelper.createAxis({pixelSpan:c,domainOptions:i,axisZoom:e.axisZoom,zeroScalarDomain:g.ColumnChart.DefaultZeroScalarDomain,metaDataColumn:this.data.valuesMetadata,formatString:d,outerPadding:0,outerPaddingRatio:n,isScalar:!0,isVertical:!1,forcedTickCount:a,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,logAxisScale:r,axisDisplayUnits:o,axisPrecision:s,is100Pct:t,shouldClamp:u,margin:l,preventNice:h,skipAxisZoomUpdate:e.skipAxisZoomUpdate,invertAxis:e.invertAxis,orientation:g.AxisOrientation.bottom});return c.axis.tickSizeInner(-this.viewportHeight).tickSizeOuter(0),c},d.prototype.createLabelDataPoints=function(e){return g.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.xProps,!0,!1,e,this.xProps.invertAxis)},d.prototype.createTotalLabelDataPoints=function(e){var t=g.CartesianHelper.getFirstMetadataColumn(this.data.valuesMetadata),t=g.valueFormatter.getFormatString(t,g.columnChartProps.general.formatString);return g.ColumnUtil.createTotalLabelDataPoints(this.data,this.layout,this.graphicsContext,this.xProps,!0,e,t,this.xProps.invertAxis)},d.prototype.getColumnWidth=function(){return this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio)},d.prototype.getCategoryAxisScale=function(){return this.yProps.scale},d.prototype.drawColumns=function(e,t,a){var i,r,o=this.data,s=(this.barsCenters=null,{columnWidth:this.getColumnWidth(),xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin,invertAxis:this.xProps.invertAxis}),n=this.layout=d.getLayout(o,s),l=o.dataLabelsSettings,c=[],l=(l&&l.show&&(c=c.concat(this.createLabelDataPoints(t))),o.totalLabelsSettings),l=(l&&l.show&&!this.graphicsContext.is100Pct&&(c=c.concat(this.createTotalLabelDataPoints(t))),g.ColumnUtil.drawSeries(o,this.graphicsContext.mainGraphicsContext,s));return this.animator&&e&&(r=(i=this.animator.animate({viewModel:o,series:l,layout:n,itemCS:d.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}})).shapes),this.animator&&e&&!i.failed||(g.ColumnUtil.drawUncertainty(o,!0,this.graphicsContext.mainGraphicsContext,void 0,void 0,void 0),r=g.ColumnUtil.drawDefaultShapes(o,l,n,d.classes.item,!this.animator,this.interactivityService,this.graphicsContext.hostService,!0,a.onObjectOptions)),g.ColumnUtil.applyInteractivity(r,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:r,viewport:{height:this.height,width:this.width},axisOptions:s,labelDataPointGroups:c,animateLabels:i&&!i.failed}},d.prototype.selectColumn=function(e,t,a){g.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,d.classes.item.selector,e,t,a),this.moveHandle(e)},d.prototype.getClosestColumnIndex=function(e,t){return g.ColumnUtil.getClosestColumnIndex(t,this.getBarsCenters())},d.prototype.getBarsCenters=function(){var t,e,a=this;return this.barsCenters||(e=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),0<this.data.series.length&&(t=0,this.categoryLayout.isScalar||(t=e/2),e=this.data.series[0],this.barsCenters=e.data.map(function(e){return a.yProps.scale(a.categoryLayout.isScalar?e.categoryValue:e.categoryIndex)+t}))),this.barsCenters},d.prototype.moveHandle=function(e){var t,a=this.getBarsCenters(),i=d3.select(".interactive-hover-line");i.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(i.node().parentElement)),!a||a.length<=1?this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove():(i=a[e],this.columnSelectionLineHandle?((t=this.columnSelectionLineHandle).select("line").attrs({y1:i,y2:i}),t.select("circle").attrs({cy:i})):((t=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g")).append("line").classed("interactive-hover-line",!0).attrs({x1:0,x2:this.width,y1:i,y2:i}),t.append("circle").classed("drag-handle",!0).attrs({cx:0,cy:i,r:"6px"})))},d.getLayout=function(e,t){var a=t.columnWidth,i=t.isScalar,r=t.xScale,o=t.yScale,s=t.invertAxis,n=i?a/2:0;return{shapeLayout:{width:function(e){return s?r(e.position-e.valueAbsolute)-r(e.position):r(e.position)-r(e.position-e.valueAbsolute)},x:function(e){return r(s?e.position:e.position-e.valueAbsolute)},y:function(e){return o(i?e.categoryValue:e.categoryIndex)-n},height:function(e){return a}},shapeLayoutWithoutHighlights:{width:function(e){return s?r(e.originalPosition-e.originalValueAbsolute)-r(e.originalPosition):r(e.originalPosition)-r(e.originalPosition-e.originalValueAbsolute)},x:function(e){return r(s?e.originalPosition:e.originalPosition-e.originalValueAbsolute)},y:function(e){return o(i?e.categoryValue:e.categoryIndex)-n},height:function(e){return a}},zeroShapeLayout:{width:function(){return 0},x:function(e){return 0<=e.value?r(e.position-e.valueAbsolute):r(e.position)},y:function(e){return o(i?e.categoryValue:e.categoryIndex)-n},height:function(e){return a}}}},d.classes={item:{class:"bar",selector:".bar"},highlightItem:{class:"highlightBar",selector:".highlightBar"}},g.StackedBarChartStrategy=d}(powerbi=powerbi||{}),function(e){var v,b,x,S,C,f,t;function g(r,e,o,s,n,t){var t=(t===s?e:r).topLevelToggle,l=__assign(__assign({},r),{topLevelToggle:t}),c={};e.groups.forEach(function(e){c[e.uid]=e}),r.groups.forEach(function(e,t){var a,i;b.isPlaceholder(e)||(a=c[e.uid])&&(i="errorBars"===r.uid,l.groups[t]=w(e,a,o,s,n,i),delete c[e.uid])});for(var a=0,i=e.groups;a<i.length;a++){var u=i[a];if(b.isPlaceholder(u))return;u=c[u.uid];u&&l.groups.push(u)}var t=_.unionWith(r.revertToDefaultDescriptors,e.revertToDefaultDescriptors,_.isEqual),d=v.comboChartObjectProps;return l.revertToDefaultDescriptors=t.filter(function(e){return d[e.objectName]&&d[e.objectName][e.propertyName]}),l}function w(e,t,a,i,r,o){var s=__assign({},t),n=e.slices,l=t.slices;return s.slices=A(n,l,a,i,r),e.container&&t.container?s.container=function(e,t,a,i,r,o){var s=__assign({},t),n=(s.containerItems=[],__spreadArray([],e.containerItems,!0)),l=__spreadArray([],t.containerItems,!0);if(o)(o=s.containerItems).push.apply(o,__spreadArray(__spreadArray([],l,!1),n,!1));else{for(var c=void 0,u=(0<e.containerItems.length&&0<t.containerItems.length&&(c=function(e,t,i,r,o){var s=__assign(__assign({},t),{groups:[],slices:[]}),n={};t.groups.forEach(function(e){n[e.uid]=e}),e.groups.forEach(function(e,t){var a=n[e.uid];a?(s.groups[t]=w(e,a,i,r,o),delete n[e.uid]):s.groups[t]=e});for(var a=0,l=t.groups;a<l.length;a++){var c=l[a];n[c.uid]&&s.groups.push(n[c.uid])}return s.slices=A(e.slices,t.slices,i,r,o),s}(n.shift(),l.shift(),a,i,r)),s.containerItems.push(c),[]),d=0,h=n;d<h.length;d++){var p=h[d];u.push({containerItem:p,layerType:a})}for(var g=0,y=l;g<y.length;g++){var m=y[g];u.push({containerItem:m,layerType:i})}for(var v=0,S=u;v<S.length;v++){var f=S[v];s.containerItems.push(function(e,t,o){var s=__assign({},t),a={};return t.groups.forEach(function(e){a[x.getGroupUid(e.uid)]=e}),e.groups.forEach(function(e,i){var r,t=x.getGroupUid(e.uid);a[t]&&(r={},a[t].slices.forEach(function(e){r[C.getGroupAndSliceUid(e.uid)]=e}),s.groups[i].slices=[],e.slices.forEach(function(e){var t,a;b.isPlaceholder(e)||(t=C.getGroupAndSliceUid(e.uid),(a=(a=r[t])||r[t.replace("__".concat(o,"__"),"")])&&("Dropdown"!==a.control.type||"Dropdown"!==e.control.type||P(a.control.properties,e.control.properties))?(a.displayName=e.displayName,s.groups[i].slices.push(a)):s.groups[i].slices.push(__assign(__assign({},e),{displayName:e.displayName,disabled:!0})))}))}),s}(c,f.containerItem,f.layerType))}}return s}(e.container,t.container,a,i,r,o):s.container=e.container||t.container,s}function D(e){return _.findIndex(e,function(e){return!b.isCompositeSlice(e)&&(t=e,a=v.comboChartObjectProps.labels.labelDensity,(t=e.control.properties.descriptor).objectName===a.objectName)&&t.propertyName===a.propertyName;var t,a})}function A(e,t,o,a,s){var n=[],i=D(e),r=e[i],l=D(t),c=t[l],u=(r&&c&&(e=e.filter(function(e,t){return!b.isCompositeSlice(e)&&t!==i}),t=t.filter(function(e,t){return!b.isCompositeSlice(e)&&t!==l})),v.comboChartObjectProps),d={};t.forEach(function(e){L(e,u)&&(d[S.getSliceUid(e,!1)]=e)}),e.forEach(function(e){if(L(e,u)){var t=d[S.getSliceUid(e,!1)],a=e.displayName;if(function(e,t){if(t&&t.control.type===e.control.type&&function(e,t){if(b.isCompositeSlice(e)||b.isCompositeSlice(t))return 1;var a=e.control.properties.descriptor,i=t.control.properties.descriptor;if(_.isEqual(_.omit(i,["selector","instanceKind"]),_.omit(a,["selector","instanceKind"]))){if(f.equals(i.selector,a.selector))return 1;var r=void 0;if(null==i.selector&&(r=f.isWildcardSelector(a.selector)),r=null==a.selector?f.isWildcardSelector(i.selector):r)return function(e,t){e=e.control.properties.descriptor,t=t.control.properties.descriptor;e.instanceKind|=t.instanceKind,null!=e.selector||(e.selector=t.selector)}(e,t),1}return}(e,t))return"Dropdown"!==t.control.type||(t=t.control.properties,e=e.control.properties,P(t,e))?1:void 0;return}(e,t)){if(b.isCompositeSlice(e)&&b.isCompositeSlice(t))for(var i in e.control.properties){var r=e.control.properties[i],i=t.control.properties[i];r&&i&&_.isEqual(r.descriptor,i.descriptor)&&(r.value=i.value)}else e.control.properties.value=t.control.properties.value;delete d[S.getSliceUid(t,!1)]}else a=M(e.uid,o,s);n.push(__assign(__assign({},e),{displayName:a}))}});for(var h=0,p=t;h<p.length;h++){var g,y=p[h],m=d[S.getSliceUid(y,!1)],y=(y=y.uid,g=a,"".concat(y,"__").concat(g,"__"));m&&(g=M(m.uid,a,s),n.push(__assign(__assign({},m),{displayName:g,uid:y})))}return r&&c&&(e=c,t=n,c=s,(r=r).control.properties.value=e.control.properties.value,e=c("Visual_LabelDensity"),t.push(__assign(__assign({},r),{displayName:e}))),n}function a(e){return void 0===e.items}function P(e,t){return a(e)&&a(t)&&_.isEqual(e.filterValues,t.filterValues)}function L(e,t){var a;return b.isCompositeSlice(e)?!!(a=e.control.properties)&&Object.keys(a).every(function(e){e=a[e],e=null==e?void 0:e.descriptor;return!e||!!(e&&t[e.objectName]&&t[e.objectName][e.propertyName])}):!!((e=e.control.properties.descriptor)&&t[e.objectName]&&t[e.objectName][e.propertyName])}function r(e,t){if(0===t.length)return e;for(var a={},i=(e.forEach(function(e){a[e.uid]=e}),[]),r=0,o=t;r<o.length;r++){var s=o[r];a[s]&&i.push(a[s])}return i}function M(e,t,a){return a("Visual_Slice_Placeholder_"+C.getSliceUid(e),function(e,t){switch(e){case 5:return t("DisplayName_QuickCalc_PercentOfColumnTotal");case 0:return t("Visual_Slice_PlaceholderChartType_Line")}}(t,a))}v=e.visuals||(e.visuals={}),b=e.visuals.builder,x=b.FormattingGroupUidBuilder,S=e.visuals.FormattingModelUtil,C=b.FormattingSliceUidBuilder,f=e.data.Selector,t=[[v.comboChartRoleNames.y,v.comboChartRoleNames.tooltips],[v.comboChartRoleNames.y2]],(e=v.ComboChart||(v.ComboChart={})).enumerateDataPoints=function(e,t,a){if(a){for(var i,r=a.length,o=0;o<r;o++){var s=a[o];s.enumerateObjectInstances&&(s instanceof v.ColumnChart?i=o:s.enumerateObjectInstances(e,t))}void 0!==i&&a[i].enumerateObjectInstances(e,t)}},e.isComboChart=function(e){return 11===e||14===e||15===e||16===e||17===e},e.getRoleGroups=function(){return t},e.mergeFormattingCards=function(e,t,a){if(0!==e.length){var i,r;switch(t){case 14:case 15:i=[5,0],r=5;break;default:"There is no support to merge formatting cards for this chart type (enum): ".concat(t)}if(0===(e=function(e,t){if(0===t.length)return;for(var a={},i=(e.forEach(function(e){a[e.type]=e.card}),[]),r=0,o=t;r<o.length;r++)!function(t){a[t]&&a[t].forEach(function(e){return i.push({card:e,type:t})})}(o[r]);return i}(e,i)).length)return[];for(var o={},s=0,n=e;s<n.length;s++){var l=n[s],c=l.card;o[c.uid]?o[c.uid]={card:g(o[c.uid].card,c,o[c.uid].type,l.type,a,r),type:l.type}:o[c.uid]={card:c,type:l.type}}for(var u=[],d=0,h=_.values(o);d<h.length;d++){var p=h[d];u.push(p.card)}return u}},e.mergeFormattingCard=g,e.existsInProps=L,e.sortComboChartFormattingCards=function(e,t,a){var i=[];switch(t){case 14:case 15:i=["bars","lines","markers","labels","seriesLabels","totals"],a&&i.push("errorBars")}return r(e,i)},e.sortFormattingCards=r}(powerbi=powerbi||{}),function(y){var m;function v(e){this.isScrollable=e.isScrollable,this.interactivityService=e.interactivityService}m=y.visuals||(y.visuals={}),v.prototype.initData=function(e){this.style=e.style,this.currentViewport=e.viewport,this.animationOptions=e.animation},v.prototype.initRenderer=function(e){this.svg=e.svg,this.svg.classed(v.ClassName,!0),this.mainGraphicsG=this.svg.append("g").classed("dataDotChartMainGraphicsContext",!0),this.mainGraphicsContext=this.mainGraphicsG.append("svg")},v.prototype.setData=function(e){this.data={series:{data:[]},hasHighlights:!1,hasDynamicSeries:!1},0<e.length&&null!=(e=e[0])&&e.categorical&&(this.data=v.converter(e,m.valueFormatter.format(null),this.interactivityService))},v.prototype.setFilteredData=function(e,t){var a,i=this.clippedData=y.Prototype.inherit(this.data);return null!=(a=null==i?void 0:i.series)&&a.data&&(i.series={data:i.series.data.slice(e,t),xCol:i.series.xCol,yCol:i.series.yCol}),i},Object.defineProperty(v.prototype,"availableWidth",{get:function(){return Math.max(0,this.currentViewport.width-(this.margin.left+this.margin.right))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"availableHeight",{get:function(){return Math.max(0,this.currentViewport.height-(this.margin.top+this.margin.bottom))},enumerable:!1,configurable:!0}),v.prototype.calculateAxesProperties=function(r){function e(e){var t="x"===e,e="y"===e,a=t?s:n,i=t?null==(i=o.data)?void 0:i.series.xCol:null==(i=o.data)?void 0:i.series.yCol;return m.AxisHelper.createAxis({pixelSpan:t?o.availableWidth:o.availableHeight,domainOptions:t?u:c,metaDataColumn:i,axisZoom:void 0,isScalar:e,isVertical:e,isCategoryAxis:t,formatString:m.valueFormatter.getFormatString(i,v.formatStringProp),outerPadding:t?l.categoryThickness*l.outerPaddingRatio:0,forcedTickCount:r.forcedTickCount,useTickIntervalForDisplayUnits:!0,margin:o.margin,preventNice:m.AxisHelper.hasForcedDomain(t?a.includeDomain:c),includeZero:e,categoryThickness:t?l.categoryThickness:void 0,innerPaddingRatio:t?r.innerPaddingRatio:void 0,getValueFn:t?function(e,t){return o.lookupXValue(e,t)}:void 0})}var o=this,s=r.categoryAxisOptions,n=r.valueAxisOptions,t=(this.currentViewport=r.viewport,this.margin=r.margin,this.clippedData=this.data,null!=(t=null==(t=null==(t=null==(t=this.data)?void 0:t.series)?void 0:t.data)?void 0:t.length)?t:0),l=(this.data.hasHighlights&&(t/=2),m.CartesianChartLayout.getLayout(null,{availableWidth:this.availableWidth,categoryCount:t,domain:null,isScalar:!1,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:r.trimOrdinalDataOnOverflow,outerPaddingRatio:r.outerPaddingRatio,innerPaddingRatio:r.innerPaddingRatio})),c=(this.isScrollable||(this.clippedData=v.createClippedDataIfOverflowed(this.data,l.categoryCount)),m.AxisHelper.createScalarDomainOptions(this.getAxesDomains(!1,{valueAxis:!0}).valueAxis,0)),c=m.AxisHelper.mergeScalarAxisDomains(c,n.includeDomain),u=m.AxisHelper.createDomain(0<(null==(t=null==(t=this.data.series)?void 0:t.data)?void 0:t.length)?[this.data.series]:[],null!=(t=null==(t=this.xAxisProperties)?void 0:t.axisType)?t:y.ValueType.fromDescriptor({text:!0}),!1,[s.includeDomain]);return this.xAxisProperties=e("x"),this.yAxisProperties=e("y"),[this.xAxisProperties,this.yAxisProperties]},v.prototype.getAxesDomains=function(e,t){var a={},i=this.clippedData||this.data;return i&&t.valueAxis&&(t=i.series&&!_.isEmpty(i.series.data)?[i.series]:[],a.valueAxis=m.AxisHelper.createValueDomain(t)),a},v.prototype.setAxesLayout=function(e){},v.createClippedDataIfOverflowed=function(e,t){var a,t=e.hasHighlights?Math.min(e.series.data.length,2*t):Math.min(e.series.data.length,t);return t>=e.series.data.length?e:((a=y.Prototype.inherit(e)).series=y.Prototype.inherit(e.series),a.series.data=a.series.data.slice(0,t),a)},v.prototype.lookupXValue=function(e,t){var a=this.data;if(m.AxisHelper.isDateTime(t))return new Date(e);if(a&&a.series){t=a.series.data;if(t){a=t[e];if(a)return a.categoryValue}}return e},v.prototype.overrideXScale=function(e){this.xAxisProperties=e},v.prototype.render=function(e){var t,a,i,r,o,s,n,l,c,u,d,h,p,g=this;if(this.clippedData)return t=(u=this.clippedData).series.data,a=u.hasHighlights,u=this.margin,l=(c=this.currentViewport).width-(u.left+u.right),c=c.height-(u.top+u.bottom),i=this.xAxisProperties.scale,r=this.yAxisProperties.scale,o=this.xAxisProperties.categoryThickness*(1-this.xAxisProperties.innerPaddingRatio),s=o/2,u=this.style.colorPalette.dataColors.getNewColorScale().getColor(v.DotColorKey),n=!!this.interactivityService&&this.interactivityService.hasSelection(),this.mainGraphicsContext.attr("width",l).attr("height",c),(c=(l=this.mainGraphicsContext.selectAll(v.DotClassSelector).data(t,function(e){return e.identity.getKey()})).enter().append("circle").classed(v.DotClassName,!0).merge(l)).styles({fill:u.value}).style("fill-opacity",function(e){return m.ColumnUtil.getFillOpacity(e.selected,e.highlight,n,a)}).classed("null-value",function(e){return null===e.value}).attrs({r:s,cx:function(e){return i(e.categoryIndex)+s},cy:function(e){return r(e.value)}}),l.exit().remove(),u=this.mainGraphicsContext.selectAll(v.DotLabelClassSelector).data(t,function(e){return e.identity.getKey()}),(d=u.enter().append("text").classed(v.DotLabelClassName,!0).attrs({"text-anchor":v.DotLabelTextAnchor,dy:v.DotLabelVerticalOffset}).merge(u)).classed("null-value",function(e){return null===e.value}).classed("overflowed",!1).attrs({x:function(e){return i(e.categoryIndex)+s},y:function(e){return r(e.value)}}).text(function(e){return g.yAxisProperties.formatter.format(e.value)}),h=!1,d.each(function(){h||$("<div>").addClass($(this).attr("class")).hasClass("null-value")||o<y.TextMeasurementService.measureSvgTextElementWidth(this)&&(d.classed("overflowed",!0),h=!0)}),u.exit().remove(),this.interactivityService&&(p={dots:c,dotLabels:d,datapoints:t}),m.SVGUtil.flushAllD3TransitionsIfNeeded(this.animationOptions,c,d),{dataPoints:t,behaviorOptions:p,labelDataPoints:[],labelsAreNumeric:!0,animateLabels:!1}},v.prototype.hasLegend=function(){var e;return null==(e=this.data)?void 0:e.hasDynamicSeries},v.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},v.converter=function(e,t,a){var r,e=e.categorical,o=e.categories&&0<e.categories.length?e.categories[0]:{source:void 0,values:[t],identity:void 0},s=null!=(t=e.originalCategories)?t:[o],t=m.AxisHelper.getCategoryValueType(o.source),n=m.AxisHelper.isDateTime(t),l=o.values;if(_.isEmpty(e.values))return{series:{data:[]},hasHighlights:!1,hasDynamicSeries:!1};for(var c=e.values[0],u=!!c.highlights,d=[],i=0,h=c.values.length;i<h;i++)!function(e){var t,a=new m.SelectionIdBuilder,a=(a=o.identity?a.withCategory(s,e,null==(r=null==o?void 0:o.source)?void 0:r.queryName,!0):a).withMeasure(c.source.queryName).createSelectionId(),i=l[e];if(n&&null!=i&&!(i instanceof Date))return;d.push({categoryValue:n&&i?i.getTime():i,value:c.values[e],categoryIndex:e,seriesIndex:0,selected:!1,identity:a,highlight:!1}),u&&(a=m.SelectionId.createWithHighlight(a),t=c.highlights[e],d.push({categoryValue:n&&i?i.getTime():i,value:t,categoryIndex:e,seriesIndex:0,selected:!1,identity:a,highlight:!0}))}(i);return a&&a.applySelectionStateToData(d),{series:{xCol:o.source,yCol:c.source,data:d},hasHighlights:u,hasDynamicSeries:!0}},v.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},v.prototype.getStaticSeriesRole=function(){},v.formatStringProp={objectName:"general",propertyName:"formatString"},v.ClassName="dataDotChart",v.DotClassName="dot",v.DotClassSelector=".dot",v.DotColorKey="dataDot",v.DotLabelClassName="label",v.DotLabelClassSelector=".label",v.DotLabelVerticalOffset="0.4em",v.DotLabelTextAnchor="middle",m.DataDotChart=v}(powerbi=powerbi||{}),function(e){var r=e.visuals||(e.visuals={});function t(){}t.prototype.create=function(){return new a},r.DataDotChartWebBehaviorFactory=t,i.prototype.bindEvents=function(e,t,a){var i=this.dots=e.dots,e=e.dotLabels;r.InteractivityUtils.registerStandardInteractivityHandlers(i,t),e&&r.InteractivityUtils.registerStandardInteractivityHandlers(e,t)},i.prototype.renderSelection=function(t){this.dots.style("fill-opacity",function(e){return r.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,!1)})};var a=i;function i(){}r.DataDotChartWebBehavior=a}(powerbi=powerbi||{}),function(l){var d,e,t,h;function c(e){this.chartType=132,this.tooltipsEnabled=e.tooltipsEnabled,this.interactivityService=e.interactivityService}d=l.visuals||(l.visuals={}),e=jsCommon.CssConstants.createClassAndSelector,t=l.data.DataViewTransform,h=d.histogramProps.general.formatString,c.prototype.initData=function(e){this.style=e.style,this.currentViewport=e.viewport,this.hostService=e.host,this.tooltipService=e.services.tooltips,this.featureSwitches=e.featureSwitches},c.prototype.initRenderer=function(e){this.svg=e.svg,this.svg.classed("histogram",!0),this.unclippedGraphicsContext=this.svg.append("g").classed("histogramUnclippedGraphicsContext",!0),this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("mainGraphicsContext",!0),this.interactivityService&&(e=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attrs({tabindex:0,focusable:!0,"aria-label":this.hostService.getLocalizedString("Visual_Plot")}).classed(d.SetFocusRingClassName,!e))},c.prototype.setData=function(e){this.data=this.originalData={categories:[],categoryFormatter:null,series:[],totals:[],valuesMetadata:[],hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!0,dataLabelsSettings:null,legendData:null,hasDynamicSeries:!0,isMultiMeasure:!1,binType:d.binType.numOfBins,binSize:c.DefaultBinSize,numberOfBins:c.DefaultBinCount},0<e.length&&(e=this.dataView=c.view)&&e.categorical&&(this.data=this.originalData=c.converter(e,this.style,e.metadata,this.featureSwitches,this.chartType,this.interactivityService,!0,this.hostService))},c.prototype.calculateAxesProperties=function(i){function e(e){var t="x"===e,e="y"===e,a=t?r:o;return d.AxisHelper.createAxis({pixelSpan:t?n.width:n.height,domainOptions:t?d.AxisHelper.createDomain(s.series,d.AxisHelper.getCategoryValueType(s.categoryMetadata,!0),!0,[u]):c,metaDataColumn:t?s.categoryMetadata:s.valuesMetadata,axisZoom:void 0,isScalar:!0,isVertical:e,isCategoryAxis:t,formatString:d.valueFormatter.getFormatString(t?s.categoryMetadata:s.valuesMetadata[0],h),outerPadding:t?l.categoryThickness*l.outerPaddingRatio:0,outerPaddingRatio:t?l.outerPaddingRatio:0,forcedTickCount:i.forcedTickCount,axisDisplayUnits:a.displayUnits,axisPrecision:a.precision,preventNice:d.AxisHelper.hasForcedDomain(t?r.includeDomain:c),categoryThickness:t?l.categoryThickness:void 0,innerPaddingRatio:t?0:void 0,useTickIntervalForDisplayUnits:e||void 0})}var r=i.categoryAxisOptions,o=i.valueAxisOptions,s=(this.currentViewport=i.viewport,this.margin=i.margin,this.viewModelAdapterFactory&&this.originalData&&(t=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=t.getData()),this.data),t=s.categories.length,n=this.getPreferredPlotArea(!0,t,d.CartesianHelper.MinOrdinalRectThickness,i.outerPaddingRatio),a=null!=(a=null==s?void 0:s.preferredCategoryWidth)?a:null,l=d.CartesianChartLayout.getLayout(null,{availableWidth:n.width,categoryCount:t,preferredCategoryWidth:a,domain:null,isScalar:!0,isScrollable:!1,trimOrdinalDataOnOverflow:i.trimOrdinalDataOnOverflow,outerPaddingRatio:i.outerPaddingRatio,innerPaddingRatio:0}),c=d.AxisHelper.createScalarDomainOptions(d.AxisHelper.createValueDomain(s.series),0),c=d.AxisHelper.mergeScalarAxisDomains(c,o.includeDomain),u=d.AxisHelper.createScalarDomainOptions(d.AxisHelper.createIntervalDomain(s.series),0,[!0,!0]);return this.xAxisProperties=e("x"),this.yAxisProperties=e("y"),[this.xAxisProperties,this.yAxisProperties]},c.prototype.getAxesDomains=function(e,t){var a,i={},r=this.data;return r&&(t.categoryAxis&&(a=d.AxisHelper.getCategoryValueType(r.categoryMetadata,!0),a=d.AxisHelper.createDomain(r.series,a,!0,[d.AxisHelper.createScalarDomainOptions(d.AxisHelper.createIntervalDomain(r.series),0,[!0,!0])]))&&(d.AxisHelper.assertScalarDomain(a.domain),i.categoryAxis=a.domain),t.valueAxis)&&(i.valueAxis=d.AxisHelper.createValueDomain(r.series)),i},c.prototype.setAxesLayout=function(e){},c.prototype.getVisualCategoryAxisIsScalar=function(){return!0},c.prototype.getPreferredPlotArea=function(e,t,a,i){return d.CartesianChartLayout.getPreferredPlotArea(t,a,this.currentViewport,!1,e,this.margin,i)},c.prototype.overrideXScale=function(e){this.xAxisProperties=e},c.prototype.render=function(e){var t=this,a=this.data;if(a){var i=this.margin,r=this.currentViewport,o=r.height-(i.top+i.bottom),r=r.width-(i.left+i.right),i=a.series;this.mainGraphicsContext.attr("height",o).attr("width",r),this.mainGraphicsContext.selectAll(c.SeriesSelector.selector).remove();var r=this.mainGraphicsContext.selectAll(c.SeriesSelector.selector).data(i).enter().append("g").classed("bar",!0),i=r.selectAll(c.BinsSelector.selector).data(function(e){return e.data}),s=(i.enter().append("rect").classed(c.BinsSelector.class,!0).attr("x",function(e){return t.xAxisProperties.scale(e.categoryValue.min)}).attr("y",function(e){return t.yAxisProperties.scale(e.value)}).attr("height",function(e){return o-t.yAxisProperties.scale(e.value)}).attr("width",function(e){return t.xAxisProperties.scale(e.categoryValue.max)-t.xAxisProperties.scale(e.categoryValue.min)}).style("fill",function(e){return e.color}),i.exit().remove(),this.tooltipsEnabled&&this.tooltipService.addTooltip(r,function(e){return e.data&&e.data.tooltipInfo},function(e){return e.data&&e.data.identity&&[e.data.identity]}),[]);if(this.interactivityService)for(var n=0,l=a.series.length;n<l;n++)s=s.concat(a.series[n].data);return{dataPoints:s,behaviorOptions:void 0,navigationOptions:void 0,labelDataPoints:[],labelsAreNumeric:!0,labelOrientation:a.dataLabelsSettings.labelOrientation,animateLabels:!0}}},c.converter=function(e,t,a,i,r,o,s,n){t=d.ColumnChart.converter({dataView:e,style:t,is100PercentStacked:!1,isScalar:!0,dataViewMetadata:a=void 0===a?null:a,multipleInfo:void 0,chartType:r,interactivityService:o,tooltipsEnabled:s=void 0===s?!0:s,hostServices:n,ribbonChart:!1,isCombo:!1,buildCategories:c.buildCategories,supportsTotalLabels:!1,featureSwitches:i}),a=l.DataViewObjects.getValue(e.metadata.objects,d.histogramProps.binning.binType),r=l.DataViewObjects.getValue(e.metadata.objects,d.histogramProps.binning.binCount,c.DefaultBinCount),o=l.DataViewObjects.getValue(e.metadata.objects,d.histogramProps.binning.binSize,c.DefaultBinSize);return __assign(__assign({},t),{series:t.series,binType:a,numberOfBins:r,binSize:o})},c.buildCategories=function(e){e.categories;for(var t=[],a=e.categories[0].values.length,i=0;i<a;i++)t.push({min:e.categories[0].values[i],max:e.categories[1].values[i]});return t},c.buildTooltipCategories=function(e,t,a){return(t+=1)===a?{displayName:_.first(e).displayName,value:"[".concat(_.map(e,function(e){return e.value}).join(", "),"]")}:{displayName:_.first(e).displayName,value:"[".concat(_.map(e,function(e){return e.value}).join(", "),")")}},c.prototype.enumerateObjectInstances=function(e,t){if(this.originalData)switch(t.objectName){case"dataPoint":this.enumerateDataPoints(e);break;case"binning":this.enumerateBinning(e,t.objectName)}},c.prototype.enumerateBinning=function(e,t){t={selector:null,properties:{binType:this.data.binType===d.binType.binSize?d.binType.binSize:d.binType.numOfBins},validValues:{},objectName:t};this.data.binType===d.binType.binSize?t.properties[d.histogramProps.binning.binSize.propertyName]=this.data.binSize:t.properties[d.histogramProps.binning.binCount.propertyName]=this.data.numberOfBins,e.pushInstance(t)},c.prototype.enumerateDataPoints=function(e){var t=this.originalData;t&&t.series&&0!==t.series.length&&l.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:_.map(t.series,function(e){return{color:e.color,displayName:e.displayName,identity:e.identity}})},this.featureSwitches)},c.prototype.hasLegend=function(){return!0},c.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},c.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1,supportsValueAxis:!0}},c.prototype.getStaticSeriesRole=function(){return"Y"},c.BinsSelector=e("bin"),c.SeriesSelector=e("bar"),c.DefaultBinCount=5,c.DefaultBinSize=10,c.view={metadata:{columns:[{roles:{Y:!0},type:{numeric:!0},displayName:"Count of Commit",queryName:"CountNonNull(commits5.Commit)",expr:null,index:0,isMeasure:!0,aggregates:{minLocal:5158,maxLocal:15509}},{roles:{Category:!0},type:{integer:!0},format:"0",displayName:"HourOfDayBin",queryName:"commits5.HourOfDayBin",expr:null,sort:1,sortOrder:0,objects:{general:{formatString:"0"}},index:1,identityExprs:null},{roles:{Category:!0},type:{numeric:!0},format:"0",displayName:"Max of HourOfDay",queryName:"Sum(commits5.HourOfDay)",expr:null,objects:{general:{formatString:"0"}},index:2,isMeasure:!0,aggregates:{minLocal:3,maxLocal:23}}],objects:{categoryAxis:{axisType:"Categorical"},general:{formatString:"0"}}},categorical:{categories:[{source:{roles:{Category:!0},type:{integer:!0},format:"0",displayName:"HourOfDayBin",queryName:"commits5.HourOfDayBin",expr:null,sort:1,sortOrder:0,objects:{general:{formatString:"0"}},index:1,identityExprs:null},values:[0,4,8,12,16,20],identity:null,identityFields:null},{source:{roles:{Category:!0},type:{numeric:!0},format:"0",displayName:null,queryName:"query",expr:null,objects:{general:{formatString:"0"}},index:2,isMeasure:!0,aggregates:{minLocal:3,maxLocal:23}},values:[4,8,12,16,20,24]}],values:t.createValueColumns([{source:{roles:{Y:!0},type:{numeric:!0},displayName:"Count of Commit",queryName:"CountNonNull(commits5.Commit)",expr:null,index:0,isMeasure:!0,aggregates:{minLocal:5158,maxLocal:15509}},values:[5272,5427,11478,15509,12732,5158],highlights:[null,null,null,null,1662,2519]}])}},d.Histogram=c}(powerbi=powerbi||{}),function(N){var re=N.visuals||(N.visuals={}),C=N.visuals.AxisHelper,d=jsCommon.BrowserUtils,h=N.visuals.builder,oe=jsCommon.Color,e=jsCommon.CssConstants.createClassAndSelector,o=N.visuals.AddDataViewObjectChange,s=N.visuals.DataViewObjectChangeHelper,u=N.data.DataViewRoleWildcard,p=N.data.DataViewWildcard,n=jsCommon.DOMConstants,se=jsCommon.EnumExtensions,l=N.visuals.OnObjectUtil,g=N.data.Selector,y=N.data.Selector.normalizeSelector,c=(re.horizontalLabelBackgroundPadding=4,ne.getDefaultLineChartLabelSettings=function(e,t){void 0===t&&(t=!1);var a=re.ColorHelper.getThemeColor(e,re.DataLabelViewModel.DefaultLabelColorName),a=re.DataLabelViewModel.getDefaultLabelSettings({style:e,labelColor:a,textClassName:"smallLightLabel"}).fontProperties,a={show:!1,showByDefault:!0,position:re.labelPosition.auto,displayUnits:0,precision:re.DataLabelViewModel.defaultLabelPrecision,fontProperties:a,labelDensity:re.DataLabelViewModel.defaultLabelDensity};return t?(a.enableBackground=!0,a.backgroundColor=re.ColorHelper.getThemeColor(e,re.BackgroundColorName),a.backgroundTransparency=re.DataLabelViewModel.defaultComboChartLabelBackgroundOpacity):a.enableBackground=!1,a.bold=!1,a.italic=!1,a.underline=!1,a},ne.getDefaultLineChartSeriesLabelSettings=function(e){var t=re.ColorHelper.getThemeColor(e,re.DataLabelViewModel.DefaultLabelColorName),e=re.DataLabelViewModel.getDefaultLabelSettings({style:e,labelColor:t,textClassName:"smallLightLabel"}).fontProperties;return{show:!1,seriesColor:t,seriesPosition:re.labelSeriesPosition.right,fontProperties:e,seriesWordWrap:!1,seriesMaximumWidth:20,defaultSeriesWidth:20,showLabelPerSeries:!1,enableBackground:!1,bold:!1,italic:!1,underline:!1}},ne.getDefaultLineChartSeriesWidthSettings=function(e,t){var a=1;if(t)for(var i=t.length,r=0;r<i;r++)var o=re.DataLabelRenderer.LabelTextProperties,o={text:t[r],fontFamily:e.family,fontSize:jsCommon.PixelConverter.fromPoint(e.size.pt),fontWeight:o.fontWeight},o=N.TextMeasurementService.measureSvgTextWidth(o)+2*re.horizontalLabelBackgroundPadding,a=a<o?o:a;return a},ne.converter=function(e){return new re.LineChartConverter(e).convert()},ne.getInteractiveLineChartDomElement=function(e){return e.children("svg").get(0)},ne.createStackedValueDomain=function(e){return 0===e.length?null:[d3.min(e,function(e){return d3.min(e.data,function(e){return e&&e.stackedValue})}),d3.max(e,function(e){return d3.max(e.data,function(e){return e&&e.stackedValue})})]},ne.prototype.initData=function(e){this.options=e,this.style=e.style;var t=e.chartType;this.isComboChart=11===t||14===t||15===t,this.isAreaChart=1===t||2===t,this.element=e.element,this.currentViewport=e.viewport,this.isInteractiveChart=null==(t=e.interactivity)?void 0:t.isInteractiveLegend,this.isInteractiveVisual=null==(t=e.interactivity)?void 0:t.isVisualInteractive,this.host=e.host},ne.prototype.initRenderer=function(e){var t,a=this,i=(this.animator=e.animator,this.cartesianHost=e.cartesianHost,e.svg),i=(i.classed(ne.ClassName,!0),this.mainGraphicsSVG=i.append("svg").classed(ne.lineChartSVGClassName,!0)),r=(this.svgDefs=i.append("defs"),!this.isComboChart&&!this.isInteractiveChart),e=(this.tooltipService=new m(this.options.services.tooltips,i,r),this.mainGraphicsContext=i.append("g").attr("role","listbox").attr("aria-label",this.host.getLocalizedString("Visual_Plot")).attr("aria-live","polite").classed(ne.MainGraphicsContextClassName,!0),this.interactivityService&&(this.isComboChart?this.mainGraphicsContext.attr(n.skipChildrenFocusAttribute,!0):(r=d.isInternetExplorerOrEdge(),e.useManagedTabIndex?(this.mainGraphicsContext.classed(re.managedTabIndexElement.class,!0),this.mainGraphicsContext.attr(n.skipChildrenFocusAttribute,!0)):this.mainGraphicsContext.attr("tabindex",0).attr("focusable",!0),this.mainGraphicsContext.classed(re.SetFocusRingClassName,!r))),this.hoverLineContext=i.append("g").classed("hover-line",!0),this.hoverLineContext.append(ne.LineElementName).attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",0),this.hoverLine=this.hoverLineContext.select(ne.LineElementName));this.isInteractiveChart&&e.classed("interactive",!0),e.style("opacity",re.SVGUtil.AlmostZero),e.style("stroke",re.ColorHelper.getThemeColor(this.style,"foregroundNeutralSecondary")),this.selectionCircles=[],this.xAxisProperties={axis:null,scale:null,axisType:null,formatter:null,graphicsContext:null,values:null,axisLabel:null,isCategoryAxis:!0},this.isInteractiveChart&&(t=ne.getInteractiveLineChartDomElement(this.element),r=function(){a.lastDragMoveXPosition=d3.mouse(t)[0],a.deferDragMoveOperation()},i=d3.drag().on("drag",r),d3.select(t).style("touch-action","none").call(i).on("click",r)),this.markerRenderer=new re.MarkerRenderer,this.anomalyNavigationHelper=new re.AnomalyDetectionKeyboardNavigationHelper},ne.prototype.setData=function(e,t){var a,i,r,o,s;this.data=this.originalData={series:[],dataLabelsSettings:ne.getDefaultLineChartLabelSettings(this.style),seriesLabelSetings:ne.getDefaultLineChartSeriesLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],categoryIdentities:[],lineStyle:re.LineStyle.getDefault(),binnedLineSamplingApplied:!1,legendMarkerRendering:null!=(o=this.featureSwitches)&&o.removeDefaultToCircleToggle?re.legendMarkerRendering.markerCircleDefault:re.legendMarkerRendering.markerOnly,matchLineColor:!1,defaultToCircle:!(null!=(o=this.featureSwitches)&&o.removeDefaultToCircleToggle)},this.focusedDatum=void 0,_.isEmpty(e)?this.dataView=void 0:(o=_.first(e),a=_.find(e,function(e){return re.ForecastHelper.isDataViewForForecast(e)}),e=_.find(e,function(e){return re.AnomalyDetectionVisualPlugin.isDataViewForAnomalyDetection(e)}),null!=o&&o.categorical&&(r={text:!0},i=void 0,(s=(this.dataView=o).categorical.categories)&&!_.isEmpty(s)&&(s[0].source&&s[0].source.type&&(r=s[0].source.type),i=re.ScalarUtils.getScalarKeys(s[0])),s=re.ScalarUtils.shouldDrawScalar(null!=(s=null==(s=o.metadata)?void 0:s.objects)?s:null,re.lineChartProps.categoryAxis.axisType,r,i,re.CartesianHelper.hasCategoryHierarchy(o)),r=!(!(i=null==(r=this.host)?void 0:r.tooltips())||!i.enabled()),i=this.tooltipsEnabled=this.tooltipsEnabledOnHost&&(!i||r),this.data=this.originalData=ne.converter({dataView:o,style:this.style,isScalar:s,host:this.host,interactivityService:this.interactivityService,isComboChart:this.isComboChart,tooltipsEnabled:i,forecastDataView:a,anomalyDetectionDataView:e,shouldCalculateStacked:se.hasFlag(this.lineType,16),multipleInfo:t,supportsTotalLabels:!t&&this.supportsTotalLabels(),featureSwitches:this.featureSwitches}),r=this.previousCategoryIds,o=this.data.categoryIdentities,this.suppressAnimation=ne.shouldSuppressAnimations(r,o),this.previousCategoryIds=o,s=_.find(this.data.series,function(e){return e.data[0]}),this.focusedDatum=s&&s.data[0]))},ne.shouldSuppressAnimations=function(e,t){var a;if(null!=e&&!(e.length>re.AnimatorCommon.MaxDataPointsToAnimate||t.length>re.AnimatorCommon.MaxDataPointsToAnimate))if(a=!1,0===e.length)a=!0;else for(var i=0,r=Math.min(e.length,t.length);i<r;i++)if(!re.SelectionId.isEqual(e[i],t[i])){a=!0;break}return a},ne.prototype.getCategoryDomain=function(e){return C.createDomain(e.series,this.getCategoryValueType(),e.isScalar,[C.createScalarDomainOptions(null==(e=ne.getForecastDomain(e.forecastLines))?void 0:e.x,0)])},ne.prototype.getAxesDomains=function(e,t){var a,i,r,o,s,n;return this.data?(n=this.data,a={},s=ne.getForecastDomain(n.forecastLines),t.categoryAxis&&n.isScalar&&(r=this.getCategoryDomain(n))&&(C.assertScalarDomain(r.domain),i=(r=r.domain)[0],r=r[1],void 0!==i)&&void 0!==r&&(a.categoryAxis=[i,r]),(t.valueAxis||t.secondaryValueAxis)&&(i=s&&s.y,r=this.lineType,t.valueAxis&&(s=ne.getValueDataDomain(n,e,!1,r),o=(s=C.mergeDomains(i,s))[0],s=s[1],void 0!==o)&&void 0!==s&&(a.valueAxis=[o,s]),t.secondaryValueAxis)&&(o=ne.getValueDataDomain(n,e,!0,r),t=(s=C.mergeDomains(i,o))[0],n=s[1],void 0!==t)&&void 0!==n&&(a.secondaryValueAxis=[t,n]),a):{}},ne.getValueDataDomain=function(e,t,a,i){e=ne.getDataForValueAxis(e,a).seriesData;return se.hasFlag(i,16)?ne.createStackedValueDomain(e):C.createUncertaintyAwareValueDomain(e,t)},ne.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&(1<this.data.series.length||1<this.data.valuesMetadata.length))},ne.prototype.setFilteredData=function(e,t){var a=t-e,i=this.scrolledData=N.Prototype.inherit(this.data);return i.series=ne.sliceSeries(i.series,a,e),i.categories=i.categories.slice(e,t),i},ne.prototype.getSeriesSettings=function(){return N.Prototype.inherit(this.data).seriesLabelSetings},ne.getForecastDomain=function(e){if(!_.isEmpty(e)){for(var t=[],a=[],i=0,r=e;i<r.length;i++){var o=r[i];_.isEmpty(o.points)||(t.push.apply(t,_.map(o.points,function(e){return e.point.x})),a.push.apply(a,_.map(o.points,function(e){return e.point.y})),t.push.apply(t,_.map(o.points,function(e){return e.upperBound.x})),a.push.apply(a,_.map(o.points,function(e){return e.upperBound.y})),t.push.apply(t,_.map(o.points,function(e){return e.lowerBound.x})),a.push.apply(a,_.map(o.points,function(e){return e.lowerBound.y})))}return{x:[d3.min(t),d3.max(t)],y:[d3.min(a),d3.max(a)]}}},ne.prototype.calculateAxesProperties=function(i){function e(e){var t="x"===e,e="y"===e,a=t?s:n,a={pixelSpan:t?d.width:d.height,domainOptions:t?f:S,metaDataColumn:t?g:p,axisZoom:i.axisZoom,isScalar:e||l.isScalar,isVertical:e,isCategoryAxis:t,forcedTickCount:i.forcedTickCount,logAxisScale:a.logAxisScale,axisDisplayUnits:a.displayUnits,axisPrecision:a.precision,useTickIntervalForDisplayUnits:!0,margin:o.margin,invertAxis:!(!e&&!l.isScalar)&&a.invertAxis,zeroScalarDomain:ne.DefaultZeroScalarDomain,formatString:t?re.valueFormatter.getFormatString(g,re.lineChartProps.general.formatString):null!=v?v:re.valueFormatter.getFormatString(y,re.lineChartProps.general.formatString),outerPadding:t&&l.isScalar?ne.ScalarOuterPadding:0,outerPaddingRatio:t?u.outerPaddingRatio:0,preventNice:t?!!l.isScalar&&C.hasForcedDomain(f):C.hasForcedDomain(S)};return t?(a.getValueFn=function(e,t){return re.CartesianHelper.lookupXValue(l,e,t,l.isScalar)},a.categoryThickness=u.categoryThickness,a.allowSingleScalarTick=l.isScalar,a.maxTickCount=l.scalarKeyCount):e&&(a.isSecValueAxis=h||o.isComboChart,a.shouldClamp=!1),a}var t,a,r,o=this,s=i.categoryAxisOptions,n=i.valueAxisOptions,l=(this.currentViewport=i.viewport,this.margin=i.margin,this.trimOrdinalDataOnOverflow=i.trimOrdinalDataOnOverflow,this.data),c=0<(null==(c=(l=this.viewModelAdapter&&this.originalData?(this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport})).getData():l).series)?void 0:c.length)?l.series[0].data.length:0,u=this.getCategoryLayout(c,i,l),d=this.getPreferredPlotArea(u.isScalar,u.categoryCount,u.categoryThickness,u.outerPaddingRatio),c=(l=this.adjustLayoutForScroll(l,c,u)).series,h=!1,p=this.data.valuesMetadata,g=(_.some(c,function(e){return e.isY2})&&(h=i.roleName===re.LineChartRoles.Y2,c=(m=ne.getDataForValueAxis(l,h)).seriesData,p=m.valuesMetadata),!_.isEmpty(l.series)&&l.series[0].xCol),y=!_.isEmpty(c)&&c[0].yCol,m=this.getAxesDomains(!1,{categoryAxis:!0,valueAxis:!h,secondaryValueAxis:h}),v=C.getAxisFormatString(c),S=C.createScalarDomainOptions(h?m.secondaryValueAxis:m.valueAxis,0),S=C.mergeScalarAxisDomains(n.includeDomain,S),f=l.isScalar?C.mergeScalarAxisDomains(C.createScalarDomainOptions(m.categoryAxis,0),s.includeDomain):this.getCategoryDomain(l),c=C.createAxis(__assign(__assign({},e("y")),{includeZero:this.axisShouldIncludeZero()})),m=!1,b=0,x=!1,b=(c.dataDomain&&_.isNumber(c.dataDomain[0])&&_.isNumber(c.dataDomain[1])&&(m=(null==(r=l.totalLabelsSettings)?void 0:r.show)&&this.supportsTotalLabels(),b=ne.getMaximumMarkerSize(l.series),x=_.some(l.anomalyDetections,function(e){return-1!==e.highestAnomalyPointIndex||-1!==e.lowestAnomalyPointIndex})),(m||b||x)&&(t=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],a=!1,r=function(e){t=[Math.min(t[0],e[0]),Math.max(t[1],e[1])],a=!0},m&&(m=ne.adjustDomainForLabels(c,l)).adjusted&&r(m.domain),b&&(m=ne.adjustDomainCommon(c,b)).adjusted&&r(m.domain),x&&r(re.AnomalyDetectionVisualPlugin.adjustDomainForAnomalyMarkers(c.dataDomain,c.scale,l.anomalyDetections)),a)&&(c=C.createAxis(__assign(__assign({},e("y")),{domainOptions:C.mergeScalarAxisDomains(n.includeDomain,S,C.createScalarDomainOptions(t,0)),preventNice:!0}))),h?this.y2AxisProperties=c:this.yAxisProperties=c,C.createAxis(e("x")));return this.interactivityService&&!this.data.isScalar&&(b.categoryIdentities=_.map(l.categoryIdentities,function(e){return function(){return e}})),[b,c]},ne.prototype.getCategoryValueType=function(){var e=this.data.scalarMetadata||this.data.categoryMetadata;return C.getCategoryValueType(e)},ne.getDataForValueAxis=function(e,t){var a=e.series,e=e.valuesMetadata,i=t?{roles:{Y2:!0}}:{roles:{Y:!0}};return{seriesData:_.filter(a,function(e){return e.isY2===t}),valuesMetadata:_.filter(e,i)}},ne.prototype.adjustLayoutForScroll=function(e,t,a){return this.scrolledData=void 0,e&&!e.isScalar&&!this.isScrollable&&this.trimOrdinalDataOnOverflow&&t!==(t=Math.min(t,a.categoryCount))&&((e=this.scrolledData=N.Prototype.inherit(e)).series=ne.sliceSeries(e.series,t),e.categories=e.categories.slice(0,t),e.categoryIdentities)&&(e.categoryIdentities=e.categoryIdentities.slice(0,t)),e},ne.prototype.setAxesLayout=function(e){var t=e.layout,a=(this.currentViewport=t.viewport,this.margin=t.margin,this.trimOrdinalDataOnOverflow=e.trimOrdinalDataOnOverflow,this.viewModelAdapter&&this.originalData&&(a=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=a.getData()),this.data.series&&0<this.data.series.length?this.data.series[0].data.length:0),i=e.layout.axes.x,i=this.data?{categoryCount:_.isEmpty(i.values)?0:i.values.length,categoryThickness:i.categoryThickness,outerPaddingRatio:i.outerPaddingRatio,innerPaddingRatio:i.innerPaddingRatio,isScalar:this.getVisualCategoryAxisIsScalar()}:{categoryCount:0,categoryThickness:re.CartesianHelper.MinOrdinalRectThickness,outerPaddingRatio:0,innerPaddingRatio:0,isScalar:!1};this.data=this.adjustLayoutForScroll(this.data,a,i),this.xAxisProperties=t.axes.x,2&e.axisType&&(this.isComboChart?this.yAxisProperties=t.axes.y2:this.y2AxisProperties=t.axes.y2),1&e.axisType&&(this.yAxisProperties=t.axes.y1)},ne.adjustDomainForLabels=function(e,t){var a="",i=(0<t.series.length&&0<t.series[0].data.length&&(a=t.series[0].data[0].labelFormatString),re.DataLabelViewModel.createColumnFormatterCacheManager()),r=re.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(e,t.totalLabelsSettings),i=i.getOrCreate(a,t.totalLabelsSettings,r.units,t.totalLabelsSettings.precision),a=e.dataDomain[0].toString(),r=re.DataLabelRenderer.getLabelFormattedText(i.format(a)),i=re.FontProperties.toTextProperties(t.totalLabelsSettings.fontProperties,r),a=N.TextMeasurementService.estimateSvgTextHeight(i)+re.DataLabelViewModel.labelMargin;return ne.adjustDomainCommon(e,a)},ne.getMaximumMarkerSize=function(e){return 0<e.length?d3.max(e,function(e){return e.lineStyle.markerProperties.showMarker?e.lineStyle.markerProperties.size:0})*re.MarkerRenderer.sizeRatio:0},ne.adjustDomainCommon=function(e,t){var a=e.dataDomain,i=e.scale.domain(),e=e.scale,r=e(a[0])+t,a=e(a[1])-t,t=e.invert(r),r=e.invert(a);return C.adjustDomainWithConstantPixelDifference(i[0],i[1],t,r)},ne.prototype.getCategoryLayout=function(e,t,a){var i;return a?(i=this.getVisualCategoryAxisIsScalar(),re.CartesianChartLayout.getLayout(this.data,{availableWidth:this.availableWidth,categoryCount:e,preferredCategoryWidth:null!=(e=null==a?void 0:a.preferredCategoryWidth)?e:null,domain:null==(e=C.createDomain(a.series,C.getCategoryValueType(null==a?void 0:a.categoryMetadata),i,[t.categoryAxisOptions.includeDomain]))?void 0:e.domain,isScalar:i,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:t.trimOrdinalDataOnOverflow,outerPaddingRatio:t.outerPaddingRatio,innerPaddingRatio:t.innerPaddingRatio})):{categoryCount:0,categoryThickness:re.CartesianHelper.MinOrdinalRectThickness,outerPaddingRatio:t.outerPaddingRatio,innerPaddingRatio:t.innerPaddingRatio,isScalar:!1}},ne.prototype.getErrorBarsCard=function(){var n=this;if(!this.isAreaChart){var l,e,c=this.originalData;if(c&&c.series&&0!==c.series.length)return l=function(e){return n.host.getLocalizedString(e)},e=[(e=re.StandardObjectIdentifiers.error).enabled,e.errorRange,e.barShow,e.barMatchSeriesColor,e.barColor,e.barWidth,e.barBorderColor,e.barBorderSize,e.shadeShow,e.shadeBandStyle,e.shadeColor,e.shadeMatchSeriesColor,e.shadeTransparency,e.labelShow,e.labelFontFamily,e.labelFontSize,e.labelBold,e.labelItalic,e.labelUnderline,e.labelColor,e.labelMatchSeriesColor,e.labelFormat,e.labelBackground,e.labelBackgroundColor,e.labelBackgroundTransparency,e.markerShape,e.markerSize,e.showMarkerByDefault,e.tooltipShow,e.tooltipFormat],(e=new re.builder.FormattingCardBuilder(new re.builder.FormattingCardUidBuilder("errorBars"),"Visual_Error_Bars",e,l,!0,!0)).addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1),e.addContainer("measure",function(s){s.withDisplayName("Series");for(var e=0,t=c.valuesMetadataBySeries;e<t.length;e++)!function(e){var t=_.first(e.usedInSeriesIndices);if(null!=t){var a=e.metadataColumn,t=c.series[t];if(null==t)return;var i=e.valueSelector.getSelector(),r=n.isComboChart?u.fromRoles([re.LineChartRoles.Rows,re.LineChartRoles.Category]):p.create(),r=__assign(__assign({},i),{data:[r],highlightMatching:1}),o={localize:l,uncertainty:t.uncertainty,targetMeasure:e.metadataColumn.expr,measureSelector:i,dataPointSelector:r,featureSwitches:n.featureSwitches};s.addContainerItem(a.queryName,a.displayName,function(e){return re.UncertaintyHelper.getFormattingContainer(o,e)})}}(t[e])})}),e.build()}},ne.prototype.getDataPointCard=function(i){var r,o,e,s,n,l,c=this,u=this.originalData;if(u&&u.series&&0!==u.series.length)return r=function(e){return c.host.getLocalizedString(e)},o=N.DataViewObjects.getValue(this.dataView&&this.dataView.metadata&&this.dataView.metadata.objects,re.lineChartObjectProps.lineStyles.showSeries,!0),e=[re.lineChartObjectProps.lineStyles.lineStyle,re.lineChartObjectProps.lineStyles.showSeries,re.lineChartObjectProps.lineStyles.strokeWidth,re.lineChartObjectProps.lineStyles.strokeLineJoin,re.lineChartObjectProps.lineStyles.stepped,re.lineChartObjectProps.dataPoint.fill,re.lineChartObjectProps.dataPoint.showAllDataPoints,re.lineChartObjectProps.dataPoint.defaultColor,re.lineChartObjectProps.dataPoint.transparency,re.cartesianChartProps.categoryAxis.preferredCategoryWidth,re.comboChartObjectProps.lineStyles.shadeArea,re.cartesianChartProps.categoryAxis.reverseStackOrder],e=new re.builder.FormattingCardBuilder(new re.builder.FormattingCardUidBuilder("lines"),"Visual_Lines",e,r),s={lineStyle:re.lineChartObjectProps.lineStyles.lineStyle,strokeLineJoin:re.lineChartObjectProps.lineStyles.strokeLineJoin,strokeWidth:re.lineChartObjectProps.lineStyles.strokeWidth,stepped:re.lineChartObjectProps.lineStyles.stepped,showSeries:re.lineChartObjectProps.lineStyles.showSeries},n={styleProps:s,style:u.lineStyle,showSeries:!0,showSeriesValue:o},l=this.getValidDataPointIndices(u),e.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).withContainerDisabled(!o).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",r("All"),function(e){var t;c.addDataPointGroupsToContainer(i,n,e,l),o||(t=[re.lineChartObjectProps.lineStyles.lineStyle,re.lineChartObjectProps.lineStyles.strokeWidth,re.lineChartObjectProps.lineStyles.strokeLineJoin,re.lineChartObjectProps.lineStyles.stepped,re.lineChartObjectProps.lineStyles.showMarkerByDefault,re.lineChartObjectProps.lineStyles.showMarker,re.lineChartObjectProps.lineStyles.markerShape,re.lineChartObjectProps.lineStyles.markerSize,re.lineChartObjectProps.lineStyles.markerColor],e.addSimpleSlice("showSeriesLink",function(){return new h.SeriesDialogLinkBuilder({descriptor:re.lineChartObjectProps.lineStyles.showSeries,value:function(){},ariaLabel:"Enable_This_Setting",type:"SeriesDialogLink",resetToDefaultDescriptors:t,warningIcon:!0}).build()},function(e){return e.withCustomDisplayName("Enable_This_Setting").withSuppressDisplayName(!0)}))}),1<u.series.length)for(var t=0,a=u.series;t<a.length;t++)!function(t){n={styleProps:s,style:t.lineStyle,selector:y(t.identity.getSelector())},e.addContainerItem(t.seriesName,t.seriesName,function(e){return c.addDataPointGroupsToContainer(i,n,e,l,t)})}(a[t])})}),this.getVisualCategoryAxisIsScalar()||e.addGroup("spacing",function(e){e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("categoryWidth",new re.builder.NumUpDownBuilder({descriptor:re.cartesianChartProps.categoryAxis.preferredCategoryWidth,value:i.preferredCategoryWidth,options:{minValue:{type:0,value:20},maxValue:{type:1,value:180},unitSymbol:"Numeric_Pixel"}}).build())}),e.build()},ne.prototype.addDataPointGroupsToContainer=function(a,i,e,t,r){function o(e){return s.host.getLocalizedString(e)}var s=this,n=(re.LineStyle.addLineStyleFormattingContainers(i,e),this.originalData),l=_.map(n.series,function(e){return{color:e.color,displayName:e.seriesName,identity:e.identity}}),t=(a.reverseStackOrder||l.reverse(),0<t.length&&ne.chartTypeSupportsExplicitDots(n.isComboChart)),c=(e.addGroup("colors",function(e){e.withDisplayName("Visual_Colors");var t={groupBuilder:e,dataPoints:l,seriesColorProps:re.lineChartObjectProps.dataPoint,localize:o,featureSwitches:s.featureSwitches},t=(r?(t=__assign(__assign({},t),{selector:i.selector}),N.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(t,i.selector)):N.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(t),s.originalData.series.length);(s.originalData.hasDynamicSeries||1<t)&&s.featureSwitches&&s.featureSwitches.flipStackOrder&&s.isStacked()&&e.addSimpleSlice("Visual_ReverseStackOrder",new h.ToggleSwitchBuilder({descriptor:re.cartesianChartProps.categoryAxis.reverseStackOrder,value:a.reverseStackOrder}).build(),function(e){return e.withDisabled(!!r)}),s.isComboChart&&(r?e.addSimpleSlice("shadearea",function(){return new h.ToggleSwitchBuilder({descriptor:__assign(__assign({},re.comboChartObjectProps.lineStyles.shadeArea),{selector:r.identity.getSelector()}),value:r.lineStyle.shadeArea}).build()}):e.addSimpleSlice("shadearea",function(){return new h.ToggleSwitchBuilder({descriptor:re.comboChartObjectProps.lineStyles.shadeArea,value:n.lineStyle.shadeArea}).build()}))}),this.isAreaChart&&this.featureSwitches.areaChartTransparency),u=n.areaTransparency;t&&c&&e.addGroup("shadeArea",function(e){e.withDisplayName("Visual_Shapes_ShadeArea").addSimpleSlice("transparency",h.SliderBuilder.getTransparencySliderBuilder({descriptor:re.lineChartObjectProps.dataPoint.transparency,value:u,localize:o}).build(),function(e){return e.withDisabled(!!r)}),r&&e.withDisabled(!0,"")})},ne.prototype.addMarkersFormattingContainers=function(e,t){var a=e.styleProps,i=e.style,r=e.selector,o=e.categoryColorsOptions;a&&(a.showMarker&&t.addSimpleSlice("showMarker",new h.ToggleSwitchBuilder({descriptor:__assign(__assign({},a.showMarker),{selector:r}),value:i.markerProperties.showMarker}).build(),function(e){return e.withDisabled(!r)}),t.addGroup("markers",function(e){e.withDisplayName("Visual_Shape"),a.markerShape&&e.addSimpleSlice("markerShape",new h.DropdownBuilder({descriptor:__assign(__assign({},a.markerShape),{selector:r}),value:i.markerProperties.shape}).build(),function(e){return e.withCustomDisplayName("Type").withDisabled(!i.markerProperties.showMarker)}),a.markerSize&&e.addSimpleSlice("markerSize",new h.NumUpDownBuilder({descriptor:__assign(__assign({},a.markerSize),{selector:r}),value:i.markerProperties.size,options:{minValue:{type:0,value:ne.MarkerShapeSizeRange.min},maxValue:{type:1,value:ne.MarkerShapeSizeRange.max},unitSymbol:re.visualLocKeys.PixelUnitSymbol}}).build(),function(e){return e.withCustomDisplayName("Visual_BubbleSize").withDisabled(!i.markerProperties.showMarker)})}),a.markerColor)&&t.addGroup("colors",function(e){e.withDisplayName("Visual_Colors").addSimpleSlice("markerColor",new h.ColorPickerBuilder({descriptor:__assign(__assign({},a.markerColor),{selector:r}),value:{value:i.markerProperties.color}}).build(),function(e){return e.withCustomDisplayName("Default").withDisabled(!i.markerProperties.showMarker)}),o&&(o.options.disableShowAllToggle=!!r,N.colorEnumerationHelperModuleFactory().appendCategoryColorSlicesToGroup(__assign(__assign({},o),{groupBuilder:e})))})},ne.prototype.getMarkersCard=function(){var s,n,l,e,c=this,u=this.originalData;if(u&&u.series&&0!==u.series.length)return s=function(e){return c.host.getLocalizedString(e)},n=N.DataViewObjects.getValue(this.dataView&&this.dataView.metadata&&this.dataView.metadata.objects,re.lineChartObjectProps.lineStyles.showSeries,!0),l={showMarker:re.lineChartObjectProps.lineStyles.showMarker,markerShape:re.lineChartObjectProps.lineStyles.markerShape,markerSize:re.lineChartObjectProps.lineStyles.markerSize,markerColor:re.lineChartObjectProps.lineStyles.markerColor,showAllDataPoints:re.lineChartObjectProps.dataPoint.showAllDataPoints,fill:re.lineChartObjectProps.dataPoint.fill,showSeries:re.lineChartObjectProps.lineStyles.showSeries},(e=new re.builder.FormattingCardBuilder(new re.builder.FormattingCardUidBuilder("markers"),"Visual_Markers",l,s)).addTopLevelToggle("showMarkerTopLevel",function(){return new h.ToggleSwitchBuilder({descriptor:__assign({},l.showMarker),value:u.lineStyle.markerProperties.showMarker}).build()}),e.addGroup("applySettingsTo",function(e){var t=c.getValidDataPointIndices(u),a=0<t.length&&ne.chartTypeSupportsExplicitDots(u.isComboChart),r=a?c.getCategoryColorsOptions(u,t,e,a):void 0,o={styleProps:l,style:u.lineStyle,categoryColorsOptions:r};e.withContainerDisabled(!n).withDisplayName("Apply_Settings_To").withCollapsible(!1),e.addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",s("All"),function(e){var t;c.addMarkersFormattingContainers(o,e),n||(t=[re.lineChartObjectProps.lineStyles.lineStyle,re.lineChartObjectProps.lineStyles.strokeWidth,re.lineChartObjectProps.lineStyles.strokeLineJoin,re.lineChartObjectProps.lineStyles.stepped,re.lineChartObjectProps.lineStyles.showMarker,re.lineChartObjectProps.lineStyles.showMarkerByDefault,re.lineChartObjectProps.lineStyles.markerShape,re.lineChartObjectProps.lineStyles.markerSize,re.lineChartObjectProps.lineStyles.markerColor,re.lineChartObjectProps.dataPoint.showAllDataPoints,re.lineChartObjectProps.dataPoint.fill],e.addSimpleSlice("showSeriesLink",function(){return new h.SeriesDialogLinkBuilder({descriptor:re.lineChartObjectProps.lineStyles.showSeries,value:function(){},ariaLabel:"Enable_This_Setting",type:"SeriesDialogLink",resetToDefaultDescriptors:t,warningIcon:!0}).build()},function(e){return e.withCustomDisplayName("Enable_This_Setting").withSuppressDisplayName(!0)}))}),1<u.series.length)for(var t=0,a=u.series;t<a.length;t++){var i=a[t];o={styleProps:l,style:i.lineStyle,categoryColorsOptions:r,selector:y(i.identity.getSelector())},e.addContainerItem(i.seriesName,i.seriesName,function(e){return c.addMarkersFormattingContainers(o,e)})}})}),e.build()},ne.prototype.getDataLabelsCard=function(){function o(e){return s.host.getLocalizedString(e)}var s=this,n=this.originalData,e=n.dataLabelsSettings,l=n.series.length,c=1<l||!n.categoryMetadata||this.isComboChart,u=[re.labelPosition.auto,re.labelPosition.above,re.labelPosition.under],t=(this.isStacked()&&(u=[re.labelPosition.auto,re.labelPosition.insideCenter,re.labelPosition.insideEnd]),e.position&&u.indexOf(e.position)<0&&(e.position=re.labelPosition.auto),__assign(__assign({},re.lineChartObjectProps.labels),{position:re.lineChartObjectProps.labels.labelPosition,precision:re.lineChartObjectProps.labels.labelPrecision,displayUnits:re.lineChartObjectProps.labels.labelDisplayUnits,labelBackgroundColor:re.lineChartObjectProps.labels.backgroundColor,labelBackgroundTransparency:re.lineChartObjectProps.labels.backgroundTransparency,showDynamicLabels:re.lineChartObjectProps.labels.showDynamicLabels,dynamicLabelValue:re.lineChartObjectProps.labels.dynamicLabelValue})),a=new re.builder.FormattingCardBuilder(new re.builder.FormattingCardUidBuilder("labels"),"Visual_DataPointsLabels",t,o),i=this.getLabelSettingsOptions(void 0,e,null,c,u),d={cardBuilder:a,dataLabelsProps:t,featureSwitches:this.featureSwitches,hostServices:this.host,options:i,includeAltConstantValueSelector:!0,individualSelector:this.isComboChart?void 0:this.getLabelIndividualSelector(!1)};return a.withDescription("Visual_DataPointsLabelsDescription"),t.show&&a.addTopLevelToggle("show",function(){return new h.ToggleSwitchBuilder({descriptor:t.show,value:i.dataLabelsSettings.show}).build()}),a.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",o("All"),function(e){return re.DataLabelViewModel.createDataLabelsFormattingContainers(d,e)}),c)for(var t=0;t<l;t++){var a=n.series[t],i=null!=(i=a.labelSettings)?i:n.dataLabelsSettings,r=(i.position&&u.indexOf(i.position)<0&&(i.position=re.labelPosition.auto),a.identity.getSelector());d.includeAltConstantValueSelector=!1,d.selector=n.hasDynamicSeries?g.normalizeSelector(r):r,d.individualSelector=s.getLabelIndividualSelector(!0),d.options=s.getLabelSettingsOptions(void 0,i,r,void 0,u,n.hasDynamicSeries),e.addContainerItem(a.seriesName,a.seriesName,function(e){return re.DataLabelViewModel.createDataLabelsFormattingContainers(d,e)})}})}),a.build()},ne.prototype.getSeriesLabelsCard=function(){var o,e,s,n,l,t,a,i,c,u=this;if(this.showSeriesCard())return e=(o=this.originalData).seriesLabelSetings,s=o.series.length,n=this.showLabelPerSeries(),l=function(e){return u.host.getLocalizedString(e)},t=__assign(__assign({},re.lineChartObjectProps.seriesLabels),{show:{objectName:"seriesLabels",propertyName:"show"}}),a=new re.builder.FormattingCardBuilder(new re.builder.FormattingCardUidBuilder("seriesLabels"),"Visual_SeriesLabels",t,l),i=this.getSeriesLabelSettingsOptions(void 0,e,null,n),c={cardBuilder:a,seriesLabelsProps:t,featureSwitches:this.featureSwitches,hostServices:this.host,seriesOptions:i},a.withDescription("Visual_SeriesDescription"),t.show&&a.addTopLevelToggle("show",function(){return new h.ToggleSwitchBuilder({descriptor:t.show,value:i.seriesLabelsSettings.show}).build()}),a.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){var t;if(e.withDisplayName("Series"),e.addContainerItem("all",l("All"),function(e){return re.DataLabelViewModel.createSeriesLabelsFormattingContainers(c,e)}),n)for(var a=0;a<s;a++){var i=o.series[a],r=i.identity.getSelector();c.selector=o.hasDynamicSeries?g.normalizeSelector(r):r,c.seriesOptions=u.getSeriesLabelSettingsOptions(void 0,null!=(t=i.seriesSettings)?t:o.seriesLabelSetings,r,void 0),e.addContainerItem(i.seriesName,i.seriesName,function(e){return re.DataLabelViewModel.createSeriesLabelsFormattingContainers(c,e)})}})}),a.build()},ne.prototype.getTotalsCard=function(){var t=this;if(this.supportsTotalLabels()){var e,a,i=this.originalData.totalLabelsSettings;if(i)return e=__assign(__assign({},re.lineChartObjectProps.totals),{precision:re.lineChartObjectProps.totals.labelPrecision,displayUnits:re.lineChartObjectProps.totals.labelDisplayUnits}),(a=new re.builder.FormattingCardBuilder(new re.builder.FormattingCardUidBuilder("totals"),"Visual_DataTotalLabels",e,function(e){return t.host.getLocalizedString(e)})).withDescription("Visual_DataTotalLabelsDescription"),a={cardBuilder:a,dataLabelsProps:e,featureSwitches:this.featureSwitches,hostServices:this.host,options:this.getTotalLabelSettingsOptions(void 0,i),individualSelector:this.getLabelIndividualSelector(!1)},re.DataLabelViewModel.getDataLabelsFormattingModel(a)}},ne.prototype.getLabelIndividualSelector=function(e){return re.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:this.featureSwitches,hasCategories:null!=_.first(this.originalData.categories),hasDynamicSeries:this.originalData.hasDynamicSeries,hasSeriesSelector:e})},ne.prototype.getFormattingCards=function(e){var t=this;return{card:[function(){return t.getDataPointCard(e.categoryAxisData)},function(){return t.getMarkersCard()},function(){return t.getDataLabelsCard()},function(){return t.getSeriesLabelsCard()},function(){return t.getTotalsCard()},function(){return t.getErrorBarsCard()}].reduce(function(e,t){t=t();return t&&e.push(t),e},[]),type:0}},ne.prototype.getDisambiguationSubSelectables=function(e,t){if(!this.data)return[];var a=[];if(void 0===t||3===t)for(var i=0,r=this.data.series;i<r.length;i++){var o,s=r[i];s.lineStyle.markerProperties.showMarker&&(o=null==(o=null==s?void 0:s.identity)?void 0:o.getSelectorsByColumn(),s=this.host.getLocalizedString("MiniToolbar_Markers",s.seriesName),a.push(e.createVisualSubSelectionForSingleObject({objectName:"markers",subSelectionType:3,displayName:s,showUI:!0,selectorsByColumn:o})))}return a},ne.prototype.getSelectorsByColumnFromSubselectedElement=function(e){switch(d3.select(e).attr(re.SubSelectableObjectNameAttribute)){case"area":case"lines":var t=d3.select(e).datum(),t=null==(t=null==t?void 0:t.identity)?void 0:t.getSelectorsByColumn();if(t)return t;break;case"data-labels":case"series-labels":t=re.DataLabelUtil.getLabelSeriesSelectorsByColumn(e,this.data.series);if(t)return t;break;default:return}},ne.prototype.getSubSelectionCustomOutlines=function(e){var t=e.visualObjects[0].objectName,a=e.visualObjects[0].selectorsByColumn;if("markers"===t){e=(null==(e=this.scrolledData)?void 0:e.series)||(null==(t=this.data)?void 0:t.series);if(e)for(var i=0,r=e;i<r.length;i++){var o=r[i],s=null==(s=o.identity)?void 0:s.getSelectorsByColumn();if(g.equalsSelectorsByColumn(s,a))return ne.getMarkerOutlinesForSeries(o,this.buildViewModel(0),this.tooltipService.getTooltipOverlayElement()||this.mainGraphicsPositionRect)}}},ne.prototype.getSubSelectionCustomElements=function(e){var t,e=e.visualObjects[0].objectName;if("area"===e)return e=d3.event,t=this.buildViewModel(0),(e=ne.findSubSelectedAreaElement({x:e.clientX,y:e.clientY},this.mainGraphicsSVG,t))?[e]:void 0},ne.prototype.getSubSelectionStyles=function(e){var t,e=_.first(e).visualObjects;if(0<e.length){(e=e[0])&&e.selectorsByColumn&&(t=g.normalizeSelector(g.convertSelectorsByColumnToSelector(e.selectorsByColumn)));var a,i,r=1===this.data.series.length;switch(e.objectName){case"lines":return t?{type:3,stroke:{reference:{cardUid:"Visual-lines",groupUid:"lines-applySettingsTo-series--colors",sliceUid:"lines-applySettingsTo-series--colors-datapoint",selector:t},label:this.host.getLocalizedString("Visual_Shape_Line")}}:void 0;case"area":return t?l.getShapeSubSelectionStyles("".concat("Visual","-").concat("lines"),"".concat("lines-applySettingsTo-series","--").concat("colors"),"".concat("lines-applySettingsTo-series","--").concat("colors","-datapoint"),this.host,!1,!0,t):void 0;case"markers":return t?(a="".concat("Visual","-").concat("markers"),i="".concat("markers-applySettingsTo-series","--").concat("colors"),l.getShapeSubSelectionStyles(a,r?void 0:i,"".concat(i,"-markerColor"),this.host,!1,!0,r?void 0:t)):void 0;case"data-labels":return l.getDataLabelsSubSelectionStyles({hostServices:this.host,omitSelectorForSingleSeries:r,individualSelector:this.getLabelIndividualSelector(!r),selector:t,repetitionSelector:void 0,inContainer:!0});case"total-labels":return l.getTotalLabelsSubSelectionStyles(this.host,this.getLabelIndividualSelector(!1),void 0);default:return}}},ne.prototype.getSubSelectionShortcuts=function(e,t){if(!t){t=_.first(e).visualObjects;if(0<t.length){var a,i,r,e=t[0],o=(_.isEmpty(e.selectorsByColumn)||(a=g.normalizeSelector(g.convertSelectorsByColumnToSelector(e.selectorsByColumn))),{key:"Delete",nextValue:!1}),s={sourceUid:"".concat("markers-applySettingsTo-series","--showMarker"),selector:a};switch(e.objectName){case"lines":case"area":return a?[{type:0,excludedResetSourceUids:[{sourceUid:"".concat("Visual","-").concat("labels")},i={sourceUid:"".concat("labels","-").concat("applySettingsTo","-series--showSeries"),selector:a},s,r={sourceUid:"".concat("seriesLabels","-").concat("applySettingsTo","-series--showSeries"),selector:a}]},{type:2,sourceUid:i.sourceUid,enabledLabel:this.host.getLocalizedString("Format_AddDataLabels"),selector:i.selector},{type:2,sourceUid:s.sourceUid,enabledLabel:this.host.getLocalizedString("Format_AddMarkers"),selector:s.selector,keyboardShortcuts:[o]},{type:2,sourceUid:r.sourceUid,enabledLabel:this.host.getLocalizedString("Format_AddSeriesLabel"),selector:r.selector},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("lines")}],label:this.host.getLocalizedString("Format_Line")}]:void 0;case"markers":return a?[{type:2,sourceUid:s.sourceUid,disabledLabel:this.host.getLocalizedString("Delete"),selector:s.selector,keyboardShortcuts:[o]},{type:0,excludedResetSourceUids:[s]},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("markers")}],label:this.host.getLocalizedString("Format_Markers")}]:void 0;default:return}}}},ne.prototype.enumerateObjectInstances=function(e,t){var a,i=this.originalData;if(i)switch(t.objectName){case"dataPoint":this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e);break;case"seriesLabels":null!=(a=this.featureSwitches)&&a.lineChartSeriesLabels&&this.enumerateSeriesDataLabels(e);break;case"totals":this.supportsTotalLabels()&&this.enumerateTotalLabels(e);break;case re.lineChartProps.lineStyles.strokeLineJoin.objectName:ne.enumerateLineStyles(e,i,this.dataView);break;case re.ForecastHelper.forecastObjectName:this.supportsForecast()&&(a=void 0,_.isEmpty(i.anomalyDetections)||(a=this.host.getLocalizedString("Visual_AnomalyDetection_WarningMessage_NoWithForecast")),re.ForecastHelper.enumerateObjectInstances(e,i.forecastLines,this.style,a));break;case re.AnomalyDetectionObjectConstants.capabilityObjectName:this.supportsAnomalyDetection()&&(a=i.isScalar,re.AnomalyDetectionVisualPlugin.enumerateAnomalyObjectInstances(this.host,this.data,this.dataView,e,i.anomalyDetections,this.style,a,t.selectors))}},ne.prototype.enumerateDataPoints=function(e){var a=this.originalData;if(a&&a.series&&0!==a.series.length){N.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:_.map(a.series,function(e){return{color:e.color,displayName:e.seriesName,identity:e.identity}})},this.featureSwitches);var t=this.getValidDataPointIndices(a),i=0<t.length&&ne.chartTypeSupportsExplicitDots(a.isComboChart);if(i){for(var r=[],o=0,s=t;o<s.length;o++){var n=s[o],n=re.CategoryLevelUtils.concatenateCategoryLevels(a.categoryData[n.categoryIndex].hierarchyCategoryLevels);r.push(n.value)}N.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:e,dataView:this.dataView,style:this.style,categories:_.map(t,function(e,t){return{color:a.series[e.seriesIndex].data[e.dataPointIndex].pointColor,displayName:r[t],identity:a.categoryIdentities[e.categoryIndex]}}),fillInstanceKind:a.hasDynamicSeries?1:3,noDefaultFillColor:i,multipleRole:a.multipleIdentity?re.LineChartRoles.Rows:void 0,supportDataPointTransparency:this.isAreaChart&&this.featureSwitches.areaChartTransparency,dataPointTransparency:a.areaTransparency},this.featureSwitches)}}},ne.prototype.enumerateDataLabels=function(e){var t=this.originalData,a=t.dataLabelsSettings,i=t.series.length,r=this.showLabelPerSeries(),o=[re.labelPosition.auto,re.labelPosition.above,re.labelPosition.under];if(this.isStacked()&&(o=[re.labelPosition.auto,re.labelPosition.insideCenter,re.labelPosition.insideEnd],a.position)&&o.indexOf(a.position)<0&&(a.position=re.labelPosition.auto),re.DataLabelViewModel.enumerateDataLabels(this.getLabelSettingsOptions(e,a,null,r,o),this.featureSwitches),r&&a.showLabelPerSeries)for(var s=0;s<i;s++){var n=t.series[s],l=(e.pushContainer({displayName:n.seriesName}),n.identity.getSelector());t.hasDynamicSeries&&(l=g.normalizeSelector(l)),re.DataLabelViewModel.enumerateDataLabels(this.getLabelSettingsOptions(e,null!=(n=n.labelSettings)?n:t.dataLabelsSettings,l,void 0,o),this.featureSwitches),e.popContainer()}},ne.prototype.showSeriesCard=function(){return!(this.isComboChart&&!this.data.hasY2Role)},ne.prototype.enumerateSeriesDataLabels=function(e){if(this.showSeriesCard()){var t=this.originalData,a=t.seriesLabelSetings,i=t.series.length,r=this.showLabelPerSeries();if(re.DataLabelViewModel.enumerateSeriesDataLabels(this.getSeriesLabelSettingsOptions(e,a,null,r),this.featureSwitches),r&&a.showLabelPerSeries)for(var o=0;o<i;o++){var s=t.series[o],n=(e.pushContainer({displayName:s.seriesName}),s.identity.getSelector());t.hasDynamicSeries&&(n=g.normalizeSelector(n)),re.DataLabelViewModel.enumerateSeriesDataLabels(this.getSeriesLabelSettingsOptions(e,null!=(s=s.seriesSettings)?s:t.seriesLabelSetings,n,void 0),this.featureSwitches),e.popContainer()}}},ne.prototype.enumerateTotalLabels=function(e){var t=this.originalData.totalLabelsSettings;t&&re.DataLabelViewModel.enumerateDataLabels(this.getTotalLabelSettingsOptions(e,t),this.featureSwitches)},ne.enumerateLineStyles=function(e,t,a){var i;if(1<t.series.length&&(i=N.DataViewObjects.getValue(a&&a.metadata&&a.metadata.objects,re.lineChartProps.lineStyles.showSeries,!1)),re.LineStyle.enumerate({enumeration:e,style:t.lineStyle,showSeries:i}),i)for(var r=0,o=t.series.length;r<o;r++){var s=t.series[r];e.pushContainer({displayName:s.seriesName}),re.LineStyle.enumerate({enumeration:e,style:s.lineStyle,selector:s.identity.getSelector()}),e.popContainer()}},ne.prototype.supportsTotalLabels=function(){return!!(!this.data||!this.data.multipleIdentity)&&this.isStacked()},ne.prototype.supportsTrendLine=function(){var e,t;return!this.data.multipleIdentity&&(e=this.getVisualCategoryAxisIsScalar(),t=this.haveY2Data()&&!this.isComboChart,!se.hasFlag(this.lineType,16))&&e&&this.data.hasValues&&!t},ne.prototype.supportsStaticReferenceLines=function(){return this.getVisualCategoryAxisIsScalar()},ne.prototype.supportsForecast=function(){var e;return!this.data.multipleIdentity&&(e=this.getVisualCategoryAxisIsScalar(),!se.hasFlag(this.lineType,16))&&e&&this.data.hasValues&&1===this.data.series.length&&!this.hasLegend()},ne.prototype.supportsAnomalyDetection=function(){return!this.data.multipleIdentity&&this.options.featureSwitches.daxTransformEnabled&&!se.hasFlag(this.lineType,16)&&this.data.hasValues},ne.prototype.isStacked=function(){return se.hasFlag(this.lineType,16)},ne.prototype.shouldSuppressAnimation=function(){return!!this.suppressAnimation},ne.prototype.showLabelPerSeries=function(){var e=this.originalData;return 1<e.series.length||!e.categoryMetadata||this.isComboChart},ne.prototype.getLabelSettingsOptions=function(e,t,a,i,r,o){return{enumeration:e,dataLabelsSettings:t,show:!0,position:!0,positionObject:r,displayUnits:!0,precision:!0,selector:a,showAll:i,fontSize:!0,fontFamily:!0,labelDensity:this.data.isScalar,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0,showDynamicLabels:!o||this.isComboChart}},ne.prototype.getSeriesLabelSettingsOptions=function(e,t,a,i){return{enumeration:e,show:!0,seriesLabelsSettings:t,seriesColor:t.seriesColor,seriesPosition:t.seriesPosition,selector:a,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,fontProperties:t.fontProperties,seriesWordWrap:t.seriesWordWrap,seriesMaximumWidth:t.seriesMaximumWidth,defaultSeriesWidth:t.defaultSeriesWidth,showAll:i,fontSize:!0,fontFamily:!0,bold:!0,italic:!0,underline:!0}},ne.prototype.getTotalLabelSettingsOptions=function(e,t){return{enumeration:e,dataLabelsSettings:t,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0}},ne.prototype.overrideXScale=function(e){this.xAxisProperties=e},ne.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},ne.prototype.render=function(e,t,a){var i,r=this,o=this.suppressAnimation?0:re.AnimatorCommon.GetAnimationDuration(this.animator,e),o=this.buildViewModel(o),s=this.tooltipService.getTooltipOverlayElement(),n=(this.mainGraphicsPositionRect=this.mainGraphicsSVG.selectAll(ne.PositionRectSelector.selector).data(function(e){return!s&&a?[e]:[]}).join("rect").attrs({x:0,width:0,height:0}).style("pointer-events","none").classed(ne.PositionRectSelector.class,!0),{hoverLine:this.hoverLine,hoverLineContext:this.hoverLineContext,mainGraphicsContext:this.mainGraphicsContext,svgDefs:this.svgDefs,mainGraphicsSVG:this.mainGraphicsSVG,mainGraphicsPositionOverlay:s||this.mainGraphicsPositionRect}),l=(re.AnomalyDetectionCartesianRenderer.render(this.data.anomalyDetections,n.mainGraphicsSVG,o.xAxisProperties.scale,o.yAxisProperties.scale,o.currentViewport,o.animationDuration,this.host,this.isInteractiveVisual),ne.hasAnomalies(this.data)?this.data.anomalyDetections[0].anomalies:[]);return this.anomalyNavigationHelper.update(l,this.scrolledData,this.focusedDatum,function(e){return ne.updateFocusElement(r.mainGraphicsContext,e,r.buildViewModel(0),r.host)},this.mainGraphicsContext),this.isInteractiveChart?(l=$.extend(n,{dragHandle:this.dragHandle,selectionCircles:this.selectionCircles}),i=ne.renderOld(o,l,this.interactivityService,this,this.isInteractiveChart,!e,this.markerRenderer,this.style),l.dragHandle&&(this.dragHandle=l.dragHandle)):i=ne.renderNew({viewModel:o,renderContext:n,interactivityService:this.interactivityService,plotAreaHelper:this,tooltipService:this.tooltipService,tooltipInteractivity:this,markerRenderer:this.markerRenderer,style:this.style,host:this.host,anomalyNavigationHelper:this.anomalyNavigationHelper,formatMode:a}),this.interactivityService&&(i.navigationOptions={helper:this,navigationStrategy:o.data.isScalar?re.DataPointNavigationStrategy.SeriesFirst:re.DataPointNavigationStrategy.CategoryFirst}),re.ForecastHelper.render(this.data.forecastLines,n.mainGraphicsSVG,o.xAxisProperties.scale,o.yAxisProperties.scale,o.currentViewport,o.animationDuration),re.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),i},ne.prototype.buildViewModel=function(e){return{currentViewport:this.currentViewport,data:this.scrolledData||this.data,allData:this.data,animationDuration:e,horizontalOffset:this.getXOfFirstCategory(),isComboChart:this.isComboChart,lineClassAndSelector:ne.LineClassSelector,lineType:this.lineType,margin:this.margin,tooltipsEnabled:this.tooltipsEnabled,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,y2AxisProperties:this.y2AxisProperties,focusedDatum:this.focusedDatum}},ne.renderNew=function(o){var s=o.viewModel,d=o.renderContext,B=o.plotAreaHelper,i=o.tooltipService,R=o.tooltipInteractivity,t=o.viewModel.data,e=o.markerRenderer,a=o.style;if(t){for(var r=_.filter(t.series,function(e){return e.uncertainty&&e.uncertainty.renderUncertainty}),H=!_.isEmpty(r),n=!s.isComboChart,l=[],U=0,j=s.data.series;U<j.length;U++){var c=j[U];l.push(c.lineStyle.markerProperties),H&&c.uncertainty&&(l.push(c.uncertainty.markers),c.uncertainty.markersFlipped)&&l.push(c.uncertainty.markersFlipped)}e.ensureMarkers(o.renderContext.svgDefs,l);var h,u,z,p,E,W,G,Y,X,g,K,q,y=se.hasFlag(s.lineType,16),m=s.margin,Z=s.currentViewport,$=Z.height-(m.top+m.bottom),m=Z.width-(m.left+m.right),v=s.xAxisProperties.scale,S=s.yAxisProperties.scale,f=s.y2AxisProperties&&s.y2AxisProperties.scale,b=s.horizontalOffset,x=t.isScalar,C=t.seriesLabelSetings,w=(C&&C.show&&(w=C?100*C.defaultSeriesWidth/m:0,w=Math.min(Math.max(1,w),50),m-=(C?C.defaultSeriesWidth?w:C.seriesMaximumWidth:0)/100*m),s.focusedDatum),D=o.interactivityService&&o.interactivityService.hasSelection(),J=se.hasFlag(s.lineType,2)||se.hasFlag(s.lineType,16),A=J||t.lineStyle.shadeArea||_.some(t.series,function(e){return e.lineStyle.shadeArea}),P=s.animationDuration,L=((t.categories.length*t.series.length>re.AnimatorCommon.MaxDataPointsToAnimate||e.shouldDisableAnimations()&&_.some(l,function(e){return e.showMarker})||A)&&(P=0),function(e){return v(ne.getXValue(e,x))+b}),M=y?(h=function(e){return S(e.stackedValue-e.value)},function(e){return S(e.stackedValue)}):(h=function(e){return(e.isY2?f:S)(0)},function(e){return(e.isY2?f:S)(e.value)}),V=(A&&(u=ne.getAreaGenerator(L,h,M),z=ne.getAreaGenerator(L,h,M).curve(d3.curveStep)),ne.getLineGenerator(L,M)),T=ne.getLineGenerator(L,M).curve(d3.curveStep),F=(se.hasFlag(s.lineType,4)&&(V.curve(d3.curveBasis),u)&&u.curve(d3.curveBasis),ne.hasAnomalies(t)?"".concat(o.host.getLocalizedString("Visual_Plot")," ").concat(o.host.getLocalizedString("Visual_Plot_ScreenReader_NavigateToAnomalies")):o.host.getLocalizedString("Visual_Plot")),F=(d.mainGraphicsContext.attr("aria-label",F),d.mainGraphicsSVG.attr("height",$).attr("width",m),A?(p=(F=d.mainGraphicsContext.selectAll(ne.CategoryAreaSelector.selector).data(_.filter(t.series,function(e){return J||e.lineStyle&&e.lineStyle.shadeArea}),function(e){return e.identity.getKey()})).enter().append(ne.PathElementName).classed(ne.CategoryAreaSelector.class,!0).merge(F).style("fill",function(e){return e.areaColor}).style("fill-opacity",function(e){return D&&!e.selected?ne.AreaTransparencyReductionFactor*(1-t.areaTransparency/100):1-t.areaTransparency/100}).classed(re.HtmlSubSelectableClass,n).attr(re.SubSelectableObjectNameAttribute,"area").attr(re.SubSelectableTypeAttribute,3).each(function(u){var t=this;re.HtmlSubSelectionHelper.setDataForElement(t,{getDisplayName:function(){var e=d3.select(t).datum().seriesName;return o.host.getLocalizedString("MiniToolbar_Area",e)},getRegionOutlines:function(){for(var e=d.mainGraphicsSVG.node().getBoundingClientRect(),t=e.left,r=e.top,o={type:1,x:e.x,y:e.y,height:e.height,width:e.width},s=Z.scale,e=S.range(),n=_.min(e),l=_.max(e),c=[],a=0,i=ne.getDefinedDataArray(u.data);a<i.length;a++)!function(a){var e=a.map(function(e){return{x:ne.convertSvgXToClientX(L(e),0,s,t),y:ne.convertSvgYToClientY(M(e),s,r)}}),i=[],e=(e.forEach(function(e,t){t=_.clamp(h(a[t]),n,l);i.unshift({x:e.x,y:ne.convertSvgYToClientY(t,s,r)})}),__spreadArray(__spreadArray([],e,!0),i,!0));c.push({type:3,points:e,clipPath:o})}(i[a]);return[{id:"".concat("area","-").concat(u.lineIndex),outline:{type:0,outlines:c}}]}})}),o.formatMode&&n&&p.style("pointer-events","auto"),p.interrupt(),P?p.transition().ease(d3.easeLinear).duration(P).attr("d",function(e){return(e.lineStyle.stepped?z:u)(e.data)}):p.attr("d",function(e){return(e.lineStyle.stepped?z:u)(e.data)}),p.order(),F.exit().remove()):p=d.mainGraphicsContext.selectAll(ne.CategoryAreaSelector.selector).remove(),H?(F=d.mainGraphicsContext.selectAll(ne.UncertaintySelector.selector).data([1]).join("g").attr("class",ne.UncertaintySelector.class),E=d3.area().x(L).y0(function(e){return null!=e.uncertainty.lower?(e.isY2?f:S)(e.uncertainty.lower):M(e)}).y1(function(e){return null!=e.uncertainty.upper?(e.isY2?f:S)(e.uncertainty.upper):M(e)}).defined(function(e){return e&&e.uncertainty&&(null!=e.uncertainty.upper||null!=e.uncertainty.lower)}),W=d3.line().x(L).y(function(e){return(e.isY2?f:S)(e.uncertainty.lower)}).defined(function(e){return e&&e.uncertainty&&null!=e.uncertainty.lower}),G=d3.line().x(L).y(function(e){return(e.isY2?f:S)(e.uncertainty.upper)}).defined(function(e){return e&&e.uncertainty&&null!=e.uncertainty.upper}),Y=function(e,t){return re.ColumnUtil.getFillOpacity(e.selected,!1,D,D,oe.convertTransparencyToOpacity(t))},F.selectAll(ne.UncertaintyAreas.selector).data(_.filter(r,function(e){return e.uncertainty.band.show}),function(e){return e.identity.getKey()}).join("g").attr("class",ne.UncertaintyAreas.class).order().each(function(e){var t,a,i,r;null==e||_.isEmpty(e.data)||(t=e.uncertainty.band,a=d3.select(this),i=_.filter(e.data,function(e){return!!e}),r=t.bandStyle!==re.confidenceBandStyle.line?["0"]:[],a.selectAll(ne.UncertaintyArea.selector).data(r,function(e){return e}).join("path").attr("class",ne.UncertaintyArea.class).style("fill",t.color).style("fill-opacity",Y(e,t.transparency)).attr("d",E(i)),r=t.bandStyle!==re.confidenceBandStyle.fill?["0"]:[],a.selectAll(ne.UncertaintyLines.selector).data(r,function(e){return e}).join("g").attr("class",ne.UncertaintyLines.class).style("stroke",t.color).style("stroke-opacity",Y(e,t.transparency)).style("stroke-width",2).selectAll(ne.UncertaintyLine.selector).data(["upper","lower"],function(e){return e}).join("path").attr("class",ne.UncertaintyLine.class).attr("d",function(e){return("upper"===e?G:W)(i)}))}),F.selectAll(ne.UncertaintyBars.selector).data(_.filter(r,function(e){return e.uncertainty.bar.show}),function(e){return e.identity.getKey()}).join("g").attr("class",ne.UncertaintyBars.class).style("fill",function(e){return e.uncertainty.bar.color}).style("stroke",function(e){return e.uncertainty.bar.borderColor}).style("stroke-width",function(e){return e.uncertainty.bar.borderWidth}).order().each(function(e){var t;null==e||_.isEmpty(e.data)||(t=e.uncertainty.bar,e=_.filter(e.data,function(e){return!!e}),d3.select(this).selectAll(ne.UncertaintyBar.selector).data(e,function(e){return e.identity.getKey()}).join("path").attr("class",ne.UncertaintyBar.class).attr("transform",function(e){return"translate(".concat(L(e),", ").concat((e.isY2?f:S)(e.value),")")}).attr("d",function(e){return d3.symbol().type(re.UncertaintyHelper.errorBarSymbol(e,t,e.isY2?f:S)).size(10)()}))}),X=S.range()[1]>S.range()[0],I=F.selectAll(ne.UncertaintyMarkers.selector).data(_.filter(r,function(e){return e.uncertainty.markers.showMarker}),function(e){return e.identity.getKey()}).join("g").attr("class",ne.UncertaintyMarkers.class).style("stroke-opacity",0).style("stroke-width",2).order().selectAll(ne.UncertaintyMarker.selector).data(function(t){return _.map(["upper","lower"],function(e){return{seriesData:t,type:e}})}).join("path").attr("class",ne.UncertaintyMarker.class).style("stroke-width","inherit").attr("d",function(e){return("upper"===e.type&&!X||"lower"===e.type&&X?G:W)(e.seriesData.data)}),e.renderUncertaintyMarkers(I),g=[ne.UncertaintyAreas,ne.UncertaintyBars,ne.UncertaintyMarkers],(I=F.selectAll(_.map(g,function(e){return e.selector}).join(", ")).nodes()).sort(function(e,t){for(var a=0,i=0,r=g.length;i<r;i++)a=(a+=Number(d3.select(e).classed(g[i].class))*i)-Number(d3.select(t).classed(g[i].class))*i;return a}),d3.selectAll(I).order()):d.mainGraphicsContext.selectAll(ne.UncertaintySelector.selector).remove(),d.mainGraphicsContext.selectAll(s.lineClassAndSelector.selector).data(t.series,function(e){return e.identity.getKey()})),I=F.enter().append(ne.PathElementName).classed(s.lineClassAndSelector.class,!0).merge(F),I=(I.style("stroke",function(e){return e.color}).style("stroke-opacity",function(e){return re.ColumnUtil.getFillOpacity(e.selected,!1,D,D)}).style("stroke-width",function(e){return a.isHighContrast?re.CartesianHelper.defaultLineStrokeWidth:e.lineStyle.strokeWidth}).style("stroke-linejoin",function(e){return e.lineStyle.lineJoin}).style("stroke-dasharray",function(e){return re.LineStyle.getStrokeDashArrayFromLineStyle(e.lineStyle.style)}),I.interrupt(),P?I.transition().ease(d3.easeLinear).duration(P).attr("d",function(e){return(e.lineStyle.stepped?T:V)(e.data)}):I.attr("d",function(e){return(e.lineStyle.stepped?T:V)(e.data)}),I.order(),F.exit().remove(),d.mainGraphicsContext.selectAll(ne.MarkerLineClassSelector.selector).data(_.filter(t.series,function(e){return e.lineStyle.markerProperties.showMarker}),function(e){return e.identity.getKey()})),F=I.enter().append(ne.PathElementName).classed(ne.MarkerLineClassSelector.class,!0).style("stroke","#ffffff").style("stroke-width",re.CartesianHelper.defaultLineStrokeWidth).style("stroke-opacity",0).merge(I),e=(P?k=F.transition().ease(d3.easeLinear).duration(P).attr("d",function(e){return V(e.data)}).style("opacity",function(e){return re.ColumnUtil.getFillOpacity(e.selected,!1,D,!1)}).style("pointer-events","none"):F.attr("d",function(e){return V(e.data)}).style("opacity",function(e){return re.ColumnUtil.getFillOpacity(e.selected,!1,D,!1)}).style("pointer-events","none"),F.order(),e.renderMarkers(k||F),I.exit().remove(),d.mainGraphicsContext.selectAll(ne.InteractivityLineClassSelector.selector).data(_.filter(t.series,function(e){return ne.getLeftmostPathPointFromSeriesData(e)}),function(e){return e.identity.getKey()})),k=e.enter().append(ne.PathElementName).classed(ne.InteractivityLineClassSelector.class,!0).style("stroke-width",ne.InteractivityStrokeWidth).style("stroke-linejoin",re.strokeLineJoin.round).attr(re.SubSelectableObjectNameAttribute,"lines").attr(re.SubSelectableAltObjectNameAttribute,"markers").attr(re.SubSelectableTypeAttribute,3).classed(re.HtmlSubSelectableClass,!A||!n).merge(e),F=(k.attr("d",function(e){if(!x){var t=ne.getLeftmostPathPointFromSeriesData(e);if(t){var a=_.findIndex(e.data,function(e){return e&&e.categoryIndex===t.categoryIndex});if(0<a&&a<e.data.length)return a=e.data.slice(a),(e.lineStyle.stepped?T:V)(a)}}return(e.lineStyle.stepped?T:V)(e.data)}),e.exit().remove(),k.order(),k.each(function(){var t=this;re.HtmlSubSelectionHelper.setDataForElement(t,{getDisplayName:function(){var e=d3.select(t).datum();return o.host.getLocalizedString("MiniToolbar_Line",e.seriesName)},getRegionOutlines:function(){return ne.getMarkerOutlinesForSeries(d3.select(t).datum(),o.viewModel,o.renderContext.mainGraphicsPositionOverlay)}})}),d.mainGraphicsContext.selectAll(ne.CategorySelector.selector).data(t.series,function(e){return e.identity.getKey()})),I=F.enter().append("g").classed(ne.CategorySelector.class,!0).merge(F),A=(F.exit().remove(),F.order(),I.selectAll(ne.CategoryValuePoint.selector).data(function(a){return a.data.filter(function(e,t){return ne.shouldDrawCircle(a,t)})},function(e){return e.key})),n=A.enter().append(ne.CircleElementName).classed(ne.CategoryValuePoint.class,!0).classed(re.HtmlSubSelectableClass,!0).attr(re.SubSelectableObjectNameAttribute,"lines").attr(re.SubSelectableAltObjectNameAttribute,"markers").attr(re.SubSelectableTypeAttribute,3).merge(A),e=(n.style("fill",function(){return d3.select(this.parentNode).datum().color}).style("fill-opacity",function(){var e=d3.select(this.parentNode).datum();return e.lineStyle.markerProperties.showMarker?0:re.ColumnUtil.getFillOpacity(e.selected,!1,D,!1)}),P?n.transition().duration(P).attrs({cx:function(e){return v(ne.getXValue(e,x))+b},cy:function(e){return e.isY2?f(e.value):S(y?e.stackedValue:e.value)},r:t.lineStyle.strokeWidth/2+ne.CircleRadiusExtra}):n.attrs({cx:function(e){return v(ne.getXValue(e,x))+b},cy:function(e){return e.isY2?f(e.value):S(y?e.stackedValue:e.value)},r:t.lineStyle.strokeWidth/2+ne.CircleRadiusExtra}),A.exit().remove(),n.each(function(){var e=d3.select(this.parentNode).datum();re.HtmlSubSelectionHelper.setDataForElement(this,{getDisplayName:function(){return o.host.getLocalizedString("MiniToolbar_Line",e.seriesName)},getRegionOutlines:function(){return ne.getMarkerOutlinesForSeries(e,o.viewModel,o.renderContext.mainGraphicsPositionOverlay)}})}),I.selectAll(ne.CategoryPointSelector.selector).data(function(e){return ne.chartTypeSupportsExplicitDots(s.isComboChart)?_.filter(e.data,function(e){return e&&null!=e.pointColor}):[]},function(e){return e.key})),F=e.enter().append(ne.CircleElementName).classed(ne.CategoryPointSelector.class,!0).style("pointer-events","none").merge(e),A=(F.style("fill",function(e){return e.pointColor}),P?F.transition().duration(P).attrs({cx:function(e){return v(ne.getXValue(e,x))+b},cy:function(e){return e.isY2?f(e.value):S(y?e.stackedValue:e.value)},r:t.lineStyle.strokeWidth/2+ne.PointRadiusExtra}):F.attrs({cx:function(e){return v(ne.getXValue(e,x))+b},cy:function(e){return e.isY2?f(e.value):S(y?e.stackedValue:e.value)},r:t.lineStyle.strokeWidth/2+ne.PointRadiusExtra}),e.exit().remove(),F.order(),0<t.series.length&&(d.mainGraphicsContext.selectAll(ne.SelectedMarkerLineClassSelector.selector).data([0]).enter().append("g").attr("class",ne.SelectedMarkerLineClassSelector.class),(K=this.renderSelectedPointsGenerator(d.mainGraphicsContext,s))(D)),o.interactivityService&&(q=this.updateFocusElement(d.mainGraphicsContext,w,s,o.host)),t.dataLabelsSettings),I=[],P=[],w=(A&&A.show&&(I=I.concat(this.createLabelDataPoints(s,a))),C&&C.show&&(e=C.seriesPosition===re.labelSeriesPosition.right?1:0,P=P.concat(this.createSeriesLabelDataPoints(s,a,e?m:0,e))),t.totalLabelsSettings);w&&w.show&&y&&(I=I.concat(this.createTotalLabelDataPoints(s,a)));_.map(_.filter(r,function(e){return e.uncertainty.labels.show}),function(e){return e.uncertainty.labels})&&(I=I.concat(this.createUncertaintyLabels(s,a,o.host)));var O,A={width:m,height:$,interactivityLines:k,dots:n,focusElement:q,explicitDots:F,isComboChart:s.isComboChart,binnedLineSamplingApplied:t.binnedLineSamplingApplied,hasDynamicSeries:t.hasDynamicSeries},Q=(i.removeTooltips(A,R),s.tooltipsEnabled&&!o.formatMode&&i.applyTooltips(A,B,R),re.D3Helper.orderShapesByClass(d.mainGraphicsContext,ne.RenderOrderableElements),[]);if(o.interactivityService){for(var N=[],ee=0,te=s.allData.series;ee<te.length;ee++){var c=te[ee],ae=(Q.push(c),_.filter(c.data,function(e){return e}));N.push.apply(N,ae||[])}O=[],ne.hasAnomalies(t)&&(C=_.filter(t.anomalyDetections[0].anomalies,function(e){return e.isAnomaly}),O.push.apply(O,C||[]));var e=d.mainGraphicsSVG.selectAll(re.AnomalyDetectionCartesianRenderer.anomalyPointClassSelector.selector),ie={interactivityLines:k,root:d.mainGraphicsContext,focusMarker:q,selectedMarkersCallback:K,dots:n,areas:p,tooltipOverlay:i.getTooltipOverlayElement(),showHoverline:i.usingHoverLine,getCategoryIndex:function(e,t,a){return a=a&&!i.usingHoverLine,B.getCategoryIndexFromSeriesAndPointX(e,t,a)},categoryIdentities:t.categoryIdentities,hitTester:new le({dataPoints:N,isComboChart:s.isComboChart,isScalar:x,hasCategories:0<t.categoryIdentities.length}),onSelecting:o.host.onSelecting,anomalies:e,anomalyNavigationHelper:o.anomalyNavigationHelper,areaTransparency:t.areaTransparency,onLineSubSelection:function(e,t,a,i,r){ne.onLineSubSelection(e,t,a,i,B,o.host,s,d.mainGraphicsSVG,r)},onDotSubSelection:function(e,t,a,i){ne.onDotSubSelection(e,t,a,o.host,i)},onAreaPointerMove:function(e){ne.onAreaPointerMove(e,d.mainGraphicsSVG,s)}}}return{dataPoints:N?__spreadArray(__spreadArray([],Q,!0),N,!0):void 0,behaviorOptions:ie,labelDataPoints:[],labelsAreNumeric:!0,labelDataPointGroups:I,labelDataPointSeriesGroups:P,animateLabels:!1,anomalies:O}}},ne.hasAnomalies=function(e){return _.some(e.anomalyDetections,function(e){return!_.isEmpty(e.anomaliesCategoryIndex)})},ne.isAnomaly=function(e){return e.isAnomaly},ne.getAreaGenerator=function(e,t,a){return d3.area().x(e).y0(t).y1(a).defined(function(e){return ne.isDataPointDefined(e)})},ne.getLineGenerator=function(e,t){return d3.line().x(e).y(t).defined(function(e){return ne.isDataPointDefined(e)})},ne.isDataPointDefined=function(e){return e&&null!==e.value},ne.renderSelectedPointsGenerator=function(s,n){var e=n.data,l=e.series,c=e.isScalar,u=se.hasFlag(n.lineType,16),d=n.horizontalOffset,h=n.xAxisProperties.scale,p=n.yAxisProperties.scale,g=n.y2AxisProperties&&n.y2AxisProperties.scale,y=s.selectAll(ne.SelectedMarkerLineClassSelector.selector);return function(a){var e=_.flatten(_.map(l,function(e){return _.filter(e.data,function(e){return e&&e.selected&&null!==e.value})})),t=y.selectAll(ne.PathElementName).data(e,function(e){return e.key}),i=_.map(e,function(e){return e.seriesIndex}),e=t.enter().append(ne.PathElementName).attr("pointer-events","none").merge(t),t=(e.attr("d",function(e){return e.lineStyle.markerProperties.showMarker?re.Markers.getPathWithRadius(e.lineStyle.markerProperties.shape,e.lineStyle.markerProperties.size*re.MarkerRenderer.sizeRatio):re.Markers.getPathWithRadius(re.markerShape.circle,e.lineStyle.strokeWidth/2+ne.TooltipCircleRadiusExtra)}).attr("transform",function(e){var t=h(ne.getXValue(e,c))+d,e=e.isY2?g(e.value):p(u?e.stackedValue:e.value);return"translate(".concat(t,",").concat(e,")")}).style("stroke-width",function(e){return re.Markers.getStrokeWidth(e.lineStyle.markerProperties.shape)}).style("stroke-opacity",1).style("stroke",function(e){return e.lineStyle.markerProperties.color}).style("fill",function(e){return e.lineStyle.markerProperties.color}),t.exit().remove(),s.selectAll(n.lineClassAndSelector.selector)),r=[];t.each(function(e,t){r[t]=e.selected,e.selected=-1<i.indexOf(e.lineIndex)}).style("stroke-opacity",function(e,t){return re.ColumnUtil.getFillOpacity(e.selected,!1,a,a&&!r[t])});function o(e,t){return re.ColumnUtil.getFillOpacity(e.selected||-1<i.indexOf(e.lineIndex),!1,a,a&&!r[e.lineIndex],null!=t?oe.convertTransparencyToOpacity(t):void 0)}s.selectAll(ne.MarkerLineClassSelector.selector).style("opacity",re.ColumnUtil.getFillOpacity(!1,!1,a,!1));t=s.select(ne.UncertaintySelector.selector);return t.selectAll(ne.UncertaintyAreas.selector).each(function(e){var t=e.uncertainty.band.transparency,a=d3.select(this);a.selectAll(ne.UncertaintyArea.selector).style("fill-opacity",o(e,t)),a.selectAll(ne.UncertaintyLines.selector).style("stroke-opacity",o(e,t))}),t.selectAll(ne.UncertaintyBars.selector).style("fill-opacity",function(e){return o(e)}).style("stroke-opacity",function(e){return o(e)}),t.selectAll(ne.UncertaintyMarker.selector).style("opacity",function(e){return o(e.seriesData)}),e}},ne.updateFocusElement=function(e,t,r,o){var a=r.xAxisProperties.scale,i=r.yAxisProperties.scale,s=null==(u=r.y2AxisProperties)?void 0:u.scale,n=r.data.isScalar,l=r.horizontalOffset,c=se.hasFlag(r.lineType,16),u=d.isInternetExplorerOrEdge(),e=e.selectAll(ne.FocusElementSelector.selector).data(t?[t]:[]),t=e.enter().append(ne.CircleElementName).attr("class",ne.FocusElementSelector.class).attr("tabindex",0).attr("focusable",!0).attr("role","option").classed(re.SetFocusRingClassName,!u).merge(e);return t.attr("aria-selected",function(e){return e.selected}).attr("aria-label",function(t){var e,a,i;return ne.isAnomaly(t)?o.getLocalizedString("Anomaly_ScreenReader_Hint"):(i=t,e=!1,ne.hasAnomalies(r.data)&&(a=r.data.anomalyDetections[0].anomaliesCategoryIndex,e=_.some(a,function(e){return e===t.categoryIndex})),a=re.tooltipUtils.formatTooltipInfo(i.tooltipInfo),(i=i.uncertainty)&&(i.upperTooltip&&(a+=" ".concat(re.tooltipUtils.formatTooltipInfo([i.upperTooltip]))),i.lowerTooltip)&&(a+=" ".concat(re.tooltipUtils.formatTooltipInfo([i.lowerTooltip]))),e&&(a+=" ".concat(o.getLocalizedString("AnomalyPoint_ScreenReader_Hint"))),a)}).attr("cx",function(e){return a(ne.getXValue(e,n))+l||0}).attr("cy",function(e){var t;return ne.isAnomaly(e)?(t=r.data.anomalyDetections[0].markerShapeSize,re.AnomalyDetectionCartesianRenderer.getAnomalyYPosition(e,i,t)):(t=e).isY2?s(t.value):i(c?t.stackedValue:t.value)}).attr("r",function(e){var t;return ne.isAnomaly(e)?(t=r.data.anomalyDetections[0].markerShapeSize,re.AnomalyDetectionCartesianRenderer.getAnomalySize(t)):(t=e.lineStyle.markerProperties).showMarker?t.size*re.MarkerRenderer.sizeRatio:e.lineStyle.strokeWidth/2+ne.TooltipCircleRadiusExtra}).style("fill","none"),e.exit().remove(),t},ne.getMarkerXPositionCalc=function(e,t,a,i){t=t(ne.getXValue(e,a.data.isScalar));return ne.convertSvgXToClientX(t,a.horizontalOffset,a.currentViewport.scale,i)},ne.getMarkerXPosition=function(e,t,a,i){var r=t.xAxisProperties.scale,a=a.node().getBoundingClientRect().left,e=_.find(e.data,function(e){return e&&e.categoryIndex===i});return Math.floor(ne.getMarkerXPositionCalc(e,r,t,a))},ne.getMarkerOutlinesForSeries=function(e,t,a){for(var i=e.data,a=a.node().getBoundingClientRect(),r=a.left,o=a.top,a=null==(a=_.first(i))?void 0:a.isY2,s=t.currentViewport,n=t.data,l=t.xAxisProperties,c=t.yAxisProperties,u=l.scale,d=(a?t.y2AxisProperties:c).scale,h=s.scale,l=n.lineStyle.markerProperties.size*h,p=Math.max(l+1.2*l,10)*h,g=(p%2==0&&++p,1),y=(i.length*p>s.width&&(a=re.DataLabelRenderer.getNumberOfLabelsToRender(s.width,50,4,p),g=Math.floor(i.length/a)),[]),m=0;m<i.length;m+=g){var v=i[m];v&&y.push({x:Math.floor(ne.getMarkerXPositionCalc(v,u,t,r)-p/2),y:Math.floor(ne.convertSvgYToClientY(d(v.value),h,o)-p/2),width:p,height:p,type:1})}return[{id:e.key,outline:{type:0,outlines:y,clipPath:{type:1,x:r,y:o,height:(t.currentViewport.height-t.margin.bottom-t.margin.top)*h,width:(t.currentViewport.width-t.margin.left-t.margin.right)*h}}}]},ne.onLineSubSelection=function(e,t,a,i,r,o,s,n,l){var c,u=re.InteractivityUtils.getPositionOfLastInputEvent(),r=r.getCategoryIndexFromSeriesAndPointX(e,t,!0);try{c=ne.getMarkerXPosition(e,s,n,r)}catch(e){return}var d,s=null==(t=e.identity)?void 0:t.getSelectorsByColumn(),n=e.lineStyle.markerProperties.showMarker&&Math.abs(c-u.x)<=e.lineStyle.markerProperties.size/2?(d="markers",o.getLocalizedString("MiniToolbar_Markers",e.seriesName)):(d="lines",o.getLocalizedString("MiniToolbar_Line",e.seriesName)),r={x:i.clientX,y:i.clientY},t=a.createVisualSubSelectionForSingleObject({objectName:d,subSelectionType:3,displayName:n,showUI:l,selectorsByColumn:s,selectionOrigin:r});a.subSelect(t)},ne.onDotSubSelection=function(e,t,a,i,r){var o,s=null==(s=e.identity)?void 0:s.getSelectorsByColumn(),i=e.lineStyle.markerProperties.showMarker?(o="markers",i.getLocalizedString("MiniToolbar_Markers",e.seriesName)):(o="lines",i.getLocalizedString("MiniToolbar_Line",e.seriesName)),e={x:a.clientX,y:a.clientY},a=t.createVisualSubSelectionForSingleObject({objectName:o,subSelectionType:3,displayName:i,showUI:r,selectorsByColumn:s,selectionOrigin:e});t.subSelect(a)},ne.onAreaPointerMove=function(e,t,a){var i=new MouseEvent("pointerover",e),e=ne.findSubSelectedAreaElement({x:e.clientX,y:e.clientY},t,a);null!=e&&e.dispatchEvent(i)},ne.prototype.getFirstElement=function(t,e){var a,i;return void 0===e&&(e=!1),null!=t?((a=e?_.findLast:_.find)(this.data.series,function(e){return i=a(e.data,function(e){return e&&e.categoryIndex===t&&null!=e.value})}),i&&this.scrolledData&&-1===this.scrolledData.categories.indexOf(i.categoryValue)?{element:null,targetCategoryIndex:i.categoryIndex,targetSeriesIndex:i.seriesIndex}:i?(this.focusedDatum=i,{element:ne.updateFocusElement(this.mainGraphicsContext,i,this.buildViewModel(0),this.host).node(),targetCategoryIndex:t,targetSeriesIndex:i.seriesIndex}):(e=e?this.data.series.length-1:0,{element:null,targetCategoryIndex:t,targetSeriesIndex:e})):{element:this.mainGraphicsContext.select(ne.FocusElementSelector.selector).node()}},ne.prototype.getNextDataPoint=function(t,e,a){var i,r,o=this.focusedDatum;switch(a){case re.DataDirection.NextCategory:case re.DataDirection.PreviousCategory:var s,n=this.data.series[e];o=n?(n=n.data,s=_.findIndex(n,function(e){return e&&e.categoryIndex===t}),this.pickNextAvailableIndex(n,s,e,a)):void 0;break;case re.DataDirection.NextSeries:case re.DataDirection.PreviousSeries:n=_.map(this.data.series,function(e){return _.find(e.data,function(e){return e&&e.categoryIndex===t})});o=this.pickNextAvailableIndex(n,e,t,a)}return o?this.scrolledData&&-1===this.scrolledData.categories.indexOf(o.categoryValue)?{element:null,targetCategoryIndex:o.categoryIndex,targetSeriesIndex:o.seriesIndex}:(this.focusedDatum=o,{element:ne.updateFocusElement(this.mainGraphicsContext,o,this.buildViewModel(0),this.host).node(),targetCategoryIndex:o.categoryIndex,targetSeriesIndex:o.seriesIndex}):(i=a===re.DataDirection.NextSeries||a===re.DataDirection.NextCategory?1:-1,r=this.data.categories.length,t=this.incrementIndex(t,i,r),r=e,a!==re.DataDirection.NextSeries&&a!==re.DataDirection.PreviousSeries||(r=i<0?this.data.series.length-1:0),{element:null,targetCategoryIndex:t,targetSeriesIndex:r})},ne.prototype.pickNextAvailableIndex=function(e,t,a,i){var r=i===re.DataDirection.NextCategory||i===re.DataDirection.PreviousCategory?this.rollToNextSeries:this.rollToNextCategory,o=i===re.DataDirection.NextSeries||i===re.DataDirection.NextCategory?1:-1,s=t;do{if((s+=o)>=e.length||s<0)return r.call(this,a,i)}while(s!==t&&(!e[s]||null==e[s].value));if(null!=e[s].value)return e[s]},ne.prototype.rollToNextSeries=function(e,t){var a=t===re.DataDirection.PreviousCategory?-1:1,t=t===re.DataDirection.PreviousCategory?_.findLast:_.find,i=this.data.series.length;return e=this.incrementIndex(e,a,i),t(this.data.series[e].data,function(e){return e&&null!=e.value})},ne.prototype.rollToNextCategory=function(t,e){var a=e===re.DataDirection.PreviousSeries?-1:1,e=e===re.DataDirection.PreviousSeries?_.findLast:_.find,i=this.data.categories.length,a=(t=this.incrementIndex(t,a,i),_.map(this.data.series,function(e){return _.find(e.data,function(e){return e&&e.categoryIndex===t})}));return e(a,function(e){return e&&null!=e.value})||e(a,function(e){return!!e})},ne.prototype.incrementIndex=function(e,t,a){return a<=(e+=t)?e=0:e<0&&(e=a-1),e},ne.renderOld=function(e,t,a,i,r,o,s,n){var l=this,c=e.data;if(c){for(var u,d=e.margin,h=e.currentViewport,p=h.height-(d.top+d.bottom),g=e.xAxisProperties.scale,y=e.yAxisProperties.scale,m=e.y2AxisProperties&&e.y2AxisProperties.scale,v=c.isScalar,S=e.animationDuration,f=(s.shouldDisableAnimations()&&(S=0),h.width-(d.left+d.right)),h=h.height-(d.top+d.bottom),b=a&&a.hasSelection(),x=function(e){return(e.isY2?m:y)(e.value)},C=se.hasFlag(e.lineType,16)||se.hasFlag(e.lineType,2),d=C||c.lineStyle.shadeArea||_.some(c.series,function(e){return e.lineStyle.shadeArea}),w=(d&&(u=d3.area().x(function(e){return g(ne.getXValue(e,v))}).y0(p).y1(x).defined(function(e){return null!==e.value})),d3.line().x(function(e){return g(ne.getXValue(e,v))}).y(x).defined(function(e){return!!e&&null!==e.value})),a=(se.hasFlag(e.lineType,4)&&(w.curve(d3.curveBasis),u)&&u.curve(d3.curveBasis),e.horizontalOffset),f=(t.mainGraphicsContext.attr("transform",re.SVGUtil.translate(a,0)),t.mainGraphicsSVG.attr("height",h).attr("width",f),t.hoverLineContext.attr("transform",re.SVGUtil.translate(a,0)),(d?((p=t.mainGraphicsContext.selectAll(ne.CategoryAreaSelector.selector).data(_.filter(c.series,function(e){return C||e.lineStyle&&e.lineStyle.shadeArea}),function(e){return e.identity.getKey()})).enter().append("g").classed(ne.CategoryAreaSelector.class,!0).append(ne.PathElementName),t.mainGraphicsContext.selectAll(ne.CategoryAreaSelector.selector).select(ne.PathElementName).transition().ease(d3.easeLinear).duration(S).attr("d",function(e){return u(e.data)}).style("fill",function(e){return e.areaColor}).style("fill-opacity",function(e){return b&&!e.selected?l.AreaTransparencyReductionFactor*(1-c.areaTransparency/100):1-c.areaTransparency/100}),p.exit()):t.mainGraphicsContext.selectAll(ne.CategoryAreaSelector.selector)).remove(),t.mainGraphicsContext.selectAll(ne.CategorySelector.selector).data(c.series,function(e){return e.identity.getKey()})),a=f.enter().append("g").classed(ne.CategorySelector.class,!0),d=(a.append(ne.PathElementName),a.selectAll(ne.CategoryValuePoint.selector).data(function(e){return e.data}).enter().append(ne.CircleElementName).classed(ne.CategoryValuePoint.class,!0),a.merge(f)),D=(f.exit().remove(),r&&!t.dragHandle&&(p=h,t.dragHandle=t.hoverLineContext.append("circle").attr("cx",0).attr("cy",p).attr("r","6px").classed("drag-handle",!0)),d.data().length);t.selectionCircles.length<D;){var A=t.hoverLineContext.append(ne.CircleElementName).classed(ne.CircleClassName,!0).attr("r",c.lineStyle.strokeWidth/2+ne.CircleRadiusExtra).style("opacity",0);t.selectionCircles.push(A)}for(;t.selectionCircles.length>D;)t.selectionCircles.pop().remove();var P,L,M,a=t.mainGraphicsContext.selectAll(ne.CategorySelector.selector),h=(a.select(ne.PathElementName).classed(e.lineClassAndSelector.class,!0).style("stroke",function(e){return e.color}).style("stroke-opacity",function(e){return re.ColumnUtil.getFillOpacity(e.selected,!1,b,b)}).style("stroke-width",c.lineStyle.strokeWidth).style("stroke-linejoin",c.lineStyle.lineJoin).transition().ease(d3.easeLinear).duration(S).attr("d",function(e){return w(e.data)}),s.ensureMarkers(t.svgDefs,_.map(e.data.series,function(e){return e.lineStyle.markerProperties})),t.mainGraphicsContext.selectAll(ne.MarkerLineClassSelector.selector).data(_.filter(c.series,function(e){return e.lineStyle.markerProperties.showMarker}),function(e){return e.identity.getKey()})),p=h.enter().append(ne.PathElementName).classed(ne.MarkerLineClassSelector.class,!0).style("stroke","#ffffff").style("stroke-width",re.CartesianHelper.defaultLineStrokeWidth).style("stroke-opacity",0).merge(h).transition().ease(d3.easeLinear).duration(S).attr("d",function(e){return w(e.data)}).style("opacity",function(e){return re.ColumnUtil.getFillOpacity(e.selected,!1,b,!1)}).style("pointer-events","none"),V=(s.renderMarkers(p),h.exit().remove(),this),d=a.selectAll(ne.CategoryValuePoint.selector),s=d.style("fill",function(){return d3.select(this.parentNode).datum().color}).style("fill-opacity",function(){var e=d3.select(this.parentNode).datum();return re.ColumnUtil.getFillOpacity(e.selected,!1,b,!1)}).transition().duration(S).attrs({cx:function(e,t){var a=d3.select(this.parentNode).datum();return V.shouldDrawCircle(a,t)?g(V.getXValue(e,v)):0},cy:function(e,t){var a=d3.select(this.parentNode).datum();return V.shouldDrawCircle(a,t)?x(e):0},r:function(e,t){var a=d3.select(this.parentNode).datum();return V.shouldDrawCircle(a,t)?c.lineStyle.strokeWidth/2+ne.CircleRadiusExtra:0}}),T=(r&&ne.hasDataPoint(c.series)&&(P=d.size(),L=0,s.on("end",function(){++L===P&&i.selectColumn(re.CartesianHelper.findMaxCategoryIndex(c.series),!0)})),null);if(c.dataLabelsSettings.show)for(var T=[],F=0,I=c.series.length;F<I;F++)Array.prototype.push.apply(T,c.series[F].data);return f.exit().remove(),c.dataLabelsSettings.show&&(M=ne.createLabelDataPoints(e,n)),null==T?null:{dataPoints:T,behaviorOptions:null,labelDataPoints:null,labelsAreNumeric:null,labelDataPointGroups:M,animateLabels:o}}},ne.getLeftmostPathPointFromSeriesData=function(e,i){return(i?_.findLast:_.find)(e.data,function(e,t,a){a=i?a[t-1]:a[t+1];return null!=e&&null!=e.value&&null!=a&&null!=a.value})},ne.getSeriesTooltipInfo=function(e,t){var a;if(!e)return null;var i=e.dataPoints;if(_.isEmpty(i))return null;var r="#000000",o=!_.isEmpty(i)&&i[0].seriesDisplayName,s=[],n=[],l=0,c=e.legendMarkerRendering,u=c!==re.legendMarkerRendering.markerOnly&&c!==re.legendMarkerRendering.markerCircleDefault,d=i[0].additionalTooltipItems;if(i.every(function(e){return _.isEqual(e.additionalTooltipItems,d)})){for(var h in i){var p,g=i[h];if(10<=l)break;null!=g.value&&(p=g.measure,null!=(a=g.uncertaintyTooltipItems)&&a.rangeTooltip&&(p=g.uncertaintyTooltipItems.rangeTooltip.value),s.push({header:g.category,subheader:g.multiple,color:g.color,displayName:g.seriesName||g.measureDisplayName,value:p,markerShape:g.markerShape,lineStyle:u?g.lineStyle:void 0,lineColor:g.lineColor}),n.push(+h),l++)}if(e.hasUncertainty&&(s=ne.augmentTooltipInfoWithUncertainty(s,i,n,t)),!_.isEmpty(d))for(var y=0,m=d;y<m.length;y++){var v=m[y];if(10<=l)break;s.push({color:r,displayName:v.displayName,value:v.value,opacity:"0",markerShape:re.markerShape.none}),l++}}else for(var S=0,f=i;S<f.length;S++){g=f[S];if(10<=l)break;if(null!=g.value&&(o&&(s.push({header:g.category,subheader:g.multiple,displayName:g.seriesDisplayName,value:g.seriesName,markerShape:g.markerShape,lineStyle:u?g.lineStyle:void 0,lineColor:g.lineColor}),l++),s.push({header:g.category,subheader:g.multiple,color:g.color,displayName:g.measureDisplayName,value:g.measure,markerShape:g.markerShape,lineStyle:u?g.lineStyle:void 0,lineColor:g.lineColor}),l++,!_.isEmpty(g.additionalTooltipItems)))for(var b=0,x=g.additionalTooltipItems;b<x.length;b++){v=x[b];if(10<=l)break;s.push({header:g.category,subheader:g.multiple,color:r,displayName:v.displayName,value:v.value,opacity:"0",markerShape:re.markerShape.none}),l++}}if(!_.isEmpty(e.additionalTooltipItems))for(var C=0,w=e.additionalTooltipItems;C<w.length;C++){v=w[C];if(10<=l)break;s.push({header:i[0].category,subheader:i[0].multiple,color:r,displayName:v.displayName,value:v.value,opacity:"0",markerShape:re.markerShape.none}),l++}return 0===s.length?null:s},ne.augmentTooltipInfoWithUncertainty=function(e,t,a,i){for(var r,o=[],s=1/0,n=-1,l=0,c=a.length;l<c;l++)(h=t[a[l]]).uncertaintyTooltipItems&&(h.isY2?(r=Math.abs(h.value-i.y2.point))<i.y2.threshold?o.push(l):r<s&&(s=r,n=l):((r=Math.abs(h.value-i.y.point))<i.y.threshold&&o.push(l),r<s&&(s=r,n=l)));for(var u=[],l=0,c=a.length;l<c;l++){var d,h=t[a[l]],p=e[l];_.includes(o,l)||n===l?((d=h.uncertaintyTooltipItems).upperTooltip&&u.push(__assign({header:h.category,subheader:h.multiple},d.upperTooltip)),u.push(p),d.lowerTooltip&&u.push(d.lowerTooltip)):u.push(p)}return u},ne.prototype.getTooltipInfoForPoint=function(e,t){var a,i=e.data,r=this.getCategoryIndexFromSeriesAndPointX(i,t,!0,e.context);if(a=i&&i.data&&i.data.length?_.find(i.data,function(e){return e&&e.categoryIndex===r}):a)return a.tooltipInfo},ne.isDataPointData=function(e){return e&&null!=e.categoryIndex},ne.isForecastPoint=function(e){return e&&null!=e.points},ne.prototype.getCategoryIndexFromTooltipEvent=function(e,t){e=e.data;if(!ne.isForecastPoint(e))return ne.isDataPointData(e)?e.categoryIndex:this.getCategoryIndexFromSeriesAndPointX(e,t,!1)},ne.prototype.getCategoryIndexFromSeriesAndPointX=function(e,t,a,i){var r=0,o=this.data.categoryData,s=this.xAxisProperties.scale;return e&&!_.isEmpty(e.data)&&this.xAxisProperties&&(t=this.adjustPathXCoordinate(t,i),i=this.data.isScalar&&s.range()[1]<s.range()[0],(i=ne.getLeftmostPathPointFromSeriesData(e,i))&&(r=s(ne.getXValue(i,this.data.isScalar))+this.getXOfFirstCategory()),a)&&(o=_.map(e.data,function(e){return re.CartesianHelper.extractCategoryFromDataPoint(e)})),ne.findCategoryIndex({pointX:t,offsetX:r,categoryData:o,currentViewport:this.currentViewport,scale:s,categoryThickness:this.xAxisProperties.categoryThickness,isScalar:this.data.isScalar})},ne.prototype.getYValueFromTooltipEvent=function(e,t){var a,i=null==(i=this.yAxisProperties)?void 0:i.scale,r=null==(r=this.y2AxisProperties)?void 0:r.scale,o=this.currentViewport.scale,o=(N.Double.equalWithPrecision(o,1,1e-5)||(e/=o),t.classList.contains(ne.TooltipOverlaySelector.class)||t.classList.contains(ne.lineChartSVGClassName)||(e+=t.getBBox().y),{});return i&&(a=i.domain(),o.y={point:i.invert(e),threshold:.1*(a[1]-a[0])}),r&&(a=r.domain(),o.y2={point:r.invert(e),threshold:.1*(a[1]-a[0])}),o},ne.prototype.getVisualCategoryAxisIsScalar=function(){return!!this.data&&this.data.isScalar},ne.prototype.getSupportedCategoryAxisType=function(){var t,e=!1,a=this.dataView&&this.dataView.categorical?this.dataView.categorical.categories:void 0;return(e=_.isEmpty(a)?e:a.some(function(e){if(e.source&&e.source.type)return t=e.source.type,e=re.ScalarUtils.getScalarKeys(e),!C.isOrdinal(t)||e&&!_.isEmpty(e.values)}))?re.axisType.both:re.axisType.categorical},ne.prototype.getPreferredPlotArea=function(e,t,a,i){return re.CartesianChartLayout.getPreferredPlotArea(t,a,this.currentViewport,this.isScrollable,e,this.margin,i=void 0===i?0:i)},Object.defineProperty(ne.prototype,"availableWidth",{get:function(){return Math.max(0,this.currentViewport.width-(this.margin.left+this.margin.right))},enumerable:!1,configurable:!0}),Object.defineProperty(ne.prototype,"availableHeight",{get:function(){return Math.max(0,this.currentViewport.height-(this.margin.top+this.margin.bottom))},enumerable:!1,configurable:!0}),ne.sliceSeries=function(e,t,a){void 0===a&&(a=0);var i=[];if(e&&0<e.length)for(var r=0,o=e.length;r<o;r++){for(var s=e[r],n=(i[r]=N.Prototype.inherit(s),[]),l=a,c=a+t;l<c;l++)n.push(s.data[l]);i[r].data=n}return i},ne.prototype.getXOfFirstCategory=function(){if(!this.data.isScalar){var e=this.xAxisProperties.scale;if(re.D3Helper.isScaleBand(e))return e.bandwidth()/2}return 0},ne.hasDataPoint=function(e){if(0!==e.length)for(var t=0,a=e.length;t<a;t++)if(0<e[t].data.length)return!0;return!1},ne.getXValue=function(e,t){return t?e.categoryValue:e.categoryIndex},ne.shouldDrawCircle=function(e,t){var a=e.data[t];return null!=a&&null!==a.value&&(a=null==(a=e.data[t-1])||null===a.value,t=null==(e=e.data[t+1])||null===e.value,a)&&t},ne.prototype.getHoverLineDataForCategory=function(e){var t,a=this.getChartX(e)+this.getXOfFirstCategory(),e=this.createTooltipData(e);if(e)return t=e.dataPoints,0<e.dataPoints.length&&this.setHoverLineForTooltip(a),this.setDotsForTooltip(a,t,this.data.lineStyle.strokeWidth/2+ne.TooltipCircleRadiusExtra),e},ne.prototype.getHoverLineIdentities=function(t,e){var a,i=null==(i=null==(i=this.data)?void 0:i.categoryIdentities)?void 0:i[t],r=null==(r=null==(r=this.data)?void 0:r.multiplesCategoryIdentities)?void 0:r[t],o=[],e=null==(e=_.find(null!=e?e:[],function(e){return(null==e?void 0:e.categoryIndex)===t}))?void 0:e.identity;return e&&(r.exclude=((a={})[1]=!0,a),i.exclude=((a={})[1]=!0,a),e.exclude=((a={})[0]=!0,a),o.push(e)),(r||i)&&o.push(null!=r?r:i),o},ne.prototype.setHoverLineForTooltip=function(e){this.hoverLine.attr("x1",e=e||0).attr("x2",e).attr("y1",0).attr("y2",this.availableHeight).style("opacity",1)},ne.prototype.clearHoverLine=function(){this.hoverLine.style("opacity",re.SVGUtil.AlmostZero),this.hoverLineContext.selectAll(ne.HoverLineCircleDot.selector).remove()},ne.prototype.setDotsForTooltip=function(e,t,a){var i=this;void 0===a&&(a=3);var r=se.hasFlag(this.lineType,16)?function(e){return i.yAxisProperties.scale(e.stackedValue)}:function(e){return(e.isY2?i.y2AxisProperties:i.yAxisProperties).scale(e.value)},t=this.hoverLineContext.selectAll(ne.HoverLineCircleDot.selector).data(_.filter(t,function(e){return e.showDot}));t.enter().append(ne.CircleElementName).classed(ne.HoverLineCircleDot.class,!0).merge(t).filter(function(e){return null!=e.value}).attr("fill",function(e){return e.color}).attr("r",a).attr("cx",e).attr("cy",r),t.exit().remove()},ne.prototype.selectColumn=function(e,t){((t=void 0===t?!1:t)||this.lastInteractiveSelectedColumnIndex!==e)&&(this.lastInteractiveSelectedColumnIndex=e,t=this.getChartX(e),this.setHoverLine(t,e),t=this.createLegendDataPoints(e))&&this.cartesianHost.updateLegend(t)},ne.prototype.setHoverLine=function(r,o){this.hoverLine.attr("x1",r).attr("x2",r).attr("y1",0).attr("y2",this.availableHeight).style("opacity",1);var s=this;this.mainGraphicsContext.selectAll(ne.CategorySelector.selector).selectAll(ne.PathElementName).each(function(e){var t=this,a=e.color,i=s.selectionCircles[e.lineIndex];i&&i.attrs({cx:r,cy:function(){var e=d3.select(t).node();return ne.getPosition(r,e).y}}).styles({opacity:function(){return _.some(e.data,function(e){return!!e&&e.categoryIndex===o})?1:0},fill:a}),s.dragHandle&&s.dragHandle.attr("cx",r)})},ne.prototype.getChartX=function(e){var t=0,e=(this.data.isScalar?0<=e&&e<this.data.categoryData.length&&(t=Math.max(0,this.xAxisProperties.scale(this.data.categoryData[e].categoryValue))):t=Math.max(0,this.xAxisProperties.scale(e)),Math.max.apply(Math,N.visuals.AxisHelper.extent(this.xAxisProperties.scale))),t=Math.min(t,e);return isNaN(t)?0:t},ne.findCategoryIndex=function(e){var t=e.pointX,a=e.offsetX,i=e.categoryData,r=e.scale,o=e.currentViewport.scale,o=(N.Double.equalWithPrecision(o,1,1e-5)||(t/=o),a&&(t+=a),N.visuals.AxisHelper.invertScale(r,t,0,0,void 0).value);if(e.isScalar)return 0<=(a=C.findClosestXAxisIndex(o,i,r))?i[a].categoryIndex:-1;if(i[o]&&!i[o].hasData){for(var s=-1,n=o;0<n&&-1===s&&i[--n].hasData;)s=n;for(var l=-1,c=o,u=i.length-1;c<u&&-1===l&&i[++c].hasData;)l=c;var a=Math.abs(s-o),d=Math.abs(l-o);a<d?o=s:d<a?o=l:a===d&&(o=r(o)+e.categoryThickness/2<t?l:s)}return o},ne.getPosition=function(e,t,a,i){for(var r,o,s=0,n=t.getTotalLength();r=t.getPointAtLength(o=s+n>>1),re.SVGUtil.ensureValidSVGPoint(r),a&&(r.x=a(r.x)),i&&(r.y=i(r.y)),o!==n&&o!==s||r.x===e;)if(r.x>e)n=o;else{if(!(r.x<e))break;s=o}return r},ne.getDefinedDataArray=function(e){for(var t=e.length,a=[],i=[],r=0;r<t;r++){var o=e[r];ne.isDataPointDefined(o)?(i.push(o),r===t-1&&a.push(i)):0<i.length&&(a.push(i),i=[])}return a},ne.findSubSelectedAreaIndex=function(e,t,a,i){for(var r,o=Number.MAX_VALUE,a=a.node().getBoundingClientRect(),s=a.left,n=a.top,l=0;l<t.length;l++){var c=t[l],c=ne.getPosition(e.x,c,function(e){return ne.convertSvgXToClientX(e,0,i.currentViewport.scale,s)},function(e){return ne.convertSvgYToClientY(e,i.currentViewport.scale,n)}).y,c=e.y-c;-4<=c&&(c=Math.abs(c))<o&&(o=c,r=l)}return r},ne.findSubSelectedAreaElement=function(e,t,a){var i=t.selectAll(ne.LineClassSelector.selector).filter(function(e){return e.data.some(function(e){return ne.isDataPointDefined(e)})}).nodes(),r=ne.findSubSelectedAreaIndex(e,i,t,a);if(null!=r)return t.selectAll(ne.CategoryAreaSelector.selector).filter(function(e){return e.lineIndex===r}).node()},ne.convertSvgXToClientX=function(e,t,a,i){return(e+t)*a+i},ne.convertSvgYToClientY=function(e,t,a){return e*t+a},ne.prototype.createTooltipData=function(e){var t=this.data;if(t&&0!==t.series.length&&t.categories&&t.categoryData){for(var a,i=[],r=t.categoryData[e],o=!1,s=t.multipleDisplayName,n=re.lineChartProps.general.formatString,l=0,c=t.series;l<c.length;l++){var u,d,h=(g=c[l]).data,p=void 0;this.data.isScalar?r&&(p=h.filter(function(e){return e.categoryValue===r.categoryValue})[0]):p=h[e],null!=(v=p&&p.value)&&(h=re.CategoryLevelUtils.concatenateCategoryLevels(r.hierarchyCategoryLevels),u=g.lineStyle.markerProperties,d=this.getDefaultMarkerShape(t.defaultToCircle),S={color:re.Markers.resolveMarkerColor(u,g.color,t.legendMarkerRendering,t.matchLineColor),category:h.value,multiple:s,measureDisplayName:g.seriesName,measure:re.valueFormatter.format(v,p.labelFormatString||re.valueFormatter.getFormatString(g.yCol,n)),value:v,stackedValue:p.stackedValue,uncertaintyTooltipItems:p.uncertainty,showDot:!u.showMarker,markerShape:re.Markers.resolveMarkerShape(u,t.legendMarkerRendering,d),lineStyle:g.lineStyle.style,lineColor:g.color,isY2:p.isY2},o=o||!!p.uncertainty,t.hasDynamicSeries?(S.seriesDisplayName=t.seriesDisplayName,S.seriesName=g.seriesName,S.additionalTooltipItems=p.additionalTooltipItems):a=a||p.additionalTooltipItems,i.push(S))}if(!_.isEmpty(t.forecastLines)&&r)for(var g=_.head(t.series),y=0,m=t.forecastLines;y<m.length;y++){var v,S,f=m[y],b=_(f.points).filter(function(e){return e.point.x===r.categoryValue}).first();null!=(v=b&&b.point.y)&&(S={color:f.lineColor.solid.color,category:re.CategoryLevelUtils.concatenateCategoryLevels(r.hierarchyCategoryLevels).value,multiple:s,measureDisplayName:f.displayName,measure:re.valueFormatter.format(v,re.valueFormatter.getFormatString(g.yCol,n)),value:v,stackedValue:void 0,additionalTooltipItems:[{displayName:this.host.getLocalizedString("Visual_Confidence_Band_Upper"),value:re.valueFormatter.format(b.upperBound.y,re.valueFormatter.getFormatString(g.yCol,n))},{displayName:this.host.getLocalizedString("Visual_Confidence_Band_Lower"),value:re.valueFormatter.format(b.lowerBound.y,re.valueFormatter.getFormatString(g.yCol,n))}],showDot:!0,markerShape:re.markerShape.circle,lineStyle:void 0,lineColor:void 0},i.push(S))}return{dataPoints:i,additionalTooltipItems:a,legendMarkerRendering:t.legendMarkerRendering,hasUncertainty:o}}},ne.prototype.createLegendDataPoints=function(e){var t=this.data;if(t&&t.series&&!(t.series.length<1)){for(var a,i=[],r=t.categoryData[e],o=(this.isInteractiveChart&&r&&(this.data.isScalar?(a=r.categoryValue,C.isDateTime(this.xAxisProperties.axisType)&&(a=N.PBIFormattingDate.fromTimeValue(a))):a=re.CartesianHelper.lookupXValue(this.data,e,this.xAxisProperties.axisType,this.data.isScalar)),re.lineChartProps.general.formatString),s=0,n=t.series.length;s<n;s++){var l=t.series[s],c=l.data,u=void 0;if(this.isInteractiveChart){var d=void 0;if(this.data.isScalar){if(r)for(var h=r.categoryValue,p=0,g=c;p<g.length;p++){var y=g[p];if(y.categoryValue===h){d=y;break}}}else d=c[e];u=d&&d.value}c=re.converterHelper.getFormattedLegendLabel(l.yCol,this.dataView.categorical.values,o);i.push({color:l.color,icon:re.LegendIcon.Line,label:c,category:re.valueFormatter.format(a,re.valueFormatter.getFormatString(l.xCol,o)),measure:re.valueFormatter.format(u,re.valueFormatter.getFormatString(l.yCol,o)),identity:l.identity,selected:l.selected,index:s})}var m=this.dataView&&this.dataView.categorical?this.dataView.categorical.values:null,m=m&&m.source?m.source.displayName:"",v=re.Legend.getDefaultLegendData(this.style);return v.title=m,v.dataPoints=i,v.grouped=t.hasDynamicSeries,v}},ne.createLabelDataPoints=function(m,v){for(var S,f,b=m.xAxisProperties.scale,x=m.yAxisProperties.scale,C=m.y2AxisProperties&&m.y2AxisProperties.scale,e=m.data,c=e.series,u=e.dataLabelsSettings,w=re.DataLabelViewModel.createColumnFormatterCacheManager(),D=se.hasFlag(m.lineType,16),d=[],A=e.isScalar,t=function(e,t){f=c[e];var g=100===(S=f.labelSettings||u).labelDensity,a=re.DataLabelRenderer.getNumberOfLabelsToRender(m.currentViewport.width,S.labelDensity,h.MinimumLabelsToRender,re.MinMaxLabelDataPointSorter.estimatedLabelWidth),a=!g&&A?a:f.data.length;if(!S.show)return d[e]={labelDataPoints:[],maxNumberOfLabels:0},"continue";var i=f.isY2?m.y2AxisProperties:m.yAxisProperties,y=re.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(i,S),r=f.data,o=[];if(!_.isEmpty(r))for(var s=0,n=r.length;s<n;s++){var l=r[s];null!=l&&null!=l.value&&(l=function(e,t,a){var i,r=t.labelFormatString,o=S.fontProperties,s=!1,n=m.horizontalOffset,l=e.isY2?C:x,c=null!=(c=t.labelFill)?c:o.color,u=t.dynamicLabelValue,r=(i=null!=u&&u.enabled&&null!=u&&u.value?("number"==typeof(i=null==(i=t.dynamicLabelValue)?void 0:i.value)&&(u=w.getOrCreate(null==u?void 0:u.formatString,S,y.units,y.getPrecision(!(null==u||!u.formatString),f.type)),i=re.DataLabelRenderer.getLabelFormattedText(u.format(i))),jsCommon.StringExtensions.encodeHtml(i)):(u=w.getOrCreate(r,S,y.units,y.getPrecision(!!r,e.type)),re.DataLabelRenderer.getLabelFormattedText(u.format(t.value))),re.FontProperties.toTextProperties(o,i)),u=N.TextMeasurementService.measureSvgTextWidth(r)+re.DataLabelViewModel.LabelDensityPadding,r=N.TextMeasurementService.estimateSvgTextHeight(r,!0);if(D){var d=Math.max(t.stackedValue-t.value,l.domain()[0]),h=m.currentViewport.width,p=void 0;switch(S&&S.position){case re.labelPosition.insideCenter:p=[1];break;case re.labelPosition.insideEnd:p=[4];break;default:re.labelPosition.auto;p=ne.validStackedLabelPositions}h={rect:{left:b(ne.getXValue(t,A))+n-h/2,top:l(Math.max(t.stackedValue,t.stackedValue-t.value)),width:h,height:Math.abs(l(t.stackedValue)-l(d))},orientation:0<=t.value?1:2,validPositions:p},s=!0}else{d=e.lineStyle.markerProperties,p=void 0;switch(S&&S.position){case re.labelPosition.above:p=[1];break;case re.labelPosition.under:p=[2];break;default:re.labelPosition.auto;p=g?[1]:ne.getValidLabelPositions(f,a)}h={point:{x:b(ne.getXValue(t,A))+n,y:l(t.value)},radius:d.showMarker?d.size:0,validPositions:p}}return{isPreferred:!1,text:i,textSize:{width:u,height:r},outsideFill:null!=c?c:re.ColorHelper.getThemeColor(v,re.DataLabelViewModel.DefaultLabelColorName),insideFill:c&&D?c:re.ColorHelper.getThemeColor(v,re.DataLabelViewModel.DefaultInsideLabelColorName),parentType:s?1:0,parentShape:h,fontProperties:o,identity:t.identity,key:t.key,hasBackground:S.enableBackground,backgroundColor:S.backgroundColor,backgroundTransparency:S.backgroundTransparency}}(f,l,s),o.push(l))}d[e]={labelDataPoints:o,maxNumberOfLabels:a}},h=this,a=0,i=c.length;a<i;a++)t(a);return new re.MinMaxLabelDataPointSorter({unsortedLabelDataPointGroups:d,series:c,viewport:m.currentViewport,yScale:x,y2Scale:C}).getSortedDataLabels()},ne.createSeriesLabelDataPoints=function(e,S,f,b){for(var x,C,t=e.xAxisProperties.scale,w=e.yAxisProperties.scale,D=e.y2AxisProperties&&e.y2AxisProperties.scale,a=e.data,A=a.series,P=a.seriesLabelSetings,i=e.margin,L=e.currentViewport,M=se.hasFlag(e.lineType,16),V=[],T=a.isScalar,F=N.TextMeasurementService.estimateSvgTextHeight(re.DataLabelRenderer.LabelTextProperties),I=L.width-(i.left+i.right),k=t.domain()[0],O=t.domain()[1],r=function(e,t){var r=(C=A[e]).isY2?D:w,a=r.domain()[0],i=r.domain()[1];if(!(x=C.seriesSettings||P)||!x.show)return V[e]={labelDataPoints:[],maxNumberOfLabels:0},"continue";function o(e,t){var a=re.FontProperties.toTextProperties(x.fontProperties,e.seriesName),i=(t.value,!1);return l&&(i=1<re.DataLabelRenderer.checkWordBreak(e.seriesName,a,n,L.height-(s+F+c),void 0,!0,!0).length),{identity:t.identity,key:t.key,isPreferred:!1,text:e.seriesName,textSize:{width:N.TextMeasurementService.measureSvgTextWidth(a),height:N.TextMeasurementService.estimateSvgTextHeight(a,!0)},outsideFill:null!=(a=x.seriesColor)?a:re.ColorHelper.getThemeColor(S,re.DataLabelViewModel.DefaultLabelColorName),insideFill:x.seriesColor&&M?x.seriesColor:re.ColorHelper.getThemeColor(S,re.DataLabelViewModel.DefaultInsideLabelColorName),parentType:0,parentShape:{point:{x:f,y:r(M?t.stackedValue:t.value)},radius:e.lineStyle.markerProperties.showMarker?e.lineStyle.markerProperties.size:0,validPositions:[512]},fontProperties:x.fontProperties,wordBreak:i,hasBackground:x.enableBackground,backgroundColor:x.backgroundColor,backgroundTransparency:x.backgroundTransparency}}var s=x?x.fontProperties.size.px:0,n=x?x.seriesMaximumWidth/100*I:0,l=!!x&&!!x.seriesWordWrap,c=(L.height-F-s)/2,u=C.data,d=[],h=0,p=u.length;if(!_.isEmpty(u)&&C.seriesName){var g=b?_.last(_.compact(u)):_.first(_.compact(u));if(T){for(h=0;h<p;h++){var y=u[h];if(null!=y&&null!=y.value&&y){y=ne.getXValue(y,T);if(b?O<y:k<y){var m,v,y=-1;b&&0<=h-1?y=h-1:b||(y=h),0<=y&&null!=(y=u[y])&&(a<=(m=M?y.stackedValue:y.value)&&m<=i)&&(v=o(C,y),d.push(v));break}}}g&&h===u.length&&null!=(m=M?g.stackedValue:g.value)&&(a<=m&&m<=i)&&(v=o(C,g),d.push(v))}else g&&null!=(m=M?g.stackedValue:g.value)&&(a<=m&&m<=i)&&(v=o(C,g),d.push(v))}V[e]={labelDataPoints:d,maxNumberOfLabels:1}},o=0,s=A.length;o<s;o++)r(o);return V},ne.createTotalLabelDataPoints=function(e,t){for(var a,i,r,o,s,n,l,c=re.CartesianHelper.getFirstMetadataColumn(e.data.valuesMetadata),u=re.valueFormatter.getFormatString(c,re.columnChartProps.general.formatString),d=e.xAxisProperties.scale,h=e.yAxisProperties.scale,p=e.data,g=re.DataLabelViewModel.createColumnFormatterCacheManager(),c=[],y=p.totalLabelsSettings,m=p.isScalar,v=e.horizontalOffset,S=e.yAxisProperties,f=re.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(S,y),b=[],x=0;x<p.totals.length;x++){var C,w=p.totals[x];w&&0!==(w=w.net)&&(w=w,a=x,l=C=n=o=s=o=r=i=void 0,a=p.totals[a],i=g.getOrCreate(a.dynamicFormatString||u,y,f.units,y.precision),i=re.DataLabelRenderer.getLabelFormattedText(i.format(w)),r=y.fontProperties,o=re.FontProperties.toTextProperties(r,i),s=N.TextMeasurementService.measureSvgTextWidth(o),o=N.TextMeasurementService.estimateSvgTextHeight(o,!0),n=null!=(n=a.labelFill)?n:r.color,C=0<w?a.positive:a.negative,a={value:C,stackedValue:C,categoryIndex:a.categoryIndex,categoryValue:a.categoryValue,labelSettings:void 0,key:void 0,identity:void 0,lineStyle:void 0,seriesIndex:void 0,selected:!1},l=e.currentViewport.width,C={isPreferred:!(a={left:d(ne.getXValue(a,m))+v-l/2,top:h(C),width:l,height:0}),text:i,textSize:{width:s,height:o},outsideFill:null!=n?n:re.ColorHelper.getThemeColor(t,re.DataLabelViewModel.DefaultLabelColorName),insideFill:null!=n?n:re.ColorHelper.getThemeColor(t,re.DataLabelViewModel.DefaultInsideLabelColorName),parentType:1,parentShape:{rect:a,orientation:0<=w?1:2,validPositions:[16]},identity:void 0,fontProperties:r,hasBackground:y.enableBackground,backgroundColor:y.backgroundColor,backgroundTransparency:y.backgroundTransparency},b.push(C))}return c.push({labelDataPoints:b,maxNumberOfLabels:2*p.totals.length}),c},ne.createUncertaintyLabels=function(n,p,g){for(var y,m,e=n.data,l=e.series,v=re.DataLabelViewModel.createColumnFormatterCacheManager(),S=n.xAxisProperties.scale,f=e.isScalar,b=n.horizontalOffset,c=[],t=function(e,t){var a=(y=l[e]).uncertainty;if(!a||!a.renderUncertainty||!a.labels.show)return c[e]={labelDataPoints:[],maxNumberOfLabels:0},"continue";m=a.labels;for(var a=y.isY2?n.y2AxisProperties:n.yAxisProperties,u=re.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(a,m),d=a.scale,h=m.fontProperties,i=[],r=0,o=y.data;r<o.length;r++){var s=o[r];null==s||null==s.value||null==s.uncertainty||(s=function(e){for(var t=[],a=re.UncertaintyHelper.formatUncertaintyByErrorFormat(e.value,e.uncertainty,m.errorFormat),i=[a.lower,a.upper],r=0;r<2;r++){var o,s,n=i[r],l=1===r,c=l?e.uncertainty.upper:e.uncertainty.lower;null!=c&&(o=void 0,o=m.errorFormat===re.errorFormat.relativePercentage?re.UncertaintyHelper.formatUncertaintyRelativePercentage(n,g):(s=e.labelFormatString,s=v.getOrCreate(s,m,u.units,u.getPrecision(!!s,y.type)),re.DataLabelRenderer.getLabelFormattedText(s.format(n))),s=re.FontProperties.toTextProperties(h,o),n={isPreferred:!1,text:o,textSize:{width:N.TextMeasurementService.measureSvgTextWidth(s)+re.DataLabelViewModel.LabelDensityPadding,height:N.TextMeasurementService.estimateSvgTextHeight(s,!0)},outsideFill:h.color||re.ColorHelper.getThemeColor(p,re.DataLabelViewModel.DefaultLabelColorName),insideFill:h.color||re.ColorHelper.getThemeColor(p,re.DataLabelViewModel.DefaultInsideLabelColorName),parentType:0,parentShape:{point:{x:S(ne.getXValue(e,f))+b,y:d(c)},radius:0,validPositions:[l?1:2]},identity:void 0,fontProperties:h,hasBackground:m.enableBackground,backgroundColor:m.backgroundColor,backgroundTransparency:m.backgroundTransparency},t.push(n))}return t}(s),_.isEmpty(s))||i.push.apply(i,s)}c[e]={labelDataPoints:i,maxNumberOfLabels:100}},a=0,i=l.length;a<i;a++)t(a);return c},ne.prototype.axisShouldIncludeZero=function(){var e;return null!=(null==(e=null==(e=null==(e=null==(e=this.dataView)?void 0:e.metadata)?void 0:e.objects)?void 0:e.categoryAxis)?void 0:e.reverseStackOrder)&&this.isStacked()},ne.prototype.adjustPathXCoordinate=function(e,t){jsCommon.BrowserUtils.isFirefox()&&null!=t&&(this.pathXAdjustment=this.getPathXAdjustmentForFirefox(t)),jsCommon.BrowserUtils.isInternetExplorerOrEdge()&&(this.pathXAdjustment=ne.InteractivityStrokeWidth/2);t=this.currentViewport.scale;return N.Double.equalWithPrecision(t,1,1e-5)?e-=this.pathXAdjustment:e-=this.pathXAdjustment*t,e},ne.prototype.getPathXAdjustmentForFirefox=function(e){var t,a=e.getBoundingClientRect(),e=re.SVGUtil.tryGetBBox(e);if(0<e.height&&0<e.width)return t=this.currentViewport.scale,(a.width/t-e.width)/2},ne.getValidLabelPositions=function(e,t){var e=e.data,a=e.length,i=e[t].value,r=e[t-1]&&e[t-1].value,e=e[t+1]&&e[t+1].value,o=1,s=1;if(null==r?o=0:i<r?o=3:r<i&&(o=2),null===e?s=0:i<e?s=3:e<i&&(s=2),0===t)return 3!==s?[1,2]:[2,1];if(t===a-1)return 3!==o?[1,2]:[2,1];switch(o){case 0:switch(s){case 0:return[1,2,8,4];case 1:return[1,2,4,8];case 3:return[2,1,4,8];case 2:return[1,2,4,8]}case 1:switch(s){case 0:case 1:return[1,2,8,4];case 3:return[2,1,8,4];case 2:return[1,2,8,4]}case 3:switch(s){case 0:return[2,1,8,4];case 1:return[2,1,4,8];case 3:return[2,1,8,4];case 2:return[1,2,8,4]}case 2:switch(s){case 0:return[1,2,8,4];case 1:return[1,2,4,8];case 3:case 2:return[1,2,8,4]}}},ne.prototype.getCartesianVisualCapabilities=function(){var e=this.data,t=e&&!e.hasDynamicSeries&&this.hasSingleSeriesPerValueAxis(e),t=!se.hasFlag(this.lineType,16)||t;return{supportsHierarchicalCategoryAxis:!0,axesCapabilities:{categoryAxis:{domainAggregateRole:re.LineChartRoles.Category,supportedDomainAggregates:e&&e.isScalar?e.scalarKeyCount?1:3:0},valueAxis:{domainAggregateRole:re.LineChartRoles.Y,supportedDomainAggregates:t?3:1},secondaryValueAxis:this.haveY2Data()||this.isComboChart?{domainAggregateRole:re.LineChartRoles.Y2,supportedDomainAggregates:t?3:1}:void 0}}},ne.prototype.hasSingleSeriesPerValueAxis=function(e){if(!e||_.isEmpty(e.valuesMetadata))return!1;for(var t=!1,a=!1,i=0,r=e.valuesMetadata;i<r.length;i++){var o,s=r[i].roles;for(o in s)if(s[o]){if(o===re.LineChartRoles.Y){if(t)return!1;t=!0}if(o===re.LineChartRoles.Y2){if(a)return!1;a=!0}}}return!0},ne.prototype.getStaticSeriesRole=function(){return this.isComboChart?re.LineChartRoles.Y2:re.LineChartRoles.Y},ne.prototype.haveY2Data=function(){return this.data&&this.data.series&&_.some(this.data.series,function(e){return e&&e.isY2})},ne.prototype.calculateCustomLegend=function(){var e,t;return this.dataView?(e=this.data,t=this.getDefaultMarkerShape(e.defaultToCircle),re.Legend.buildSeriesLegendData({dataView:this.dataView,allowLegendWithNoSeries:this.isComboChart,showByDefault:!0,staticSeriesRoleNames:this.isComboChart?["Y2"]:["Y","Y2"],style:this.style,ignoreDefaultColor:this.isComboChart,ignoreDefaultCategoryColor:!0,lineAndMarkerOptions:{renderLineStyle:!0,legendMarkerRendering:e.legendMarkerRendering,matchSeriesColor:e.matchLineColor,defaultMarkerShape:t},featureSwitches:this.featureSwitches})):re.Legend.getDefaultLegendData(this.style)},ne.prototype.enumerateCustomLegend=function(e){e=__assign(__assign({},this.customizeLegendFormattingModelOptions(e)),{enumeration:e.enumeration});re.Legend.enumerate(e,this.featureSwitches)},ne.prototype.customizeLegendFormattingModelOptions=function(e){var t=this.originalData,a=t.legendMarkerRendering,i=this.featureSwitches.removeDefaultToCircleToggle&&a===re.legendMarkerRendering.markerCircleDefault;return __assign(__assign({},e),{legendMarkerRendering:a,matchLineColor:a===re.legendMarkerRendering.markerOnly||i?t.matchLineColor:void 0,defaultToCircle:a===re.legendMarkerRendering.markerOnly?t.defaultToCircle:void 0})},ne.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e)},ne.chartTypeSupportsExplicitDots=function(e){return!e},ne.prototype.getTelemetryInformation=function(){var e,t={};if(_.isEmpty(null==(e=this.data)?void 0:e.anomalyDetections)||(t.AnomalyDetections=!0),!_.isEmpty(t))return t},ne.prototype.getDefaultMarkerShape=function(e){return!this.featureSwitches.removeDefaultToCircleToggle&&e?re.markerShape.circle:re.markerShape.longDash},ne.prototype.getValidDataPointIndices=function(i){for(var r=[],e=0,t=i.categoryData;e<t.length;e++)!function(t){if(t&&i.categoryIdentities[t.categoryIndex])for(var e=0;e<i.series.length;e++){var a=_.findIndex(i.series[e].data,function(e){return e.categoryIndex===t.categoryIndex});if(0<=a){r.push({categoryIndex:t.categoryIndex,seriesIndex:e,dataPointIndex:a});break}}}(t[e]);return r},ne.prototype.getCategoryColorsOptions=function(a,e,t,i){var r=e.map(function(e){return re.CategoryLevelUtils.concatenateCategoryLevels(a.categoryData[e.categoryIndex].hierarchyCategoryLevels).value});return{colorProps:{showAllDataPoints:re.lineChartObjectProps.dataPoint.showAllDataPoints,fill:re.lineChartObjectProps.dataPoint.fill},featureSwitches:this.featureSwitches,groupBuilder:t,hostService:this.host,options:{dataView:this.dataView,style:this.style,categories:_.map(e,function(e,t){return{color:a.series[e.seriesIndex].data[e.dataPointIndex].pointColor,displayName:r[t],identity:a.categoryIdentities[e.categoryIndex]}}),fillInstanceKind:a.hasDynamicSeries?1:3,noDefaultFillColor:i,multipleRole:a.multipleIdentity?re.LineChartRoles.Rows:void 0}}},ne.prototype.getDataViewObjectLayerChanges=function(e){var t,a,i,r;return this.featureSwitches.onObject?(t=this.isComboChart?re.comboChartObjectProps:re.lineChartObjectProps,r=this.data.series.map(function(e){return{selector:e.identity.getSelector(),value:e.lineStyle.markerProperties.showMarker}}),a=this.data.series.map(function(e){return{selector:e.identity.getSelector(),value:null==(e=e.seriesSettings)?void 0:e.show}}),i=this.data.series.map(function(e){return{selector:e.identity.getSelector(),value:null==(e=e.labelSettings)?void 0:e.show}}),r=[re.SeriesLevelToggleBehavior.create(t.lineStyles.showMarker,this.data.lineStyle.markerProperties.showMarker,r).onToggleEnabled(o.createBooleanDataViewObjectChange(t.lineStyles.showMarkerByDefault,!1,{required:!0}),o.createBooleanDataViewObjectChange(t.lineStyles.showMarker,!0,{required:!0})).onToggleDisabled(o.createRevertToDefaultDataViewObjectChange("lineStyles",{required:!0})),re.TopLevelToggleBehavior.create(t.lineStyles.showMarker,this.data.lineStyle.markerProperties.showMarker).onToggleDisabled(o.createRevertToDefaultDataViewObjectChange("lineStyles",{required:!0})),re.SeriesLevelToggleBehavior.create(re.lineChartObjectProps.seriesLabels.backgroundColor,this.data.seriesLabelSetings.enableBackground).onToggleEnabled(o.createBooleanDataViewObjectChange(re.lineChartObjectProps.seriesLabels.enableBackground,!0,{required:!0,inheritSelector:!0})),re.TopLevelToggleBehavior.create(re.lineChartObjectProps.seriesLabels.backgroundColor,this.data.seriesLabelSetings.enableBackground).onToggleEnabled(o.createBooleanDataViewObjectChange(re.lineChartObjectProps.seriesLabels.enableBackground,!0,{required:!0})),re.SeriesLevelToggleBehavior.create(re.lineChartObjectProps.seriesLabels.show,this.data.seriesLabelSetings.show,a).onToggleEnabled(o.createBooleanDataViewObjectChange(re.lineChartObjectProps.seriesLabels.showByDefault,!1,{required:!0}),o.createBooleanDataViewObjectChange(re.lineChartObjectProps.seriesLabels.show,!0,{required:!0})).onToggleDisabled(o.createRevertToDefaultDataViewObjectChange("seriesLabels",{required:!0})),re.TopLevelToggleBehavior.create(re.lineChartObjectProps.seriesLabels.show,this.data.seriesLabelSetings.show).onToggleDisabled(o.createRevertToDefaultDataViewObjectChange("seriesLabels",{required:!0})),re.SeriesLevelToggleBehavior.create(t.labels.backgroundColor,this.data.dataLabelsSettings.enableBackground).onToggleEnabled(o.createBooleanDataViewObjectChange(t.labels.enableBackground,!0,{inheritSelector:!0})),re.TopLevelToggleBehavior.create(t.labels.backgroundColor,this.data.dataLabelsSettings.enableBackground).onToggleEnabled(o.createBooleanDataViewObjectChange(t.labels.enableBackground,!0)),re.SeriesLevelToggleBehavior.create(t.labels.showSeries,this.data.dataLabelsSettings.show,i).onToggleEnabled(o.createBooleanDataViewObjectChange(t.labels.showByDefault,!1),o.createBooleanDataViewObjectChange(t.labels.show,!0)).onToggleDisabled(o.createRevertToDefaultDataViewObjectChange("labels")),re.TopLevelToggleBehavior.create(t.labels.show,this.data.dataLabelsSettings.show).onToggleDisabled(o.createRevertToDefaultDataViewObjectChange("labels"))],s.getDataViewObjectsBehaviorChanges(e,r)):[]},ne.ClassName="lineChart",ne.MainGraphicsContextClassName="mainGraphicsContext",ne.lineChartSVGClassName="lineChartSVG",ne.CategorySelector=e("cat"),ne.CategoryValuePoint=e("dot"),ne.CategoryPointSelector=e("point"),ne.CategoryAreaSelector=e("catArea"),ne.HoverLineCircleDot=e("circle-item"),ne.UncertaintySelector=e("uncertainty"),ne.UncertaintyAreas=e("uncertainty-areas"),ne.UncertaintyArea=e("uncertainty-area"),ne.UncertaintyLines=e("uncertainty-lines"),ne.UncertaintyLine=e("uncertainty-line"),ne.UncertaintyBars=e("uncertainty-bars"),ne.UncertaintyBar=e("uncertainty-bar"),ne.UncertaintyMarkers=e("uncertainty-markers"),ne.UncertaintyMarker=e("uncertainty-marker"),ne.LineClassSelector=e("line"),ne.MarkerLineClassSelector=e("marker-line"),ne.InteractivityLineClassSelector=e("interactivity-line"),ne.TooltipOverlaySelector=e("tooltip-overlay"),ne.SelectedMarkerLineClassSelector=e("selected-markers"),ne.FocusElementSelector=e("focus-element"),ne.PositionRectSelector=e("position-rect"),ne.RenderOrderableElements=[ne.CategoryAreaSelector,ne.UncertaintySelector,ne.LineClassSelector,ne.MarkerLineClassSelector,ne.InteractivityLineClassSelector,ne.CategorySelector,ne.SelectedMarkerLineClassSelector,ne.FocusElementSelector],ne.PointRadiusExtra=4,ne.CircleRadiusExtra=3,ne.TooltipCircleRadiusExtra=2,ne.PathElementName="path",ne.CircleElementName="circle",ne.CircleClassName="selection-circle",ne.LineElementName="line",ne.ScalarOuterPadding=10,ne.InteractivityStrokeWidth=10,ne.MinimumLabelsToRender=4,ne.DefaultZeroScalarDomain=[-1,1],ne.DefaultAreaTransparency=60,ne.AreaTransparencyReductionFactor=.4,ne.MarkerShapeSizeRange={min:1,max:20},ne.validStackedLabelPositions=[1,4],ne);function ne(e){var t,a=this;this.pathXAdjustment=0,this.deferDragMoveOperation=jsCommon.DeferUtility.deferUntilNextFrame(function(){var e;a.lastDragMoveXPosition&&a.data&&a.margin&&(e=ne.findCategoryIndex({pointX:a.lastDragMoveXPosition-a.margin.left,offsetX:0,categoryData:a.data.categoryData,currentViewport:a.currentViewport,scale:a.xAxisProperties.scale,categoryThickness:a.xAxisProperties.categoryThickness,isScalar:a.data.isScalar}),a.selectColumn(e),a.lastDragMoveXPosition=void 0)}),this.isScrollable=null!=(t=e.isScrollable)&&t,this.tooltipsEnabledOnHost=e.tooltipsEnabled,this.lineType=null!=(t=e.chartType)?t:1,this.interactivityService=e.interactivityService,this.featureSwitches=e.featureSwitches,this.viewModelAdapterFactory=e.viewModelAdapterFactory}re.LineChart=c,Object.defineProperty(v.prototype,"usingHoverLine",{get:function(){return this.showHoverLine},enumerable:!1,configurable:!0}),v.prototype.getTooltipOverlayElement=function(){return this.tooltipOverlay},v.prototype.applyTooltips=function(e,t,a){!this.tooltipOverlay||e.binnedLineSamplingApplied&&e.hasDynamicSeries?this.applyPointTooltip(e,t,a):this.applyHoverLineTooltip(e,t,a)},v.prototype.removeTooltips=function(e,t){this.removePointTooltip(e),this.removeHoverLineTooltip(t)},v.prototype.applyHoverLineTooltip=function(e,i,r){this.tooltipOverlay,this.tooltipOverlay&&(this.showHoverLine||this.removePointTooltip(e),this.tooltipOverlay.attrs({x:0,width:e.width,height:e.height}),this.tooltipService.addTooltip(this.mainGraphicsSVG,function(e){var t,a=e.elementCoordinates[0],a=i.getCategoryIndexFromTooltipEvent(e,a),a=r.getHoverLineDataForCategory(a);return a&&a.hasUncertainty&&(t=e.elementCoordinates[1],t=i.getYValueFromTooltipEvent(t,e.context)),c.getSeriesTooltipInfo(a,t)},function(e){return v.getCategoryIdentityForHoverLineTooltipEvent(i,r,e)},!0),this.mainGraphicsSVG.on("mouseout.hoverline",function(){return r.clearHoverLine()}),this.mainGraphicsSVG.on("touchmove.hoverline",function(){return r.clearHoverLine()}),this.showHoverLine=!0)},v.prototype.removeHoverLineTooltip=function(e){e.clearHoverLine(),this.tooltipService.removeTooltips(this.mainGraphicsSVG),this.mainGraphicsSVG.on(".hoverline",null),this.showHoverLine=!1},v.prototype.applyPointTooltip=function(e,a,t){this.showHoverLine&&this.removeHoverLineTooltip(t);var i=e.isComboChart?function(e){return v.getCategoryIdentityForHoverLineTooltipEvent(a,t,e)}:function(e){return e.data&&[e.data.identity]};e.interactivityLines,this.tooltipService.addTooltip(e.interactivityLines,function(e){var t=e.elementCoordinates[0];return a.getTooltipInfoForPoint(e,t)},i,!0),e.dots,this.tooltipService.addTooltip(e.dots,function(e){return e.data&&e.data.tooltipInfo},i,!0),e.explicitDots&&this.tooltipService.addTooltip(e.explicitDots,function(e){return e.data&&e.data.tooltipInfo},function(e){return e.data&&[e.data.identity]},!0),e.focusElement&&this.tooltipService.addTooltip(e.focusElement,function(e){return e.data&&e.data.tooltipInfo},i,!0),this.showHoverLine=!1},v.prototype.removePointTooltip=function(e){e.interactivityLines&&this.tooltipService.removeTooltips(e.interactivityLines),e.dots&&this.tooltipService.removeTooltips(e.dots),e.explicitDots&&this.tooltipService.removeTooltips(e.explicitDots)},v.getCategoryIdentityForHoverLineTooltipEvent=function(e,t,a){var i;if(a)return a.data&&c.isForecastPoint(a.data)?null:(i=a.elementCoordinates[0],e=e.getCategoryIndexFromTooltipEvent(a,i),t.getHoverLineIdentities(e,null==(i=a.data)?void 0:i.data))};var m=v;function v(e,t,a){this.tooltipService=e,this.mainGraphicsSVG=t,a&&(this.tooltipOverlay=t.append("rect").classed(c.TooltipOverlaySelector.class,!0)),this.showHoverLine=!1}t.prototype.queryRegion=function(e){var t=this,a=[],i=e.dataSpace;return a=this.isScalar||this.hasCategories&&void 0!==i.left&&void 0!==i.right?_.filter(this.dataPoints,function(e){return N.Double.lessOrEqualWithPrecision(i.left.value,t.isScalar?e.categoryValue:e.categoryIndex)&&N.Double.lessOrEqualWithPrecision(t.isScalar?e.categoryValue:e.categoryIndex,i.right.value)&&N.Double.lessOrEqualWithPrecision(t.getBottom(i,e),e.value)&&N.Double.lessOrEqualWithPrecision(e.value,t.getTop(i,e))}):a},t.prototype.getBottom=function(e,t){return(t.isY2||this.isComboChart&&e.bottom2?e.bottom2:e.bottom).value},t.prototype.getTop=function(e,t){return(t.isY2||this.isComboChart&&e.top2?e.top2:e.top).value};var le=t;function t(e){this.dataPoints=e.dataPoints,this.isComboChart=e.isComboChart,this.isScalar=e.isScalar,this.hasCategories=e.hasCategories}re.LineChartHitTester=le}(powerbi=powerbi||{}),function(e){var g=e.visuals||(e.visuals={}),y=jsCommon.BrowserUtils,n=jsCommon.DOMConstants.KeyDictionary,m=jsCommon.DOMConstants.mouseClickEventName;function t(){}t.prototype.create=function(){return new a},g.LineChartWebBehaviorFactory=t,v.prototype.bindEvents=function(s,n,e,t){function l(e){return i.getPointX(e)}var i=this,a=s.areas,r=s.focusMarker,o=s.interactivityLines,c=s.root,u=s.showHoverline,d=s.tooltipOverlay,h=this.dots=s.dots,p=(this.areas=a,s.onSelecting);this.anomalies=s.anomalies,this.areaTransparency=s.areaTransparency,this.anomalyNavigationHelper=s.anomalyNavigationHelper,this.selectedMarkersCallback=s.selectedMarkersCallback,this.hitTester=s.hitTester;t?(this.unbindEventsFormatMode(s),o.on(m,function(e){S(s,l(this),e,n.getSubSelectionHelper(),!1)}),o.on("contextmenu",function(e){S(s,l(this),e,n.getSubSelectionHelper(),!0)}),h.on(m,function(){var e=d3.select(this.parentNode).datum();f(s,e,n.getSubSelectionHelper(),!1)}),h.on("contextmenu",function(){var e=d3.select(this.parentNode).datum();f(s,e,n.getSubSelectionHelper(),!0)}),a.on("pointermove",function(){s.onAreaPointerMove(d3.event),g.EventBubblingUtil.markAsHandled(d3.event)})):(o.on(m,function(e){var t=s,a=n,i=l(this),r=t.getCategoryIndex(e,i,!0);i=(i=_.find(e.data,function(e){return e&&e.categoryIndex===r}))||{selected:e.selected,identity:e.identity,specificIdentity:t.categoryIdentities[r]},g.InteractivityUtils.handleSelection(i,a)}),o.on("contextmenu",function(e){var t,a,i,r,o;t=s,a=n,i=l(this),e=e,y.isCtrlOrMeta(d3.event)||(d3.event.preventDefault(),g.EventBubblingUtil.markAsHandled(d3.event),r=g.InteractivityUtils.getPositionOfLastInputEvent(),o=t.getCategoryIndex(e,i,!0),i=(i=_.find(e.data,function(e){return e&&e.categoryIndex===o}))||{selected:e.selected,identity:e.identity,specificIdentity:t.categoryIdentities[o]},a.handleContextMenu(i,r))}),g.InteractivityUtils.registerStandardInteractivityHandlers(h,n),g.InteractivityUtils.registerClearCatcherShortcut(c,n),r&&(r.on(m,function(e){e=g.InteractivityUtils.isSelectableDataPointContainer(e)?e.data:e;g.InteractivityUtils.handleSelection(e,n)}),r.on("keydown.select",function(t){var e=d3.event,a=e.keyCode;32!==a&&13!==a||(v.isAnomaly(t)?(a=i.anomalies.filter(function(e){return e.isAnomaly&&e===t}),g.AnomalyDetectionCartesianRenderer.handleSelectedAnomaly(a.node(),t,p)):(a=g.InteractivityUtils.isSelectableDataPointContainer(t)?t.data:t,g.InteractivityUtils.handleSelection(a,n)),e.preventDefault(),e.stopPropagation())},!0),g.InteractivityUtils.registerStandardContextMenuHandler(r,n)),d&&u&&(d.style("pointer-events","all"),_.isEmpty(s.categoryIdentities)?d.on(m,function(){y.isCtrlOrMeta(d3.event)||n.handleClearSelection()}):(d.on(m,function(){var e=s.getCategoryIndex(void 0,l(this),!1),e={selected:!1,identity:void 0,specificIdentity:s.categoryIdentities[e]};g.InteractivityUtils.handleSelection(e,n)}),d.on("contextmenu",function(){var e,t=d3.event;y.isCtrlOrMeta(t)||(t.preventDefault(),g.EventBubblingUtil.markAsHandled(t),t=g.InteractivityUtils.getPositionOfLastInputEvent(),e=s.getCategoryIndex(void 0,l(this),!1),n.handleContextMenu({selected:!1,identity:void 0,specificIdentity:s.categoryIdentities[e]},t))})))),e&&(t=e.dataPointNavigationManager,a=e.pointSourceKey,t.isEmpty(a)||("0"!==c.attr("tabindex")&&!c.classed(g.managedTabIndexElement.class)||this.registerEnterPlotAreaHandler(c,t,a),r&&this.registerDataPointNavigationHandler(r,t,a)))},v.prototype.unbindEventsFormatMode=function(e){var t=e.dots,a=e.focusMarker,e=e.tooltipOverlay;a&&(a.on(m,null),a.on("keydown.select",null),g.InteractivityUtils.removeStandardContextMenuHandler(a)),e&&(e.style("pointer-events","none"),g.InteractivityUtils.removeStandardSelectionHandler(e)),g.InteractivityUtils.removeStandardInteractivityHandlers(t)},v.prototype.registerEnterPlotAreaHandler=function(i,r,o){var s=this;i.on("keydown.enterPlotArea",function(){var e,t=d3.event,a=t.keyCode;a===n.F1&&t.ctrlKey?(t.preventDefault(),t.stopPropagation(),(e=s.anomalyNavigationHelper.getFirstElement(0))&&s.renderFocus(e.element)):13===a?(t.preventDefault(),t.stopPropagation(),r.goToFirstElement(o)):27===a&&t.target!==i.node()&&(t.preventDefault(),t.stopPropagation(),e=i.node(),s.renderFocus(e))})},v.prototype.registerDataPointNavigationHandler=function(e,r,o){var s=this;e.on("keydown.dataPoint",function(){var a=d3.event,i=a.keyCode;(9===i||37===i||39===i||38===i||40===i||i===n.F1&&y.isCtrlOrMeta(a))&&g.InteractivityUtils.tryToSelectD3Target(function(e){a.preventDefault(),a.stopPropagation();var t,e=g.InteractivityUtils.isNavigableDataPointContainer(e)?e.data:e;v.isAnomaly(e)?s.handleAnomalyKeyDownEvent(e.categoryIndex,e.seriesIndex,i,y.isCtrlOrMeta(a),r,o):i===n.F1&&y.isCtrlOrMeta(a)?(t=s.anomalyNavigationHelper.getFirstElement(e.categoryIndex))&&s.renderFocus(t.element):r.handleKeyDownEvent(o,e.categoryIndex,e.seriesIndex,i,a.shiftKey)},void 0)},!0)},v.isAnomaly=function(e){return e.isAnomaly},v.prototype.handleAnomalyKeyDownEvent=function(e,t,a,i,r,o){var s;switch(a){case 37:return s=this.anomalyNavigationHelper.getNextDataPoint(e,t,g.DataDirection.PreviousCategory),void this.renderFocus(s.element);case 39:return s=this.anomalyNavigationHelper.getNextDataPoint(e,t,g.DataDirection.NextCategory),void this.renderFocus(s.element);case n.F1:return void(i&&(0<e?r.handleKeyDownEvent(o,e-1,t,39,!1):r.goToFirstElement(o)));default:return}},v.prototype.renderSelection=function(t){var a=this;this.dots.style("fill-opacity",function(e){return e.lineStyle.markerProperties.showMarker?0:g.ColumnUtil.getFillOpacity(e.selected,!1,t,!1)}),this.areas&&this.areas.style("fill-opacity",function(e){return t&&!e.selected?g.LineChart.AreaTransparencyReductionFactor*(1-a.areaTransparency/100):1-a.areaTransparency/100}),this.selectedMarkersCallback&&this.selectedMarkersCallback(t)},v.prototype.renderFocus=function(e){e&&y.focus(e)},v.prototype.lassoSelectRectLayer=function(e){return this.hitTester.queryRegion(e)},v.prototype.getLassoSelectDirectionMode=function(){return 1},v.prototype.getPointX=function(e){for(var t,a=d3.event;t=a.sourceEvent;)a=t;var i=e.getBoundingClientRect();return a.clientX-i.left-e.clientLeft};var a=v;function v(){}function S(e,t,a,i,r){e.onLineSubSelection(a,t,i,d3.event,r),g.EventBubblingUtil.markAsHandled(d3.event)}function f(e,t,a,i){e.onDotSubSelection(t,a,d3.event,i),g.EventBubblingUtil.markAsHandled(d3.event)}g.LineChartWebBehavior=a}(powerbi=powerbi||{}),function(S){var f=S.visuals||(S.visuals={}),e=jsCommon.CssConstants.createClassAndSelector,n=S.data.createDataViewScopeIdentity,a=S.data.DataViewConcatenateCategoricalColumns,l=S.data.ScopeIdentityExtractor;function c(e){e&&(this.interactivityService=e.interactivityService)}c.prototype.initData=function(e){this.element=e.element,this.host=e.host,this.featureSwitches=e.featureSwitches,this.isMobileChart=e.interactivity&&e.interactivity.isInteractiveLegend},c.prototype.initRenderer=function(e){var t=this;this.svg=e.svg,this.interactivityService&&(this.playControl=new i(this.element,function(e){return t.moveToFrameAndRender(e)},this.isMobileChart),this.playControl.onPlay(function(){return t.play()})),this.rendererInitialized=!0},c.prototype.isRendererInitialized=function(){return this.rendererInitialized},c.prototype.setData=function(e,t){if(e){if(this.ridiculousFlagForPersistProperties&&e.metadata)return this.ridiculousFlagForPersistProperties=!1,this.playData;e.matrix||e.categorical?this.playData=u.converter(e,t):this.playData=u.getDefaultPlayData()}else this.playData=u.getDefaultPlayData();return this.lastViewport=void 0,this.playData},c.prototype.render=function(e,t,a,i){var r,o=this.playData,s=!this.lastViewport||this.lastViewport.height!==a.height||this.lastViewport.width!==a.width;if(this.lastViewport=a,s&&this.stop(),o)return t={data:this.playData,viewModel:t,viewport:a},this.interactivityService&&(r=o.currentViewModel,this.interactivityService.applySelectionStateToData(r.dataPoints)),this.updateCallout(a,i),this.playControl&&s&&this.playControl.rebuild(o,a,this.playControlWidth),r=o.allViewModels.map(function(e){return e.dataPoints}),{allDataPoints:_.flatten(r),viewModel:t}},c.prototype.updateCallout=function(e,t){var a=this.playData,i=a.frameData,a=a.currentFrameIndex,r=e.height,o=r-t.top-t.bottom,e=e.width,t=e-t.left-t.right,s=0,r=Math.min(r,1.3*e),e=Math.max(12,Math.round(r/7)),e=Math.min(e,70),r=[],o=(a<i.length&&0<=a&&(i={fontSize:jsCommon.PixelConverter.toString(e),text:i[a].text||"",fontFamily:f.Font.Family.regular.css},(s=S.TextMeasurementService.estimateSvgTextHeight(i)-S.TextMeasurementService.estimateSvgTextBaselineDelta(i))<o)&&(a=t-2*c.calloutOffsetMultiplier*s,r=[S.TextMeasurementService.getTailoredTextOrDefault(i,a)]),this.svg.selectAll(c.PlayCallout.selector).data(r));o.enter().append("text").classed(c.PlayCallout.class,!0).merge(o).text(function(e){return e}).attrs({x:t-c.calloutOffsetMultiplier*s,y:function(){return s}}).styles({"font-size":"".concat(e,"px"),"text-anchor":"end"}),o.exit().remove()},c.prototype.play=function(){var e,t=this.playData;this.isPlaying?this.stop():this.playControl&&(this.isPlaying=!0,this.playControl.play(),null!=(e=this.playControl.getCurrentIndex()))&&((e=Math.round(e))>=t.allViewModels.length-1?t.currentFrameIndex=-1:t.currentFrameIndex=e-1,this.playNextFrame(t))},c.prototype.playNextFrame=function(e,t,a){var i,r,o=this;this.isPlaying&&(i=e.currentFrameIndex+1,null!=t&&null!=a&&(i=Math.abs(a-t+1),t=i),i<e.allViewModels.length)&&-1<i?((r=this.host.tooltips())&&r.hide({immediately:!0,isTouchEvent:!1}),e.currentFrameIndex=i,e.currentViewModel=e.allViewModels[i],this.renderDelegate(e.currentViewModel),this.playControl.setFrame(i),i<e.allViewModels.length&&window.setTimeout(function(){o.playNextFrame(e,t,a)},u.FrameStepDuration)):this.stop()},c.prototype.stop=function(){this.playControl&&this.playControl.pause(),this.isPlaying=!1},c.prototype.remove=function(){this.playControl&&this.playControl.remove(),d3.selectAll(c.PlayCallout.selector).remove()},c.prototype.setRenderFunction=function(e){this.renderDelegate=e},c.prototype.getCartesianExtents=function(e,t){return this.playData&&!_.isEmpty(this.playData.allViewModels)&&!_.isEmpty(this.playData.frameData)&&u.getMinMaxForAllFrames(this.playData,t)||e},c.prototype.setPlayControlPosition=function(e){var t;this.playControl&&((t=this.playControl.getContainer()).css("left",e.left?"".concat(e.left,"px"):""),t.css("top",e.top?"".concat(e.top,"px"):""),t.css("width",e.width?"".concat(e.width,"px"):""),this.playControlWidth=e.width)},c.prototype.moveToFrameAndRender=function(e){var t=this.playData;this.isPlaying=!0,t&&0<=e&&e<t.allViewModels.length&&e!==t.currentFrameIndex&&(t.currentFrameIndex=e,e=t.allViewModels[e],t.currentViewModel=e,this.renderDelegate(e)),this.isPlaying=!1},c.prototype.isCurrentlyPlaying=function(){return this.isPlaying},c.prototype.enumerateDataPoints=function(e,t,a,i){var r=_.filter(a.metadata.columns,function(e){return e.roles[f.scatterRoleNames.category]}),o=0<r.length&&r[r.length-1].queryName,r=_.filter(a.metadata.columns,function(e){return e.roles[f.scatterRoleNames.series]}),s=0<r.length&&r[0].queryName;t.hasDynamicSeries?S.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:_.map(t.dataPoints,function(e){return{color:e.fill,displayName:t.dataPointSeries[e.seriesIndex].name,identity:new f.SelectionId({data:__spreadArray([],e.identity.getSelectorsByColumn().dataMap[s]||[],!0)},!1)}})},this.featureSwitches):S.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:e,dataView:a,style:i,categories:_.map(t.dataPoints,function(e){var t=e.identity.getSelectorsByColumn().dataMap[o],t=l.getKeyValuePairs(t[0].expr);return{color:e.fill,displayName:e.formattedCategory.getValue(),identity:new f.SelectionId({data:__spreadArray([S.data.DataViewRoleWildcard.fromRoles([f.scatterRoleNames.play])],_.map(t,function(e){return n(e)}),!0)},!1)}}),fillInstanceKind:3},this.featureSwitches)},c.PlayCallout=e("play-callout"),c.calloutOffsetMultiplier=.3,f.PlayAxis=c,d.prototype.getContainer=function(){return this.playAxisContainer},d.prototype.remove=function(){this.playAxisContainer&&this.playAxisContainer.remove()},d.prototype.pause=function(){this.playButton.removeClass("pause").addClass("play")},d.prototype.play=function(){this.playButton.removeClass("play").addClass("pause")},d.prototype.getCurrentIndex=function(){if(this.noUiSlider)return Number(this.noUiSlider.get())},d.prototype.onPlay=function(e){this.playButtonCircle.off("click"),this.playButtonCircle.on("click",e)},d.prototype.setFrame=function(e){this.noUiSlider.set([e])},d.prototype.rebuild=function(e,t,a){var i=this,r=(this.noUiSlider&&this.noUiSlider.destroy(),e.labelData),a=d.calucalateSliderSize(r,a),o=this.getContainer(),o=(a.marginLeft>d.SliderMarginLeft&&(o.css("padding-left","".concat(a.marginLeft-d.SliderMarginLeft,"px")),o.css("box-sizing","border-box")),this.updateSliderControl(e,a.width)),e=d.adjustWidthRegardingLastItem(r,o,a.width);this.slider.css("width","".concat(e,"px")),this.noUiSlider.on("slide",function(){var e=i.getCurrentIndex();i.renderDelegate(e)}),this.noUiSlider.on("update",function(){return $(".noUi-target").removeClass("noUi-state-tap")})},d.prototype.updateSliderControl=function(a,e){var t=a.labelData,i=this.slider.get(0),r=a.frameData.length,o={start:r<=1?1:a.currentFrameIndex,step:1,range:{min:0,max:r<=1?1:r-1},animationDuration:u.FrameStepDuration},s=null,n=0;return 1<r&&(n=(e=d.createPipsFilterFn(a,e,t)).skipStep,s={mode:"steps",density:Math.ceil(100/r),format:{to:function(e){return a.frameData[e].escapedText},from:function(t){return _.findIndex(a.frameData,function(e){return e.escapedText===t})}},filter:e.filter}),o.pips=s,noUiSlider.create(i,o),this.noUiSlider=i.noUiSlider,n},d.createPipsFilterFn=function(e,t,a){var i=_.max(_.map(a.labelInfo,function(e){return e.labelWidth})),r=1,o=1,i=i/(1<e.frameData.length?t/(e.frameData.length-1):t);1.25<i?(o=Math.ceil(i),r=2):(1<i||a.anyWordBreaks)&&(r=2);return{filter:function(e){return e%o==0?r:0},skipStep:o}},d.adjustWidthRegardingLastItem=function(e,t,a){var i;return!(_.isEmpty(e.labelInfo)||e.labelInfo.length<=1)&&(i=e.labelInfo.length,t=Math.floor((i-1)/t)*t,0<(e=e.labelInfo[t].labelWidth/2-(a+d.SliderMarginRight-a/i*(1+t))))?a-(e=(i=d.SliderMaxMargin-d.SliderMarginRight)<e?i:e):a},d.prototype.createSliderDOM=function(e){this.playAxisContainer=$('<div class="play-axis-container"></div>').appendTo(e).css("height","".concat(d.PlayControlHeight,"px")),this.playButtonCircle=$('<div class="button-container"></div>').appendTo(this.playAxisContainer),this.isMobileChart&&this.playButtonCircle.addClass("mobile-button-container"),this.playButton=$('<div class="play"></div>').appendTo(this.playButtonCircle),this.slider=$('<div class="sliders"></div>').attr("drag-resize-disabled","true").attr("rtl",("rtl"===document.dir).toString()).appendTo(this.playAxisContainer)},d.calucalateSliderSize=function(e,t){var a=0,e=(!_.isEmpty(e.labelInfo)&&1<e.labelInfo.length&&(a=_.head(e.labelInfo).labelWidth/2),Math.max(a,d.SliderMarginLeft)),e=Math.min(d.SliderMaxMargin,e);return{width:Math.max(t-e-d.SliderMarginRight,1),marginLeft:e}},d.SliderMarginLeft=44,d.SliderMarginRight=20,d.SliderMaxMargin=100,d.PlayControlHeight=80;var u,t,i=d;function d(e,t,a){this.isMobileChart=a,this.createSliderDOM(e),this.renderDelegate=t}function b(e,t){t=t.convertFrame(e);return a.concatenateCategoryColumnsForVisual(t.metadata,f.StandardObjectPropertyIdentifiers.formatString,f.cartesianRoleNames.category,t.categorical)}(e=u=f.PlayChart||(f.PlayChart={})).FrameStepDuration=800,t=750,e.AnimationEase="linear",e.ClassName="playChart",e.getFrameAnimationDuration=function(){return t},e.setFrameAnimationDuration=function(e){t=e},e.convertFrame=b,e.converter=function(e,t){var a=e.metadata,a=(s={},(a=a)&&a.objects&&(a=a.objects,s.currentFrameIndex=S.DataViewObjects.getValue(a,f.scatterChartProps.currentFrameIndex.index,null)),s),i=[],r=[],o=f.DataViewMultipleReader.create(e,f.StandardObjectPropertyIdentifiers.formatString),s=o.getFrameCount(),n=o.getSubtotals();if(o.hasFrames()){var l,c,e=o.getFrameSourceColumns(),u=e&&e[0],e=f.valueFormatter.getFormatString(u,f.scatterChartProps.general.formatString),d=void 0;d=u.type.numeric?(c=null==(c=o.getFrameNode(s-1))?void 0:c.value,l=null==(l=o.getFrameNode(0))?void 0:l.value,c=Math.abs(c-l),f.valueFormatter.create({format:e,value:c,value2:0,columnType:u.type})):f.valueFormatter.createDefaultFormatter(e,!0);for(var h=0,p=s;h<p;h++){var g,y,m,v=o.getFrameNode(h);v.isSubtotal||(g=d.format(v.value),y=$("<div></div>").text(g).html(),r.push({escapedText:y,text:g}),m=t(b(h,o),{label:y,column:u,identity:v.identity,value:v.value,formattedValue:g},n),i.push(m))}}else m=t(b(0,o),void 0,n),i.push(m);return a.currentFrameIndex=r.length-1,{allViewModels:i,currentViewModel:m,frameData:r,currentFrameIndex:a.currentFrameIndex,labelData:function(e,t){for(var a={fontFamily:f.Font.Family.regular.css,fontSize:jsCommon.PixelConverter.toString(14)},i=[],r=!1,o=0,s=e;o<s.length;o++){var n=s[o],l=jsCommon.WordBreaker.getMaxWordWidth(n.escapedText,S.TextMeasurementService.measureSvgTextWidth,a);r=r||jsCommon.WordBreaker.hasBreakers(n.escapedText)||-1<n.escapedText.indexOf("-"),i.push({label:n.escapedText,labelWidth:l})}return{labelInfo:i,anyWordBreaks:r,labelFieldName:t&&t.displayName}}(r,u)}},e.getDefaultPlayData=function(){return{frameData:[],allViewModels:[],currentFrameIndex:0,currentViewModel:void 0,labelData:{anyWordBreaks:!1,labelInfo:[]}}},e.getMinMaxForAllFrames=function(e,t){var a={},i=!1;if(e.allViewModels&&0<e.allViewModels.length)for(var r=0,o=e.allViewModels.length;r<o;r++){var s=e.allViewModels[r];_.isEmpty(s.dataPoints)||(i=!0,s=t(s),a={minY:d3.min([s.minY,a.minY]),maxY:d3.max([s.maxY,a.maxY]),minX:d3.min([s.minX,a.minX]),maxX:d3.max([s.maxX,a.maxX]),formatStringX:s.formatStringX||a.formatStringX,formatStringY:s.formatStringY||a.formatStringY})}return i?a:null},e.isDataViewPlayable=function(e,t){return void 0===t&&(t="Play"),(e=e.matrix&&e.matrix.rows&&e.matrix.rows.levels&&e.matrix.rows.levels[0]&&e.matrix.rows.levels[0].sources&&e.matrix.rows.levels[0].sources[0]&&e.matrix.rows.levels[0].sources[0].roles)&&e[t]},e.renderTraceLines=function(e,t,a){e=_.filter(e,function(e){return e.selected}),e=_.uniqBy(e,function(e){return e.identity.getKey()}),t.render(e,a)}}(powerbi=powerbi||{}),function(o){var c;function t(e){this.maxDataValue=Number.MIN_VALUE,this.newDataInterval=0,this.duration=3e5,this.featureSwitches=e.featureSwitches}c=o.visuals||(o.visuals={}),t.prototype.initData=function(e){this.style=e.style,this.currentViewport=e.viewport,this.data={series:[],dataLabelsSettings:c.LineChart.getDefaultLineChartLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],lineStyle:c.LineStyle.getDefault()}},t.prototype.initRenderer=function(e){this.animator=e.animator;e=e.svg,e.classed("realTimeLineChart",!0).classed("cartesianChart",!0),e=this.mainGraphicsSVG=e.append("svg");e.classed("mainGraphicsSVG",!0),this.mainGraphicsContext=e.append("g").classed("mainGraphicsContext",!0)},t.prototype.setData=function(e){var t,a;this.data||(this.data={series:[],dataLabelsSettings:c.LineChart.getDefaultLineChartLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],lineStyle:c.LineStyle.getDefault()}),_.isEmpty(e)||(e=_.head(e)).categorical&&((t=c.CartesianHelper.getCategoryAxisProperties(e.metadata).duration)&&(this.duration=t),t=e.categorical,this.removeOldData(),t=t.categories,a=o.ValueType.fromDescriptor({text:!0}),t&&0<t.length&&t[0].source&&t[0].source.type&&(a=t[0].source.type),t=c.ScalarUtils.canHaveScalarAxis(e.metadata?e.metadata.objects:null,c.lineChartProps.categoryAxis.axisType,a),a=c.LineChart.converter({dataView:e,style:this.style,isScalar:t,featureSwitches:this.featureSwitches}),this.mergeNewData(a),this.removeOldData(this.newDataInterval))},t.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||!_.isEmpty(this.data.series))},t.prototype.calculateAxesProperties=function(r){var o,e,s=this,n=r.categoryAxisOptions,l=r.valueAxisOptions;return this.currentViewport=r.viewport,this.margin=r.margin,this.newAxisData&&(this.axisData=this.newAxisData),this.data&&(o=this.getAxesDomains(!1,{categoryAxis:!0,valueAxis:!0}),this.xAxisProperties=(e=function(e){var t="x"===e,e="y"===e,a=t?n:l,i=t?s.data.categoryMetadata:s.containsEmptySeries()?void 0:s.data.series[0].yCol,i=c.AxisHelper.createAxis({pixelSpan:t?r.viewport.width:r.viewport.height-s.margin.top-s.margin.bottom,domainOptions:t?{domain:o.categoryAxis,type:0}:{domain:o.valueAxis,type:0},axisZoom:void 0,metaDataColumn:i,isScalar:!0,isCategoryAxis:t,isVertical:e,formatString:c.valueFormatter.getFormatString(i,c.columnChartProps.general.formatString),outerPadding:t?10:0,useTickIntervalForDisplayUnits:!0,getValueFn:t?function(e,t){return c.CartesianHelper.lookupXValue(s.data,e,t,!0)}:void 0,logAxisScale:!1,margin:r.margin,preventNice:c.AxisHelper.hasForcedDomain(a.includeDomain),categoryThickness:null});return e&&i.axis.tickSize(-r.viewport.width),i})("x"),this.yAxisProperties=e("y"),this.newAxisData={x:this.xAxisProperties,y1:this.yAxisProperties}),this.axisData||(this.axisData=this.newAxisData),[this.xAxisProperties,this.yAxisProperties]},t.prototype.getAxesDomains=function(e,t){var a,i,r={};return this.data&&(a=this.truncateSeries(),_.isEmpty(a)||(t.categoryAxis&&(i=c.AxisHelper.createDomain(a,null!=(i=null==(i=null==(i=this.data)?void 0:i.categoryMetadata)?void 0:i.type)?i:o.ValueType.fromDescriptor({text:!0}),!0,[c.AxisHelper.createScalarDomainOptions([this.getMinData()+this.newDataInterval,void 0],0,[!0,void 0])]))&&(c.AxisHelper.assertScalarDomain(i.domain),r.categoryAxis=i.domain),t.valueAxis&&(r.valueAxis=c.AxisHelper.createValueDomain(a)))),r},t.prototype.setAxesLayout=function(e){},t.prototype.overrideXScale=function(e){this.xAxisProperties=e},t.prototype.render=function(e){if(!this.containsEmptySeries())return this.renderLines(),this.animator&&this.animator.refreshLastUpdate(),{dataPoints:[],behaviorOptions:{},labelDataPoints:[],labelsAreNumeric:!0,labelDataPointGroups:[],animateLabels:!1}},t.prototype.onClearSelection=function(){},t.prototype.truncateSeries=function(){var a=this.getMinData(),e=this.data.series;return e?_.map(e,function(e){(e=o.Prototype.inherit(e)).data=o.Prototype.inherit(e.data);var t=0;return 0<_.findIndex(e.data,function(e){return e&&e.categoryValue>=a})&&t++,e.data=e.data.slice(t),e}):[]},t.prototype.removeOldData=function(e){if(void 0===e&&(e=0),!this.containsEmptySeries()){for(var t=this.getMinData(e),e=this.data,a=0,i=e.series;a<i.length;a++){var r=i[a],o=_.findIndex(r.data,function(e){return e&&e.categoryValue>t});0<o&&(r.data=r.data.slice(o))}var s=_.findIndex(e.categoryData,function(e){return e&&e.categoryValue>t});0<s&&(e.categoryData=this.data.categoryData.slice(s),e.categories=this.data.categories.slice(s))}},t.prototype.mergeNewData=function(e){this.containsEmptySeries()?(this.data=e,this.maxDataValue=this.getMaxData()):(this.data.series=t.mergeSeries(this.data.series,e.series,this.maxDataValue),t.mergeCategories(this.data,e,this.maxDataValue),e=this.getMaxData(),this.newDataInterval=this.maxDataValue&&e?e-this.maxDataValue:0,this.maxDataValue=e)},t.prototype.getMaxData=function(){for(var e=0,t=0,a=this.data.series;t<a.length;t++){var i=a[t];i.data.length&&(e=Math.max(_.last(i.data).categoryValue,e))}return e},t.prototype.getMinData=function(e){return this.maxDataValue-this.duration-1.5*(e=void 0===e?0:e)},t.prototype.renderLines=function(){var t=this.axisData.x.scale,a=this.axisData.y1.scale,e=this.currentViewport,i=this.margin,r=e.height-i.top-i.bottom,e=e.width-i.left-i.right,i=t(t.domain()[0]+this.newDataInterval)-t(t.domain()[0]),o=d3.line().x(function(e){return t(e.categoryValue)}).y(function(e){return a(e.value)}),r=(this.mainGraphicsSVG.attrs({x:0,height:r,width:e}),this.mainGraphicsContext.attr("transform",c.SVGUtil.translate(0,0)),this.mainGraphicsContext.selectAll(".line").data(this.data.series,function(e){return e.identity.getKey()}));r.enter().append("path").classed("line",!0).merge(r).style("stroke",function(e){return e.color}).attr("d",function(e){return o(e.data)}),r.exit().remove(),this.animator&&this.animator.animate({mainGraphicsContext:this.mainGraphicsContext,interactivityService:null,xTranslation:i})},t.prototype.containsEmptySeries=function(){return!this.data||_.isEmpty(this.data.series)},t.mergeCategories=function(e,t,a){var i=t.categories,i=_.findIndex(i,function(e){return e&&e.categoryValue>a});-1<i?(e.categories=e.categories.concat(t.categories.slice(i)),e.categoryData=e.categoryData.concat(t.categoryData.slice(i))):(e.categories=t.categories,e.categoryData=t.categoryData)},t.mergeSeries=function(e,t,a){for(var i=[],r=0,o=t;r<o.length;r++){var s=o[r],n=_.find(e,function(e){return e.identity.equals(s.identity)});if(n){i.push(n);for(var l=0,c=s.data;l<c.length;l++){var u=c[l];u.categoryValue>a&&n.data.push(u)}}else i.push(s)}return i},t.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},t.prototype.getStaticSeriesRole=function(){return"Y"},c.RealTimeLineChart=t}(powerbi=powerbi||{}),function(e){var t,o=e.visuals||(e.visuals={});function a(e){e=t.call(this,e)||this;return e.lastUpdateTime=null,e}t=o.BaseAnimator,__extends(a,t),a.prototype.refreshLastUpdate=function(){this.lastUpdateTime=Date.now()},a.prototype.getDuration=function(){var e;return this.lastUpdateTime?(e=Math.min(Date.now()-this.lastUpdateTime,250),Math.max(this.animationDuration,e)):this.animationDuration},a.prototype.getEasing=function(){return o.D3Helper.easeCompat("linear")},a.prototype.animate=function(t){var e=t.mainGraphicsContext,a=this.getDuration();return e.transition().duration(a).ease(this.getEasing()).attrTween("transform",function(){return function(e){return o.SVGUtil.translate(-t.xTranslation*e,0)}}),{failed:!1}},o.RealTimeLineChartAnimator=a,i=o.BaseAnimator,__extends(r,i),r.prototype.animate=function(e){var t={failed:!0,shapes:null},a=e.viewModel,i=this.previousViewModel;return a.categories.length*a.series.length>o.AnimatorCommon.MaxDataPointsToAnimate||(i&&(t=this.animateDefaultShapes(e.viewModel,e.series,e.layout,e.itemCS)),this.previousViewModel=a),t},r.prototype.getEasing=function(){return o.D3Helper.easeCompat("linear")},r.prototype.animateDefaultShapes=function(t,e,a,i){var e=e.selectAll(i.selector).data(function(e){return e.data},function(e){return e.key}),r=e.enter().append("rect").attr("class",function(e){return i.class.concat(e.highlight?" highlight":"")}).merge(e);return r.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return o.ColumnUtil.getFillOpacity(e.selected,e.highlight,!1,t.hasHighlights)}).transition().ease(this.getEasing()).duration(this.animationDuration).attrs(a.shapeLayout),e.exit().remove(),{failed:!1,shapes:r}};var i;function r(e){return i.call(this,e)||this}o.DashboardColumnChartAnimator=r}(powerbi=powerbi||{}),function(j){var z;(z=j.visuals||(j.visuals={})).scatterChartConverterModuleFactory=function(){var A=j.data.DataRoleHelper;function e(e,t,a,i){var r,o,s,n,l,c,u;if(!t.useMatrixDV)return e.categorical&&e.categorical.values?(p=e,g=t,h=a,i=i,S=j.data.createDataViewCategoricalReaderAdvanced(p,{colorOptions:{valueRole:"Size",visualStyle:g.style},formatStringProp:z.scatterChartProps.general.formatString}),c=g.style,v=g.interactivityService,y=g.categoryAxisProperties,m=g.valueAxisProperties,D=p.categorical,d=z.GradientUtils.getGradientValueColumn(D),f=D.categories&&0<D.categories.length?(r=D.categories[0].values,z.valueFormatter.create({format:z.valueFormatter.getFormatString(D.categories[0].source,z.scatterChartProps.general.formatString),value:r[0],value2:r[r.length-1],columnType:S.data.getCategoryType("Category")})):(r=[null],z.valueFormatter.createDefaultFormatter(null)),o=!!(u=D.values).source,s=function(e){var t,a,i,r=A.getMeasureIndexOfRole(e,"X"),o=A.getMeasureIndexOfRole(e,"Y"),s=A.getMeasureIndexOfRole(e,"Size"),n="",l="";e&&e.length&&(e=e[0],0<=r&&(t=e.values[r].source,n=e.values[r].source.displayName),0<=o&&(a=e.values[o].source,l=e.values[o].source.displayName),0<=s)&&(i=e.values[s].source);return{idx:{x:[r],y:o,size:s},cols:{x:t,y:a,size:i},axesLabels:{x:n,y:l}}}(l=u.grouped()),n=z.DataLabelViewModel.getDefaultPointLabelSettings(c,"smallLightLabel"),l=function(e,t){var a={};e&&e.forEach(function(e){e=z.ScatterChart.getMeasureValue(t,e.values),e=z.AxisHelper.getRangeForColumn(e);(null==a.min||a.min>e.min)&&(a.min=e.min),(null==a.max||a.max<e.max)&&(a.max=e.max)});return a}(l,s.idx.size),c=T(p,n,!1,c),u=function(p,g,e,y,m,v,S,f,b,x,C,w){var D,A=p.data.hasValues("X"),P=p.data.hasValues("Y"),L=y.categories;if(!A&&!P)return[];for(var t=[],a=e.idx,M=z.scatterChartProps.general.formatString,V=g.source,i=g.grouped(),T=_.isEmpty(L)?null:L[0],r=p.objects.getStaticObjects(),o=j.DataViewObjects.getValue(r,z.scatterChartProps.bubbles.markerShape,z.markerShape.circle),F=U(e),I=0,s=i.length;I<s;I++)for(var k=i[I],n=k.values,O=z.ScatterChart.getMeasureValue(_.first(a.x),n),N=z.ScatterChart.getMeasureValue(a.y,n),B=z.ScatterChart.getMeasureValue(a.size,n),n=void 0,R=(S&&(n=p.colors.createBySeries(I,void 0,z.ForegroundColorName)),void 0),l=(R=p.data.hasSeries()&&j.DataViewObjects.getValue(r,z.scatterChartProps.bubbles.showSeries,!0)?j.DataViewObjects.getValue(p.objects.getSeriesDataObjects(I),z.scatterChartProps.bubbles.markerShape,o):o,p.identities.createForSeries(I,[z.scatterRoleNames.size])),H={identityKey:k&&k.identity&&k.identity.key||"",dataPoints:[],hasSize:!(!B||!B.values),fill:n,identity:l,markerShape:R,name:S?z.valueFormatter.format(p.data.getSeriesName(I),p.objects.getSeriesFormatString()):void 0},c=(t.push(H),0),u=m.length;c<u;c++)!function(e){var t=m[e],a=A?z.AxisHelper.normalizeNonFiniteNumber(p.data.getValue(z.scatterRoleNames.x,e,I)):0,i=P?z.AxisHelper.normalizeNonFiniteNumber(p.data.getValue(z.scatterRoleNames.y,e,I)):0,r=A?p.data.getFormatString(z.scatterRoleNames.x,e,I):void 0,o=P?p.data.getFormatString(z.scatterRoleNames.y,e,I):void 0,s=z.AxisHelper.normalizeNonFiniteNumber(p.data.getValue("Size",e,I));if(null==a||null==i)return;var n,l=void 0,l=x&&!S?p.colors.createByCategory(e,z.ForegroundColorName):p.colors.createBySeries(I,e,z.ForegroundColorName),c=void 0,u=null!=(D=y.originalCategories)?D:[T],u=z.SelectionIdBuilder.builder().withCategory(u,e,null==(D=null==T?void 0:T.source)?void 0:D.queryName,!0).withSeries(g,k,!0).withMeasures(F),d=(C?(c=u.clone(),d={expr:C.column.expr,formattedValue:C.formattedValue,identity:C.identity,value:C.value},c.withColumnIdentity(C.identity,C.column.queryName,[d])):c=u,c.createSelectionId()),c=u?u.createSelectionId():d,h=new z.CategoricalLazyTooltipBuilder(p.columns,M),u=(w&&(u=z.FormattingStrategies.defaultFormatter(M),n=z.FormattingStrategies.fallbackBasedOnType(M),h.withColumnValueByIndex(T,e,!0,u),S&&h.withColumnValue(V,k.name,void 0,!0,u),h.withColumnValueByIndex(O,e,!1,n).withColumnValueByIndex(N,e,!1,n).withColumnValueByIndex(B,e,!1,n).withColumnValueByIndex(b,e,!1,n),C&&h.withValue(C.column.displayName,C.label),h.withAllValuesForRole("Tooltips",e,I,!1,n)),{x:a,y:i,xFormatString:r,yFormatString:o,size:s,radius:{sizeMeasure:B,index:e},fill:l,formattedCategory:z.ScatterChart.createLazyFormattedCategory(v,null!=L?t:k.name),selected:!1,identity:d,renderIdentity:c,tooltipInfo:function(){return h.getTooltipItems()},labelFill:f.fontProperties.color,markerShape:R,categoryIndex:e,seriesIndex:I});H.dataPoints.push(u)}(c);return t}(S,u,s,D,r,f,o,n,d,c.colorByCategory,h,g.tooltipsEnabled),D=_.reduce(u,function(e,t){return e.concat(t.dataPoints)},[]),r=o?z.Legend.buildSeriesLegendData({dataView:p,style:g.style,showByDefault:!0,simpleMarkerProp:z.scatterChartProps.bubbles.markerShape}):z.Legend.getDefaultLegendData(),y&&null!==y.showAxisTitle&&!1===y.showAxisTitle&&(s.axesLabels.x=null),m&&null!==m.showAxisTitle&&!1===m.showAxisTitle&&(s.axesLabels.y=null),v&&(v.applySelectionStateToData(D),v.applySelectionStateToData(r.dataPoints)),f=S.data.hasCategories(),{xCol:s.cols.x,yCol:s.cols.y,hasCategory:f,hasSize:!!s.cols.size,dataPoints:D,dataPointSeries:u,legendData:r,axesLabels:s.axesLabels,size:s.cols.size,sizeRange:l,dataLabelsSettings:n,hasDynamicSeries:o,fillPoint:c.fillPoint,fillPointStyle:c.fillPointStyle,colorBorder:c.colorBorder,colorByCategory:c.colorByCategory,multiplier:c.bubbleSizeMultiplier,xSubtotal:i&&i[z.scatterRoleNames.x],ySubtotal:i&&i[z.scatterRoleNames.y],plotAreaShadingSettings:c.plotAreaShadingSettings,ratioLineSettings:c.ratioLineSettings,markerShape:c.markerShape,dataVolume:c.dataVolume}):void 0;var d=e,h=t,p=a;if(d&&d.matrix&&(0!==_.size(d.matrix.valueSources)||0!==_.size(d.matrix.rows.levels))){for(var g=h.interactivityService,y=z.DataLabelViewModel.getDefaultPointLabelSettings(h.style,"smallLightLabel"),m=T(d,y,!0,h.style),v=function(e,t){var a,i,r,e=e.matrix,o=e.valueSources,s=!1,n=!1,l=[_.findIndex(o,function(e){return A.hasRole(e,"X")})],c=_.findIndex(o,function(e){return A.hasRole(e,"Y")}),u=_.findIndex(o,function(e){return A.hasRole(e,"Size")}),d="",h="";0<=l[0]?(a=o[l[0]],d=a.displayName):(g=F(e.rows,z.scatterRoleNames.x))&&(a=g.column,l=g.levelSourceIndices,d=a.displayName,s=!0);0<=c?(i=o[c],h=i.displayName):(g=F(e.rows,z.scatterRoleNames.y))&&(i=g.column,c=g.levelSourceIndices[0],h=i.displayName,n=!0);0<=u&&(r=o[u]);var p,g=_.find(e.rows.levels,function(e){return!_.isEmpty(e.sources)&&A.hasRole(e.sources[0],z.scatterRoleNames.series)});g?p=e.rows.root:(g=_.find(e.columns.levels,function(e){return!_.isEmpty(e.sources)&&A.hasRole(e.sources[0],z.scatterRoleNames.series)}))&&(p=e.columns.root);var o=!1,y=!1;{var m;a&&(m=a.type,o=_.size(l)<=1&&!(!m.integer&&!m.numeric),y=t.categoryAxisType===z.axisType.categorical||!o)}(s||n)&&_.find(e.rows.levels,function(e){return A.hasRole(e.sources[0],z.scatterRoleNames.category)});m=s?_.find(e.rows.levels,function(e){return A.hasRole(e.sources[0],z.scatterRoleNames.x)}):n?_.find(e.rows.levels,function(e){return A.hasRole(e.sources[0],z.scatterRoleNames.y)}):_.find(e.rows.levels,function(e){return A.hasRole(e.sources[0],z.scatterRoleNames.category)});return{idx:{x:l,y:c,size:u},cols:{x:a,y:i,size:r},axesLabels:{x:d,y:h},xGroupMetadata:s?{isCategoricalAxis:y,isScalarType:o}:void 0,yGroupMetadata:n?{isCategoricalAxis:!1,isScalarType:!0}:void 0,seriesLevel:g,seriesNode:p,categoryLevel:m,treatNullsAsZero:{x:t.xValuesTreatNullsAsZero,y:t.yValuesTreatNullsAsZero}}}(d,m),S={min:Number.MAX_VALUE,max:Number.MIN_VALUE},f=v.cols.size,b=(f&&f.aggregates&&(S={min:f.aggregates.minLocal||f.aggregates.min,max:f.aggregates.maxLocal||f.aggregates.max}),d.matrix.valueSources),x=[],C=0;C<b.length;C++)A.hasRole(b[C],"Tooltips")&&x.push(C);var w,f={colorHelper:z.ColorHelper.create(h.style,z.scatterChartProps.dataPoint.fill,m.defaultDataPointColor,m.fill),metadata:v,hasDynamicSeries:A.hasRoleInDataView(d,"Series"),tooltipsEnabled:h.tooltipsEnabled,sizeRange:S,dataLabelSettings:y,playFrameInfo:p,tooltipValuesIndices:x,gradientIndex:_.findIndex(b,function(e){return A.hasRole(e,"Gradient")}),objProps:m,categoryMap:{},categoryMapNextIndex:0,categoryIdentities:[]},p=function(e,t){var a=[],i=e.matrix;if(!i.rows.root||0===_.size(i.rows.root.children))return{series:a};var r,o=t.metadata,s=o.seriesLevel,n=o.categoryLevel,l=o.seriesNode,c=-1!==o.idx.size?i.valueSources[o.idx.size]:void 0;if(l){for(var u=0;u<l.children.length;u++){var d=l.children[u];if(!d.isSubtotal){for(var h=t.colorHelper.getColorForSeriesValue(d.objects,l.childIdentityFields,d.value,z.ForegroundColorName),p=[],g=s.sources[0],y=0,m=d.levelValues;y<m.length;y++){var v=m[y];p.push({expr:g.expr,formattedValue:z.valueFormatter.format(v.value,g.format),value:v.value,identity:d.identity})}var S=(new z.SelectionIdBuilder).withColumnIdentity(d.identity,g.queryName,p).createSelectionId(),f=void 0,b=(f=t.objProps.markerShapeShowAllSeries?j.DataViewObjects.getValue(d.objects,z.scatterChartProps.bubbles.markerShape,t.objProps.markerShape):t.objProps.markerShape,z.valueFormatter.format(d.value,j.DataViewObjects.getValue(g.objects,z.scatterChartProps.general.formatString))),x={identityKey:d.identity&&d.identity.key||"",dataPoints:[],hasSize:!!c,fill:h,identity:S,markerShape:f,name:b},C=(a.push(x),{currentSeries:d,currentSeriesColor:h,seriesShape:f,seriesIndex:u});x.dataPoints=L(e,C,t),!n&&0===_.size(x.dataPoints)&&(S=M(void 0,g),b={category:d,categoryMetadataColumns:[g],categoryIdentityFields:d.childIdentityFields,currentSeries:d,currentSeriesMetadata:g,currentSeriesColor:h,categoryFormatter:S,valueColumnIds:U(t.metadata),seriesShape:f,currentSeriesIndex:u},S=V(e,b,t))&&x.dataPoints.push(S)}}var w=e.matrix.rows.root.children;(D=_.find(w,function(e){return e.isSubtotal}))&&(r=P(o,D))}else{var D,A;n?(A=null!=c?c.queryName:"",h=t.colorHelper.getColorForMeasure(null,A,z.ForegroundColorName),x={identityKey:"",dataPoints:[],hasSize:!!c,fill:h,markerShape:t.objProps.markerShape},a.push(x),C={currentSeries:i.rows.root,currentSeriesColor:h,seriesShape:t.objProps.markerShape},x.dataPoints=L(e,C,t),w=e.matrix.rows.root.children,(D=_.find(w,function(e){return e.isSubtotal}))&&(r=P(t.metadata,D))):(A=null!=c?c.queryName:"",h=t.colorHelper.getColorForMeasure(null,A,z.ForegroundColorName),a.push(w={identityKey:"",dataPoints:[],hasSize:!!c,fill:h}),C={currentSeries:i.rows.root,currentSeriesColor:h,seriesShape:t.objProps.markerShape},w.dataPoints=L(e,C,t),o.xGroupMetadata||o.yGroupMetadata||(r=P(o,e.matrix.rows.root.children[0])))}return{series:a,xSubtotal:r&&r.xSubtotal,ySubtotal:r&&r.ySubtotal}}(d,f),D=_.reduce(p.series,function(e,t){return e.concat(t.dataPoints)},[]),d=(w=f.hasDynamicSeries?(d={dataView:d,colorHelper:f.colorHelper,style:h.style,formatStringProp:null,showByDefault:!0,markerShapePropIdentifier:z.scatterChartProps.bubbles.markerShape,markerShowSeriesPropIdentifier:z.scatterChartProps.bubbles.showSeries},(w=f.metadata.xGroupMetadata)&&w.isCategoricalAxis?z.Legend.buildFromFirstMatrixColumnLevel(d):z.Legend.buildFromFirstMatrixRowLevel(d)):z.Legend.getDefaultLegendData(h.style),g&&(g.applySelectionStateToData(D),g.applySelectionStateToData(w.dataPoints)),!!(v.xGroupMetadata||v.yGroupMetadata||v.categoryLevel));return{xCol:v.cols.x,yCol:v.cols.y,hasCategory:d,hasSize:!!v.cols.size,dataPoints:D,dataPointSeries:p.series,legendData:w,axesLabels:v.axesLabels,categoryIdentities:f.categoryIdentities,size:v.cols.size,sizeRange:S,dataLabelsSettings:y,hasDynamicSeries:f.hasDynamicSeries,fillPoint:m.fillPoint,fillPointStyle:m.fillPointStyle,colorBorder:m.colorBorder,colorByCategory:m.colorByCategory,multiplier:m.bubbleSizeMultiplier,xSubtotal:p.xSubtotal,ySubtotal:p.ySubtotal,plotAreaShadingSettings:m.plotAreaShadingSettings,ratioLineSettings:m.ratioLineSettings,markerShape:m.markerShape,dataVolume:m.dataVolume,xGroupMetadata:v.xGroupMetadata,yGroupMetadata:v.yGroupMetadata,treatNullsAsZero:v.treatNullsAsZero}}}function P(e,t){var a,i,r=e.idx.x,e=e.idx.y,r=_.first(r);return{xSubtotal:a=-1!==r?z.AxisHelper.normalizeNonFiniteNumber(t.values[r].value):a,ySubtotal:i=-1!==e?z.AxisHelper.normalizeNonFiniteNumber(t.values[e].value):i}}function L(e,t,a){var i=[],r=t.currentSeries,o=a.metadata.seriesLevel?a.metadata.seriesLevel.sources[0]:void 0,s=U(a.metadata),n=function(e,t,a){var i,r,o=a.metadata.seriesLevel?a.metadata.seriesLevel.sources[0]:void 0,t=t.currentSeries,s=z.valueFormatter.createDefaultFormatter(null);a.metadata.xGroupMetadata&&a.metadata.xGroupMetadata.isCategoricalAxis?(a=e.matrix.rows,i=a.root.children,r=a.levels[0].sources,s=M(i[0],r[0])):t.children?(i=t.children,r=0<e.matrix.rows.levels.length?e.matrix.rows.levels[i[0].level].sources:void 0,o&&(s=M(i[0],r[0]))):o&&A.hasRole(o,"Category")&&(s=M((i=[t])[0],(r=[o])[0]));return{categories:i,categoryMetadataColumns:r,formatter:s}}(e,t,a);if(!_.isEmpty(n.categories))for(var l=0,c=n.categories;l<c.length;l++){var u=V(e,{category:c[l],categoryMetadataColumns:n.categoryMetadataColumns,categoryIdentityFields:r.childIdentityFields,currentSeries:r,currentSeriesMetadata:o,currentSeriesColor:t.currentSeriesColor,categoryFormatter:n.formatter,valueColumnIds:s,seriesShape:t.seriesShape,currentSeriesIndex:t.seriesIndex},a);u&&i.push(u)}return i}function M(e,t){var a;return e?(a=e.levelValues,z.valueFormatter.create({format:z.valueFormatter.getFormatString(t,z.scatterChartProps.general.formatString),value:a[0],value2:a[_.size(e.values)-1],columnType:null})):z.valueFormatter.createDefaultFormatter(null)}function V(e,l,t){if(!l.category.isSubtotal){var a,i,r=t.metadata,e=e.matrix,o=r.idx.x,s=r.idx.y,n=r.idx.size,c=_.size(e.valueSources),u=r.xGroupMetadata,d=r.yGroupMetadata,h=_.first(o),p=0,g=z.scatterChartProps.general.formatString,h=(u||-1===h||(p=z.AxisHelper.normalizeNonFiniteNumber(l.category.values[h].value),p=r.treatNullsAsZero&&r.treatNullsAsZero.x&&null==p?0:p,a=j.DataViewObjects.getValue(l.category.values[h].objects,g)),null==p?null:[p]),p=(u&&(h=_.map(o,function(e){return l.category.levelValues[e].value})),0),y=r.xGroupMetadata&&r.xGroupMetadata.isCategoricalAxis;if(d||-1===s?d&&(p=l.category.levelValues[s].value):(D=H(y,l,c,s),p=z.AxisHelper.normalizeNonFiniteNumber(l.category.values[D].value),p=r.treatNullsAsZero&&r.treatNullsAsZero.y&&null==p?0:p,i=j.DataViewObjects.getValue(l.category.values[D].objects,g)),null!=h&&null!=p){-1!==n&&(D=H(y,l,c,n),m=z.AxisHelper.normalizeNonFiniteNumber(l.category.values[D].value),N=j.DataViewObjects.getValue(l.category.values[D].objects,g));var m,o=z.SelectionIdBuilder.builder();if(!_.isEmpty(l.categoryMetadataColumns)){for(var s=_.last(l.categoryMetadataColumns),v=[],S=0,f=l.category.levelValues;S<f.length;S++){var b=f[S],x=l.categoryMetadataColumns[b.levelSourceIndex];v.push({expr:x.expr,formattedValue:z.valueFormatter.format(b.value,x.format),value:b.value,identity:l.category.identity})}o.withColumnIdentity(l.category.identity,s.queryName,v)}if(l.currentSeriesMetadata){for(var v=[],C=0,w=l.currentSeries.levelValues;C<w.length;C++){b=w[C];v.push({expr:l.currentSeriesMetadata.expr,formattedValue:z.valueFormatter.format(b.value,l.currentSeriesMetadata.format),value:b.value,identity:l.currentSeries.identity})}o.withColumnIdentity(l.currentSeries.identity,l.currentSeriesMetadata.queryName,v)}_.isEmpty(l.valueColumnIds)||o.withMeasures(l.valueColumnIds),t.playFrameInfo&&(L=t.playFrameInfo,V=o.clone(),v={expr:L.column.expr,formattedValue:L.formattedValue,identity:L.identity,value:L.value},o.withColumnIdentity(L.identity,L.column.queryName,[v]));var n=o.createSelectionId(),D=V?V.createSelectionId():n,s=t.sizeRange,o=(s.min>m&&(s.min=m),s.max<m&&(s.max=m),l.currentSeriesColor),A=(t.hasDynamicSeries||(t.objProps.colorByCategory?o=t.colorHelper.getColorForSeriesValue(l.category.objects,l.categoryIdentityFields,l.category.value,z.ForegroundColorName):l.category.objects&&(V=null!=t.metadata.cols.size?t.metadata.cols.size.queryName:"",o=t.colorHelper.getColorForMeasure(l.category.objects,V,z.ForegroundColorName))),z.FormattingStrategies.defaultFormatter(g)),s=function(){var e=l.category.levelValues,t=l.currentSeries.value;return t=e?1<_.size(e)?z.DataViewConcatenateUtil.concatenateValues(_.map(e,function(e,t){return A(e.value,l.categoryMetadataColumns[t])})):e[0].value:t},P=new z.LazyTooltipBuilder;if(t.tooltipsEnabled){var L,M=z.FormattingStrategies.fallbackBasedOnType(g),V=l.category.levelValues,T=1<_.size(l.categoryMetadataColumns),d=(u||d||(T?P.withMultipleColumnAndValues(l.categoryMetadataColumns,_.map(V,function(e){return e.value}),!0,A):V&&P.withColumnValue(_.head(l.categoryMetadataColumns),V[0].value,void 0,!0,A)),t.hasDynamicSeries&&P.withColumnValue(l.currentSeriesMetadata,l.currentSeries.value,void 0,!0,A),u&&t.metadata.xGroupMetadata.isCategoricalAxis?P.withMultipleColumnAndValues(l.categoryMetadataColumns,h,!0,A):P.withColumnValue(r.cols.x,h[0],a,!1,M),P.withColumnValue(r.cols.y,p,i,!1,M).withColumnValue(r.cols.size,m,N,!1,M),t.gradientIndex),F=e.valueSources;0<=d&&(O=j.DataViewObjects.getValue(l.category.values[d].objects,g),P.withColumnValue(F[d],l.category.values[d].value,O,!1,M)),(L=t.playFrameInfo)&&P.withValue(L.column.displayName,L.label);for(var I=0,B=t.tooltipValuesIndices;I<B.length;I++){var k=B[I],O=j.DataViewObjects.getValue(l.category.values[k].objects,g),R=H(y,l,c,k);P.withColumnValue(F[k],l.category.values[R].value,O,!1,M)}}var T=1<_.size(h)?h.join(" "):h[0],V=y?T:s(),u=t.categoryMap,r=String(V),N=u[r];return void 0===N&&(u[r]=N=t.categoryMapNextIndex,t.categoryMapNextIndex=N+1,e=t.categoryIdentities)&&(e[N]=function(){var e=z.SelectionIdBuilder.builder();if(!_.isEmpty(l.categoryMetadataColumns))for(var t=0,a=l.categoryMetadataColumns;t<a.length;t++){for(var i=a[t],r=[],o=0,s=l.category.levelValues;o<s.length;o++){var n=s[o];r.push({expr:i.expr,formattedValue:z.valueFormatter.format(n.value,i.format),value:n.value,identity:l.category.identity})}e.withColumnIdentity(l.category.identity,i.queryName,r)}return e.withMeasures(l.valueColumnIds).createSelectionId()}),{x:T,y:p,size:m,radius:{sizeMeasure:null,index:-1,value:m},fill:o,xFormatString:a,yFormatString:i,formattedCategory:z.ScatterChart.createLazyFormattedLazyValue(l.categoryFormatter,s),selected:!1,identity:n,renderIdentity:D,tooltipInfo:function(){return P.getTooltipItems()},labelFill:t.dataLabelSettings.fontProperties.color,markerShape:l.seriesShape,categoryIndex:N,seriesIndex:l.currentSeriesIndex||0}}}}function H(e,t,a,i){return e&&null!=t.currentSeriesIndex?t.currentSeriesIndex*a+i:i}function T(e,t,a,i){var r={},o=(e&&e.metadata&&e.metadata.objects&&(r=e.metadata.objects),{}),s=(o.defaultDataPointColor=j.DataViewObjects.getFillColor(r,z.columnChartProps.dataPoint.defaultColor),o.fill=j.DataViewObjects.getFillColor(r,z.columnChartProps.dataPoint.fill),r.categoryLabels),s=(s&&t&&z.DataLabelViewModel.updateLabelSettingsFromLabelsObject(s,t,void 0,i),!1),s=a?e&&z.GradientUtils.hasGradientRoleInMatrix(e.matrix):e&&z.GradientUtils.hasGradientRole(e.categorical),t=(o.fillPoint=j.DataViewObjects.getValue(r,z.scatterChartProps.fillPoint.show,s),o.fillPointStyle=j.DataViewObjects.getValue(r,z.scatterChartProps.fillPoint.style,z.fillStyle.fillOnly),o.colorBorder=j.DataViewObjects.getValue(r,z.scatterChartProps.colorBorder.show,!1),o.colorByCategory=j.DataViewObjects.getValue(r,z.scatterChartProps.colorByCategory.show,!1),o.bubbleSizeMultiplier=z.shapeUtil.getBubbleSizeMultiplier(j.DataViewObjects.getValue(r,z.scatterChartProps.bubbles.bubbleSize)),o.markerShape=j.DataViewObjects.getValue(r,z.scatterChartProps.bubbles.markerShape,z.markerShape.circle),o.markerShapeShowAllSeries=j.DataViewObjects.getValue(r,z.scatterChartProps.bubbles.showSeries,!0),z.ColorHelper.create(i)),a=(o.plotAreaShadingSettings={show:j.DataViewObjects.getValue(r,z.scatterChartProps.plotAreaShading.show,z.ScatterChart.DefaultPlotAreaShadingSettings.show),upperShadingColor:n(t,r,z.scatterChartProps.plotAreaShading.upperShadingColor,z.ScatterChart.DefaultPlotAreaShadingSettings.upperShadingColor),lowerShadingColor:n(t,r,z.scatterChartProps.plotAreaShading.lowerShadingColor,z.ScatterChart.DefaultPlotAreaShadingSettings.lowerShadingColor),transparency:j.DataViewObjects.getValue(r,z.scatterChartProps.plotAreaShading.transparency,z.ScatterChart.DefaultPlotAreaShadingSettings.transparency)},z.CartesianHelper.getDefaultScatterRatioLineSettings(i));return o.ratioLineSettings={show:j.DataViewObjects.getValue(r,z.scatterChartProps.ratioLine.show,a.show),lineColor:n(t,r,z.scatterChartProps.ratioLine.lineColor,a.lineColor),transparency:j.DataViewObjects.getValue(r,z.scatterChartProps.ratioLine.transparency,a.transparency),style:j.DataViewObjects.getValue(r,z.scatterChartProps.ratioLine.style,a.style)},o.dataVolume=j.DataViewObjects.getValue(r,z.scatterChartProps.general.dataVolume,z.ScatterChart.DefaultDataVolume),o.categoryAxisType=j.DataViewObjects.getValue(r,z.cartesianChartProps.categoryAxis.axisType),o.xValuesTreatNullsAsZero=j.DataViewObjects.getValue(r,z.scatterChartProps.categoryAxis.treatNullsAsZero,!1),o.yValuesTreatNullsAsZero=j.DataViewObjects.getValue(r,z.scatterChartProps.valueAxis.treatNullsAsZero,!1),o}function n(e,t,a,i){return{solid:{color:e.getColorForPropertyWithDefaultColor(t,a,i?i.solid.color:void 0)}}}function F(e,t){for(var a=0,i=e.levels.length;a<i;a++){var r=e.levels[a],o=_.chain(r.sources).map(function(e,t){return{levelSource:e,index:t}}).filter(function(e){return A.hasRole(e.levelSource,t)}).map(function(e){return e.index}).value();if(!_.isEmpty(o))return{levelIndex:a,levelSourceIndices:o,column:r.sources[_.first(o)]}}}function U(e){var t=[],a=e.cols;return!e.xGroupMetadata&&a.x&&t.push(a.x.queryName),!e.yGroupMetadata&&a.y&&t.push(a.y.queryName),a.size&&t.push(a.size.queryName),t}return{scatterConverter:e}}}(powerbi=powerbi||{}),function(k){var i=k.visuals.D3Helper,w=k.visuals.HtmlSubSelectionHelper;k.scatterChartRendererModuleFactory=function(){var P=k.visuals.CartesianHelper,e=jsCommon.CssConstants.createClassAndSelector,d=k.visuals.DataDirection,h=k.visuals.HtmlSubSelectableClass,s=k.visuals.LineStyle,p="markers",L=k.visuals.PlayChart,M=k.visuals.ScatterChart,g=k.visuals.SetFocusRingClassName,y=k.visuals.SubSelectableObjectNameAttribute,m=k.visuals.SubSelectableTypeAttribute,V=k.visuals.SVGUtil,v=e("scatterMarker"),l=e("mainGraphicsContext"),S=e("scatterMarkerSeriesGroup"),n=e("plotAreaShadingLayer"),c=e("upperShadingArea"),u=e("lowerShadingArea"),f=e("ratioLineLayer"),b=e("ratioLine"),T=(x.prototype.init=function(e,t,a,i,r,o,s,n){this.axisGraphicsContext=e,this.mainGraphicsG=e.append("g").classed(l.class,!0),a&&(this.mainGraphicsBackgroundRect=this.mainGraphicsG.append("rect").classed("backgroundRect",!0).attrs({width:"100%",height:"100%"})),this.mainGraphicsContext=this.mainGraphicsG.append("svg"),this.tooltipsEnabled=i,this.tooltipService=r,this.eventManager=n,this.mainGraphicsContext.attr("stroke-width","1"),o&&(e=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attr("tabindex",0).attr("focusable","true").attr("aria-label",s.getLocalizedString("Visual_Plot")).classed(g,!e))},x.prototype.markersHaveChanged=function(e){var t=_.map(e.data.dataPointSeries,function(e){return e.markerShape}),a=this.previousMarkers;if(a)for(var i=0,r=Math.min(t.length,a.length);i<r;i++)if(t[i]!==a[i])return this.previousMarkers=t,!0;return this.previousMarkers=t,!1},x.prototype.render=function(o,e,s,t,a){var i=o.plotArea,r=jsCommon.BrowserUtils.isInternetExplorerOrEdge();return this.formatMode=a,this.mainGraphicsContext.attrs({width:i.width,height:i.height}).classed(g,!r&&!!e),this.drawRatioLine(o,t),this.drawShadedBackground(o),a=o.suppressDataPointRendering?this.removeScatterMarkers():0<o.animationDuration&&!this.markersHaveChanged(o)?this.drawScatterMarkers(o,e,s):this.drawScatterMarkersNoAnimation(o,o.drawBubbles,e,s),o.drawBubbles&&a.order(),this.tooltipsEnabled&&this.tooltipService.addTooltip(this.mainGraphicsContext,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity&&[e.data.identity]}),V.flushAllD3TransitionsIfNeeded(o.animationOptions),this.numSeries=o.data.dataPointSeries.length,this.scatterChartDataPoints=o.allData.dataPoints,{dataPointsSelection:a,eventGroup:this.mainGraphicsG,data:o.data,fillMarkers:o.fillMarkers,root:this.mainGraphicsContext,visualInstanceId:s.instanceId,eventManager:this.eventManager,onMarkerSubSelection:function(e,t,a,i,r){t=o.allData.dataPointSeries[t.seriesIndex];M.onMarkerSubSelection({element:e,series:t,subSelectionHelper:a,d3Event:i,hostServices:s,showUI:r})}}},x.prototype.getNextDataPoint=function(t,a,e){var i=this.mainGraphicsContext.selectAll(v.selector),r=this.scatterChartDataPoints,o=t,s=a;switch(e){case d.PreviousCategory:case d.NextCategory:var n=e===d.PreviousCategory?-1:1,l=_.sortBy(_.filter(r,function(e){return e.seriesIndex===a}),"categoryIndex"),c=n+_.findIndex(l,function(e){return e.categoryIndex===t});c>=l.length||c<0?(u=this.rollToNextSeries(r,a,e),o=u[0],s=u[1]):o=l[c].categoryIndex;break;case d.PreviousSeries:case d.NextSeries:n=e===d.PreviousSeries?-1:1,l=_.sortBy(_.filter(r,function(e){return e.categoryIndex===t}),"seriesIndex");var u=n+_.findIndex(l,function(e){return e.seriesIndex===a}),s=u>=l.length||u<0?(c=this.rollToNextCategory(r,t,e),o=c[0],c[1]):l[u].seriesIndex}return{element:i.filter(function(e){return e.seriesIndex===s&&e.categoryIndex===o}).node(),targetCategoryIndex:o}},x.prototype.rollToNextSeries=function(e,t,a){for(var i,r=a===d.PreviousCategory?-1:1,a=a===d.PreviousCategory?_.last:_.first;_.isEmpty(i);)(t+=r)>=this.numSeries?t=0:t<0&&(t=this.numSeries-1),i=_.sortBy(_.filter(e,function(e){return e.seriesIndex===t}),function(e){return e.categoryIndex});return[a(i).categoryIndex,t]},x.prototype.rollToNextCategory=function(e,t,a){for(var i,r=d3.max(e,function(e){return e.categoryIndex})+1,o=a===d.PreviousSeries?-1:1,a=a===d.PreviousSeries?_.last:_.first;_.isEmpty(i);)r<=(t+=o)?t=0:t<0&&(t=r-1),i=_.sortBy(_.filter(e,function(e){return e.categoryIndex===t}),function(e){return e.seriesIndex});a=a(i).seriesIndex;return[t,a]},x.prototype.getFirstElement=function(){return{element:this.mainGraphicsContext.selectAll(v.selector).node()}},x.prototype.createTraceLineRenderer=function(e){return new t(e,this.mainGraphicsContext,this.tooltipsEnabled,this.tooltipService)},x.prototype.drawShadedBackground=function(e){var t,a,i,r=e.data.plotAreaShadingSettings||M.DefaultPlotAreaShadingSettings,o=this.axisGraphicsContext.select(n.selector);r.show&&e.supportsPlotAreaSymmetryShading?((o=o.empty()?this.axisGraphicsContext.insert("svg",":first-child").classed(n.class,!0).style("pointer-events","none"):o).attrs({height:e.plotArea.height,width:e.plotArea.width}),i=e.xAxisProperties.scale,e=e.yAxisProperties.scale,t=i.domain(),a=e.domain(),a=[{x:i((t=[Math.min(t[0],a[0]),Math.max(t[1],a[1])])[0]),y:e(t[0])},{x:i(t[1]),y:e(t[1])}],i=r.show?[[{x:a[0].x,y:a[0].y},{x:a[0].x,y:a[1].y}],[{x:a[1].x,y:a[1].y},{x:a[1].x,y:a[1].y}]]:[],this.drawArea(c,o,i,r.upperShadingColor,r.transparency),e=r.show?[[{x:a[0].x,y:a[0].y},{x:a[0].x,y:a[0].y}],[{x:a[1].x,y:a[0].y},{x:a[1].x,y:a[1].y}]]:[],this.drawArea(u,o,e,r.lowerShadingColor,r.transparency)):o.empty()||o.remove()},x.prototype.drawRatioLine=function(e,t){var a,i,r,o,s,n,l,t=e.data.ratioLineSettings||P.getDefaultScatterRatioLineSettings(t),c=this.axisGraphicsContext.select(f.selector);t.show?((c=c.empty()?this.axisGraphicsContext.append("svg").classed(f.class,!0):c).attrs({height:e.plotArea.height,width:e.plotArea.width}),a=e.xAxisProperties.scale,i=e.yAxisProperties.scale,r=a.domain(),o=i.domain(),s=e.data.xSubtotal,e=e.data.ySubtotal,l=[],t.show&&_.isFinite(s)&&_.isFinite(e)&&(0!==s&&0!==e?(n=e/s,l=[{x:a(r[0]),y:i(r[0]*n)},{x:a(r[1]),y:i(r[1]*n)}]):0!==e?l=[{x:a(0),y:i(o[0])},{x:a(0),y:i(o[1])}]:0!==s&&(l=[{x:a(r[0]),y:i(0)},{x:a(r[1]),y:i(0)}])),this.drawLine(b,c,l,t)):c.empty()||c.remove()},x.prototype.removeScatterMarkers=function(){return this.mainGraphicsContext.selectAll(S.selector).remove(),this.mainGraphicsContext.selectAll(v.selector)},x.getXOfFirstCategory=function(e){if(e.hasCategoricalAxis){e=e.xAxisProperties.scale;if(i.isScaleBand(e))return e.bandwidth()/2}return 0},x.prototype.drawScatterMarkers=function(a,e,i){var r=a.data,o=a.xAxisProperties.scale,s=a.yAxisProperties.scale,n=a.hasCategoricalAxis,l=x.getXOfFirstCategory(a),t=[{identityKey:"",dataPoints:r.dataPoints}],t=this.mainGraphicsContext.selectAll(S.selector).data(t,function(e){return e.identityKey}),c=t.enter().append("g").attrs({"aria-multiselectable":"true",role:"listbox"}).classed(S.class,!0).merge(t),t=(t.exit().remove(),c.selectAll(v.selector).data(function(e){return e.dataPoints},function(e){return e.renderIdentity.getKey()}).classed(h,!0).attr(y,p).attr(m,3)),c=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),c=t.enter().append("path").classed(v.class,!0).classed(g,!c&&!!e).classed(h,!0).attr(y,p).attr(m,3).style("opacity",0).attrs({transform:function(e){return V.translate(o(n?e.categoryIndex:e.x)+l,s(e.y))},tabindex:e?0:null,focusable:!!e||null,role:"option","aria-selected":function(e){return e.selected}}).merge(t);return c.styles({"stroke-opacity":function(e){return M.getMarkerStrokeOpacity(null!=e.size,r.colorBorder,a.hasSelection,e.selected)},stroke:function(e){return M.getStrokeFill(e,r.colorBorder)},fill:function(e){return e.fill},"fill-opacity":function(e){return M.getMarkerFillOpacity(null!=e.size,a.fillMarkers,a.hasSelection,e.selected)}}).transition().ease(a.easeType).duration(a.animationDuration).style("opacity",1).attrs({d:function(e){var t=P.getBubbleRadius(e.radius,r.sizeRange,a.plotArea,r.multiplier);return e.geometry=e.geometry||{},e.geometry.size=t,e.geometry.markerShape=r.markerShape,k.visuals.Markers.getPathWithRadius(e.markerShape,t)},transform:function(e){var t=o(n?e.categoryIndex:e.x)+l,a=s(e.y);return e.geometry=e.geometry||{},e.geometry.x=t,e.geometry.y=a,e.geometry.markerShape=r.markerShape,V.translate(t,a)}}),this.formatMode&&c.each(function(){var e=d3.select(this).datum(),t=a.data.dataPointSeries[e.seriesIndex];w.setDataForElement(this,{getDisplayName:function(){var e;return i.getLocalizedString("MiniToolbar_Markers",null!=(e=t.name)?e:i.getLocalizedString("All"))}})}),t.exit().transition().ease(a.easeType).duration(a.animationDuration).style("opacity",0).attr("r",0).remove(),c},x.prototype.drawScatterMarkersNoAnimation=function(o,e,a,i){var s=o.data,n=o.xAxisProperties.scale,l=o.yAxisProperties.scale,c=o.hasCategoricalAxis,u=x.getXOfFirstCategory(o),t=(e=e?(e=[{identityKey:"",dataPoints:s.dataPoints}],this.mainGraphicsContext.selectAll(S.selector).data(e,function(e){return e.identityKey})):this.mainGraphicsContext.selectAll(S.selector).data(s.dataPointSeries,function(e){return e.identityKey})).enter().append("g").attrs({"aria-multiselectable":"true",role:"listbox"}).classed(S.class,!0).merge(e),d=(e.exit().remove(),this.formatMode);return t.each(function(e){var r=M.getSeriesStyle(e.hasSize,s.colorBorder,o.hasSelection,o.fillMarkers,e.fill),t=d3.select(this),t=(C(this,r),t.selectAll(v.selector).data(e.dataPoints,function(e){return e.renderIdentity.getKey()})),e=(t.interrupt(),t.enter().append("path").classed(h,!0).classed(v.class,!0).attr(y,p).attr(m,3).merge(t)),t=(t.exit().remove(),e.each(function(e){var e=M.getMarkerStyle(e,s.colorBorder,o.hasSelection,o.fillMarkers),t=e,a=r;if(a)for(var i in t)t[i]===a[i]&&(t[i]=null);C(this,e)}),jsCommon.BrowserUtils.isInternetExplorerOrEdge());e.classed(g,!t&&!!a).attrs({d:function(e){var t=P.getBubbleRadius(e.radius,s.sizeRange,o.plotArea,s.multiplier);return e.geometry=e.geometry||{},e.geometry.size=t,e.geometry.markerShape=s.markerShape,k.visuals.Markers.getPathWithRadius(e.markerShape,t)},transform:function(e){var t=n(c?e.categoryIndex:e.x)+u,a=l(e.y);return e.geometry=e.geometry||{},e.geometry.x=t,e.geometry.y=a,e.geometry.markerShape=s.markerShape,V.translate(t,a)},tabindex:a?0:null,focusable:!!a||null,role:"option","aria-selected":function(e){return e.selected}}).style("opacity",null),d&&e.each(function(){var e=d3.select(this).datum(),t=o.data.dataPointSeries[e.seriesIndex];w.setDataForElement(this,{getDisplayName:function(){var e;return i.getLocalizedString("MiniToolbar_Markers",null!=(e=t.name)?e:i.getLocalizedString("All"))}})})}),this.mainGraphicsContext.selectAll(v.selector)},x.prototype.drawLine=function(e,t,a,i){var r={},o=(r.stroke=i.lineColor.solid.color,r["stroke-width"]=2,r["stroke-opacity"]=(100-i.transparency)/100,r["stroke-dasharray"]=s.getStrokeDashArrayFromLineStyle(i.style),r["stroke-linecap"]=s.getStrokeLineCapFromLineStyle(i.style),r.fill="none",r["stroke-width"]="3px",d3.line().x(function(e){return e.x}).y(function(e){return e.y})),i=t.selectAll(e.selector).data([a]);return i.enter().append("path").classed(e.class,!0).merge(i).attr("d",function(e){return o(e)}).styles(r),i.exit().remove(),t},x.prototype.drawArea=function(e,t,a,i,r){var o=d3.area().x0(function(e){return e[0].x}).y0(function(e){return e[0].y}).x1(function(e){return e[1].x}).y1(function(e){return e[1].y}),t=t.selectAll(e.selector).data([a]);t.enter().append("path").classed(e.class,!0).merge(t).attr("d",function(e){return o(e)}).styles({fill:i.solid.color,"fill-opacity":(100-r)/100}),t.exit().remove()},x);function x(){}var F=e("traceLine"),I=e("traceBubble"),t=(a.prototype.remove=function(){this.element.selectAll(F.selector).remove(),this.element.selectAll(I.selector).remove()},a.prototype.render=function(a,e){var t=this.viewModel,i=t.data.currentViewModel,r=t.viewModel,o=[];if(_.isEmpty(a)||r.suppressDataPointRendering)this.remove();else{for(var s=t.data.currentFrameIndex,n=[],l=0,c=a.length;l<c;l++){o[l]=[],n[l]=!1;for(var u=0,d=t.data.allViewModels.length;u<d&&u<=s;u++){var h=_.find(t.data.allViewModels[u].dataPoints,function(e){var t=a[l];return t.renderIdentity?e.renderIdentity.getKey()===t.renderIdentity.getKey():e.identity.getKey()===a[l].identity.getKey()});null!=h&&(h.frameIndex=u,o[l].push(h),u===s)&&(n[l]=!0)}}for(var p=r.xAxisProperties.scale,g=r.yAxisProperties.scale,y=d3.line().x(function(e){return p(e.x)}).y(function(e){return g(e.y)}).defined(function(e){return null!==e.x&&null!==e.y}),m=this.element.selectAll(F.selector).data(a,function(e){return e.renderIdentity.getKey()}),v=m.enter().append("path").classed(F.class,!0).merge(m),S=[],f=[],b=!1,x=(v.each(function(e,t){var a=this.hasAttribute("d")?this.getTotalLength():0,i=(S.push(a),$("<svg><path></path></svg>")),i=$("path",i),t=(i.attr("d",y(o[t])),0<o[t].length?i.get()[0].getTotalLength():0);f.push(t),b=b||t<a}),b?e?v.transition().ease(d3.easeLinear).duration(L.getFrameAnimationDuration()).attr("stroke-dashoffset",function(e,t){return S[t]-f[t]}).transition().ease(d3.easeLinear).duration(1).delay(0).style("stroke",function(e){return M.getStrokeFill(e,!0)}).attrs({d:function(e,t){return y(o[t])},"stroke-dasharray":function(e,t){return"".concat(f[t]," ").concat(f[t])},"stroke-dashoffset":0}):v.style("stroke",function(e){return M.getStrokeFill(e,!0)}).attrs({d:function(e,t){return y(o[t])},"stroke-dasharray":function(e,t){return"".concat(f[t]," ").concat(f[t])},"stroke-dashoffset":0}):(v.style("stroke",function(e){return M.getStrokeFill(e,!0)}).attrs({d:function(e,t){return y(o[t])},"stroke-dasharray":function(e,t){return"".concat(f[t]," ").concat(f[t])},"stroke-dashoffset":function(e,t){return f[t]-S[t]}}),(e?v.transition().ease(d3.easeLinear).duration(L.getFrameAnimationDuration()):v).attr("stroke-dashoffset",0)),m.exit().remove(),T.getXOfFirstCategory(r)),C=r.hasCategoricalAxis,w=[],D=0;D<o.length;D++)var A=o[D],A=n[D]?A.slice(0,A.length-1):A,w=w.concat(A);e=this.element.selectAll(I.selector).data(w,function(e){return e.renderIdentity.getKey()+e.x+e.y+e.size}),v=e.enter().append("path").style("opacity",0).classed(I.class,!0).merge(e);v.attrs({d:function(e){return k.visuals.Markers.getPathWithRadius(e.markerShape,P.getBubbleRadius(e.radius,r.data.sizeRange,r.plotArea,r.data.multiplier))},transform:function(e){return V.translate(p(C?e.categoryIndex:e.x)+x,g(e.y))}}).styles({"stroke-opacity":function(e){return M.getBubbleOpacity(e,!0)},stroke:function(e){return M.getStrokeFill(e,i.colorBorder)},fill:function(e){return e.fill},"fill-opacity":function(e){return null!=e.size?.2+e.frameIndex/s*.6:0}}).transition().ease(d3.easeLinear).duration(L.getFrameAnimationDuration()).style("opacity",1),e.exit().transition().ease(d3.easeLinear).duration(L.getFrameAnimationDuration()).style("opacity",0).remove(),this.tooltipsEnabled&&this.tooltipService.addTooltip(v,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity&&[e.data.identity]}),v.sort(function(e,t){return t.size-e.size})}},a);function a(e,t,a,i){this.viewModel=e,this.element=t,this.tooltipsEnabled=a,this.tooltipService=i}function C(e,t){for(var a in t){var i=e.style[a],r=t[a];if(null==r){if(""===i)continue}else if((r=r.toString())===i)continue;e.style[a]=r}}return{create:function(){return new T}}}}(powerbi=powerbi||{}),function(x){var d,C,w=x.visuals||(x.visuals={}),i=jsCommon.Color,c=x.data.Selector,e=(w.MARKERS_MAX_COUNT_THRESHOLD=7,w.MIN_OUTLINE_SIZE=10,p.prototype.initData=function(e){this.dataInitOptions=e,this.style=e.style,this.element=e.element,this.currentViewport=e.viewport,this.hostService=e.host,this.isMobileChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.tooltipService=e.services.tooltips,this.featureSwitches=e.featureSwitches,this.animationOptions=e.animation},p.prototype.initRenderer=function(e){this.animator=e.animator,this.colors=this.style.colorPalette.dataColors,this.cartesianVisualHost=e.cartesianHost;var t=this.svg=e.svg;t.classed("".concat(p.ClassName," ").concat(w.PlayChart.ClassName),!0),this.renderer.init(t,e.labelsContext,this.isMobileChart,this.tooltipsEnabled,this.tooltipService,this.interactivityService,this.hostService,e.eventManager),p.DefaultPlotAreaShadingSettings.upperShadingColor={solid:{color:w.ColorHelper.getDataColorByIndex(this.style,3)}},p.DefaultPlotAreaShadingSettings.lowerShadingColor={solid:{color:w.ColorHelper.getDataColorByIndex(this.style,5)}}},p.createLazyFormattedCategory=function(e,t){return new jsCommon.Lazy(function(){return e.format(t)})},p.createLazyFormattedLazyValue=function(e,t){return new jsCommon.Lazy(function(){return e.format(t())})},p.getMeasureValue=function(e,t){return 0<=e?t[e]:null},p.getDefaultData=function(e){return{xCol:void 0,yCol:void 0,hasCategory:void 0,dataPoints:[],dataPointSeries:[],legendData:w.Legend.getDefaultLegendData(e),axesLabels:{x:"",y:""},sizeRange:{min:void 0,max:void 0},dataLabelsSettings:w.DataLabelViewModel.getDefaultPointLabelSettings(e,"smallLightLabel"),hasDynamicSeries:!1,plotAreaShadingSettings:p.DefaultPlotAreaShadingSettings,ratioLineSettings:w.CartesianHelper.getDefaultScatterRatioLineSettings(e),markerShape:w.markerShape.circle,dataVolume:p.DefaultDataVolume,multiplier:w.shapeUtil.BubbleMultiplerRange.min}},p.prototype.renderAtFrame=function(e){this.data=this.originalData=e,this.viewModelAdapterFactory&&this.originalData&&(e=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=e.getData()),this.cartesianVisualHost.triggerRender(!1)},p.prototype.setData=function(e){var t,i,r,a=this;this.data=p.getDefaultData(this.style),null!=(t=this.playAxis)&&t.isCurrentlyPlaying()&&this.playAxis.stop(),0<e.length?(t=e[0]||e[1])&&(this.categoryAxisProperties=w.CartesianHelper.getCategoryAxisProperties(t.metadata,!0),this.valueAxisProperties=w.CartesianHelper.getValueAxisProperties(t.metadata,!0),this.dataView=t,i={viewport:this.currentViewport,colors:this.colors,interactivityService:this.interactivityService,categoryAxisProperties:this.categoryAxisProperties,valueAxisProperties:this.valueAxisProperties,style:this.style,tooltipsEnabled:this.tooltipsEnabled,useMatrixDV:!0},r=w.scatterChartConverterModuleFactory(),w.PlayChart.isDataViewPlayable(t)?(this.playAxis||(this.playAxis=new w.PlayAxis({interactivityService:this.interactivityService,isScrollable:!1,featureSwitches:{}}),this.dataView&&w.PlayChart.isDataViewPlayable(this.dataView)&&(this.playAxis,this.playAxis.initData(this.dataInitOptions))),i.useMatrixDV=!1,e=this.playAxis.setData(t,function(e,t,a){return r.scatterConverter(e,i,t,a)}),this.mergeSizeRanges(e),this.data=e.currentViewModel,this.playAxis.setRenderFunction(function(e){return a.renderAtFrame(e)})):(null!=(e=this.playAxis)&&e.remove(),this.playAxis=null,(e=r.scatterConverter(t,i))&&(this.data=e))):(null!=(t=this.playAxis)&&t.remove(),this.playAxis=null),this.originalData=this.data},p.prototype.mergeSizeRanges=function(e){if(e&&e.currentViewModel){for(var t=e.currentViewModel.sizeRange,a=0,i=e.allViewModels;a<i.length;a++){var r=i[a].sizeRange;null!=r.min&&(t.min=Math.min(t.min,r.min)),null!=r.max&&(t.max=Math.max(t.max,r.max))}for(var o=0,s=e.allViewModels;o<s.length;o++)s[o].sizeRange=t}},p.prototype.calculateCustomLegend=function(){var e;return null==(e=this.data)?void 0:e.legendData},p.prototype.hasLegend=function(){var e;return null==(e=this.data)?void 0:e.hasDynamicSeries},p.prototype.enumerateObjectInstances=function(e,t){var a,i=this.originalData;switch(t.objectName){case"colorByCategory":!i||i.hasDynamicSeries||e.pushInstance({objectName:"colorByCategory",selector:null,properties:{show:i.colorByCategory}});break;case"dataPoint":if(this.featureSwitches.playAxisDataColors&&this.playAxis&&this.dataView){if(!w.GradientUtils.hasGradientRoleInMatrix(this.dataView.matrix))return this.playAxis.enumerateDataPoints(e,this.data,this.dataView,this.style)}else if(!this.playAxis&&this.dataView&&!w.GradientUtils.hasGradientRoleInMatrix(this.dataView.matrix))return this.enumerateDataPoints(e);break;case"categoryAxis":e.pushInstance({selector:null,properties:{showAxisTitle:!this.categoryAxisProperties||null==this.categoryAxisProperties.showAxisTitle||this.categoryAxisProperties.showAxisTitle},objectName:"categoryAxis"}),i.xGroupMetadata||e.pushInstance({selector:null,properties:{treatNullsAsZero:!(!i.treatNullsAsZero||!i.treatNullsAsZero.x)},objectName:"categoryAxis"});break;case"valueAxis":e.pushInstance({selector:null,properties:{showAxisTitle:!this.valueAxisProperties||null==this.valueAxisProperties.showAxisTitle||this.valueAxisProperties.showAxisTitle},objectName:"valueAxis"}),i.yGroupMetadata||e.pushInstance({selector:null,properties:{treatNullsAsZero:!(!i.treatNullsAsZero||!i.treatNullsAsZero.y)},objectName:"valueAxis"});break;case"categoryLabels":this.isXAxisCategorical()||(this.data?w.DataLabelViewModel.enumerateCategoryLabels(e,i.dataLabelsSettings,!0,this.featureSwitches,void 0,void 0,this.style):w.DataLabelViewModel.enumerateCategoryLabels(e,null,!0,this.featureSwitches,void 0,void 0,this.style));break;case"fillPoint":i.hasSize||e.pushInstance({objectName:"fillPoint",selector:null,properties:{show:i.fillPoint}});break;case"colorBorder":i.hasSize&&e.pushInstance({objectName:"colorBorder",selector:null,properties:{show:i.colorBorder}});break;case"bubbles":p.enumerateBubbles(e,i,this.dataView);break;case"plotAreaShading":this.isPlotSymettryShadingSupported()?e.pushInstance({selector:null,objectName:"plotAreaShading",properties:{show:i.plotAreaShadingSettings.show,upperShadingColor:i.plotAreaShadingSettings.upperShadingColor,lowerShadingColor:i.plotAreaShadingSettings.lowerShadingColor,transparency:i.plotAreaShadingSettings.transparency}}):e.pushInstance({selector:null,objectName:"plotAreaShading",properties:{},disabledReason:this.hostService.getLocalizedString("Visual_Scatter_SymmetryShadingNotSupported")});break;case"ratioLine":null!=(a=i.xCol)&&a.isMeasure&&null!=(a=i.yCol)&&a.isMeasure&&e.pushInstance({selector:null,objectName:"ratioLine",properties:{show:i.ratioLineSettings.show,lineColor:i.ratioLineSettings.lineColor,transparency:i.ratioLineSettings.transparency,style:i.ratioLineSettings.style}});break;case"general":!i||this.playAxis||this.isXAxisCategorical()||e.pushInstance({selector:null,objectName:"general",properties:{dataVolume:i.dataVolume},validValues:{dataVolume:{numberRange:{min:p.DefaultDataVolume,max:p.MaximumDataVolume}}}})}},p.prototype.resolveFormattingPlaceholder=function(e){return!w.builder.isVisualFormattingSlicePlaceholder(e)||"dataVolume"!==e.name?void 0:this.getDataVolumeSlice()},p.prototype.getDataVolumeSlice=function(){var t=this;if(this.originalData&&!this.playAxis&&!this.isXAxisCategorical())return{item:new w.builder.SimpleFormattingSliceBuilder({uidBuilder:new w.builder.FormattingSliceUidBuilder(new w.builder.FormattingGroupUidBuilder(new w.builder.FormattingCardUidBuilder("visualPlaceholderCard"),"visualPlaceholderGroup"),"dataVolume"),control:new w.builder.NumUpDownBuilder({descriptor:w.scatterChartProps.general.dataVolume,value:this.originalData.dataVolume,options:{minValue:{type:0,value:p.DefaultDataVolume},maxValue:{type:1,value:p.MaximumDataVolume}}}).build(),localize:function(e){return t.hostService.getLocalizedString(e)}}).withCustomDisplayName("Visual_DataVolumeModern").build(),revertToDefaultDescriptors:[w.scatterChartProps.general.dataVolume]}},p.prototype.enumerateDataPoints=function(e){var t=this.originalData;t&&(t.hasDynamicSeries?x.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:w.LegendData.toIEnumerableDataPoints(t.legendData)},this.featureSwitches):x.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:e,dataView:this.dataView,style:this.style,categories:_.map(t.dataPoints,function(e){return{color:e.fill,displayName:e.formattedCategory.getValue(),identity:e.identity}}),fillInstanceKind:3},this.featureSwitches))},p.enumerateBubbles=function(e,t,a){1<t.dataPointSeries.length&&(i=x.DataViewObjects.getValue(a&&a.metadata&&a.metadata.objects,w.scatterChartProps.bubbles.showSeries,!1));var i,a={selector:null,properties:{bubbleSize:w.shapeUtil.invertBubbleSizeMultiplier(t.multiplier),markerShape:t.markerShape},validValues:{bubbleSize:{numberRange:{min:-30,max:100}},markerShape:[w.markerShape.circle,w.markerShape.square,w.markerShape.diamond,w.markerShape.triangle]},objectName:w.scatterChartProps.bubbles.markerShape.objectName};if(null!=i&&(a.properties[w.scatterChartProps.bubbles.showSeries.propertyName]=i),e.pushInstance(a),i)for(var r=0,o=t.dataPointSeries.length;r<o;r++){var s=t.dataPointSeries[r];e.pushContainer({displayName:s.name}),e.pushInstance({selector:x.data.Selector.normalizeSelector(s.identity.getSelector()),properties:{markerShape:s.markerShape},validValues:{markerShape:[w.markerShape.circle,w.markerShape.square,w.markerShape.diamond,w.markerShape.triangle]},objectName:w.scatterChartProps.bubbles.markerShape.objectName}),e.popContainer()}},p.prototype.getMarkersCard=function(t){var i,r,e,o,s=this,n=this.originalData;if(n&&n.dataPointSeries&&0!==n.dataPointSeries.length)return i=x.DataViewObjects.getValue(null==(e=null==(e=this.dataView)?void 0:e.metadata)?void 0:e.objects,w.scatterChartProps.bubbles.showSeries,!0),r=function(e){return s.hostService.getLocalizedString(e)},e=[w.scatterChartObjectProps.bubbles.markerShape,w.scatterChartObjectProps.bubbles.bubbleSize,w.scatterChartObjectProps.bubbles.showSeries,w.scatterChartObjectProps.fillPoint.show,w.scatterChartObjectProps.fillPoint.style,w.scatterChartObjectProps.dataPoint.fill,w.scatterChartObjectProps.dataPoint.showAllDataPoints,w.scatterChartObjectProps.dataPoint.defaultColor,w.scatterChartObjectProps.colorByCategory.show,w.scatterChartObjectProps.categoryAxis.preferredCategoryWidth,w.scatterChartObjectProps.categoryAxis.innerPadding,w.scatterChartObjectProps.colorBorder.show],e=new w.builder.FormattingCardBuilder(new w.builder.FormattingCardUidBuilder("markers"),"Visual_Markers",e,r),o={styleProps:{markerShape:w.scatterChartObjectProps.bubbles.markerShape,markerSize:w.scatterChartObjectProps.bubbles.bubbleSize,fillPointShow:w.scatterChartObjectProps.fillPoint.show,fillPointStyle:w.scatterChartObjectProps.fillPoint.style,showSeries:w.scatterChartObjectProps.bubbles.showSeries,colorBorder:w.scatterChartObjectProps.colorBorder.show},style:{markerShape:n.markerShape,markerSize:w.shapeUtil.invertBubbleSizeMultiplier(n.multiplier),fillPointShow:n.fillPoint,fillPointStyle:n.fillPointStyle,showSeries:i,colorBorder:n.colorBorder},selector:null,hasSize:n.hasSize,showSeries:i},e.addGroup("applySettingsTo",function(e){e.withContainerDisabled(!i).withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",r("All"),function(e){s.addScatterChartMarkersFormattingContainers(o,e),i||e.addSimpleSlice("showSeriesLink",function(){return new w.builder.SeriesDialogLinkBuilder({descriptor:w.scatterChartObjectProps.bubbles.showSeries,value:function(){},ariaLabel:"Enable_This_Setting",type:"SeriesDialogLink",resetToDefaultDescriptors:[w.scatterChartObjectProps.bubbles.markerShape],warningIcon:!0}).build()},function(e){return e.withCustomDisplayName("Enable_This_Setting").withSuppressDisplayName(!0)})}),1<n.dataPointSeries.length)for(var t=0,a=n.dataPointSeries;t<a.length;t++)!function(t){e.addContainerItem(t.name,t.name,function(e){return s.addScatterChartMarkersFormattingContainers(__assign(__assign({},o),{style:__assign(__assign({},o.style),{markerShape:t.markerShape}),selector:x.data.Selector.normalizeSelector(t.identity.getSelector())}),e)})}(a[t])})}),e.addGroup("colors",function(e){e.withDisplayName("Generic_Color"),n.hasDynamicSeries||e.addSimpleSlice("colorByCategory",new w.builder.ToggleSwitchBuilder({descriptor:__assign(__assign({},w.scatterChartObjectProps.colorByCategory.show),{selector:null}),value:n.colorByCategory}).build(),function(e){return e.withCustomDisplayName("Visual_ColorByCategory")}),n.hasDynamicSeries?x.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup({groupBuilder:e,dataPoints:w.LegendData.toIEnumerableDataPoints(n.legendData),seriesColorProps:w.scatterChartObjectProps.dataPoint,localize:r,featureSwitches:s.featureSwitches}):x.colorEnumerationHelperModuleFactory().appendCategoryColorSlicesToGroup({groupBuilder:e,colorProps:w.columnChartProps.dataPoint,featureSwitches:s.featureSwitches,hostService:s.hostService,options:{dataView:s.dataView,style:s.style,categories:n.dataPoints.map(function(e){return{color:e.fill,displayName:e.formattedCategory.getValue(),identity:e.identity}}),fillInstanceKind:3}})}),this.isXAxisCategorical()&&e.addGroup("spacing",function(e){e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerPadding",new w.builder.SliderBuilder({descriptor:w.scatterChartObjectProps.categoryAxis.innerPadding,value:100*t.categoryAxisData.innerPadding,localize:r,options:{minValue:{type:0,value:0},maxValue:{type:1,value:50}}}).build()).addSimpleSlice("maxcategoryWidth",new w.builder.NumUpDownBuilder({descriptor:w.scatterChartObjectProps.categoryAxis.preferredCategoryWidth,value:Math.round(100*t.categoryAxisData.maxMarginFactor),options:{minValue:{type:0,value:20},maxValue:{type:1,value:180}}}).build(),function(e){return e.withCustomDisplayName("Visual_Max_CategoryWidth")})}),e.build()},p.prototype.addScatterChartMarkersFormattingContainers=function(e,t){var a=this,i=e.styleProps,r=e.style,o=e.selector,s=e.hasSize;i&&t.addGroup("shape",function(e){e.withDisplayName("Visual_Shape"),i.markerShape&&e.addSimpleSlice("markerShape",new w.builder.DropdownBuilder({descriptor:__assign(__assign({},i.markerShape),{selector:o}),value:r.markerShape}).build(),function(e){return e.withCustomDisplayName("Type")}),a.featureSwitches.fillPointStyle?e.addSimpleSlice("fillStyle",new w.builder.DropdownBuilder({descriptor:__assign(__assign({},i.fillPointStyle),{selector:o}),value:r.fillPointStyle}).build(),function(e){return e.withCustomDisplayName("Style").withDisabled(s||!!o).withCustomDescriptionIf(function(){return s||!!o},"Visual_Scatter_Size_FormatOption_DisabledReason_FillPoint")}):e.addSimpleSlice("showFill",new w.builder.ToggleSwitchBuilder({descriptor:__assign(__assign({},i.fillPointShow),{selector:o}),value:r.fillPointShow}).build(),function(e){return e.withCustomDisplayName("Visual_FillPoint").withDisabled(s||!!o).withCustomDescriptionIf(function(){return s||!!o},"Visual_Scatter_Size_FormatOption_DisabledReason_FillPoint")}),i.colorBorder&&e.addSimpleSlice("colorBorder",new w.builder.ToggleSwitchBuilder({descriptor:__assign(__assign({},i.colorBorder),{selector:null}),value:r.colorBorder}).build(),function(e){return e.withCustomDisplayName("Visual_ColorBorder").withDisabled(!s).withCustomDescriptionIf(function(){return!s},"Visual_Scatter_Size_FormatOption_DisabledReason")}),i.markerSize&&e.addSimpleSlice("markerSize",new w.builder.SliderBuilder({descriptor:__assign(__assign({},i.markerSize),{selector:o}),value:r.markerSize,options:{minValue:{type:0,value:w.shapeUtil.BubbleSizeRange.min},maxValue:{type:1,value:w.shapeUtil.BubbleSizeRange.max}},localize:void 0}).build(),function(e){return e.withCustomDisplayName("Visual_BubbleSize").withDisabled(!!o)})})},p.prototype.getCategoryLabelsCard=function(){var e,t=this;if(!this.isXAxisCategorical())return w.DataLabelViewModel.getCategoryLabelsCard({cardName:"Visual_CategoryLabel",dataLabelSettings:null!=(e=null==(e=this.data)?void 0:e.dataLabelsSettings)?e:null,isShowCategory:void 0,localize:function(e){return t.hostService.getLocalizedString(e)},props:w.scatterChartObjectProps.categoryLabels,revertToDefaultProps:w.scatterChartObjectProps.categoryLabels,showBackground:!0,showValueColor:!0,style:this.style,featureSwitches:this.featureSwitches})},p.prototype.customizeFormattingCard=function(e){var t;return w.builder.isPlaceholder(e)||("categoryAxis"===e.uid&&(t=this.getCustomizedCategoryAxisCard(e)),"valueAxis"===e.uid&&(t=this.getCustomizedValueAxisCard(e))),t},p.prototype.getCustomizedCategoryAxisCard=function(e){var a=this,i=__spreadArray([],e.groups,!0);return i.forEach(function(e,t){w.builder.isPlaceholder(e)||e.uid==="".concat("categoryAxis","-").concat("valuesScalar")&&(i[t]=a.getNewValuesGroup(e,!0))}),__assign(__assign({},e),{revertToDefaultDescriptors:__spreadArray(__spreadArray([],e.revertToDefaultDescriptors,!0),[w.scatterChartProps.categoryAxis.treatNullsAsZero],!1),groups:i})},p.prototype.getCustomizedValueAxisCard=function(e){var a=this,i=__spreadArray([],e.groups,!0);return i.forEach(function(e,t){w.builder.isPlaceholder(e)||e.uid==="".concat("valueAxis","-").concat("values")&&(i[t]=a.getNewValuesGroup(e,!1))}),__assign(__assign({},e),{revertToDefaultDescriptors:__spreadArray(__spreadArray([],e.revertToDefaultDescriptors,!0),[w.scatterChartProps.valueAxis.treatNullsAsZero],!1),groups:i})},p.prototype.getNewValuesGroup=function(e,t){var a=__spreadArray([],e.slices,!0),i=w.builder.FormattingUidBuilder.fromGroup(e),i=this.getShowBlankValuesSlice(i,t);return i&&a.push(i),__assign(__assign({},e),{slices:a})},p.prototype.getShowBlankValuesSlice=function(e,t){var a=this,i=this.originalData,r=t?i.xGroupMetadata:i.yGroupMetadata,o=(t?w.scatterChartProps.categoryAxis:w.scatterChartProps.valueAxis).treatNullsAsZero,t=t?!(!i.treatNullsAsZero||!i.treatNullsAsZero.x):!(!i.treatNullsAsZero||!i.treatNullsAsZero.y);if(!r)return i={type:"ToggleSwitch",properties:{descriptor:__assign(__assign({},o),{selector:null}),value:t}},new w.builder.SimpleFormattingSliceBuilder({control:i,localize:function(e){return a.hostService.getLocalizedString(e)},uidBuilder:e.withSlice("showblankvalues")}).build()},p.prototype.getFormattingCards=function(e){var t=this;return{card:[function(){return t.getMarkersCard(e)},function(){return t.getCategoryLabelsCard()}].reduce(function(e,t){t=t();return t&&e.push(t),e},[]),type:2}},p.prototype.supportsTrendLine=function(){var e=this.data;return!(!e||this.isXAxisCategorical()||this.playAxis)&&!e.hasSize&&(e.hasCategory||e.hasDynamicSeries)&&!!e.xCol&&!!e.yCol},p.prototype.supportsStaticReferenceLines=function(){return this.data&&!this.isXAxisCategorical()},p.prototype.getAxisLocationForRole=function(e){return"X"===e?0:1},p.getExtents=function(e){var t,a={},i=e.dataPoints;return _.isEmpty(i)?{minY:0,maxY:0,formatStringY:void 0,minX:0,maxX:0,formatStringX:void 0}:((e=(t=!!e.xGroupMetadata)&&e.xGroupMetadata.isCategoricalAxis)||(a.minX=d3.min(i,function(e){return e.x}),a.maxX=d3.max(i,function(e){return e.x}),a.formatStringX=_.first(i).xFormatString),t&&!e&&(i=_.filter(i,function(e){return null!=e.x})),a.minY=d3.min(i,function(e){return e.y}),a.maxY=d3.max(i,function(e){return e.y}),a.formatStringY=null==(t=_.first(i))?void 0:t.yFormatString,a)},Object.defineProperty(p.prototype,"availableWidth",{get:function(){return Math.max(0,this.currentViewport.width-(this.margin.left+this.margin.right))},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"availableHeight",{get:function(){return Math.max(0,this.currentViewport.height-(this.margin.top+this.margin.bottom))},enumerable:!1,configurable:!0}),p.prototype.calculateAxesProperties=function(n){function e(e){var t="x"===e,a="y"===e,i=t?c:u,r=t&&l.isXAxisCategorical(),o=r?{domain:_.uniq(_.map(l.data.dataPoints,function(e){return e.categoryIndex})),type:0}:(o=w.AxisHelper.createScalarDomainOptions(t?h.categoryAxis:h.valueAxis,0),w.AxisHelper.mergeScalarAxisDomains(i.includeDomain,o)),s=t?l.data.xCol:l.data.yCol,a={pixelSpan:t?l.availableWidth:l.availableHeight,domainOptions:o,metaDataColumn:s,axisZoom:n.axisZoom,zeroScalarDomain:p.DefaultZeroScalarDomain,isScalar:a||!r,isCategoryAxis:t,isVertical:a,formatString:(t?d.formatStringX:d.formatStringY)||w.valueFormatter.getFormatString(s,w.scatterChartProps.general.formatString),outerPadding:0,forcedTickCount:n.forcedTickCount,useTickIntervalForDisplayUnits:!0,logAxisScale:i.logAxisScale,axisDisplayUnits:i.displayUnits,axisPrecision:i.precision,margin:l.margin,preventNice:r?void 0:w.AxisHelper.hasForcedDomain(o),invertAxis:i.invertAxis};return r&&(s=l.getCategoryLayout(a.domainOptions.domain,n),a=__assign(__assign({},a),{outerPadding:s.outerPaddingRatio,categoryThickness:s.categoryThickness,innerPaddingRatio:s.innerPaddingRatio,outerPaddingRatio:s.outerPaddingRatio,getValueFn:function(t,e){var a=_.find(l.data.dataPoints,function(e){return e.categoryIndex===t});return null==a?void 0:a.formattedCategory.getValue()}})),(o=w.AxisHelper.createAxis(a)).axisLabel=l.data.axesLabels[e],t&&(o.axis.tickSizeInner(-l.availableHeight).tickSizeOuter(0),r)&&(o.categoryIdentities=l.data.categoryIdentities),o}var l=this,c=n.categoryAxisOptions,u=n.valueAxisOptions,d=(this.currentViewport=n.viewport,this.margin=n.margin,this.viewModelAdapterFactory&&this.originalData&&(this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=this.viewModelAdapter.getData()),{minY:0,maxY:10,formatStringY:void 0,formatStringX:void 0,minX:0,maxX:10}),h=(this.playAxis?(d=this.playAxis.getCartesianExtents(d,p.getExtents),this.playAxisControlLayout=n.playAxisControlLayout):_.isEmpty(this.data.dataPoints)||(d=p.getExtents(this.data)),this.getAxesDomains(!1,{categoryAxis:!this.isXAxisCategorical(),valueAxis:!0}));return this.xAxisProperties=e("x"),this.yAxisProperties=e("y"),[this.xAxisProperties,this.yAxisProperties]},p.prototype.getAxesDomains=function(e,t){var a,i={},r=this.data;return r&&(a={minY:0,maxY:10,formatStringY:void 0,formatStringX:void 0,minX:0,maxX:10},this.playAxis?a=this.playAxis.getCartesianExtents(a,p.getExtents):_.isEmpty(r.dataPoints)||(a=p.getExtents(r)),t.categoryAxis&&!this.isXAxisCategorical()&&(i.categoryAxis=[a.minX,a.maxX]),t.valueAxis)&&(i.valueAxis=[a.minY,a.maxY]),i},p.prototype.setAxesLayout=function(e){},p.prototype.getCategoryLayout=function(e,t){return w.CartesianChartLayout.getLayout(void 0,{availableWidth:this.availableWidth,categoryCount:_.size(_.uniqBy(this.data.dataPoints,function(e){return e.categoryIndex})),preferredCategoryWidth:w.CartesianHelper.getPreferredCategoryWidth(w.CartesianHelper.getCategoryAxisProperties(this.dataView.metadata)),domain:e,isScalar:!this.isXAxisCategorical(),isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:t.trimOrdinalDataOnOverflow,outerPaddingRatio:t.outerPaddingRatio,innerPaddingRatio:t.innerPaddingRatio})},p.prototype.getPreferredPlotArea=function(e,t,a,i){return w.CartesianChartLayout.getPreferredPlotArea(t,a,this.currentViewport,this.isScrollable,e,this.margin,i=void 0===i?0:i)},p.prototype.setFilteredData=function(a,i){var e;this.isXAxisCategorical()&&((e=this.data=x.Prototype.inherit(this.originalData)).dataPoints=_.filter(e.dataPoints,function(e){return e.categoryIndex>=a&&e.categoryIndex<i}),e.dataPointSeries=_.map(e.dataPointSeries,function(e){var t=x.Prototype.inherit(e),e=_.filter(e.dataPoints,function(e){return e.categoryIndex>=a&&e.categoryIndex<i});return t.dataPoints=e,t}))},p.prototype.overrideXScale=function(e){this.xAxisProperties=e},p.prototype.shouldSuppressAnimation=function(){var e;return(null==(e=null==(e=this.data)?void 0:e.dataPoints)?void 0:e.length)>p.NoAnimationThreshold},p.prototype.render=function(e,t,a){var i,r,o,s,n,l,c,u;if(this.data)return this.playAxis&&!this.playAxis.isRendererInitialized()&&this.playAxis.initRenderer({svg:this.svg}),i=this.data,r=null==(r=this.interactivityService)?void 0:r.hasSelection(),n=w.AnimatorCommon.GetAnimationDuration(this.animator,e),this.playAxis&&this.playAxis.isCurrentlyPlaying()&&(this.isMobileChart||0<n)&&(n=w.PlayChart.getFrameAnimationDuration()),l=this.data.hasSize,s=this.featureSwitches.fillPointStyle?i.fillPointStyle===w.fillStyle.fillOnly:i.fillPoint,s=!l&&s,o=this.isXAxisCategorical(),s={data:i,allData:this.originalData,currentViewport:this.currentViewport,drawBubbles:l,isPlay:!!this.playAxis,hasCategoricalAxis:o,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,plotArea:{width:this.availableWidth,height:this.availableHeight},hasSelection:r,animationDuration:n,animationOptions:this.animationOptions,fillMarkers:s,easeType:this.playAxis?d3.easeLinear:d3.easeCubicInOut,suppressDataPointRendering:1===t&&(null==(n=i.dataPoints)?void 0:n.length)>p.NoRenderResizeThreshold,supportsPlotAreaSymmetryShading:this.isPlotSymettryShadingSupported()},l&&!o&&(t=i.dataPoints.sort(p.sortBubbles),s.data=x.Prototype.inherit(s.data),s.data.dataPoints=t),n=[],(i.dataLabelsSettings&&i.dataLabelsSettings.show||i.dataLabelsSettings.showCategory)&&(n=d.createLabelDataPoints(s,this.style)),(l=this.renderer.render(s,this.interactivityService,this.hostService,this.style,a)).hitTester=new h({dataPoints:l.data.dataPoints,margin:this.margin}),this.isMobileChart&&(l={data:l.data,dataPointsSelection:l.dataPointsSelection,eventGroup:l.eventGroup,root:l.root,host:this.cartesianVisualHost,mobileRoot:this.svg,visualDataInitOptions:this.dataInitOptions,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,background:d3.select(this.element.get(0)),visualInstanceId:l.visualInstanceId,eventManager:l.eventManager}),this.playAxis&&(this.playAxisControlLayout,this.playAxis.setPlayControlPosition(this.playAxisControlLayout),c=this.playAxis.render(e,s,this.currentViewport,this.margin),this.interactivityService)&&(t={traceLineRenderer:this.renderer.createTraceLineRenderer(c.viewModel)},r&&w.PlayChart.renderTraceLines(c.allDataPoints,t.traceLineRenderer,!e),l.playOptions=t),this.interactivityService&&(a=w.DataPointNavigationStrategy.SeriesFirst,o?a=w.DataPointNavigationStrategy.CategoryFirst:this.data.hasDynamicSeries||(a=w.DataPointNavigationStrategy.CategoryOnly),u={navigationStrategy:a,helper:this.renderer}),{dataPoints:null!=(s=null==c?void 0:c.allDataPoints)?s:i.dataPoints,behaviorOptions:l,navigationOptions:u,labelDataPoints:n,labelsAreNumeric:!1,animateLabels:!0}},p.getStrokeFill=function(e,t){return null!=e.size&&(t=t&&i.parseColorString(e.fill))?i.hexString(i.darken(t,p.StrokeDarkenColorValue)):e.fill},p.getMarkerFillOpacity=function(e,t,a,i){return e||t?a&&!i?p.DimmedBubbleOpacity:p.DefaultBubbleOpacity:0},p.getMarkerStrokeOpacity=function(e,t,a,i){return e&&t?1:a&&!i?p.DimmedBubbleOpacity:p.DefaultBubbleOpacity},p.getMarkerStrokeFill=function(e,t,a){return e&&t&&(e=i.parseColorString(a))?i.hexString(i.darken(e,p.StrokeDarkenColorValue)):a},p.getMarkerStyle=function(e,t,a,i){return{"stroke-opacity":p.getMarkerStrokeOpacity(null!=e.size,t,a,e.selected),stroke:p.getMarkerStrokeFill(null!=e.size,t,e.fill),fill:e.fill,"fill-opacity":p.getMarkerFillOpacity(null!=e.size,i,a,e.selected)}},p.getSeriesStyle=function(e,t,a,i,r){return{"stroke-opacity":p.getMarkerStrokeOpacity(e,t,a,!1),stroke:null,fill:r,"fill-opacity":p.getMarkerFillOpacity(e,i,a,!1)}},p.getBubbleOpacity=function(e,t){return t&&!e.selected?p.DimmedBubbleOpacity:p.DefaultBubbleOpacity},p.prototype.getCategoryValueType=function(){return w.AxisHelper.getCategoryValueType(this.data.xCol)},p.prototype.onClearSelection=function(){var e;null!=(e=this.interactivityService)&&e.clearSelection()},p.prototype.getSupportedCategoryAxisType=function(){return this.data.xGroupMetadata?this.data.xGroupMetadata.isScalarType?w.axisType.both:w.axisType.categorical:w.axisType.scalar},p.prototype.getVisualCategoryAxisIsScalar=function(){return!this.isXAxisCategorical()},p.sortBubbles=function(e,t){if(e.radius.sizeMeasure){var a=t.radius.sizeMeasure.values[t.radius.index]-e.radius.sizeMeasure.values[e.radius.index];if(0!=a)return a}else if(null!=e.radius.value)return t.radius.value-e.radius.value;return t.identity.getKey().localeCompare(e.identity.getKey())},p.prototype.getSubSelectionMetadata=function(e){return{visualObject:e}},p.onMarkerSubSelection=function(e){var t=e.element,a=e.series,i=e.subSelectionHelper,r=e.d3Event,o=e.hostServices,e=e.showUI,s=null==(s=a.identity)?void 0:s.getSelectorsByColumn(),a=o.getLocalizedString("MiniToolbar_Markers",null!=(a=a.name)?a:o.getLocalizedString("All")),o={x:r.clientX,y:r.clientY,offset:15},r=i.createVisualSubSelectionForSingleObject(__assign({objectName:"markers",subSelectionType:3,displayName:a,showUI:e,selectorsByColumn:s,selectionOrigin:o},t?{metadata:{visualObject:t}}:{}));i.subSelect(r)},p.prototype.getSubSelectionShortcuts=function(e){e=_.first(e).visualObjects;if(0<e.length){var t,e=e[0];switch(_.isEmpty(e.selectorsByColumn)||(t=c.normalizeSelector(c.convertSelectorsByColumnToSelector(e.selectorsByColumn))),e.objectName){case"markers":var a="".concat("Visual","-").concat("categoryLabels");return[{type:0,excludedResetSourceUids:[{sourceUid:a}]},{type:2,sourceUid:a,enabledLabel:this.hostService.getLocalizedString("Visual_Add_CategoryLabel")},{type:3,sourceUid:"".concat("markers","-").concat("applySettingsTo","-series--").concat("shape","-markerShape"),label:this.hostService.getLocalizedString("Visual_MarkerShape"),selector:t},{type:3,sourceUid:"".concat("markers","-").concat("applySettingsTo","-series--").concat("shape","-fillStyle"),label:this.hostService.getLocalizedString("Visual_MarkerStyle"),selector:void 0},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("markers")}],label:this.hostService.getLocalizedString("Format_Markers")}];case"category-labels":a="".concat("Visual","-").concat("categoryLabels");return[{type:2,sourceUid:a,disabledLabel:this.hostService.getLocalizedString("Delete"),selector:void 0,keyboardShortcuts:[{key:"Delete",nextValue:!1}]},{type:0,relatedResetSourceUids:[{sourceUid:"".concat("categoryLabels","-").concat("background","-show")}],excludedResetSourceUids:[{sourceUid:a}]},{type:1,destinationUids:[{cardUid:a,groupUid:"".concat("categoryLabels","-").concat("values")}],label:this.hostService.getLocalizedString("Format_Category_Labels")}];default:return}}},p.prototype.getSubSelectionStyles=function(e){var e=_.first(e).visualObjects;if(0<e.length){(e=e[0])&&e.selectorsByColumn&&(l=c.normalizeSelector(c.convertSelectorsByColumnToSelector(e.selectorsByColumn)));var t=this.originalData.fillPointStyle.includes("Fill"),a=1===this.data.dataPointSeries.length;switch(e.objectName){case"markers":var i="".concat("Visual","-").concat("markers"),r="".concat("markers","-").concat("colors"),o="".concat("markers","-").concat("colors","-datapoint"),s="".concat("markers","-").concat("colors","-defaultColor"),n={data:[x.data.DataViewWildcard.create(1)]},l=a?n:l;return w.OnObjectUtil.getShapeSubSelectionStyles(i,r,a?s:o,this.hostService,!t,t,l);case"category-labels":n="".concat("Visual","-").concat("categoryLabels"),i="".concat("categoryLabels","-").concat("values");return w.OnObjectUtil.getFontOnlyTextSubSelectionStyles(this.hostService,{fontReference:{cardUid:n,groupUid:i,sliceUid:"".concat(i,"-font")},fontColorReference:{cardUid:n,groupUid:i,sliceUid:"".concat(i,"-color")},backgroundReference:{cardUid:n,groupUid:i,sliceUid:"".concat("categoryLabels","-background-color")}},void 0);case"data-labels":return w.OnObjectUtil.getDataLabelsSubSelectionStyles({hostServices:this.hostService,omitSelectorForSingleSeries:a,individualSelector:!1,selector:l,repetitionSelector:void 0,inContainer:!0});default:return}}},p.prototype.getDataViewObjectLayerChanges=function(e){var t;return this.featureSwitches.onObject?(t=[w.TopLevelToggleBehavior.create({objectName:"categoryLabels",propertyName:"backgroundColor"},this.data.dataLabelsSettings.enableBackground).onToggleEnabled(w.AddDataViewObjectChange.createBooleanDataViewObjectChange({objectName:"categoryLabels",propertyName:"enableBackground"},!0))],w.DataViewObjectChangeHelper.getDataViewObjectsBehaviorChanges(e,t)):[]},p.prototype.getSubSelectionCustomOutlines=function(e){for(var t=e.metadata,a=[],i=0,r=e.visualObjects;i<r.length;i++){var o=r[i].objectName,s=null==t?void 0:t.visualObject;if(s&&"markers"===o){o=d3.select(s).datum(),o=this.data.dataPointSeries[o.seriesIndex];if(o.dataPoints.length<=w.MARKERS_MAX_COUNT_THRESHOLD)return this.getSubselectionDefaultOutlines(o);var n=this.currentViewport.scale,n=this.getGroupBoundingRect(o.dataPoints,n,this.renderer.mainGraphicsContext),s=s.getBoundingClientRect(),l=Math.max(s.height,w.MIN_OUTLINE_SIZE),c=Math.max(s.width,w.MIN_OUTLINE_SIZE),s={x:s.x,y:s.y,height:l,width:c},l=o.identityKey;a.push(p.getMarkerOutlinesForSeries({rectangles:[n,s],identityKey:l},this.renderer.mainGraphicsContext,this.currentViewport,this.margin))}}return a},p.prototype.getSubselectionDefaultOutlines=function(e){var t=[],a=this.renderer.mainGraphicsContext,i=this.currentViewport.scale,r=a.node().getBoundingClientRect(),o=r.left,s=r.top,r=a.node().getBBox(),n=r.x,l=r.y,c={type:1,x:o-n,y:s-l,height:(this.currentViewport.height-this.margin.top-this.margin.bottom)*i,width:(this.currentViewport.width-this.margin.left-this.margin.right)*i},a=e.dataPoints.map(function(e){var t=Math.max(2*e.geometry.size*i,w.MIN_OUTLINE_SIZE);return{x:(e.geometry.x-n)*i-t/2+o,y:(e.geometry.y-l)*i-t/2+s,width:t,height:t,type:1,clipPath:c}}),r=e.identityKey;return t.push({id:r,outline:{type:0,outlines:a}}),t},p.getMarkerOutlinesForSeries=function(e,t,a,i){for(var r=e.rectangles,e=e.identityKey,o=t.node().getBoundingClientRect(),s=o.left,o=o.top,n=[],t=t.node().getBBox(),l=t.x,t=t.y,c=a.scale,u={type:1,x:s-l,y:o-t,height:(a.height-i.top-i.bottom)*c,width:(a.width-i.left-i.right)*c},d=0,h=r;d<h.length;d++){var p=h[d];n.push({x:p.x,y:p.y,width:p.width,height:p.height,type:1,clipPath:u})}return{id:e,outline:{type:0,outlines:n}}},p.prototype.getGroupBoundingRect=function(e,t,a){var r,i=a.node().getBoundingClientRect(),o=i.left,i=i.top,a=a.node().getBBox(),s=a.x,a=a.y,e=e.reduce(function(e,t){var t=(r=t.geometry).size,a=r.x,i=r.y;return e.xMin=Math.min(a-t,e.xMin),e.yMin=Math.min(i-t,e.yMin),e.xMax=Math.max(a+t,e.xMax),e.yMax=Math.max(i+t,e.yMax),e},{xMin:Number.MAX_SAFE_INTEGER,yMin:Number.MAX_SAFE_INTEGER,xMax:Number.MIN_SAFE_INTEGER,yMax:Number.MIN_SAFE_INTEGER}),n=e.xMin,l=e.yMin,c=e.xMax,e=e.yMax,c=(c-n)*t,e=Math.round(10+(e-l)*t),c=Math.round(10+c),n=(n-s)*t,s=Math.ceil((l-a)*t-5+i);return{x:Math.ceil(n-5+o),y:s,height:e,width:c}},p.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},p.prototype.getStaticSeriesRole=function(){},p.prototype.addWarnings=function(e){var t;null!=(t=this.viewModelAdapter)&&t.addWarnings(e)},p.prototype.isXAxisCategorical=function(){var e;return null==(e=null==(e=this.data)?void 0:e.xGroupMetadata)?void 0:e.isCategoricalAxis},p.prototype.isPlotSymettryShadingSupported=function(){var e;return!(this.isXAxisCategorical()||null!=(e=this.valueAxisProperties)&&e.logAxisScale||null!=(e=this.categoryAxisProperties)&&e.logAxisScale)},p.prototype.getSelectorsByColumnFromSubselectedElement=function(e){switch(d3.select(e).attr(w.SubSelectableObjectNameAttribute)){case"markers":case"category-labels":var t=d3.select(e).datum(),t=this.data.dataPointSeries[t.seriesIndex],t=null==(t=null==t?void 0:t.identity)?void 0:t.getSelectorsByColumn();if(t)return t;break;default:return}},p.DefaultBubbleOpacity=.85,p.DimmedBubbleOpacity=.4,p.StrokeDarkenColorValue=63.75,p.ClassName="scatterChart",p.NoAnimationThreshold=1e3,p.NoRenderResizeThreshold=1e3,p.DefaultDataVolume=3500,p.MaximumDataVolume=1e4,p.DefaultZeroScalarDomain=[-1,1],p.DefaultPlotAreaShadingSettings={show:!1,upperShadingColor:null,lowerShadingColor:null,transparency:70},p);function p(e){e&&(this.tooltipsEnabled=e.tooltipsEnabled,this.interactivityService=e.interactivityService,this.viewModelAdapterFactory=e.viewModelAdapterFactory,this.isScrollable=e.isScrollable),this.renderer=x.scatterChartRendererModuleFactory().create()}w.ScatterChart=e,C=[2,1,8,4,16,32,64,128],(d=d||{}).createLabelDataPoints=function(e,t){for(var a,i,r,o,s=e.xAxisProperties.scale,n=e.yAxisProperties.scale,l=e.data.sizeRange,c=e.data.multiplier,u=[],d=e.data.dataPoints,h=e.data.dataLabelsSettings,p=(i=(a=e).plotArea.width,r=a.plotArea.height,o=new w.Point(i/2,r/2),i=function(e,t){var a=[],e=e/4,t=t/4;return a.push(new w.Point(e,t)),a.push(new w.Point(3*e,t)),a.push(new w.Point(e,3*t)),a.push(new w.Point(3*e,3*t)),a}(i,r),function(e,t,a){for(var i=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],r=[],o=a.xAxisProperties.scale,s=a.yAxisProperties.scale,n=0,l=a.data.dataPoints;n<l.length;n++){var c=l[n],u=o(c.x),d=s(c.y),h=function(e,t,a){return e>a.x&&t<=a.y?0:e<=a.x&&t<=a.y?1:e<=a.x&&t>a.y?2:3}(u,d,e);a.drawBubbles?r[h]||(r[h]=c.identity):(u=function(e,t,a,i){return Math.sqrt((e-a)*(e-a)+(t-i)*(t-i))}(t[h].x,t[h].y,u,d))<i[h]&&(r[h]=c.identity,i[h]=u)}for(var p=[],g=0,y=r;g<y.length;g++){var m=y[g];m&&p.push(m.getKey())}return p}(o,i,a)),g=0,y=d;g<y.length;g++){var m=y[g],v=m.formattedCategory.getValue(),S=h.fontProperties,f=w.FontProperties.toTextProperties(S,v),b=x.TextMeasurementService.measureSvgTextWidth(f),f=x.TextMeasurementService.estimateSvgTextHeight(f);u.push({isPreferred:!!p&&function(e,t){for(var a=0,i=t;a<i.length;a++){var r=i[a];if(0===e.localeCompare(r))return!0}return!1}(m.identity.getKey(),p),text:v,textSize:{width:b,height:f},outsideFill:S.color||w.ColorHelper.getThemeColor(t,w.DataLabelViewModel.DefaultLabelColorName),insideFill:w.ColorHelper.getThemeColor(t,w.DataLabelViewModel.DefaultInsideLabelColorName),parentType:0,parentShape:{point:{x:s(m.x),y:n(m.y)},radius:w.CartesianHelper.getBubbleRadius(m.radius,l,e.plotArea,c),validPositions:C},identity:m.renderIdentity,fontProperties:S,hasBackground:h.enableBackground,backgroundColor:h.backgroundColor,backgroundTransparency:h.backgroundTransparency,isCategory:!0})}return u},t.prototype.queryRegion=function(e){var a=this,i=w.extractBoundingRectFromLasso(e,!1);return this.adjustPositionRelativeToRoot(i),_.filter(this.dataPoints,function(e){if(void 0===e.size)return a.isPointInRect(i,e.geometry);var t;switch(e.geometry.markerShape){case w.markerShape.circle:t=w.shapes.Polygon.circleRectangleOverlap(i,{x:e.geometry.x,y:e.geometry.y},e.geometry.size);break;case w.markerShape.square:t=a.isSquareMarkerIntersect(e.geometry,i);break;case w.markerShape.diamond:t=a.isDiamondMarkerIntersect(e.geometry,i);break;case w.markerShape.triangle:t=a.isTriangleMarkerIntersect(e.geometry,i);break;default:t=!1}return t})},t.prototype.isSquareMarkerIntersect=function(e,t){e={left:e.x-e.size,right:e.x+e.size,top:e.y-e.size,bottom:e.y+e.size};return w.shapes.Rect.overlappingRange(e.left,e.right,t.left,t.right)&&w.shapes.Rect.overlappingRange(e.top,e.bottom,t.top,t.bottom)},t.prototype.isDiamondMarkerIntersect=function(e,t){if(!this.isSquareMarkerIntersect(e,t))return!1;if(this.isPointInRect(t,e))return!0;for(var a=[{x:e.x-e.size,y:e.y},{x:e.x,y:e.y-e.size},{x:e.x+e.size,y:e.y},{x:e.x,y:e.y+e.size}],i=[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.right,y:t.bottom},{x:t.left,y:t.bottom}],r=[[i[0],i[1]],[i[1],i[2]],[i[3],i[2]],[i[0],i[3]]],o=0,s=[[a[0],a[1]],[a[1],a[2]],[a[0],a[3]],[a[3],a[2]]];o<s.length;o++)for(var n=s[o],l=0,c=r;l<c.length;l++){var u=c[l];if(w.shapes.Polygon.linesIntersect(n[0],n[1],u[0],u[1],!1))return!0}return this.isLassoInShape(e,t)},t.prototype.isPointInRect=function(e,t){return x.Double.lessOrEqualWithPrecision(e.left,t.x)&&x.Double.lessOrEqualWithPrecision(t.x,e.right)&&x.Double.lessOrEqualWithPrecision(e.top,t.y)&&x.Double.lessOrEqualWithPrecision(t.y,e.bottom)},t.prototype.isLassoInShape=function(e,t){e={left:e.x-e.size,right:e.x+e.size,top:e.y-e.size,bottom:e.y+e.size};return w.shapes.Rect.overlappingRange(t.left,t.right,e.left,e.right)&&w.shapes.Rect.overlappingRange(t.top,t.bottom,e.top,e.bottom)},t.prototype.isTriangleMarkerIntersect=function(e,t){if(!this.isSquareMarkerIntersect(e,t))return!1;if(this.isPointInRect(t,e))return!0;for(var a=[{x:e.x-e.size,y:e.y+e.size},{x:e.x,y:e.y-e.size},{x:e.x+e.size,y:e.y+e.size}],i=[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.right,y:t.bottom},{x:t.left,y:t.bottom}],r=[[i[0],i[1]],[i[1],i[2]],[i[3],i[2]],[i[0],i[3]]],o=0,s=[[a[0],a[1]],[a[1],a[2]],[a[0],a[2]]];o<s.length;o++)for(var n=s[o],l=0,c=r;l<c.length;l++){var u=c[l];if(w.shapes.Polygon.linesIntersect(n[0],n[1],u[0],u[1],!1))return!0}return this.isLassoInShape(e,t)},t.prototype.adjustPositionRelativeToRoot=function(e){e.left-=this.margin.left,e.top-=this.margin.top,e.right-=this.margin.left,e.bottom-=this.margin.top};var h=t;function t(e){this.dataPoints=e.dataPoints,this.margin=e.margin}w.ScatterChartHitTester=h}(powerbi=powerbi||{}),function(e){var u=e.visuals||(e.visuals={}),i=jsCommon.BrowserUtils,e=jsCommon.CssConstants.createClassAndSelector,t=jsCommon.PerfTimer;function a(){}a.prototype.create=function(){return new r},u.ScatterChartWebBehaviorFactory=a,o.prototype.bindEvents=function(a,i,e,t){var r,o,s=this.bubbles=a.dataPointsSelection,n=a.data,l=a.eventGroup,n=(!this.playOptions||!this.playOptions.traceLineRenderer||a.playOptions&&a.playOptions.traceLineRenderer||this.playOptions.traceLineRenderer.remove(),this.playOptions=a.playOptions,this.shouldEnableFill=a.fillMarkers,this.colorBorder=n.colorBorder,this.hitTester=a.hitTester,this.rootSelection=a.root),c=this.visualInstanceId=a.visualInstanceId;e&&(r=e.dataPointNavigationManager,o=e.pointSourceKey),u.InteractivityUtils.appendUseElementForFocus(n,c,o),this.selectionHandler=i,t?(l?u.InteractivityUtils.removeGroupSelectionHandler(a.eventManager,l):u.InteractivityUtils.removeStandardInteractivityHandlers(s),s.on("contextmenu",function(e){var t=d3.event;a.onMarkerSubSelection(this,e,i.getSubSelectionHelper(),t,!0),u.EventBubblingUtil.markAsHandled(t)}),s.on("click",function(e){var t=d3.event;a.onMarkerSubSelection(this,e,i.getSubSelectionHelper(),t,!1),u.EventBubblingUtil.markAsHandled(t)})):l?u.InteractivityUtils.registerGroupInteractivityHandlers(a.eventManager,l,i):u.InteractivityUtils.registerStandardInteractivityHandlers(s,i),r&&!r.isEmpty(o)&&(u.InteractivityUtils.registerEnterPlotAreaHandler(n,r,o),u.InteractivityUtils.registerDataPointNavigationHandler(n,r,o),u.InteractivityUtils.registerClearCatcherShortcut(n,i))},o.prototype.renderSelection=function(t){var e,a,i=this.shouldEnableFill,r=this.colorBorder;this.bubbles.styles({"fill-opacity":function(e){return u.ScatterChart.getMarkerFillOpacity(null!=e.size,i,t,e.selected)},"stroke-opacity":function(e){return u.ScatterChart.getMarkerStrokeOpacity(null!=e.size,r,t,e.selected)}}),this.playOptions&&this.bubbles&&(e=this.bubbles.filter(function(e){return e.selected}).data(),a=this.playOptions.traceLineRenderer,e&&0<e.length&&null!=a?a.render(e,!0):a.remove())},o.prototype.renderFocus=function(e){var t,a="".concat(u.CurrentFocusDataPointId,"-").concat(this.visualInstanceId);this.rootSelection.select("#".concat(a)).attr("id",null),e&&(this.bubbles.attr("aria-label",null),(t=d3.select(e).datum())&&e.setAttribute("aria-label",u.tooltipUtils.formatTooltipInfo(t.tooltipInfo())),e.setAttribute("id",a),i.focus(e))},o.prototype.lassoSelectRectLayer=function(e){return this.hitTester.queryRegion(e)},o.prototype.getLassoSelectDirectionMode=function(){return 1};var r=o;function o(){}function s(){}u.ScatterChartWebBehavior=r,s.prototype.create=function(){return new n},u.ScatterChartMobileBehaviorFactory=s,l.prototype.bindEvents=function(e,t,a){this.setOptions(e),e.visualDataInitOptions&&e.visualDataInitOptions.interactivity.isInteractiveLegend&&(this.makeDataPointsSelectable(e.dataPointsSelection),this.makeRootSelectable(e.mobileRoot),this.makeDragable(e.mobileRoot),this.disableDefaultTouchInteractions(e.mobileRoot),this.selectRoot())},l.prototype.renderSelection=function(e){},l.prototype.setSelectionHandler=function(e){},l.prototype.makeDataPointsSelectable=function(){for(var a=this,e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=0,r=e.length;i<r;i++)e[i].on("click",function(e,t){a.select(t)})},l.prototype.makeRootSelectable=function(e){var t=this;e.on("click",function(){return t.selectRoot()})},l.prototype.makeDragable=function(){for(var e=this,t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];for(var i=0,r=t.length;i<r;i++){var o=t[i],s=d3.drag().on("drag",function(){e.drag(0)}).on("end",function(){e.drag(1)});o.call(s)}},l.prototype.disableDefaultTouchInteractions=function(e){e.style("touch-action","none")},l.prototype.setOptions=function(e){this.data=e.data,this.mainGraphicsContext=e.root,this.xAxisProperties=e.xAxisProperties,this.yAxisProperties=e.yAxisProperties,this.host=e.host},l.prototype.select=function(e){this.selectDotByIndex(e)},l.prototype.selectRoot=function(){var e=t.start("selectRoot");this.onClick(),e()},l.prototype.drag=function(e){switch(e){case 0:this.onDrag();break;case 1:this.onClick()}},l.prototype.onDrag=function(){var e=this.getMouseCoordinates(),e=(this.moveCrosshairToXY(e.x,e.y),this.findClosestDotIndex(e.x,e.y));this.selectDot(e),this.updateLegend(e)},l.prototype.onClick=function(){var e=this.getMouseCoordinates(),e=this.findClosestDotIndex(e.x,e.y);-1!==e&&this.selectDotByIndex(e)},l.prototype.getMouseCoordinates=function(){var e=this.mainGraphicsContext,t=0;i=(i=parseInt(e.attr("height"),10))||0;try{var a=d3.mouse(e.node()),t=a[0],i=a[1]}catch(e){}return{x:t,y:i}},l.prototype.selectDotByIndex=function(e){this.selectDot(e),this.moveCrosshairToIndexDot(e),this.updateLegend(e)},l.prototype.selectDot=function(a){var i=this,e=this.mainGraphicsContext;e.selectAll(l.ScatterMarker.selector).classed("selected",!1).classed("notSelected",!0),e.selectAll(l.ScatterMarker.selector).filter(function(e){var t=i.data.dataPoints,t=("dataPoints length:".concat(t.length,"is smaller than index:").concat(a),t[a]);return e.x===t.x&&e.y===t.y}).classed("selected",!0).classed("notSelected",!1)},l.prototype.moveCrosshairToIndexDot=function(e){var t,a=this.data.dataPoints,i=this.mainGraphicsContext,r=("dataPoints length:".concat(a.length,"is smaller than index:").concat(e),this.xAxisProperties.scale(a[e].x)),a=this.yAxisProperties.scale(a[e].y);null==this.crosshair?(e=+i.attr("width"),t=+i.attr("height"),this.crosshair=this.drawCrosshair(i,r,a,e,t),this.crosshairHorizontal=this.crosshair.select(l.Horizontal.selector),this.crosshairVertical=this.crosshair.select(l.Vertical.selector)):this.moveCrosshairToXY(r,a)},l.prototype.moveCrosshairToXY=function(e,t){this.crosshairHorizontal.attrs({y1:t,y2:t}),this.crosshairVertical.attrs({x1:e,x2:e})},l.prototype.drawCrosshair=function(e,t,a,i,r){e=e.append("g");return e.classed(l.CrosshairClassName,!0),e.append("line").classed(l.Horizontal.class,!0).attrs({x1:0,x2:i,y1:a,y2:a}),e.append("line").classed(l.Vertical.class,!0).attrs({x1:t,x2:t,y1:r,y2:0}),e},l.prototype.findClosestDotIndex=function(e,t){var a,i=-1,r=Number.MAX_VALUE,o=this.data.dataPoints,s=this.xAxisProperties.scale,n=this.yAxisProperties.scale;for(a in o){var l=o[a],c=s(l.x)-e,l=n(l.y)-t,c=c*c+l*l;(r===Number.MAX_VALUE||r&&c<r)&&(i=a,r=c)}return i},l.prototype.updateLegend=function(e){var t;null!=this.lastDotIndex&&this.lastDotIndex===e||(t=this.createLegendDataPoints(e),this.host.updateLegend(t),this.lastDotIndex=e)},l.prototype.createLegendDataPoints=function(e){var t=u.scatterChartProps.general.formatString,a=[],i=this.data,r=("dataPoints length:".concat(i.dataPoints.length,"is smaller than index:").concat(e),i.dataPoints[e]),o=u.valueFormatter.format(null),s=o,n=i.legendData,n=(n.dataPoints,n.dataPoints),l=r.formattedCategory.getValue(),l=(l!==o?(s=l,null!=r&&null!=r.radius&&null!=r.radius.sizeMeasure&&(s+="; ".concat(u.valueFormatter.format(r.radius.sizeMeasure.source.groupName)))):null!=r.radius.sizeMeasure?s=u.valueFormatter.format(r.radius.sizeMeasure.source.groupName):0<n.length&&n.length>=e&&n[e].label!==o&&(s=n[e].label),null!=i.xCol&&a.push({category:s,color:r.fill,identity:u.SelectionIdBuilder.builder().withMeasure(i.xCol.queryName).createSelectionId(),selected:r.selected,icon:u.LegendIcon.Box,label:u.valueFormatter.format(this.data.axesLabels.x),measure:u.valueFormatter.format(r.x,u.valueFormatter.getFormatString(i.xCol,t)),iconOnlyOnLabel:!0,index:0}),null!=i.yCol&&a.push({category:s,color:r.fill,identity:u.SelectionIdBuilder.builder().withMeasure(i.yCol.queryName).createSelectionId(),selected:r.selected,icon:u.LegendIcon.Box,label:u.valueFormatter.format(i.axesLabels.y),measure:u.valueFormatter.format(r.y,u.valueFormatter.getFormatString(i.yCol,t)),iconOnlyOnLabel:!0,index:1}),null!=i.size&&a.push({category:s,color:r.fill,identity:u.SelectionIdBuilder.builder().withMeasure(i.size.queryName).createSelectionId(),selected:r.selected,icon:u.LegendIcon.Box,label:u.valueFormatter.format(i.size.displayName),measure:u.valueFormatter.format(r.radius.sizeMeasure&&r.radius.sizeMeasure.values[r.radius.index]||r.radius.value,u.valueFormatter.getFormatString(i.size,t)),iconOnlyOnLabel:!0,index:2}),u.Legend.getDefaultLegendData());return l.dataPoints=a,l},l.CrosshairClassName="crosshair",l.ScatterMarker=e("scatterMarker"),l.Horizontal=e("horizontal"),l.Vertical=e("vertical");var n=l;function l(){}u.ScatterChartMobileBehavior=n}(powerbi=powerbi||{}),function(T){var F,d,e,t,y,m;function I(e){this.isScrollable=e.isScrollable,this.tooltipsEnabled=null==e.tooltipsEnabled||e.tooltipsEnabled,this.interactivityService=e.interactivityService,this.featureSwitch=e.featureSwitches,this.viewModelAdapterFactory=e.viewModelAdapterFactory}F=T.visuals||(T.visuals={}),d=F.builder,e=jsCommon.CssConstants.createClassAndSelector,t=F.labelPosition,y=jsCommon.Lazy,m=jsCommon.StringExtensions,I.prototype.initData=function(e){this.style=e.style,this.currentViewport=e.viewport,this.hostServices=e.host,this.tooltipService=e.services.tooltips,this.animationOptions=e.animation},I.prototype.initRenderer=function(e){this.svg=e.svg,this.svg.classed(I.WaterfallClassName,!0),this.mainGraphicsSVG=this.svg.append("svg"),this.mainGraphicsContext=this.mainGraphicsSVG.append("g").classed(I.MainGraphicsContextClassName,!0),this.interactivityService&&(e=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attrs({tabindex:0,focusable:!0,role:"listbox","aria-multiselectable":!0,"aria-label":this.hostServices.getLocalizedString("Visual_Plot")}).classed(F.SetFocusRingClassName,!e))},I.converter=function(e){var t=e.dataView;if(t)return t.categorical?I.categoricalConverter(e):t.matrix?T.waterfallConverterModuleFactory().matrixConverter(e):void 0},I.categoricalConverter=function(e){var l,c,t,a=e.dataView,u=e.hostServices,d=e.dataLabelSettings,h=e.sentimentColors,i=e.interactivityService,p=e.tooltipsEnabled,g=I.formatStringProp,y=T.data.createDataViewCategoricalReaderAdvanced(a,{formatStringProp:g}),m=y.data,r=T.DataViewObjects.getValue(y.objects.getStaticObjects(),F.cartesianChartProps.valueAxis.totalsEnabled,I.DefaultTotalsEnabled),o=(m.hasValues("Breakdown")&&(r=I.DefaultTotalsEnabled),a.categorical.categories||[]),s=u.getLocalizedString(I.TotalLabel),n=I.createLegend(h,u,y.objects.getStaticObjects(),e.style,void 0,r),v={current:0,min:0,max:0,formatString:void 0},S=[],f=[],b=[],x=[];if(m.hasValues("Tooltips")&&(c=y.columns.getAllValueMetadataColumnsForRole("Tooltips",void 0)),m.hasValues("Y")){var C=(x=[y.columns.getValueMetadataColumn("Y")])[0].format;if(_.isEmpty(o))var w=m.getValue("Y",0),v={current:w,max:w,min:0,formatString:m.getFormatString("Y",0)};else{var D=o[0],A=D.source;(f=D.values.slice()).push(s);for(var P=null!=(w=a.categorical.originalCategories)?w:[D],L=d.fontProperties.color,M=0,V=m.getCategoryCount();M<V;M++)!function(e){var t=f[e],a=m.getValue("Y",e)||0,i=m.getFormatString("Y",e),r=(void 0!==i&&void 0===C&&(C=i),F.SelectionIdBuilder.builder().withCategory(P,e,null==(l=null==D?void 0:D.source)?void 0:l.queryName,!0).withMeasure(x[0].queryName,y.columns.getValueColumn("Y"),e).createSelectionId()),o=void 0,s=(p&&(o=I.createCategoryTooltip(A?[A]:null,x[0],[t],a,i,g),s=m.getAllValuesForRole("Tooltips",e),n=m.getAllFormatStringsForRole("Tooltips",e),s)&&c&&I.appendTooltipMeasures(s,n,o,c,g,u),F.DataLabelUtil.determineDataLabelFillColor({defaultColor:L,categoricalDataReader:y,categoryIndex:e})),n=F.DataLabelUtil.isAssignedColor(s)?s.color:L;d.fontProperties=F.DataLabelUtil.updateFontPropertiesColor(n,d.fontProperties),S.push(I.createDataPoint(a,v.current,h,t,e,r,o,s.color,i||C,0)),b[e]=function(){return F.CartesianHelper.getCategoryIdentity(e,D)},v=I.getNewPositionContext(v,a)}(M)}o=void 0,w=(p&&(o=I.createCategoryTooltip(A?[A]:null,x[0],[s],v.current,void 0,g)),F.SelectionId.createNull());r&&S.push(I.createDataPoint(v.current,0,h,s,m.getCategoryCount(),w,o,d.fontProperties.color,C,1,{text:!0}))}i&&i.applySelectionStateToData(S),e.style.isHighContrast&&(t={visible:!0,color:F.ColorHelper.getThemeColor(e.style,F.ForegroundColorName),width:F.CartesianHelper.defaultLineStrokeWidth});r=F.CartesianHelper.getCategoryAxisProperties(a.metadata,void 0),s=F.CartesianHelper.getPreferredCategoryWidth(r);return{series:[{data:S,type:!_.isEmpty(x)&&x[0].type}],categories:f,categoryIdentities:b,categoryMetadata:A,preferredCategoryWidth:s,valuesMetadata:x,legend:n,hasHighlights:!1,positionMin:v.min,positionMax:v.max,dataLabelsSettings:d,sentimentColors:h,strokeSettings:t}},I.createDataPoint=function(e,t,a,i,r,o,s,n,l,c,u){a=1===c||2===c?a.totalFill:3===c?a.otherFill:0<e?a.increaseFill:a.decreaseFill;return{value:e,position:t,color:a.solid.color,categoryValue:i,categoryIndex:r,identity:o,seriesIndex:0,selected:!1,highlight:!1,key:o.getKey(),tooltipInfo:s&&function(){return s.getTooltipItems()},labelFill:n,labelFormatString:l,type:T.ValueType.fromDescriptor(u),barType:c}},I.createCategoryTooltip=function(a,e,t,i,r,o){var s=new F.LazyTooltipBuilder;return _.isEmpty(a)||s.withLazyValue(new y(function(){return{displayName:_.map(a,function(e){return e.displayName}).join(" "),value:_.map(t,function(e,t){return F.converterHelper.formatFromMetadataColumn(e,a[t],o)}).join(" ")}})),null!=i&&e&&s.withLazyValue(new y(function(){return{displayName:e.displayName,value:F.converterHelper.formatFromMetadataColumn(i,e,o,!1,r)}})),s},I.appendTooltipMeasures=function(s,n,l,c,u,d,h,p,g){if(!_.isEmpty(s)&&!_.isEmpty(c))for(var e=0;e<s.length;e++)!function(e){var t,a,i,r,o;null!=s[e]&&c[e]&&(t=c[e].displayName,a=F.converterHelper.formatFromMetadataColumn(s[e],c[e],u,!1,null==n?void 0:n[e]),_.isEmpty(h)?l.withLazyValue(new y(function(){return{displayName:t,value:a}})):(i=s[e],r=h[e],_.isNumber(i)&&_.isNumber(r)?(t=m.format(d.getLocalizedString("Waterfall_BreakdownDifferenceTooltip"),t),a=I.createPercentTooltipValue(a,i,r),l.withLazyValue(new y(function(){return{displayName:t,value:a}}))):(null!=r&&(o=F.converterHelper.formatFromMetadataColumn(r,c[e],u,!1),l.withLazyValue(new y(function(){return{displayName:"".concat(g," ").concat(t),value:o}}))),null!=i&&l.withLazyValue(new y(function(){return{displayName:"".concat(p," ").concat(t),value:a}})))))}(e)},I.createPercentTooltipValue=function(e,t,a){return a?(t=t/Math.abs(a),a=F.valueFormatter.getLocalizedString("Percentage"),t=F.valueFormatter.format(t,a),"".concat(e," (").concat(t,")")):e},I.createLegend=function(e,t,a,i,r,o){var s=e.increaseFill.solid.color,n=e.decreaseFill.solid.color,l=e.totalFill.solid.color,e=e.otherFill.solid.color,c=t.getLocalizedString(I.TotalLabel),u=t.getLocalizedString(I.IncreaseLabel),d=t.getLocalizedString(I.DecreaseLabel),t=t.getLocalizedString(I.OtherLabel),u=[{label:u,color:s,icon:F.LegendIcon.Box,identity:F.SelectionIdBuilder.builder().withMeasure("increase").createSelectionId(),selected:!1,index:0},{label:d,color:n,icon:F.LegendIcon.Box,identity:F.SelectionIdBuilder.builder().withMeasure("decrease").createSelectionId(),selected:!1,index:1}];return o&&u.push({label:c,color:l,icon:F.LegendIcon.Box,identity:F.SelectionIdBuilder.builder().withMeasure("total").createSelectionId(),selected:!1,index:2}),r&&u.splice(2,0,{label:t,color:e,icon:F.LegendIcon.Box,identity:F.SelectionIdBuilder.builder().withMeasure("other").createSelectionId(),selected:!1,index:3}),F.LegendData.create(a,u,!0,"",!1,i)},I.getNewPositionContext=function(e,t){t=e.current+t;return{current:t,min:Math.min(e.min,t),max:Math.max(e.max,t)}},I.getDefaultWaterfallLabelSettings=function(e,t,a,i){void 0===t&&(t=!1);e=F.DataLabelViewModel.getDefaultLabelSettings({style:e,textClassName:"smallLightLabel",labelColor:a,fontSize:i}).fontProperties;return{show:t,labelOrientation:1,position:F.labelPosition.auto,displayUnits:0,precision:F.DataLabelViewModel.defaultLabelPrecision,fontProperties:e,enableBackground:!1,bold:!1,italic:!1,underline:!1}},I.doesDataLabelFitInShape=function(e,t,a){var i,r;return null!=e&&null!==e.value&&(r={text:a.labelText(e),fontFamily:F.DataLabelViewModel.LabelTextProperties.fontFamily,fontSize:F.DataLabelViewModel.LabelTextProperties.fontSize,fontWeight:F.DataLabelViewModel.LabelTextProperties.fontWeight},0<F.CartesianHelper.getRectTop(t.scale,e.position,e.value)-F.DataLabelViewModel.labelMargin||(i=T.TextMeasurementService.measureSvgTextWidth(r),r=T.TextMeasurementService.estimateSvgTextHeight(r),a=a.categoryWidth,t=Math.abs(F.AxisHelper.diffScaled(t.scale,Math.max(0,Math.abs(e.value)),0)),!(a<i||t<r)))},I.prototype.setData=function(e){var t,a,i=this.getSentimentColorsFromObjects(null),r=I.DefaultBreakdowns,e=0<e.length?e[0]:void 0;this.data=this.originalData={series:[{data:[]}],categories:[],valuesMetadata:[],legend:F.Legend.getDefaultLegendData(this.style),hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,positionMax:0,positionMin:0,dataLabelsSettings:I.getDefaultWaterfallLabelSettings(this.style,!1,void 0),sentimentColors:i,axesLabels:{x:null,y:null},numberOfBreakdowns:r,totalBreakdownCategories:0},e&&((this.dataView=e).metadata&&e.metadata.objects&&((a=(t=e.metadata.objects).labels)&&F.DataLabelViewModel.updateLabelSettingsFromLabelsObject(a,this.data.dataLabelsSettings,!0,this.style),i=this.getSentimentColorsFromObjects(t),r=T.DataViewObjects.getValue(t,F.waterfallChartProps.breakdown.maxBreakdowns,I.DefaultBreakdowns)),e.categorical||e.matrix)&&(this.data=this.originalData=I.converter({dataView:e,style:this.style,hostServices:this.hostServices,dataLabelSettings:this.data.dataLabelsSettings,sentimentColors:i,interactivityService:this.interactivityService,tooltipsEnabled:this.tooltipsEnabled,numberOfBreakdowns:r}))},I.prototype.getFormattingCards=function(e){var t=this;return{card:[function(){return t.getSentimentColorCard(e.categoryAxisData)},function(){return t.getBreakdownCard()},function(){return t.getLabelsCard()}].reduce(function(e,t){t=t();return t&&e.push(t),e},[]),type:3}},I.prototype.getSentimentColorCard=function(t){function a(e){return i.hostServices.getLocalizedString(e)}var i=this,r=F.waterfallChartPropsNew.sentimentColors,o=this.originalData,s=o.sentimentColors,n=F.waterfallChartPropsNew.valueAxis.totalsEnabled,e=F.waterfallChartPropsNew.categoryAxis,l=e.innerPadding,c=e.preferredCategoryWidth,u=this.yAxisProperties.totalsEnabled,e=new d.FormattingCardBuilder(new d.FormattingCardUidBuilder("sentimentColors"),"Role_DisplayName_Columns",__assign(__assign({},r),{totalsEnabledProp:n,innerPaddingProp:l,preferredCategoryWidthProp:c}),a);return e.addGroup("colors",function(e){e.withDisplayName("Visual_Colors").addSimpleSlice("increaseFill",function(){var e={value:s.increaseFill.solid.color};return new d.ColorPickerBuilder({descriptor:r.increaseFill,value:e}).build()}).addSimpleSlice("decreaseFill",function(){var e={value:s.decreaseFill.solid.color};return new d.ColorPickerBuilder({descriptor:r.decreaseFill,value:e}).build()}).addSimpleSlice("otherFill",function(){var e={value:s.otherFill.solid.color};return new d.ColorPickerBuilder({descriptor:r.otherFill,value:e}).build()},function(e){return e.withDisabled(!o.isBreakdown).withCustomDescription("Visual_Waterfall_Breakdown_OtherDescription")}),i.featureSwitch.waterfallTotals&&!o.isBreakdown&&e.addSimpleSlice("totalsEnabled",new d.ToggleSwitchBuilder({descriptor:n,value:u}).build(),function(e){return e.withCustomDisplayName("Visual_Axis_Total_Column")}),u&&e.addSimpleSlice("totalFill",function(){var e={value:s.totalFill.solid.color};return new d.ColorPickerBuilder({descriptor:r.totalFill,value:e}).build()})}),e.addGroup("spacing",function(e){e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerPadding",new d.SliderBuilder({descriptor:l,value:100*t.innerPadding,localize:a,options:{minValue:{type:0,value:0},maxValue:{type:1,value:50}}}).build()).addSimpleSlice("maxcategoryWidth",new d.SliderBuilder({descriptor:c,value:Math.round(100*t.maxMarginFactor),localize:a,options:{minValue:{type:0,value:20},maxValue:{type:1,value:180}}}).build(),function(e){return e.withCustomDisplayName("Visual_Max_CategoryWidth")})}),e.build()},I.prototype.getBreakdownCard=function(){function t(e){return a.hostServices.getLocalizedString(e)}var a=this,i=this.originalData,r=F.waterfallChartPropsNew.breakdown,e=new d.FormattingCardBuilder(new d.FormattingCardUidBuilder("breakdown"),"Visual_Waterfall_Breakdown",r,t);return i.isBreakdown?e.addGroup("breakdown",function(e){e.addSimpleSlice("maxBreakdowns",new d.SliderBuilder({descriptor:r.maxBreakdowns,value:i.numberOfBreakdowns,localize:t,options:{minValue:{type:0,value:I.MinimumBreakdowns},maxValue:{type:1,value:Math.min(I.MaximumBreakdowns,i.totalBreakdownCategories)}}}).build(),function(e){return e.withCustomDisplayName("Visual_Waterfall_MaximumBreakdown")})}):e.withDisabled(!0,"Visual_BreakdownCard_DisabledReason"),e.build()},I.prototype.getLabelsCard=function(){var t=this,e=F.waterfallChartPropsNew.labels,a=this.originalData,i=this.data.dataLabelsSettings,r={dataLabelsSettings:a.dataLabelsSettings,positionObject:I.validLabelPositionsOptions,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,labelOrientation:!0,position:!0,enableBackground:i.enableBackground,backgroundColor:i.backgroundColor,backgroundTransparency:i.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0};i.position&&r.positionObject.indexOf(i.position)<0&&(i.position=I.AutoLabelPosition);i={cardBuilder:new d.FormattingCardBuilder(new d.FormattingCardUidBuilder("labels"),"Visual_DataPointsLabels",e,function(e){return t.hostServices.getLocalizedString(e)}),dataLabelsProps:e,featureSwitches:this.featureSwitch,hostServices:this.hostServices,options:r,individualSelector:F.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:this.featureSwitch,hasCategories:null!=_.first(a.categories),hasDynamicSeries:!1,hasSeriesSelector:!1})};return a.isBreakdown&&(a=null==(r=_.first(null==(e=_.first(a.series))?void 0:e.data))?void 0:r.identity.getSelector())&&(i.repetitionSelector={metadata:a.metadata}),F.DataLabelViewModel.getDataLabelsFormattingModel(i)},I.prototype.enumerateObjectInstances=function(e,t){var a=this.originalData;switch(t.objectName){case"sentimentColors":this.enumerateSentimentColors(e);break;case"labels":F.DataLabelViewModel.enumerateDataLabels({enumeration:e,dataLabelsSettings:a.dataLabelsSettings,positionObject:I.validLabelPositionsOptions,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,labelOrientation:!0,position:!0,enableBackground:this.data.dataLabelsSettings.enableBackground,backgroundColor:this.data.dataLabelsSettings.backgroundColor,backgroundTransparency:this.data.dataLabelsSettings.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0},this.featureSwitch);break;case F.waterfallChartProps.breakdown.maxBreakdowns.objectName:this.enumerateBreakdown(e)}},I.prototype.enumerateSentimentColors=function(e){var t=this.originalData,a=t.sentimentColors,i=this.yAxisProperties.totalsEnabled,r={increaseFill:a.increaseFill,decreaseFill:a.decreaseFill};t.isBreakdown&&(r.otherFill=a.otherFill),i&&(r.totalFill=a.totalFill),e.pushInstance({selector:null,properties:r,objectName:"sentimentColors"})},I.prototype.enumerateBreakdown=function(e){var t=this.originalData;t.isBreakdown&&e.pushInstance({selector:null,properties:{maxBreakdowns:t.numberOfBreakdowns},validValues:{maxBreakdowns:{numberRange:{min:I.MinimumBreakdowns,max:Math.min(I.MaximumBreakdowns,t.totalBreakdownCategories)}}},objectName:F.waterfallChartProps.breakdown.maxBreakdowns.objectName})},I.prototype.calculateCustomLegend=function(){return this.data.legend},I.prototype.hasLegend=function(){return!0},I.createClippedDataIfOverflowed=function(e,t){var a=e,i=e.series[0].data;return e&&t<i.length&&((a=T.Prototype.inherit(e)).series=[{data:i.slice(0,t)}],a.categories=e.categories.slice(0,t)),a},I.prototype.calculateAxesProperties=function(r){function e(e){var t="x"===e,e="y"===e,a=t?o:s,i={pixelSpan:t?l.width:l.height,domainOptions:t?F.AxisHelper.createDomain(n.series,F.AxisHelper.getCategoryValueType(n.categoryMetadata),!1,[o.includeDomain]):u,metaDataColumn:t?n.categoryMetadata:n.valuesMetadata,axisZoom:void 0,zeroScalarDomain:e?I.DefaultZeroScalarDomain:void 0,isScalar:e,isVertical:e,isCategoryAxis:t,formatString:F.valueFormatter.getFormatString(t?n.categoryMetadata:n.valuesMetadata[0],I.formatStringProp),outerPadding:e?0:c.categoryThickness*c.outerPaddingRatio,outerPaddingRatio:e?0:c.outerPaddingRatio,forcedTickCount:r.forcedTickCount,axisDisplayUnits:a.displayUnits,axisPrecision:a.precision,preventNice:F.AxisHelper.hasForcedDomain(t?a.includeDomain:u)},e=(t?(i.categoryThickness=c.categoryThickness,i.getValueFn=function(e,t){return I.lookupXValue(n,e,t)},i.innerPaddingRatio=r.innerPaddingRatio):e&&(i.useTickIntervalForDisplayUnits=!0,i.invertAxis=a.invertAxis,i.totalsEnabled=a.totalsEnabled),F.AxisHelper.createAxis(i));return t&&(e.outerPaddingRatio=c.outerPaddingRatio,n.categoryIdentities)&&(e.categoryIdentities=n.categoryIdentities),e}var t=this,o=r.categoryAxisOptions,s=r.valueAxisOptions,n=(this.currentViewport=r.viewport,this.margin=r.margin,this.viewModelAdapterFactory&&this.originalData&&(a=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=a.getData()),this.clippedData=this.data),a=n.categories.length,l=this.getPreferredPlotArea(!1,a,F.CartesianHelper.MinOrdinalRectThickness,r.outerPaddingRatio),c=F.CartesianChartLayout.getLayout(null,{availableWidth:l.width,categoryCount:a,preferredCategoryWidth:null!=(a=null==n?void 0:n.preferredCategoryWidth)?a:null,domain:null,isScalar:!1,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:r.trimOrdinalDataOnOverflow,outerPaddingRatio:r.outerPaddingRatio,innerPaddingRatio:r.innerPaddingRatio}),u=(this.isScrollable||(n=this.clippedData=I.createClippedDataIfOverflowed(n,c.categoryCount)),F.AxisHelper.createScalarDomainOptions(this.getAxesDomains(!1,{valueAxis:!0}).valueAxis,0)),u=F.AxisHelper.mergeScalarAxisDomains(s.includeDomain,u),i=(this.xAxisProperties=e("x"),this.yAxisProperties=e("y"),F.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(this.yAxisProperties,n.dataLabelsSettings)),d=F.DataLabelViewModel.createColumnFormatterCacheManager(),a=this.xAxisProperties.categoryThickness*(1-r.innerPaddingRatio);return this.layout={categoryCount:c.categoryCount,categoryThickness:c.categoryThickness,isScalar:c.isScalar,outerPaddingRatio:c.outerPaddingRatio,categoryWidth:a,labelText:function(e){var t=n.series[e.seriesIndex].type,t=d.getOrCreate(e.labelFormatString,n.dataLabelsSettings,i.units,i.getPrecision(!!e.labelFormatString,t));return F.DataLabelViewModel.getLabelTailoredText({label:t.format(e.value)})},labelLayout:F.CartesianHelper.getLabelLayoutXYForWaterfall(this.xAxisProperties,a,this.yAxisProperties,null==u?void 0:u.domain),filter:function(e){return I.doesDataLabelFitInShape(e,t.yAxisProperties,t.layout)},style:{fill:function(e){return e.isLabelInside?F.ColorHelper.getThemeColor(t.style,F.DataLabelViewModel.DefaultInsideLabelColorName):e.labelFill}}},[this.xAxisProperties,this.yAxisProperties]},I.prototype.getAxesDomains=function(e,t){var a={},i=this.clippedData||this.data;return i&&t.valueAxis&&(a.valueAxis=[i.positionMin,i.positionMax]),a},I.prototype.setAxesLayout=function(e){},I.lookupXValue=function(e,t,a){var i=e.series[0].data;return t===i.length-1?i[t].categoryValue:F.CartesianHelper.lookupXValue(e,t,i[t].type||a,!1)},I.prototype.getPreferredPlotArea=function(e,t,a,i){return F.CartesianChartLayout.getPreferredPlotArea(t,a,this.currentViewport,this.isScrollable,e,this.margin,i)},I.prototype.getVisualCategoryAxisIsScalar=function(){return!1},I.prototype.overrideXScale=function(e){this.xAxisProperties=e},I.prototype.setFilteredData=function(e,t){var a=this.clippedData=T.Prototype.inherit(this.data);return a.series=[{data:a.series[0].data.slice(e,t)}],a.categories=a.categories.slice(e,t),a},I.prototype.createRects=function(e){var e=this.mainGraphicsContext.selectAll(I.CategoryValueClasses.selector).data(e,function(e){return e.key}),t=e.enter().append("rect").attr("class",function(e){return I.CategoryValueClasses.class.concat(e.highlight?"highlight":"")}).merge(e);return e.exit().remove(),t},I.prototype.createConnectors=function(e){var e=this.mainGraphicsContext.selectAll(I.WaterfallConnectorClasses.selector).data(e.slice(0,e.length-1),function(e){return e.key}),t=e.enter().append("line").classed(I.WaterfallConnectorClasses.class,!0).merge(e);return e.exit().remove(),t},I.prototype.render=function(e){var t,a,i=this,r=this.clippedData.series[0].data,o=this.createRects(r),r=this.createConnectors(r),s=this.clippedData.strokeSettings,n=(this.tooltipsEnabled&&this.tooltipService.addTooltip(o,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity&&[e.data.identity]}),this.interactivityService&&this.interactivityService.hasSelection()),l=this.xAxisProperties.scale,c=this.yAxisProperties.scale,u=c.domain()[0],d=this.yAxisProperties.invertAxis,s=(this.mainGraphicsSVG.attr("height",this.availableHeight).attr("width",this.availableWidth),s&&s.visible&&this.mainGraphicsSVG.style("stroke",s.color).style("stroke-width",s.width),o.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return 1===e.barType?F.ColumnUtil.DefaultOpacity:F.ColumnUtil.getFillOpacity(e.selected,e.highlight,n,i.data.hasHighlights)}).attr("width",this.layout.categoryWidth).attr("x",function(e){return l(e.categoryIndex)}).attr("y",function(e){var t;return d?(t=0,t=e.position<u?Math.abs(c(u)-c(e.value)):Math.abs(c(e.position)-c(e.position+e.value)),F.CartesianHelper.getRectTop(c,e.position,e.value)-t):F.CartesianHelper.getRectTop(c,e.position,e.value)}).attr("height",function(e){return e.position<u?Math.abs(c(u)-c(e.value)):Math.abs(c(e.position)-c(e.position+e.value))}),this.interactivityService&&(s=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),o.attrs({tabindex:0,focusable:!0,"aria-label":function(e){return F.tooltipUtils.formatTooltipInfo(e.tooltipInfo())},role:"option","aria-selected":function(e){return e.selected}}).classed(F.SetFocusRingClassName,!s)),r.style("stroke",F.ColorHelper.getThemeColor(this.style,I.DefaultWaterfallConnectorColorName)).attrs({x1:function(e){return l(e.categoryIndex)},y1:function(e){return c(e.position+e.value)},x2:function(e){return l(e.categoryIndex+1)+i.layout.categoryWidth},y2:function(e){return c(e.position+e.value)}}),this.data.dataLabelsSettings),r=[];return(s&&s.show||s.showCategory)&&(r=this.createLabelDataPoints()),this.interactivityService&&(a={navigationStrategy:F.DataPointNavigationStrategy.CategoryOnly,helper:this},t={root:this.mainGraphicsContext,bars:o,isBreakdown:this.data.isBreakdown}),F.SVGUtil.flushAllD3TransitionsIfNeeded(this.animationOptions),{dataPoints:this.data.series[0].data,behaviorOptions:t,navigationOptions:a,labelDataPoints:r,labelsAreNumeric:!0,labelOrientation:s.labelOrientation,animateLabels:!e}},I.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},I.prototype.getSupportedCategoryAxisType=function(){return F.axisType.categorical},I.prototype.getFirstElement=function(){var e;return _.isEmpty(this.clippedData.series)||_.isEmpty(this.clippedData.series[0].data)?{element:null}:(e=this.clippedData.series[0].data[0].categoryIndex,{element:this.getHTMLElementFromCategoryIndex(e)})},I.prototype.getNextDataPoint=function(e,t,a){var i,r=e;do{switch(a){case F.DataDirection.NextCategory:e+=1,((this.yAxisProperties.totalsEnabled||this.data.isBreakdown)&&e>=this.data.categories.length||!this.yAxisProperties.totalsEnabled&&!this.data.isBreakdown&&e>=this.data.categories.length-1)&&(e=0);break;case F.DataDirection.PreviousCategory:--e<0&&(e=this.yAxisProperties.totalsEnabled||this.data.isBreakdown?this.data.categories.length-1:this.data.categories.length-2);break;case F.DataDirection.NextSeries:case F.DataDirection.PreviousSeries:}}while((i=this.data.series[t].data[e])&&0===i.value&&r!==e);return{element:this.getHTMLElementFromCategoryIndex(e),targetCategoryIndex:e}},I.prototype.getHTMLElementFromCategoryIndex=function(t){return this.mainGraphicsContext.selectAll(I.CategoryValueClasses.selector).filter(function(e){return e.categoryIndex===t}).node()},Object.defineProperty(I.prototype,"availableWidth",{get:function(){return Math.max(0,this.currentViewport.width-(this.margin.left+this.margin.right))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"availableHeight",{get:function(){return Math.max(0,this.currentViewport.height-(this.margin.top+this.margin.bottom))},enumerable:!1,configurable:!0}),I.prototype.getSentimentColorsFromObjects=function(e){var t=F.ColorHelper.create(this.style);return{increaseFill:{solid:{color:t.getColorForPropertyWithDefaultColor(e,F.waterfallChartProps.sentimentColors.increaseFill,F.ColorHelper.getSentimentColor(this.style,"good"))}},decreaseFill:{solid:{color:t.getColorForPropertyWithDefaultColor(e,F.waterfallChartProps.sentimentColors.decreaseFill,F.ColorHelper.getSentimentColor(this.style,"bad"))}},totalFill:{solid:{color:t.getColorForPropertyWithDefaultColor(e,F.waterfallChartProps.sentimentColors.totalFill,F.ColorHelper.getDataColorByIndex(this.style,0))}},otherFill:{solid:{color:t.getColorForPropertyWithDefaultColor(e,F.waterfallChartProps.sentimentColors.otherFill,F.ColorHelper.getSentimentColor(this.style,"neutral"))}}}},I.prototype.createLabelDataPoints=function(){for(var e=[],t=this.data,a=this.xAxisProperties.scale,i=this.yAxisProperties.scale,r=this.yAxisProperties.invertAxis,o=i(0),s=t.series,n=F.DataLabelViewModel.createColumnFormatterCacheManager(),l=t.dataLabelsSettings,c=F.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(this.yAxisProperties,l),u=0,d=s;u<d.length;u++)for(var h=d[u],p=0,g=h.data;p<g.length;p++){var y=g[p],m={left:a(y.categoryIndex),top:r?F.CartesianHelper.getRectTopInverted(i,y.position,y.value):F.CartesianHelper.getRectTop(i,y.position,y.value),width:this.layout.categoryWidth,height:Math.abs(o-i(Math.abs(y.value)))},v=y.labelFormatString,v=n.getOrCreate(v,this.data.dataLabelsSettings,c.units,c.getPrecision(!!v,h.type)),v=F.DataLabelRenderer.getLabelFormattedText(v.format(y.value)),S=l.fontProperties,f=F.FontProperties.toTextProperties(S,v),b=T.TextMeasurementService.measureSvgTextWidth(f),f=T.TextMeasurementService.estimateSvgTextHeight(f,!0),x=this.getValidPositions(l.position,y.value);e.push({isPreferred:!0,text:v,textSize:{width:b,height:f},outsideFill:null!=(v=y.labelFill)?v:F.ColorHelper.getThemeColor(this.style,F.DataLabelViewModel.DefaultLabelColorName),insideFill:F.ColorHelper.getThemeColor(this.style,F.DataLabelViewModel.DefaultInsideLabelColorName),parentType:1,parentShape:{rect:m,orientation:0<=y.value?r?2:1:r?1:2,validPositions:x},fontProperties:S,identity:void 0,hasBackground:l.enableBackground,backgroundColor:l.backgroundColor,backgroundTransparency:l.backgroundTransparency})}return e},I.prototype.getValidPositions=function(e,t){if(0===t)return I.validZeroLabelPosition;switch(e){case F.labelPosition.insideEnd:return[4];case F.labelPosition.insideCenter:return[1];case F.labelPosition.insideBase:return[2];case F.labelPosition.outsideEnd:return[16];default:return I.validLabelPositionsAuto}},I.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},I.prototype.getStaticSeriesRole=function(){},I.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e)},I.formatStringProp={objectName:"general",propertyName:"formatString"},I.DefaultZeroScalarDomain=[0,1],I.WaterfallClassName="waterfallChart",I.MainGraphicsContextClassName="mainGraphicsContext",I.IncreaseLabel="Increase",I.DecreaseLabel="Decrease",I.TotalLabel="Waterfall_TotalLabel",I.OtherLabel="Waterfall_OtherLabel",I.CategoryValueClasses=e("column"),I.WaterfallConnectorClasses=e("waterfall-connector"),I.AutoLabelPosition="Auto",I.DefaultWaterfallConnectorColorName="foregroundNeutralTertiary",I.MinimumBreakdowns=1,I.MaximumBreakdowns=20,I.DefaultBreakdowns=5,I.DefaultTotalsEnabled=!0,I.validLabelPositionsOptions=[I.AutoLabelPosition,t.outsideEnd,t.insideEnd,t.insideCenter,t.insideBase],I.validLabelPositionsAuto=[16,4,1,2],I.validZeroLabelPosition=[16,8],F.WaterfallChart=I}(powerbi=powerbi||{}),function(e){var n=e.visuals||(e.visuals={}),l=jsCommon.BrowserUtils;function t(){}t.prototype.create=function(){return new a},n.WaterfallChartWebBehaviorFactory=t,i.prototype.bindEvents=function(i,r,e){var t,a,o=this,s=this.bars=i.bars;e&&(t=e.dataPointNavigationManager,e=e.pointSourceKey,t.isEmpty(e)||(a=i.root,n.InteractivityUtils.registerEnterPlotAreaHandler(a,t,e),n.InteractivityUtils.registerDataPointNavigationHandler(a,t,e),n.InteractivityUtils.registerClearCatcherShortcut(a,r))),s.on("click",function(e){return o.handleSelection(e,r,i.isBreakdown)}).on("keydown",function(e){var t=d3.event,a=t.keyCode;32!==a&&13!==a||(t.preventDefault(),t.stopPropagation(),o.handleSelection(e,r,i.isBreakdown))}),s.on("contextmenu",function(e){var t=d3.event;l.isCtrlOrMeta(t)||(t.preventDefault(),n.EventBubblingUtil.markAsHandled(t),1!==e.barType&&(t=n.InteractivityUtils.getPositionOfLastInputEvent(),r.handleContextMenu(e,t)))})},i.prototype.renderSelection=function(t){this.bars.attr("aria-selected",function(e){return e.selected}).style("fill-opacity",function(e){return 1===e.barType?n.ColumnUtil.DefaultOpacity:n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,!1)}).style("stroke-opacity",function(e){return 1===e.barType?n.ColumnUtil.DefaultOpacity:n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,!1)})},i.prototype.renderFocus=function(e){e&&l.focus(e)},i.prototype.handleSelection=function(e,t,a){var i,r;1!==e.barType&&(i=n.InteractivityUtils.getPositionOfLastInputEvent(),r=void 0,r=a?0:jsCommon.SelectionUtility.getMultiSelectMode(d3.event),t.handleSelection(e,r,i))};var a=i;function i(){}n.WaterfallChartWebBehavior=a}(powerbi=powerbi||{}),define("CartesianVisuals/cartesianModule",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createScatterChartMobileBehaviorFactory=t.createDashboardColumnChartAnimator=t.createRealTimeLineChartAnimator=t.createWaterfallChartWebBehaviorFactory=t.createScatterChartWebBehaviorFactory=t.createLineChartWebBehaviorFactory=t.createDataDotChartWebBehaviorFactory=t.createColumnChartWebBehaviorFactory=t.createCartesianChartBehaviorFactory=t.createWebColumnChartAnimator=t.createCartesianChart=void 0;var a=powerbi.visuals,i=a.CartesianChart,r=a.CartesianChartBehaviorFactory,o=a.ColumnChartWebBehaviorFactory,s=a.DashboardColumnChartAnimator,n=a.DataDotChartWebBehaviorFactory,l=a.LineChartWebBehaviorFactory,c=a.RealTimeLineChartAnimator,u=a.ScatterChartMobileBehaviorFactory,d=a.ScatterChartWebBehaviorFactory,h=a.WaterfallChartWebBehaviorFactory,p=a.WebColumnChartAnimator;t.createCartesianChart=function(e){return new i(e)},t.createWebColumnChartAnimator=function(e){return new p(e)},t.createCartesianChartBehaviorFactory=function(e,t){return new r(e,t)},t.createColumnChartWebBehaviorFactory=function(){return new o},t.createDataDotChartWebBehaviorFactory=function(){return new n},t.createLineChartWebBehaviorFactory=function(){return new l},t.createScatterChartWebBehaviorFactory=function(){return new d},t.createWaterfallChartWebBehaviorFactory=function(){return new h},t.createRealTimeLineChartAnimator=function(e){return new c(e)},t.createDashboardColumnChartAnimator=function(e){return new s(e)},t.createScatterChartMobileBehaviorFactory=function(){return new u}}),function(v){var S,e;function f(e){return{x:{tickLabels:e.x.labelFontProperties,title:e.x.titleFontProperties},y:{tickLabels:e.y.labelFontProperties,title:e.y.titleFontProperties},y2:{tickLabels:e.y2.labelFontProperties,title:e.y2.titleFontProperties}}}function b(e,t){var a={x:e.x.showAxisTitle,y:e.y.showAxisTitle,y2:e.y2.showAxisTitle};return a=t?t.updateShowAxisTitles(a,e):a}S=v.visuals||(v.visuals={}),(e=S.CartesianAxesLayoutBuilder||(S.CartesianAxesLayoutBuilder={})).build=function(e){var t=e.axes,a=e.axisZoom,i=e.calculatePlotArea,r=e.data,o=e.interactivityOptions,s=e.layers,n=e.playAxesRect,l=e.referenceLines,c=e.trimOrdinalDataOnOverflow,u=e.type,d=e.viewport,h=e.rotateXTickLabels90,e=e.forceMarginMin,p=[],g=[],y=[];function m(e){e=d3.extent(e);return{min:e[0],max:e[1]}}return S.ReferenceLineHelper.gatherDomainExtents(l,p,g,y,S.CartesianChart.getCategoryValueType(s)),t.negotiateAxes({layers:s,parentViewport:d,padding:v.Prototype.inherit(S.SvgCartesianAxes.AxisPadding),playAxisControlLayout:n,showAxisTitles:b(r,a),shouldRenderAxis:S.CartesianChartLayout.shouldRenderAxis(r,S.ComboChart.isComboChart(u)),axesFontProperties:f(r),interactivityRightMargin:null!=o&&o.isInteractiveLegend&&!c?S.INTERACTIVITY_RIGHT_MARGIN:0,calculatePlotArea:i,skipMergeValueAxes:null==a?void 0:a.skipMergingValueAxisDomains(),ensureXDomain:m(p),ensureYDomain:m(g),ensureY2Domain:m(y),rotateXTickLabels90:h,forceMarginMin:e})},e.getAxesFontProperties=f,e.showAxisTitles=b}(powerbi=powerbi||{}),function(e){var w,D;function t(e){var t=(this.settings=e).axes,a=e.data,i=e.container,e=e.featureSwitches;this.svgAxes=new w.SvgCartesianAxes(t),this.svgAxes.init(i,a),this.navigationHelper=new w.CartesianChartNavigationHelper,this.featureSwitches=e}w=e.visuals||(e.visuals={}),D=e.visuals.controls.SvgScrollbar,t.prototype.destroy=function(){var e;null!=(e=this.scrollableAxes)&&e.destroy(),null!=(e=this.svgScrollbar)&&e.remove(),this.scrollableAxes=void 0,this.svgScrollbar=void 0},t.prototype.update=function(e,t){var a;null!=(a=this.svgScrollbar)&&a.updateScrollbarOptions(t),this.svgAxes.update(e)},t.prototype.render=function(o,e,i,t,a,s,r,n,l){var c,u,d=this,r=this.options=r,h=r.playAxesRect,p=r.trimOrdinalDataOnOverflow,g=r.categoryLoadMoreDataHandler,y=r.suppressAnimations,m=r.animationDuration,v=r.ease,S=r.isHierarchicalAxis,f=r.formatMode,b=r.subSelectionHelper,x=r.preserveScrollPosition,C=r.supportsScrolling,r=r.navigationScrollCallbacks;return!l&&((l=w.CartesianAxesLayoutBuilder.build({data:o,interactivityOptions:this.settings.interactivity,referenceLines:t,type:this.settings.type,axes:this.settings.axes,layers:i,viewport:a,playAxesRect:h,calculatePlotArea:this.settings.calculatePlotArea,trimOrdinalDataOnOverflow:p,axisZoom:e,rotateXTickLabels90:void 0})).plotArea.width<1||l.plotArea.height<1)?l:this.settings.suppressBrush&&(a.height<1||a.width<1)?void 0:(i.forEach(function(e,t){var a;0!==t&&l.axes.y2?a=2:(a=1)===i.length&&l.axes.y2&&(a|=2),e.setAxesLayout({layout:l,trimOrdinalDataOnOverflow:p,axisType:a})}),null!=e&&e.render({cartesianAxesLayout:l,axesData:o,formatMode:f,categoryAxisTitleSliceUid:w.CartesianChartOnObjectUtil.getAxisSliceUid(!1,!0,"title","text"),valueAxisTitleSliceUid:w.CartesianChartOnObjectUtil.getAxisSliceUid(!1,!1,"title","text"),y2AxisTitleSliceUid:w.CartesianChartOnObjectUtil.getAxisSliceUid(!0,!1,"title","text")}),t=l.axes.x.isCategoryAxis?l.axes.x:l.axes.y1,null!=g&&g.setScale(t.scale),h=function(e,t,a,i,r){return d.renderAxes(e,t,a,m,v,w.CartesianAxesLayoutBuilder.getAxesFontProperties(o),s,S,n,f,i,r)},C?(this.svgScrollbar||(e=(a=this.settings).container,t=a.onExtentUpdate,c=a.axes,u=a.animateCategoryAxis,a=a.animateValueAxis,this.svgScrollbar=new D({scrollbarWidth:w.ScrollableAxes.ScrollbarWidth,onExtentUpdate:t}),this.scrollableAxes=new w.ScrollableAxes(c,this.svgScrollbar,u,a),this.svgScrollbar.init(e)),this.scrollableAxes.render(l,i,y,h,S,x,g,this.settings.suppressBrush,this.settings.type,o.hasY2Role,f,b)):(this.destroy(),h(i,l,y,this.settings.animateCategoryAxis,this.settings.animateValueAxis)),this.navigationHelper.updateScrollCallbacks(C?r:void 0),this.eventsBoundForAxesLayout!==l&&(this.bindScrollWheelEvents(l,this.settings.container,f,b),this.bindTouchEvents(l,this.settings.container,f,b),this.eventsBoundForAxesLayout=l),l)},t.prototype.renderAxes=function(e,t,a,i,r,o,s,n,l,c,u,d){i=this.svgAxes.renderAxes({axesLayout:t,duration:i,axesFontProperties:o,animateCategoryAxis:u,animateValueAxis:d,easing:r,shouldRenderGridLinesOnly:this.options.shouldRenderGridLinesOnly,useManagedTabIndex:l,featureSwitches:this.featureSwitches,formatMode:c,categoryAxisTitleSliceUid:w.CartesianChartOnObjectUtil.getAxisSliceUid(!1,!0,"title","text"),valueAxisTitleSliceUid:w.CartesianChartOnObjectUtil.getAxisSliceUid(!1,!1,"title","text"),y2AxisTitleSliceUid:w.CartesianChartOnObjectUtil.getAxisSliceUid(!0,!1,"title","text")});null!=i&&i.navigationOptions&&this.settings.behavior&&(this.navigationHelper.clearNavigationLayers(),this.navigationHelper.addNavigationLayer(i.navigationOptions.helper),r={isAxis:!0,navigationOptions:{helper:this.navigationHelper,navigationStrategy:i.navigationOptions.navigationStrategy,focusElement:null==(d=(o=this.navigationHelper).getPendingFocusElement)?void 0:d.call(o)},pointSourceKey:"cartesian-axis".concat(this.settings.multipleId||""),isHierarchicalAxis:n},this.settings.interactivityService.bind(i.dataPoints,this.settings.behavior,i.behaviorOptions,r),this.settings.behavior.renderSelection(this.settings.interactivityService.hasSelection())),s(e,t,a,u,u,n)},t.prototype.getLayerContainer=function(){return this.svgAxes.getScrollableRegion()},t.prototype.getDataLabelContainers=function(){return this.svgAxes.getLabelsContainers()},t.prototype.getSeriesLabelContainers=function(){return this.svgAxes.getSeriesLabelsContainers()},t.prototype.setExtent=function(e){var t;null!=(t=this.scrollableAxes)&&t.setExtent(e)},t.prototype.scrollDelta=function(e){var t;null!=(t=this.scrollableAxes)&&t.scrollDelta(e)},t.prototype.scrollTo=function(e){var t;null!=(t=this.scrollableAxes)&&t.scrollTo(e)},t.prototype.shouldScrollTo=function(e){var t;return null==(t=this.scrollableAxes)?void 0:t.shouldScrollTo(e)},t.prototype.scrollBy=function(e){var t;null!=(t=this.scrollableAxes)&&t.scrollBy(e)},t.prototype.clearRenderingTimeout=function(){var e;null!=(e=this.scrollableAxes)&&e.clearRenderingTimeout()},t.prototype.bindTouchEvents=function(r,e,o,s){var n=this,l={x:0,y:0};this.settings.eventManager.on(e.node(),"touchstart",function(){var e;0===n.options.viewMode&&(r.isXScrollBarVisible||r.isYScrollBarVisible)&&(e=d3.event.changedTouches[0],l.x=e.pageX,l.y=e.pageY)}),this.settings.eventManager.on(e.node(),"touchmove",function(){var e,t,a,i=null==(i=n.settings.hostServices)?void 0:i.tooltips();0!==n.options.viewMode||!r.isXScrollBarVisible&&!r.isYScrollBarVisible||i&&i.isTouchScreenOptimizedEnabled()&&i.visible()||(o&&null!=s&&s.onVisualScroll(),n.settings.tooltipService.hide(),e=(i=d3.event).changedTouches[0],a=l.x-e.pageX,t=l.y-e.pageY,a=r.isXScrollBarVisible?a:t,n.settings.onScroll?n.settings.onScroll(a):null!=(t=n.scrollableAxes)&&t.scrollDelta(a),l.x=e.pageX,l.y=e.pageY,i.preventDefault())})},t.prototype.bindScrollWheelEvents=function(i,e,r,o){var s=this;this.settings.eventManager.on(e.node(),"wheel",function(){if(i.isXScrollBarVisible||i.isYScrollBarVisible){r&&null!=o&&o.onVisualScroll(),s.settings.tooltipService.hide();var e=d3.event,t=e.deltaX,a=e.deltaY,t=Math.abs(t)>Math.abs(a)?t:a;if(s.settings.onScroll){if(s.options.isSmallMultiples&&!e.shiftKey)return;s.settings.onScroll(t)}else null!=(a=s.scrollableAxes)&&a.scrollDelta(t);e.preventDefault()}})},w.CartesianAxesRenderer=t}(powerbi=powerbi||{}),function(F){var I,k,O;function N(){}function i(a,e,t,i){var r=I.CartesianChart.getLayerDataViews(e);return!_.isEmpty(t)&&(e=null==i?t:[t[i]],_.every(e,function(e,t){return!r[t]||a(e)}))}I=F.visuals||(F.visuals={}),k=I.AxisDataModel.AxesData,N.prototype.convert=function(e){for(var t=e.dataViews,a=e.layers,i=e.layerStyle,r=e.categoryAxisTitleOnByDefault,o=e.valueAxisTitleOnByDefault,s=e.chartType,n=e.hasDataChanged,l={scrollbarWidth:I.ScrollableAxes.ScrollbarWidth},c=[],u=[],d=I.CartesianChart.getLayerDataViews(t),h=_.filter(t,I.ForecastHelper.isDataViewForForecast),p=[],g=1<a.length&&!!(t[0]&&t[0].categorical&&t[0].categorical.values),y=i.colorPalette.dataColors,m=(y.clearPreferredScale(),_.filter(t,I.TrendLineHelper.isDataViewForRegression)),v=new I.VisualWarningBuilder,S=_.filter(t,I.AnomalyDetectionVisualPlugin.isDataViewForAnomalyDetection),f=0,b=a.length;f<b;f++){var x=d[f],C=a[f],w=x?[x]:[],w=(null!=h[f]&&w.push(h[f]),null!=S[f]&&w.push(S[f]),a[f].setData(w,e.multipleInfo),function(e,t,a,i,r){var o,s,n=0;e.calculateCustomLegend&&(o=e.calculateCustomLegend(),n=o?o.dataPoints.length:0);t&&n<=1&&(s=I.Legend.buildSeriesLegendData({dataView:t,showByDefault:!0,staticSeriesRoleNames:[e.getStaticSeriesRole()],style:a,allowLegendWithNoSeries:i},function(e){return 3===e||5===e||4===e||6===e||8===e||7===e||10===e}(r)));return!e.calculateCustomLegend||n<=1&&s&&s.isGradientLegend?s:o}(C,x,i,g,s));w&&p.push(w),u.push.apply(u,I.CartesianChart.getDataBoundReferenceLines(x,a[f],i)||[]),N.supportsTrendLines(t,a,f)&&(C=m[f])&&(w=I.TrendLineHelper.readDataView(C,x,0<f,i),c.push.apply(c,w||[])),1<b&&y.rotateScale()}var D,A,P,L,M,V=1<p.length?I.Legend.mergeLegendData(p):1===p.length?p[0]:I.Legend.getDefaultLegendData(i),T=I.AxisZoom.converter(_.head(t));return _.isEmpty(t)?M=k.createDefault(i):(P=t[0],L=t[1],A=!1,(D=P.metadata)&&P.categorical&&!_.isEmpty(P.categorical.categories)&&(A=!!I.ScalarUtils.getScalarKeys(P.categorical.categories[0])),A=I.CartesianHelper.getCategoryAxisProperties(D,A||r),r=I.CartesianHelper.getValueAxisProperties(D,o),D=I.CartesianHelper.getValueAxisProperties(D,o,"y2Axis"),o=N.getDefaultLineChartSeriesLabelSettings(),r={valueAxisProperties:r,y2AxisProperties:D,categoryAxisProperties:A,isYCategorical:I.CartesianChart.shouldYAxisBeCategorical(s),isValueAxisDisabled:!N.supportsValueAxis(t,a),isScatter:10===s,isComboChart:I.ComboChart.isComboChart(s),style:i,hasY2Role:F.data.DataRoleHelper.hasRoleInDataView(P,"Y2")||L&&F.data.DataRoleHelper.hasRoleInDataView(L,"Y2"),forceShowY2:T.show&&T.showOnValueSecAxis||!_.isEmpty(e.multipleInfo)&&I.ComboChart.isComboChart(s),show:(N.isLineComboChart(s)?a[0].getSeriesSettings():o).show,seriesMaximumWidth:(N.isLineComboChart(s)?N.getMaximumSeriesSettings(a):o).seriesMaximumWidth,seriesPosition:(N.isLineComboChart(s)?a[0].getSeriesSettings():o).seriesPosition,isLineComboChart:N.isLineComboChart(s),defaultSeriesWidth:(N.isLineComboChart(s)?N.getMaximumSeriesSettings(a):o).defaultSeriesWidth},M=new k(r),n&&(D=t,A=u,P=i,L=a,o=e.chartType,D)&&0<D.length&&(r=D[0].metadata)&&(D=O.supportsStaticReferenceLines(D,L),A.push.apply(A,function(e,t,a,i){var r=I.ColorHelper.getDataColorByIndex(t,0,I.ForegroundColorName),o=[];a&&(a=F.DataViewObjects.getUserDefinedObjects(e.objects,I.ReferenceLineHelper.xAxisRefLineObjectName),o.push.apply(o,I.ReferenceLineHelper.readDataView(a,r,I.ReferenceLineHelper.xAxisRefLineObjectName,0,t,i,void 0)||[]));a=F.DataViewObjects.getUserDefinedObjects(e.objects,I.ReferenceLineHelper.y1AxisRefLineObjectName);return o.push.apply(o,I.ReferenceLineHelper.readDataView(a,r,I.ReferenceLineHelper.y1AxisRefLineObjectName,1,t)||[]),o}(r,P,D,o)||[]))),{legendData:V,trendLines:c,referenceLines:u,axesData:M,warningObjectCollection:v,showIcon:!1,scrollbarOptions:l,zoomData:T}},N.getDefaultLineChartSeriesLabelSettings=function(){var e=I.DataLabelViewModel.getDefaultLabelSettings({labelColor:"#FFF",textClassName:"smallLightLabel"}).fontProperties;return{seriesColor:"#FFF",seriesPosition:I.labelSeriesPosition.right,fontProperties:e,seriesWordWrap:!1,seriesMaximumWidth:20,defaultSeriesWidth:20,showLabelPerSeries:!1,enableBackground:!1,show:!1}},N.isLineComboChart=function(e){return 0===e||11===e||14===e||15===e||1===e||2===e},N.getMaximumSeriesSettings=function(e){var t,a,i;return 1<e.length?(t=e[0].getSeriesSettings(),a=e[1].getSeriesSettings(),i=t.seriesMaximumWidth,a.seriesMaximumWidth<i?t:a):e[0].getSeriesSettings()},N.supportsTrendLines=function(e,t,a){return i(function(e){return e.supportsTrendLine&&e.supportsTrendLine()},e,t,a)},N.supportsValueAxis=function(e,t,a){return i(function(e){e=e.getCartesianVisualCapabilities().supportsValueAxis;return void 0===e||e},e,t,a)},N.supportsDataBoundReferenceLines=function(e,t,a){return i(function(e){return!e.isStacked||!e.isStacked()},e,t,a)},N.supportsStaticReferenceLines=function(e,t,a){return i(function(e){return!e.supportsStaticReferenceLines||e.supportsStaticReferenceLines()},e,t,a)},O=N,I.CartesianChartConverter=O}(powerbi=powerbi||{}),function(S){var l=S.visuals||(S.visuals={});function e(e,t,a,i,r,o,s,n){this.options=e,this.behaviorFactory=t,this.featureSwitches=a,this.axes=i,this.type=r,this.isPlayAxis=o,this.scrollOnRowsEnabled=s,this.adapterFactory=n}e.prototype.init=function(e,t,a,i,r,o,s,n){this.initOptions=e,this.tooltipService=t,this.legend=a,this.axesData=i,this.interactivityService=r,this.layerStyle=o,this.rowLoadMoreDataHandler=s,this.eventManager=n},e.prototype.create=function(e){var t=new a(this.options,this.behaviorFactory,this.featureSwitches,this.axes,this.type,this.isPlayAxis,this.axesData,this.scrollOnRowsEnabled,this.adapterFactory);return t.init(e,this.initOptions,this.tooltipService,this.legend,this.interactivityService,this.layerStyle,this.rowLoadMoreDataHandler,this.eventManager),t},l.CartesianChartLayoutBuilder=e,t.prototype.render=function(e,t){var a,i;this.shouldRender()&&(i=(a=this.data).position||l.LegendPosition.Top,this.legend.setPosition(i),1!==a.dataPoints.length||a.grouped||((a=S.Prototype.inherit(a)).dataPoints=[]),this.legend.drawLegend(a,this.viewport,{isHierarchicalAxis:e,formatMode:t,titleSliceUid:"".concat("legend","-").concat("title","-titleText")}))},t.prototype.shouldRender=function(){return!(this.interactivity&&this.interactivity.isInteractiveLegend)},t.prototype.getMargin=function(){return this.legend.getMargins()},t.prototype.getPosition=function(){return this.legend.getPosition()},t.prototype.adjustChartArea=function(e){l.Legend.positionChartArea(e,this.legend)},t.prototype.isRenderedLeftOrRight=function(){return this.legend.isVisible()&&l.Legend.isLeftOrRight(this.legend.getPosition())};var r=t;function t(e,t,a,i){this.legend=e,this.data=t,this.viewport=a,this.interactivity=i}l.CartesianLegendRender=r,f.prototype.init=function(e,t,a,i,r,o,s,n){this.options=t,this.tooltipService=a,this.legend=i,this.interactivityService=r,this.layerStyle=o,this.element=e,this.rowLoadMoreDataHandler=s,this.eventManager=n,this.hostServices=t.host,this.gridContainer=$(document.createElement("div")).appendTo(this.element),this.gridContainer.addClass(f.GridContainerClassName),this.behavior=null==(a=this.behaviorFactory)?void 0:a.create(),this.visibilityHelper=S.responsiveVisualUtilModuleFactory().visibilityHelper(this.element,f.IconClassName);i=d3.select(this.element.get(0)),r=this.chartAreaSvg=i.append("svg");r.classed(f.ClassName,!0),r.attr("name",this.getCartesianChartName()),r.style("position","absolute"),null!=(o=t.featureSwitches)&&o.onObject&&r.attr(l.SubSelectableRestrictingElementAttribute,0),this.behavior&&(this.clearCatcher=l.appendClearCatcher(r),this.axisBehavior=new l.AxisBehavior),this.viewMode=t.host.getViewMode()},f.prototype.getCartesianChartName=function(){var e;switch(this.type){case 0:e="LineChart_ToolTip";break;case 1:e="AreaChart_ToolTip";break;case 2:e="StackedAreaChart_ToolTip";break;case 3:e="ClusteredColumnChart_ToolTip";break;case 4:e="ColumnChart_ToolTip";break;case 5:e="ClusteredBarChart_ToolTip";break;case 6:e="BarChart_ToolTip";break;case 7:e="HundredPercentStackedBarChart_ToolTip";break;case 8:e="HundredPercentStackedColumnChart_ToolTip";break;case 9:e="RibbonChart_ToolTip";break;case 10:e="ScatterChart_ToolTip";break;case 11:e="ComboChart_ToolTip";break;case 13:e="WaterfallChart_ToolTip";break;case 14:e="LineClusteredColumnComboChart_ToolTip";break;case 15:e="LineStackedColumnComboChart_ToolTip";break;case 16:e="DataDotClusteredColumnComboChart_ToolTip";break;case 17:e="DataDotStackedColumnComboChart_ToolTip";break;case 18:e="LineChart_ToolTip";break;case 19:e="Histogram_Tooltip";break;default:e="Chart"}return this.hostServices.getLocalizedString(e)},f.prototype.render=function(s,n,l,c,u,d,h,p,g,y,m,v){return __awaiter(this,void 0,S.Promise,function(){var t,a,i,r,o;return __generator(this,function(e){switch(e.label){case 0:return(this.cartesianSmallMultipleFactory=s,this.viewportScale=n.scale,s.clearRenderingTimeout(),t=s.getCoreMultiple(),a=t.getData())?(this.axesData=a.axesData,this.formatMode=y,o=this.renderLegend(a.legendData,n,p,y),i=o[0],o=o[1],this.chartAreaViewport={height:n.height-i.height,width:n.width-i.width,scale:n.scale},r=u.renderContainers(this.chartAreaViewport,this.axesData,this.isPlayAxis()?f.PlayAxisBottomMargin:0,this.featureSwitches),this.legendRenderer.adjustChartArea(u.context),this.positionChartArea(i,o,this.isPlayAxis(),r),o=this.calculatePlayAxisControlLayout(this.chartAreaViewport,i,this.legendRenderer.getPosition(),r),s.isSmallMultiples()?[3,1]:(this.cartesianSmallMultiplesLayout&&(this.cartesianSmallMultiplesLayout.destroy(),this.cartesianSmallMultiplesLayout=void 0),this.setGridContainerVisibility(!1),2&t.getState()||t.initRenderer(this.buildPlotAreaLayout(!1)),this.renderMultiple({multiple:t,viewport:n,background:c,axisZoom:u,chartAreaViewport:this.chartAreaViewport,chartAreaMargins:this.chartAreaMargins,renderedViewport:this.renderedPlotArea,playAxisControlLayout:o,suppressAnimations:h,resizeMode:v,trimOrdinalDataOnOverflow:d,categoryLoadMoreDataHandler:l,isSharedAxis:!1,isHierarchicalAxis:p,preserveScrollPosition:g,supportsScrolling:!0,formatMode:y,subSelectionHelper:m}),[3,3])):[2];case 1:return this.setGridContainerVisibility(!0),this.adjustGridContainer(this.chartAreaViewport),this.cartesianSmallMultiplesLayout=this.cartesianSmallMultiplesLayout||this.createSmallMultiplesLayout(),[4,this.cartesianSmallMultiplesLayout.render({viewport:this.chartAreaViewport,axisRendererSettings:this.getAxisRendererSettings(this.chartAreaSvg,!0,!1),cartesianSmallMultipleFactory:s,axesData:this.axesData,animationSettings:this.getAnimationOptions(!0),background:c,playAxisControlLayout:o,suppressAnimations:!0,resizeMode:v,isHierarchicalAxis:p,trimOrdinalDataOnOverflow:d,categoryLoadMoreDataHandler:l,warnings:a.warningObjectCollection})];case 2:e.sent(),e.label=3;case 3:return[2]}})})},f.prototype.setGridContainerVisibility=function(e){this.gridContainer.css("display",e?"":"none")},f.prototype.scrollRowsTo=function(e){this.cartesianSmallMultiplesLayout,this.cartesianSmallMultiplesLayout.scrollRowsTo(e)},f.prototype.destroy=function(){this.cartesianSmallMultiplesLayout&&this.cartesianSmallMultiplesLayout.destroy()},f.prototype.positionChartArea=function(e,t,a,i){this.chartAreaMargins=f.getEmptyMargins(),l.Legend.isLeft(t)&&(this.chartAreaMargins.left=e.width),l.Legend.isTop(t)&&(this.chartAreaMargins.top=e.height),a&&(this.chartAreaViewport.height-=f.PlayAxisBottomMargin),i&&(this.chartAreaViewport.height-=i.top+i.bottom,this.chartAreaViewport.width-=i.left+i.right,this.chartAreaMargins.left=(this.chartAreaMargins.left||0)+i.left,this.chartAreaMargins.top=(this.chartAreaMargins.top||0)+i.top),this.chartAreaSvg.attrs({width:this.chartAreaViewport.width,height:this.chartAreaViewport.height}).styles({"margin-top":this.chartAreaMargins.top?"".concat(this.chartAreaMargins.top,"px"):null,"margin-left":this.chartAreaMargins.left?"".concat(this.chartAreaMargins.left,"px"):null})},f.prototype.createSmallMultiplesLayout=function(){var t=this;return new l.CartesianSmallMultipleLayout(this.gridContainer,this.interactivityService,this.featureSwitches,function(e){return t.hostServices.getLocalizedString(e)},this.rowLoadMoreDataHandler,this.scrollOnRowsEnabled,this.behaviorFactory,this.layerStyle,this.viewMode,this.buildPlotAreaLayout.bind(this),this.renderMultiple.bind(this),this.adapterFactory,this.hostServices.instanceId,this.eventManager)},f.prototype.adjustGridContainer=function(e){this.gridContainer.css({width:e.width,height:e.height}),this.legendRenderer.adjustChartArea(d3.select(this.gridContainer.get(0)))},f.prototype.getVisibleMultiples=function(){return this.cartesianSmallMultiplesLayout?this.cartesianSmallMultiplesLayout.getVisibleMultiples():{startIndex:0,endIndex:1}},f.prototype.renderMultiple=function(e){var t=this,a=this.cartesianSmallMultipleFactory.isSmallMultiples(),i={scrollTo:function(e){return t.scrollTo(e)},shouldScrollTo:function(e){return t.shouldScrollTo(e)},scrollBy:function(e){return t.scrollBy(e)}},a={background:e.background,axisZoom:e.axisZoom,labelAnimationOptions:this.getLabelAnimationOptions(e.suppressAnimations),axesAnimationOptions:this.getAnimationOptions(e.suppressAnimations),renderedPlotArea:e.renderedViewport,viewport:e.viewport,chartAreaViewport:e.chartAreaViewport,chartAreaMargins:e.chartAreaMargins,layerStyle:this.layerStyle,suppressAnimations:e.suppressAnimations,playAxisControlLayout:e.playAxisControlLayout,resizeMode:e.resizeMode,viewMode:this.viewMode,trimOrdinalDataOnOverflow:e.trimOrdinalDataOnOverflow,categoryLoadMoreDataHandler:e.categoryLoadMoreDataHandler,shouldRenderGridLinesOnly:!1,isSmallMultiples:a,multipleId:e.multiple.index.toString(),isHierarchicalAxis:e.isHierarchicalAxis,preserveScrollPosition:e.preserveScrollPosition,supportsScrolling:e.supportsScrolling,navigationScrollCallbacks:i,formatMode:e.formatMode,subSelectionHelper:e.subSelectionHelper},i=e.multiple.getData(),r=(e.isSharedAxis&&(r=this.axesData.valueAxis.show,f.adjustOptionsForSharedAxis(a,e.viewport,e.axesLayout,i,this.featureSwitches,r)),e.multiple.getRenderer());r.axesRenderer.update(i.axesData,i.scrollbarOptions),r.render(e.multiple.layers,i,e.renderedViewport,a,this.viewportScale),this.noLabelsCanBeRendered=r.noLabelsCanBeRendered,this.renderedPlotArea=r.renderedPlotArea},f.prototype.scrollTo=function(e){var t;null!=(t=this.cartesianSmallMultipleFactory)&&t.isSmallMultiples()?this.cartesianSmallMultiplesLayout.scrollTo(e):this.cartesianSmallMultipleFactory.scrollTo(e,this.getVisibleMultiples())},f.prototype.shouldScrollTo=function(e){var t;return null!=(t=this.cartesianSmallMultipleFactory)&&t.isSmallMultiples()?this.cartesianSmallMultiplesLayout.shouldScrollTo(e):this.cartesianSmallMultipleFactory.shouldScrollTo(e,this.getVisibleMultiples())},f.prototype.scrollBy=function(e){var t;null!=(t=this.cartesianSmallMultipleFactory)&&t.isSmallMultiples()?this.cartesianSmallMultiplesLayout.scrollBy(e):this.cartesianSmallMultipleFactory.scrollBy(e,this.getVisibleMultiples())},f.prototype.getLabelAnimationOptions=function(e){e=this.getAnimationOptions(e);return{duration:this.isPlayAxis()?l.PlayChart.getFrameAnimationDuration():e.duration,ease:this.isPlayAxis()?l.D3Helper.easeCompat(l.PlayChart.AnimationEase):e.ease}},f.prototype.getAnimationOptions=function(e){return{ease:this.animator&&this.animator.getEasing(),duration:l.AnimatorCommon.GetAnimationDuration(this.animator,e)}},f.prototype.calculatePlotArea=function(e){var t,a,i;return this.cartesianSmallMultipleFactory&&this.cartesianSmallMultipleFactory.isSmallMultiples()?{width:(i=this.cartesianSmallMultiplesLayout.calculatePlotArea(e)).width,height:i.height,scale:e.viewport.scale}:(i=e.viewport,a=e.axesMargins,t={width:i.width-(a.left+a.right),height:i.height-(a.top+a.bottom),scale:i.scale},i=i.width-(a.left+a.right),a=0,null!=e.layerSeriesData.defaultSeriesWidth&&(i=100*e.layerSeriesData.defaultSeriesWidth/i,a=Math.min(Math.max(1,i),50),e.layerSeriesData.seriesMaximumWidth=a),i=e.layerSeriesData.seriesMaximumWidth/100,e&&e.showSeriesLabels&&(t.width=t.width-i*t.width),t)},f.adjustOptionsForSharedAxis=function(e,t,a,i,r,o){!r.smallMultiplesUnsharedAxes||i.axesData.y.sharedAxis&&i.axesData.x.sharedAxis?(a.shouldRenderAxis.x=!1,a.shouldRenderAxis.y=!1,a.shouldRenderAxis.y2=!1,a.margin=a.axesOverflow,e.shouldRenderGridLinesOnly=!0):e.shouldRenderGridLinesOnly=!o,a.viewport=t,e.axesLayout=a},f.getEmptyMargins=function(){return{top:0,bottom:0,left:0,right:0}},f.prototype.getAxisRendererSettings=function(e,t,a){var i=this,e={axes:this.axes,container:e,type:this.type,data:this.axesData,interactivity:this.options.interactivity,interactivityService:this.interactivityService,behavior:this.axisBehavior,animateCategoryAxis:this.animateCategoryAxis,animateValueAxis:this.animateValueAxis,calculatePlotArea:function(e){return i.calculatePlotArea(e)},hostServices:this.hostServices,tooltipService:this.tooltipService,eventManager:this.eventManager,featureSwitches:this.featureSwitches,formatMode:this.formatMode};return t&&(e.onScroll=function(e){return i.cartesianSmallMultiplesLayout.onScroll(e)},e.onExtentUpdate=function(e){return i.cartesianSmallMultiplesLayout.onExtentUpdate(e)},e.suppressBrush=a),e.data.useManagedTabIndex=!1,e},f.prototype.calculatePlayAxisControlLayout=function(e,t,a,i){var r;return this.isPlayAxis()&&(r=(null==i?void 0:i.left)||0,i=(null==i?void 0:i.bottom)||0,r={left:l.Legend.isLeft(a)?t.width:0,top:l.Legend.isTop(a)?t.height+e.height+i:e.height+i,height:f.PlayAxisBottomMargin,width:e.width+r}),r},f.addCartesianChartContainer=function(e,t){var e=d3.select(e.get(0)),a=e.select("svg"),e=(a.empty()&&((a=e.append("svg")).classed(f.ClassName,!0),a.style("position","absolute")),l.appendClearCatcher(a));return t&&a.attrs({width:t.width,height:t.height}),{element:a,clearCatcher:e}},f.prototype.renderLegend=function(e,t,a,i){return this.legendRenderer=new r(this.legend,e,t,this.options.interactivity),this.legendRenderer.render(a,i),[this.legendRenderer.getMargin(),this.legendRenderer.getPosition()]},f.prototype.buildPlotAreaLayout=function(e,t,a,i,r){var o=this.getAxisRendererSettings(t||this.chartAreaSvg,e,e&&this.isSharedAxis),o=new l.CartesianAxesRenderer(o);return new l.CartesianPlotAreaLayout(this.visibilityHelper,t||this.chartAreaSvg,o,i||this.element,this.type,this.hostServices,r||this.behavior,this.interactivityService,this.isLabelInteractivityEnabled,a||this.clearCatcher,this.animator,this.dataPointLassoSelect&&!e,this.viewportScale,this.featureSwitches)},f.shouldRenderAxis=function(e,t){return{x:e.x.show,y:e.y.show,y2:e.y2.show||t&&!1!==e.y2.show}},f.getPreferredPlotArea=function(e,t,a,i,r,o,s){a={height:a.height-(o=o||{top:0,right:0,bottom:0,left:0}).top-o.bottom,width:a.width-o.left-o.right};return!r&&i&&(o=f.getPreferredCategorySpan(e,t,s),a.width=Math.max(o,a.width)),a},f.getPreferredCategorySpan=function(e,t,a){return t*e+t*(a||0)*2},f.getLayout=function(e,t){var a=t.categoryCount,i=t.availableWidth,r=!!t.isScalar,o=!!t.isScrollable,e=f.getCategoryWidth(e?e.series:null,t),e=f.getCustomizedCategoryWidthInfo(e,t),s=e.categoryWidth,e=e.outerPaddingRatio,n=S.Double.floorWithPrecision((i-s*e*2)/s),n=Math.min(n,a);return r||n<a&&o||(e=Math.max(0,(i-s*n)/2/s),e=S.Double.equalWithPrecision(e,0)?0:e),{categoryCount:n=!r&&o?a:n,categoryThickness:s,outerPaddingRatio:e,innerPaddingRatio:t.innerPaddingRatio,isScalar:r}},f.getCustomizedCategoryWidthInfo=function(e,t){var a=e,i=t.categoryCount,r=t.availableWidth,o=t.isScalar,s=t.preferredCategoryWidth,t=t.outerPaddingRatio;return{categoryWidth:a=o||null==s||s<e?a:(o=Math.floor((r-s*t*2)/s))<=0?r/(1+2*t):o<i?(t=(r-s*o)/(2*s),s):Math.min(s,r),outerPaddingRatio:t}},f.getCategoryWidth=function(e,t){var a,i=t.categoryCount,r=t.availableWidth,o=t.domain,s=t.isScalar,n=t.trimOrdinalDataOnOverflow,t=t.outerPaddingRatio,o=(i<2?a=r*(1-t):s&&o&&1<o.length?(a=r*((e=f.getMinInterval(e))/(o[o.length-1]-o[0]+e*t*2)),a=Math.max(a,l.CartesianChart.MinScalarRectThickness)):(a=r/(i+2*t),n&&(a=Math.max(a,l.CartesianHelper.MinOrdinalRectThickness))),r/(3+2*t));return a=Math.min(a,o),!s&&3<=i&&n?Math.max(a,l.CartesianHelper.MinOrdinalRectThickness):a},f.getMinInterval=function(e){var t,a,i=Number.MAX_VALUE;if(0<e.length)for(var r=e[0].data.filter(function(e){return!e.highlight}),o=0,s=r.length-1;o<s;o++)a=void 0,a=r[(t=o)+1].categoryValue,t=r[t].categoryValue,i=Math.min(i,Math.abs(a-t));return i},f.ClassName="cartesianChart",f.IconClassName="cartesianChartResponsiveIcon",f.GridContainerClassName="cartesian-grid-container",f.PlayAxisBottomMargin=80;var a=f;function f(e,t,a,i,r,o,s,n,l){this.behaviorFactory=t,this.featureSwitches=a,this.axes=i,this.type=r,this.isPlayAxis=o,this.axesData=s,this.scrollOnRowsEnabled=n,this.adapterFactory=l,this.animateCategoryAxis=!1,this.animateValueAxis=!1,this.isSharedAxis=!0,e&&(this.viewMode=0,this.isLabelInteractivityEnabled=e.isLabelInteractivityEnabled,this.dataPointLassoSelect=this.featureSwitches.dataPointLassoSelect&&e.dataPointLassoSelect,this.animator=e.animator,this.animateCategoryAxis=e.animateCategoryAxis,this.animateValueAxis=e.animateValueAxis)}l.CartesianChartLayout=a}(powerbi=powerbi||{}),function(e){var l,c,u,d,o;l=e.visuals||(e.visuals={}),o=e.visuals.OnObjectUtil,(e=l.CartesianChartOnObjectUtil||(l.CartesianChartOnObjectUtil={})).getAxisTitleSubSelectionStyles=function(e,t,a){var i=u(e,t),e=d(e,t,"title");return o.getFontOnlyTextSubSelectionStyles(a,{fontReference:{cardUid:i,groupUid:e,sliceUid:"".concat(e,"-font")},fontColorReference:{cardUid:i,groupUid:e,sliceUid:"".concat(e,"-color")}})},e.getAxisValuesSubSelectionStyles=function(e,t,a,i){var a=c(t,a),r=u(e,t),e=d(e,t,t&&a?"valuesScalar":"values");return o.getNumericTextSubSelectionStyles(i,{fontReference:{cardUid:r,groupUid:e,sliceUid:"".concat(e,"-font")},fontColorReference:{cardUid:r,groupUid:e,sliceUid:"".concat(e,"-color")},precisionReference:{cardUid:r,groupUid:e,sliceUid:"".concat(e,"-precision")},displayUnitsReference:{cardUid:r,groupUid:e,sliceUid:"".concat(e,"-displayUnits")}})},e.getAxisTitleSubSelectionShortcuts=function(e,t,a,i){var r=u(e,t),o=d(e,t,"title"),r=[{type:1,destinationUids:[{cardUid:r,groupUid:o}],label:i.getLocalizedString("Format_AxisTitle")}],e="".concat("zoom","-default-").concat(e?"valueSecAxis":t?"categoryAxis":"valueAxis"),s="".concat("Visual","-").concat("zoom");return c(t,a)&&r.unshift({type:2,sourceUid:e,relatedToggledSourceUids:[{sourceUid:s}],enabledLabel:i.getLocalizedString("Format_AddZoomSlider")}),r.unshift({type:2,sourceUid:o,disabledLabel:i.getLocalizedString("Delete"),keyboardShortcuts:[{key:"Delete",nextValue:!1}]},{type:0,excludedResetSourceUids:[{sourceUid:o},{sourceUid:s},{sourceUid:e}]}),r},e.getAxisValuesSubSelectionShortcuts=function(e,t,a,i,r){var a=c(t,a),o=u(e,t),s=[{type:1,destinationUids:[{cardUid:o,groupUid:d(e,t,t&&a?"valuesScalar":"values")}],label:r.getLocalizedString("Format_AxisValues")}],i=(a||s.unshift({type:4,sortableField:{queryName:"",sortDirection:1},label:r.getLocalizedString("Format_SortAxis"),key:"Category"}),t&&i===l.axisType.both&&(i="".concat(d(e,t,"type"),"-type"),s.unshift({type:3,sourceUid:i,label:r.getLocalizedString("Format_Label_AxisType")})),"".concat("zoom","-default-").concat(e?"valueSecAxis":t?"categoryAxis":"valueAxis")),n="".concat("Visual","-").concat("zoom"),a=(a&&s.unshift({type:2,sourceUid:i,relatedToggledSourceUids:[{sourceUid:n}],enabledLabel:r.getLocalizedString("Format_AddZoomSlider")}),d(e,t,"title"));return s.unshift({type:2,sourceUid:a,enabledLabel:r.getLocalizedString("Format_AddAxisTitle")}),s.unshift({type:2,sourceUid:o,disabledLabel:r.getLocalizedString("Delete"),keyboardShortcuts:[{key:"Delete",nextValue:!1}]},{type:0,excludedResetSourceUids:[{sourceUid:o},{sourceUid:n},{sourceUid:i}]}),s},c=function(e,t){return!e||t},u=function(e,t){return e?"".concat("Visual","-").concat("y2Axis"):t?"".concat("Visual","-").concat("categoryAxis"):"".concat("Visual","-").concat("valueAxis")},d=function(e,t,a){return"".concat(e?"y2Axis":t?"categoryAxis":"valueAxis","-").concat(a)},e.getAxisSliceUid=function(e,t,a,i){return"".concat(d(e,t,a),"-").concat(i)}}(powerbi=powerbi||{}),function(S){var P;function e(e,t,a,i,r,o,s,n,l,c,u,d,h,p){this.visibilityHelper=e,this.chartAreaSvg=t,this.axesRenderer=a,this.element=i,this.type=r,this.hostServices=o,this.behavior=s,this.interactivityService=n,this.isLabelInteractivityEnabled=l,this.clearCatcher=c,this.animator=u,this.dataPointLassoSelect=d,this.initialViewportScale=h,this.featureSwitches=p,this.dataPointNavigationHelper=new P.CartesianChartNavigationHelper,this.dataPointLassoSelect&&(this.plotLassoManager=new P.PlotAreaLassoManager(!1),this.plotLassoManager.init([a.getLayerContainer(),c],t,this.hostServices,this.featureSwitches),this.lassoSelectionBehavior=new P.LassoSelectionBehavior(this.behavior),this.plotLassoManager.behaviors.push(this.lassoSelectionBehavior),this.plotLassoManager.setUiScale(this.initialViewportScale))}P=S.visuals||(S.visuals={}),e.prototype.attachToElement=function(e,t){this.element=e;var a=this.chartAreaSvg;a.attrs({width:t.width,height:t.height}),a.node().parentElement!==e.get(0)&&e.append(a.node())},e.prototype.render=function(e,t,a,i,r){this.options=i,this.renderedPlotArea=a,this.cartesianData=t,this.layers=e,null!=(i=this.plotLassoManager)&&i.setUiScale(r),this.cartesianData&&(this.cartesianData.showIcon?this.visibilityHelper.updateVisibility({showIcon:this.cartesianData.showIcon,viewport:this.options.viewport}):(this.visibilityHelper.updateVisibility({showIcon:this.cartesianData.showIcon}),this.renderCartesianChart()))},e.prototype.destroy=function(){this.axesRenderer.destroy(),this.chartAreaSvg.html(null),P.visualBackgroundHelper.removeBackgroundImage(this.element)},e.prototype.renderCartesianChart=function(){var i=this,r=this.options,e=!this.renderedPlotArea||this.renderedPlotArea.height!==r.chartAreaViewport.height||this.renderedPlotArea.width!==r.chartAreaViewport.width,e=(this.renderedPlotArea=r.chartAreaViewport,__assign(__assign({},r),{suppressAnimations:r.suppressAnimations||e,playAxesRect:r.playAxisControlLayout,animationDuration:r.axesAnimationOptions.duration,ease:r.axesAnimationOptions.ease,supportsScrolling:r.supportsScrolling,formatMode:r.formatMode,subSelectionHelper:r.subSelectionHelper}));this.axesRenderer.render(this.cartesianData.axesData,this.options.axisZoom,this.layers,this.cartesianData.referenceLines,this.options.chartAreaViewport,function(e,t,a){return i.renderPlotArea(e,t,a,r.resizeMode,r.formatMode)},e,void 0,this.options.axesLayout),this.dataPointNavigationHelper.updateScrollCallbacks(r.supportsScrolling?r.navigationScrollCallbacks:void 0)},e.prototype.getPlotAreaRect=function(e){return{left:e.margin.left+this.options.chartAreaMargins.left,top:e.margin.top+this.options.chartAreaMargins.top,width:e.plotArea.width,height:e.plotArea.height}},e.prototype.renderBackgroundImage=function(e){P.visualBackgroundHelper.renderBackgroundImage(this.options.background,this.element,e)},e.prototype.renderPlotArea=function(e,t,a,i,r){a=a||_.some(e,function(e){return e.shouldSuppressAnimation&&e.shouldSuppressAnimation()});var o=this.getPlotAreaRect(t);this.renderBackgroundImage(o),this.renderReferenceLines(t),this.renderLayers(e,t,a,i),this.renderTrendLines(t,r)},e.prototype.renderTrendLines=function(e,t){P.TrendLineHelper.render(this.cartesianData.trendLines,this.axesRenderer.getLayerContainer(),e.axes,e.plotArea,t)},e.prototype.renderReferenceLines=function(e){P.ReferenceLineHelper.render({graphicContext:this.axesRenderer.getLayerContainer(),axes:e.axes,viewport:e.plotArea,referenceLines:this.cartesianData.referenceLines})},e.prototype.getReferenceLineLabels=function(e,t){return P.ReferenceLineHelper.createLabelDataPoint({axes:e,viewport:t,referenceLines:this.cartesianData.referenceLines,hostServices:this.hostServices,style:this.options.layerStyle})},e.prototype.renderDataLabels=function(e,t,a,i,r,o){var s,n,l,c,u=this.axesRenderer.getDataLabelContainers(),d=u.foreground,u=u.background,h=[],p=this.options,g=p.formatMode,p=p.labelAnimationOptions;this.behavior?(n=this.animator,s=P.DataLabelRenderer.getDataLabelLayoutOptions(this.type),h=new S.LabelLayout(s).layout(e,a),l=void 0,l=n&&!i&&o?P.DataLabelRenderer.animateLabelsAndBackgrounds({labelContext:d,dataLabels:h,duration:p.duration,numeric:t,easeType:p.ease,backgroundContext:u,formatMode:g,onObject:this.featureSwitches.onObject}):P.DataLabelRendererResolver.get(this.featureSwitches).drawLabelsAndBackgrounds({labelContext:d,dataLabels:h,numeric:t,backgroundContext:u,formatMode:g,onObject:this.featureSwitches.onObject}),s.allowLeaderLines&&(n=_.filter(h,function(e){return null!=e.leaderLinePoints&&!_.isEmpty(e.leaderLinePoints)&&null!=e.identity}),P.DataLabelRendererResolver.get(this.featureSwitches).drawLabelLeaderLines(d,n,function(e){return e.identity.getKey()})),this.interactivityService&&(this.isLabelInteractivityEnabled||g)&&(i={labelItems:l},this.interactivityService.bind(h,new P.LabelsBehavior,i,{isLabels:!0,pointSourceKey:"data-labels",formatMode:g}))):(h=new S.LabelLayout({maximumOffset:P.DataLabelViewModel.maxLabelOffset,startingOffset:P.DataLabelViewModel.startingLabelOffset,attemptToMoveLabelsIntoViewport:!0}).layout(e,a),P.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:d,dataLabels:h,numeric:t,backgroundContext:u,formatMode:g,onObject:this.featureSwitches.onObject}));for(var y=0,m=e;y<m.length;y++){var v=m[y];if(!_.isEmpty(v.labelDataPoints)){c=!0;break}}return!_.isEmpty(h)||!c},e.prototype.renderSeriesLabels=function(e,t,a,i,r){var o,s=this.axesRenderer.getSeriesLabelContainers(),n=s.seriesForeground,s=s.seriesBackground,l=new S.LabelLayout({maximumOffset:P.DataLabelViewModel.maxLabelOffset,startingOffset:P.DataLabelViewModel.startingLabelOffset,attemptToMoveLabelsIntoViewport:!0}),c=!!a&&!!a.seriesWordWrap,u=a?a.fontProperties.size.px:0,l=l.layout(e,t),i=a?a.seriesMaximumWidth/100*i:0,a=a&&a.seriesPosition===P.labelSeriesPosition.right?1:0;P.DataLabelRenderer.drawSeriesLabelsAndBackgrounds({labelContext:n,dataLabels:l,backgroundContext:s,availableWidth:i,position:a,seriesWordWrap:c,plotArea:t,seriesFontSize:u,formatMode:r,onObject:this.featureSwitches.onObject});for(var d=0,h=e;d<h.length;d++){var p=h[d];if(!_.isEmpty(p.labelDataPoints)){o=!0;break}}return!_.isEmpty(l)||!o},e.prototype.renderLayers=function(e,t,a,i){for(var r,o,s,n=[],l=[],c=[],u=[],d=!0,h=t.axes,p=t.plotArea,g=(a=a||_.some(e,function(e){return e.shouldSuppressAnimation&&e.shouldSuppressAnimation()}),!0),y=this,m=0,v=e;m<v.length;m++){var S=v[m],f=(D=w=C=x=b=f=void 0,S.render(a,i,y.options.formatMode));if(f){if(f.animateLabels||(g=!1),y.behavior&&(c=c.concat(f.dataPoints),u.push(f.behaviorOptions),f.navigationOptions)&&(r?r.navigationOptions.navigationStrategy=P.DataPointNavigationStrategy.CategoryFirst:(r={pointSourceKey:"cartesian-layer ".concat(y.options.multipleId||""),navigationOptions:{navigationStrategy:f.navigationOptions.navigationStrategy,helper:y.dataPointNavigationHelper}},y.dataPointNavigationHelper.clearNavigationLayers()),r.isHierarchicalAxis=y.options.isHierarchicalAxis,y.dataPointNavigationHelper.addNavigationLayer(f.navigationOptions.helper)),f.labelDataPointGroups)for(var b=0,x=f.labelDataPointGroups;b<x.length;b++)(C=x[b])&&n.push({labelDataPoints:P.DataLabelRenderer.removeDuplicates(C.labelDataPoints||[]),maxNumberOfLabels:C.maxNumberOfLabels,labelOrientation:C.isTotal?1:f.labelOrientation});else{S=f.labelDataPoints||[];n.push({labelDataPoints:P.DataLabelRenderer.removeDuplicates(S),maxNumberOfLabels:S.length,labelOrientation:f.labelOrientation})}if(f.labelDataPointSeriesGroups)for(var C,w=0,D=f.labelDataPointSeriesGroups;w<D.length;w++)(C=D[w])&&l.push({labelDataPoints:P.DataLabelRenderer.removeDuplicates(C.labelDataPoints||[]),maxNumberOfLabels:C.maxNumberOfLabels,labelOrientation:C.isTotal?1:f.labelOrientation});d=d&&f.labelsAreNumeric,y.lassoSelectionBehavior&&(void 0!==f.categorySubRangeCount&&void 0===o&&(o=f.categorySubRangeCount),void 0!==f.verticalCategoryAxis)&&void 0===s&&(s=f.verticalCategoryAxis)}}var h=this.getReferenceLineLabels(h,p),h=(_.isEmpty(h)||n.unshift({labelDataPoints:h,maxNumberOfLabels:h.length}),this.noLabelsCanBeRendered=!this.renderDataLabels(n,d,p,a,P.ComboChart.isComboChart(this.type),g),P.CartesianChartConverter.isLineComboChart(this.type)?P.CartesianChartConverter.getMaximumSeriesSettings(e):P.CartesianChartConverter.getDefaultLineChartSeriesLabelSettings()),e=t.viewport,A=t.margin,e=e.width-(A.left+A.right);this.noSeriesLabelsCanBeRendered=!this.renderSeriesLabels(l,p,h,e,this.options.formatMode),this.dataPointNavigationHelper.getPendingFocusElement&&r&&(r.navigationOptions.focusElement=this.dataPointNavigationHelper.getPendingFocusElement()),this.interactivityService&&(A={layerOptions:u,clearCatcher:this.clearCatcher,root:this.chartAreaSvg,axesLayout:t,categorySubRangeCount:o,verticalCategoryAxis:s},this.interactivityService.bind(c,this.behavior,A,r))},P.CartesianPlotAreaLayout=e}(powerbi=powerbi||{}),function(n){var p;function e(){var e;this.unSyncedLayout=[],this.maxMargin={top:0,bottom:0,left:0,right:0},this.axesRenderersByPosition=((e={})[2]=[],e[0]=[],e[1]=[],e)}p=n.visuals||(n.visuals={}),e.prototype.update=function(e,t,a,i,r,o,s,n){this.settings=e,this.coreMultiple=s,this.renderOptions=a,this.maxMargin={bottom:0,left:0,right:0,top:0},this.unSyncedLayout=[];var l=_.clone(this.getCoreMultipleData()),e=this.coreMultiple.layers;if(n.smallMultiplesUnsharedAxes&&!this.shouldShareAxis()){for(var c=0,u=t;c<u.length;c++){var d=u[c],h=d.getData(),d=d.layers,h=(h.axesData.x.showAxisTitle=!1,h.axesData.y.showAxisTitle=!1,h.axesData.y2.showAxisTitle=!1,l.axesData.y.sharedAxis||(h.axesData.x.show=!1),l.axesData.x.sharedAxis||(h.axesData.y.show=!1),p.CartesianAxesLayoutBuilder.build({data:h.axesData,interactivityOptions:this.settings.interactivity,referenceLines:h.referenceLines,type:this.settings.type,axes:this.settings.axes,layers:d,viewport:i,playAxesRect:this.renderOptions.playAxesRect,calculatePlotArea:this.settings.calculatePlotArea,trimOrdinalDataOnOverflow:this.renderOptions.trimOrdinalDataOnOverflow,axisZoom:void 0,rotateXTickLabels90:!0}));this.unSyncedLayout.push(h),h.margin.left>=this.maxMargin.left&&(this.maxMargin.left=h.margin.left),h.margin.right>=this.maxMargin.right&&(this.maxMargin.right=h.margin.right),h.margin.top>=this.maxMargin.top&&(this.maxMargin.top=h.margin.top),h.margin.bottom>=this.maxMargin.bottom&&(this.maxMargin.bottom=h.margin.bottom)}(l=_.clone(t[0].getData())).axesData.x.showAxisTitle=this.getCoreMultipleData().axesData.x.showAxisTitle,l.axesData.y.showAxisTitle=this.getCoreMultipleData().axesData.y.showAxisTitle,l.axesData.y.sharedAxis||(l.axesData.x.show=this.getCoreMultipleData().axesData.x.show,l.axesData.y.show=!1,l.axesData.y2&&(l.axesData.y2.show=!1,l.axesData.y2.showAxisTitle=this.getCoreMultipleData().axesData.y.showAxisTitle)),l.axesData.x.sharedAxis||(l.axesData.x.show=!1,l.axesData.y.show=this.getCoreMultipleData().axesData.y.show)}return this.generateSharedAxisLayout(l,e,i,r,o,n),this.unSyncedLayout},e.prototype.generateSharedAxisLayout=function(e,t,a,i,r,o){o.smallMultiplesUnsharedAxes&&!this.shouldShareAxis()&&(s=__assign({},this.maxMargin));var s,o={data:e.axesData,interactivityOptions:this.settings.interactivity,referenceLines:e.referenceLines,type:this.settings.type,axes:this.settings.axes,layers:t,viewport:a,playAxesRect:this.renderOptions.playAxesRect,calculatePlotArea:this.settings.calculatePlotArea,trimOrdinalDataOnOverflow:this.renderOptions.trimOrdinalDataOnOverflow,axisZoom:void 0,rotateXTickLabels90:!0,forceMarginMin:s};this.layout=p.CartesianAxesLayoutBuilder.build(o),this.clearUnusedRenderers(i,r,this.layout.shouldRenderAxis,this.layout)},e.prototype.getCoreMultipleData=function(){return this.coreMultiple.getData()},e.prototype.shouldShareAxis=function(){return this.getCoreMultipleData().axesData.x.sharedAxis&&this.getCoreMultipleData().axesData.y.sharedAxis},e.prototype.clearUnusedRenderers=function(e,t,a,i){e=a.x||i.isXScrollBarVisible?e:0,this.destroyUnusedRenderers(e,2);var e=a.y||i.isYScrollBarVisible?t:0,r=this.shouldRenderYAxis(0,this.settings.data.y.switchAxisPosition)?0:1,e=(this.destroyUnusedRenderers(e,r),a.y2||i.isYScrollBarVisible?t:0);this.destroyUnusedRenderers(e,0==r?1:0)},e.prototype.destroyUnusedRenderers=function(e,t){var a=this.axesRenderersByPosition[t];_.isEmpty(a)||a.length<=e||(a.slice(e,a.length).forEach(function(e){return e.destroy()}),this.axesRenderersByPosition[t]=a.slice(0,e))},e.prototype.calculateAxesLayout=function(e,t){return!e.smallMultiplesUnsharedAxes||this.shouldShareAxis()||void 0===t?this.calculateSynchronizedAxesLayout():void 0!==t?this.calculateUnSynchronizedAxesLayout(t):this.layout},e.prototype.calculateSynchronizedAxesLayout=function(){var e=_.cloneDeep(this.layout),t=(n.Prototype.copyPrototypeDeep(this.layout,e),e.axes);return t.x.scale=t.x.scale.copy(),t.y1.scale=t.y1.scale.copy(),t.y2&&(t.y2.scale=t.y2.scale.copy()),e},e.prototype.calculateUnSynchronizedAxesLayout=function(e){var t,a,i,r=_.cloneDeep(this.unSyncedLayout[e]),e=(n.Prototype.copyPrototypeDeep(this.unSyncedLayout[e],r),r.axes),o=r.plotArea=this.layout.plotArea,s=this.getCoreMultipleData().axesData;return s.y.sharedAxis||(r.axes.x.outerPadding=this.layout.axes.x.outerPadding,r.axes.x.outerPaddingRatio=this.layout.axes.x.outerPaddingRatio,r.axes.x.xLabelMaxWidth=this.layout.axes.x.xLabelMaxWidth,r.axes.x.categoryThickness=this.layout.axes.x.categoryThickness,r.isXScrollBarVisible=this.layout.isXScrollBarVisible,a=this.layout.axesOverflow.bottom+this.layout.axesOverflow.top-(r.axesOverflow.bottom+r.axesOverflow.top),i=r.axes.y1.scale,r.axes.y1.invertAxis?i.range([1,o.height+a-1]):i.range([o.height+a-1,1]),e.x.scale=this.layout.axes.x.scale.copy(),r.axes.y2&&(t=r.axes.y2.scale,r.axes.y1.invertAxis?t.range([1,o.height+a-1]):t.range([o.height+a-1,1])),r.margin.left=Math.max(this.maxMargin.left,r.margin.left),r.margin.right=Math.max(this.maxMargin.right,r.margin.right)),s.x.sharedAxis||(r.axes.y1.outerPadding=this.layout.axes.y1.outerPadding,r.axes.y1.outerPaddingRatio=this.layout.axes.y1.outerPaddingRatio,r.axes.y1.xLabelMaxWidth=this.layout.axes.y1.xLabelMaxWidth,r.axes.y1.categoryThickness=this.layout.axes.y1.categoryThickness,r.isYScrollBarVisible=this.layout.isYScrollBarVisible,t=this.layout.axesOverflow.left+this.layout.axesOverflow.right-(r.axesOverflow.left+r.axesOverflow.right),a=r.axes.x.scale,r.axes.x.invertAxis?a.range([o.width+t-1,1]):a.range([1,o.width+t-1]),s.x.show||(i=e.y1.scale,p.AxisHelper.isScaleBand(i)?(i.range([0,r.plotArea.height]),i.paddingOuter(r.axes.y1.outerPaddingRatio)):(o=null!=(a=e.y1.outerPadding)?a:0,i.range([r.plotArea.height-o,o]))),r.margin.bottom=Math.max(this.maxMargin.bottom,r.margin.bottom),r.margin.top=Math.max(this.maxMargin.top,r.margin.top)),r},e.prototype.renderAxes=function(e,t){var a,i,r,o;e.viewport.height<1||e.viewport.width<1||(r=p.CartesianChartLayout.addCartesianChartContainer(e.element,e.viewport),a=this.getCoreMultipleData(),i=__assign(__assign({},this.renderOptions),{supportsScrolling:this.shouldSupportScrolling(a,e.position),formatMode:this.settings.formatMode,subSelectionHelper:void 0}),r=this.getAxesRenderer(r.element,e.position,e.index,a),o=this.coreMultiple.layers,t=this.updateAxesLayoutByPosition(e.position,e.viewport,t),r.render(a.axesData,void 0,o,a.referenceLines,e.viewport,function(){},i,this.useManagedTabIndex(),t))},e.prototype.scrollDelta=function(t,e){this.updateScrollState(function(e){return e.scrollDelta(t)},e)},e.prototype.scrollTo=function(t,e){this.updateScrollState(function(e){return e.scrollTo(t)},e)},e.prototype.scrollBy=function(t,e){this.updateScrollState(function(e){return e.scrollBy(t)},e)},e.prototype.updateScrollbarExtent=function(t,e){this.updateScrollState(function(e){return e.setExtent(t)},e)},e.prototype.updateScrollState=function(a,i){var e=this.getCoreMultipleData(),r=this.getScrollablePosition(e),e=this.axesRenderersByPosition[r];2!==r&&_.isEmpty(i)||_.isEmpty(e)||e.forEach(function(e,t){2!==r&&(t<i.startIndex||t>i.endIndex)||a(e)})},e.prototype.updateAxesLayoutByPosition=function(e,t,a){var i=this.calculateAxesLayout(a),t=(i.viewport=this.adjustViewportForScroll(t,i.scrollHandleMargins),i.preferredPlotArea={width:0,height:0},this.getCoreMultipleData());return 2===e?(i.margin=this.getMarginByPosition(i.margin,e,i.axesOverflow),a.smallMultiplesUnsharedAxes&&(!t.axesData.y.sharedAxis&&t.axesData.y.show&&(i.margin.left=this.layout.margin.left,i.shouldRenderAxis.y=!1),t.axesData.x.sharedAxis||(i.margin.bottom=this.layout.margin.bottom),!this.shouldShareAxis())||(i.shouldRenderAxis.y=!1),i.shouldRenderAxis.y2=!1,i.shouldRenderAxis.y=!1,i.axisLabels.y=null,i.axisLabels.y2=null,i.plotArea.height=0):(i.plotArea.width=0,i.margin=this.getMarginByPosition(i.margin,e,i.axesOverflow),i.shouldRenderAxis.x=!1,i.axisLabels.x=null,this.shouldRenderYAxis(e,this.settings.data.y.switchAxisPosition)?(i.axisLabels.y2=null,i.shouldRenderAxis.y2=!1):(i.shouldRenderAxis.y=!1,i.axisLabels.y=null)),i},e.prototype.destroy=function(){var a=this;this.executeActionByPosition(this.axesRenderersByPosition,function(e,t){_.isEmpty(e)||(e.forEach(function(e){return e.destroy()}),a.axesRenderersByPosition[t]=[])})},e.prototype.executeActionByPosition=function(e,t){for(var a in this.axesRenderersByPosition)t(e[a],a)},e.prototype.clearRenderingTimeout=function(){this.executeActionByPosition(this.axesRenderersByPosition,function(e){_.isEmpty(e)||e.forEach(function(e){return e.clearRenderingTimeout()})})},e.prototype.shouldRenderYAxis=function(e,t){return 0===e&&!t||1===e&&t},e.prototype.getMarginByPosition=function(e,t,a){a=n.Prototype.inherit(a);return 2===t?(a.bottom=e.bottom,a.top=0):(a.left=0,(a.right=0)===t?a.left=e.left:1===t&&(a.right=e.right)),a},e.prototype.getScrollablePosition=function(e){return this.layout.isYScrollBarVisible?null!=(e=e.axesData.y)&&e.switchAxisPosition?1:0:this.layout.isXScrollBarVisible?2:void 0},e.prototype.shouldSupportScrolling=function(e,t){return this.getScrollablePosition(e)===t},e.prototype.getAxesRenderer=function(e,t,a,i){var r=$(e.node()),o=r.data("CartesianAxesRenderer");return o?o.update(i.axesData,i.scrollbarOptions):((i=n.Prototype.inherit(this.settings)).container=e,i.multipleId="".concat(a),i.behavior=new p.AxisBehavior,i.data.useManagedTabIndex=!0,this.axesRenderersByPosition[t][a]=o=new p.CartesianAxesRenderer(i),r.data("CartesianAxesRenderer",o)),o},e.prototype.adjustViewportForScroll=function(e,t){return t?{width:e.width-(t.left+t.right),height:e.height-(t.top+t.bottom),scale:e.scale}:e},e.prototype.useManagedTabIndex=function(){return this.renderOptions.isSmallMultiples},p.CartesianSharedAxisLayout=e}(powerbi=powerbi||{}),function(C){var w;function g(e,t,a,i,r,o,s,n,l,c,u,d,h,p){this.interactivityService=t,this.featureSwitches=a,this.getLocalizedString=i,this.behaviorFactory=s,this.layerStyle=n,this.viewMode=l,this.buildPlotAreaLayout=c,this.renderMultiple=u,this.adapterFactory=d,this.visualInstanceId=h,this.isSharedAxis=!0,this.sharedAxisLayout=new w.CartesianSharedAxisLayout,this.gridLayout=new w.GridLayout(e,function(){return r.loadMoreData()},o,t,p,"multiple"),this.visibilityHelper=C.responsiveVisualUtilModuleFactory().visibilityHelper(e,g.IconClassName)}w=C.visuals||(C.visuals={}),g.prototype.render=function(t){var e,a,i=this,r=(this.clearRenderingTimeout(),t.cartesianSmallMultipleFactory),o=(this.options=t).cartesianSmallMultipleFactory,s=this.adapterFactory(),n=s.getMultiplesSubheader(t.warnings),s=this.multiplesLayout=s.getMultiplesLayout(t.warnings),l=s.showIcon;if(this.visibilityHelper.updateVisibility({showIcon:l,viewport:t.viewport}),!l)return l={type:s.gridLineType,settings:{color:s.gridLineColor,style:s.gridLineStyle,width:s.gridLineWidth}},e=this.getCellPadding(s),a=this.getOuterPadding(s),s={categoryLoadMoreDataHandler:t.categoryLoadMoreDataHandler,playAxisControlLayout:t.playAxisControlLayout,trimOrdinalDataOnOverflow:t.trimOrdinalDataOnOverflow,suppressAnimations:t.suppressAnimations,resizeMode:t.resizeMode,rowCount:s.rowCount,columnCount:s.columnCount,getCellBackgroundColor:function(e){return i.getColorFromMultipleObjects(e,w.StandardObjectPropertyIdentifiers.smallMultiplesBackgroundColor,i.multiplesLayout.backgroundColor)},backgroundTransparency:s.backgroundTransparency,isHierarchicalAxis:t.isHierarchicalAxis,gridLineSettings:l,cellPadding:e,outerPadding:a},this.cellDimensions&&(this.cellDimensions.maxSubheaderHeight=void 0),this.renderGridLayout(r,t.viewport,function(e){return i.renderGridCell(o,e,t.background,t.playAxisControlLayout,t.suppressAnimations,t.resizeMode,t.trimOrdinalDataOnOverflow,t.categoryLoadMoreDataHandler,t.isHierarchicalAxis,!0)},function(e){return i.renderGridCellSubheader(e,o,n)},n,s,t.axisRendererSettings.axes.isYAxisCategorical)},g.prototype.clearRenderingTimeout=function(){this.sharedAxisLayout.clearRenderingTimeout(),this.gridLayout.clearRenderingTimeout()},g.prototype.destroy=function(){this.gridLayout.destroy(),this.sharedAxisLayout.destroy()},g.prototype.onScroll=function(e){this.sharedAxisLayout.scrollDelta(e,this.gridLayout.getScrollPosition()),this.options.cartesianSmallMultipleFactory.scrollDelta(e,this.getVisibleMultiples())},g.prototype.onExtentUpdate=function(e){this.sharedAxisLayout.updateScrollbarExtent(e,this.gridLayout.getScrollPosition()),this.options.cartesianSmallMultipleFactory.updateScrollbarExtent(e,this.getVisibleMultiples())},g.prototype.scrollTo=function(e){this.sharedAxisLayout.scrollTo(e,this.gridLayout.getScrollPosition()),this.options.cartesianSmallMultipleFactory.scrollTo(e,this.getVisibleMultiples())},g.prototype.shouldScrollTo=function(e){return this.options.cartesianSmallMultipleFactory.shouldScrollTo(e,this.getVisibleMultiples())},g.prototype.scrollBy=function(e){this.sharedAxisLayout.scrollBy(e,this.gridLayout.getScrollPosition()),this.options.cartesianSmallMultipleFactory.scrollBy(e,this.getVisibleMultiples())},g.prototype.getVisibleMultiples=function(){var e,t=this.options.cartesianSmallMultipleFactory.getFrameCount(),a=this.gridLayout.getScrollPosition();return a?(e=a.startIndex*this.multiplesLayout.columnCount,a=a.endIndex*this.multiplesLayout.columnCount,{startIndex:e,endIndex:Math.min(a,t)}):{startIndex:0,endIndex:0}},g.prototype.calculatePlotArea=function(e){_.clone(e.axesMargins);var t=e.axesMargins,a=e.axesOverflow,i=e.titleMargins,i=w.CartesianAxes.adjustAxesMarginsForShared(t,i,e.scrollHandleMargins,e.willRenderAxis,this.options.axesData.y.switchAxisPosition,e.axes,w.CartesianAxesLayoutBuilder.showAxisTitles(this.options.axesData,void 0)),i=(this.gridLayout.updateHeaderMargins(i),this.adapterFactory()),i=i?i.getMultiplesSubheader(this.options.warnings):w.CartesianChart.getMultiplesSubheader(this.options.cartesianSmallMultipleFactory.getObjects(),this.layerStyle),r=(i.titleWrap&&(r=this.getFrameDisplayNames()),{titleWrap:i.titleWrap,subheaders:r,subheaderFontProperties:i.fontProperties,subheaderLineHeight:i.height,subheaderMargin:i.margins});return!this.featureSwitches.smallMultiplesUnsharedAxes||this.options.axesData.y.sharedAxis&&this.options.axesData.x.sharedAxis?this.cellDimensions=this.gridLayout.calculateCellDimensions(a,r,e):(i=__assign({},a),!this.options.axesData.y.sharedAxis&&this.sharedAxisLayout.getCoreMultipleData().axesData.valueAxis.show&&(i.left=Math.max(t.left,a.left),i.right=Math.max(t.right,a.right)),!this.options.axesData.x.sharedAxis&&this.sharedAxisLayout.getCoreMultipleData().axesData.valueAxis.show&&(i.bottom=Math.max(t.bottom,a.bottom),i.top=Math.max(t.top,a.top)),this.cellDimensions=this.gridLayout.calculateCellDimensions(i,r,e)),this.cellDimensions.plotAreaViewport},g.prototype.scrollRowsTo=function(e){this.gridLayout,this.gridLayout.scrollTo(e)},g.prototype.getCellPadding=function(e){return{top:e.rowPaddingInner,bottom:0,left:e.columnPaddingInner,right:0}},g.prototype.getOuterPadding=function(e){return{top:e.rowPaddingOuter,bottom:e.rowPaddingOuter,left:e.columnPaddingOuter,right:e.columnPaddingOuter}},g.prototype.getFrameDisplayNames=function(){var t=this.getLocalizedString("ListJoin_Separator"),e=this.options.cartesianSmallMultipleFactory.reader.getFrameDisplayNames();return e&&e.map(function(e){return e.join(t)})},g.prototype.renderGridLayout=function(y,m,v,S,f,b,x){return __awaiter(this,void 0,C.Promise,function(){var t,a,i,r,o,s,n,l,c,u,d,h,p,g=this;return __generator(this,function(e){return t=this.getAxesRenderOptions(b),a=y.getFrameCount(),i=y.getCoreMultiple(),p=y.getShouldResetRowMultipleScrollPosition(),r=b.rowCount,o=b.columnCount,s=b.getCellBackgroundColor,n=b.backgroundTransparency,l=b.cellPadding,c=b.outerPadding,u=f.height,d=f.margins,h=f.show,u=u+d.top+d.bottom,d={rowCount:r,columnCount:o,viewport:m,renderCell:function(t){return __awaiter(g,void 0,C.Promise,function(){return __generator(this,function(e){return v(t),[2,new C.Promise(function(e){return e()})]})})},renderCellSubheader:function(t){return __awaiter(g,void 0,C.Promise,function(){return __generator(this,function(e){return S(t),[2,new C.Promise(function(e){return e()})]})})},cellCount:a,headerMargins:w.CartesianChartLayout.getEmptyMargins(),renderHeader:function(){},subheaderShow:h,subheaderHeight:this.cellDimensions&&this.cellDimensions.maxSubheaderHeight||u,subheaderLineHeight:f.height,subheaderPosition:1!==f.vertical?0:1,shouldResetScrollPosition:p,cellPadding:l,outerPadding:c,scrollPadding:5,getCellBackgroundColor:s,backgroundTransparency:n,gridLineSettings:b.gridLineSettings,getAllCells:function(){return y.multiples},manageTabIndexOnRowHeaderFooter:x,boldedSubheaders:f.labelBold},this.isSharedAxis&&(this.gridLayout.update(d),h=Math.ceil(a/o),this.sharedAxisLayout.update(this.options.axisRendererSettings,y.multiples,t,m,o,Math.max(h,r),i,this.featureSwitches),d.renderHeader=function(e){return g.sharedAxisLayout.renderAxes(e,g.featureSwitches)},d.headerMargins=this.cellDimensions.headerMargins,d.subheaderHeight=this.cellDimensions&&this.cellDimensions.maxSubheaderHeight||u),this.gridLayout.update(d),p=_.map(y.multiples,function(e){return e.getDataPoint()}),[2,this.gridLayout.render(this.cellDimensions,p,"multiples",this.visualInstanceId)]})})},g.prototype.renderGridCellSubheader=function(e,t,a){var i=e.element,r=e.index,o=e.viewport;if(!_.isUndefined(r)){var s=1===a.horizontal?"center":2===a.horizontal?"right":"left",n=this.getSubheaderFontProperties(r,a.fontProperties),s=(i.css(w.FontProperties.toHTMLStyle(n)),i.css({padding:"".concat(a.margins.top,"px ").concat(a.margins.right,"px ").concat(a.margins.bottom,"px ").concat(a.margins.left,"px "),"text-align":s}),this.getLocalizedString("ListJoin_Separator")),l=this.options.cartesianSmallMultipleFactory.reader.getDisplayNameForFrame(r),l=l&&l.join("".concat(s));if(i.attr("title",l),i.attr("id","".concat(this.visualInstanceId,"-").concat(r)),i.empty(),a.titleWrap&&(this.cellDimensions&&this.cellDimensions.maxSubheaderHeight)>a.height+a.margins.top+a.margins.bottom)for(var s=w.FontProperties.toTextProperties(n),n=o.width,c=jsCommon.WordBreaker.splitByWidth(l,s,C.TextMeasurementService.measureSvgTextWidth,n,w.GridLayoutSubheaderMaxLines,null,!0),u=0;u<c.length;u++){var d=c[u],d=$("<div/>").text(d);u===c.length-1&&d.addClass("truncate"),i.append(d)}else i.text(l);this.interactivityService&&(o=t.get(r),s=i.closest(w.GridLayoutSelectors.Cell.selector),e.styleSubheader(s,o,a.labelBold))}},g.prototype.getSubheaderFontProperties=function(e,t){e=this.getColorFromMultipleObjects(e,{objectName:w.SmallMultiplesUtils.SubheaderObjectName,propertyName:"fontColor"});return null==e?t:w.FontProperties.inherit(t,{color:e})},g.prototype.getColorFromMultipleObjects=function(e,t,a){if(null!=e){e=null==(e=this.options.cartesianSmallMultipleFactory.reader.getFrameNode(e))?void 0:e.objects;if(e){e=C.DataViewObjects.getFillColor(e,t);if(e)return e}}return a},g.prototype.getAxesRenderOptions=function(e){var t=this,a={scrollTo:function(e){return t.scrollTo(e)},shouldScrollTo:function(e){return t.shouldScrollTo(e)},scrollBy:function(e){return t.scrollBy(e)}};return __assign(__assign({},e),{animationDuration:this.options.animationSettings.duration,ease:this.options.animationSettings.ease,playAxesRect:e.playAxisControlLayout,viewMode:this.viewMode,isSmallMultiples:!0,isHierarchicalAxis:e.isHierarchicalAxis,preserveScrollPosition:!0,navigationScrollCallbacks:a})},g.prototype.renderGridCell=function(e,t,a,i,r,o,s,n,l,c){var u,d,h,p=t.viewport,e=e.get(t.index);2&e.getState()?e.getRenderer().attachToElement(t.element,t.viewport):(h=(u=w.CartesianChartLayout.addCartesianChartContainer(t.element,p)).element,d=null==(d=this.behaviorFactory)?void 0:d.create(),e.initRenderer(this.buildPlotAreaLayout(!0,h,u.clearCatcher,t.element,d))),this.interactivityService&&(h=t.element.closest(w.GridLayoutSelectors.Cell.selector),t.bindDataToGridCell(h,e,"multiple")),this.renderMultiple({multiple:e,viewport:p,background:a,axisZoom:void 0,chartAreaViewport:p,chartAreaMargins:w.CartesianChartLayout.getEmptyMargins(),renderedViewport:p,playAxisControlLayout:i,suppressAnimations:r,resizeMode:o,trimOrdinalDataOnOverflow:s,categoryLoadMoreDataHandler:n,isSharedAxis:!0,isHierarchicalAxis:l,preserveScrollPosition:c,supportsScrolling:!0,axesLayout:this.sharedAxisLayout.calculateAxesLayout(this.featureSwitches,e.index)})},g.IconClassName="cartesianChartResponsiveIcon",w.CartesianSmallMultipleLayout=g}(powerbi=powerbi||{}),function(y){var c,F,I,i,k,e,a,n,t,l;function r(){}function o(e){var t=a.call(this)||this;return t.matrix=e,t}function s(e){return t.call(this)||this}function u(e,t){var a=this,t=(this.sourceDataView=e,this.formatStringPropId=t,this.matrix=e.matrix,this.matrix.rows.root.children);this.hasRowChildren=!_.isEmpty(t),this.hasColChildren=!_.isEmpty(this.matrix.columns.root.children),this.hasSeries=this.hasColChildren&&!_.isEmpty(this.matrix.columns.levels)&&_.every(this.matrix.columns.levels[0].sources,function(e){return!e.isMeasure}),this.hasCategories=1<this.matrix.rows.levels.length&&this.hasRowChildren,this.objects=e.metadata.objects,this.frameCount=(t=this.matrix).rows.root.children?_.filter(t.rows.root.children,function(e){return!e.isSubtotal}).length:0,this._frameDisplayNames=new i(function(){return a.getDisplayNameFromAllFrames()})}c=y.visuals||(y.visuals={}),F=y.data.createDataViewScopeIdentity,I=y.data.DataViewMatrixUtils,i=jsCommon.Lazy,k=y.data.SQExprBuilder,r.prototype.ensureValueGroupAtSeriesIndex=function(e,t,a){var i;return e[t]||(i=this.getValueGroupName(a),a={identity:this.getSeriesIdentity(a),values:[],objects:this.getSeriesObjects(a),name:i},e[t]=a),e[t]},__extends(o,a=e=r),o.prototype.setSource=function(e){e.source=this.matrix.columns.levels[0].sources[0]},o.prototype.getSeriesGroups=function(e,t){return e&&_.map(e,function(e){return _.isEmpty(e.children)?1:e.children.length})},o.prototype.getSeriesDataPoints=function(e){var t=this.matrix.columns.root;return _.filter(t.children,function(e){return!e.isSubtotal})},o.prototype.getValueGroupName=function(e){return e.value||e.levelValues&&e.levelValues[0].value},o.prototype.getSeriesObjects=function(e){return e.objects},o.prototype.getSeriesIdentity=function(e){return e.identity},o.prototype.getSeriesSourceColumn=function(e,t){return void 0===t&&(t=null),_.create(e,{groupName:t})},o.prototype.createValueColumnForMeasure=function(e,t,a,i,r){return t[r]||(e={identity:this.getSeriesIdentity(e),values:[],source:this.getSeriesSourceColumn(a,i),objects:void 0},t[r]=e),t[r]},n=o,__extends(s,t=e),s.prototype.setSource=function(e){},s.prototype.getSeriesGroups=function(e,t){return t?[t]:[]},s.prototype.getSeriesDataPoints=function(e){return e},s.prototype.getValueGroupName=function(e){return e.displayName},s.prototype.getSeriesObjects=function(e){return e.objects},s.prototype.getSeriesIdentity=function(e){},s.prototype.getSeriesSourceColumn=function(e,t){return e},s.prototype.createValueColumnForMeasure=function(e,t,a,i,r){return t[r]||(e={identity:this.getSeriesIdentity(e),values:[],source:this.getSeriesSourceColumn(a,i),objects:[]},t[r]=e),t[r]},l=s,u.create=function(e,t){return new u(e,t)},u.prototype.getObjects=function(){return this.objects},u.prototype.getFrameDisplayNames=function(){return this._frameDisplayNames.getValue()},u.prototype.hasFrames=function(){var e=this.matrix.rows;return this.matrix&&0<this.frameCount&&!_.isEmpty(e.levels)&&!!this.getFrameSourceColumns()},u.prototype.getFrameCount=function(){return this.frameCount},u.prototype.getFrameSourceColumns=function(){return this.matrix.rows.levels[0].sources},u.prototype.getFrameNode=function(e){return this.matrix.rows.root.children[e]},u.prototype.getValueSources=function(e){return e?(e=this.hasCategories?1:0,e=this.matrix.rows.levels[e],I.getScopedValueSources(e)):this.matrix.valueSources},u.prototype.buildCategoricals=function(e,P,L,t,a){var M=this,e=this.matrix.rows.root.children[e],V=[],T=(a.forEach(function(e,t){V[t]={shouldReadScopedValues:!e&&M.hasSeries}}),a.map(function(e){return new(M.hasSeries&&e?n:l)(M.matrix)}));V.forEach(function(e){e.allValueSources=M.getValueSources(e.shouldReadScopedValues)});for(var i=0;i<T.length;i++){var r=this.findUniqueFilteredValueSourcesAndIndices(V[i].allValueSources,t&&t[i]),o=r[0],r=r[1],o=(V[i].requiredValueSources=o,V[i].requiredValueSourcesIndices=r,T[i].setSource(P[i].values),T[i].getSeriesDataPoints(o)),o=(V[i].seriesNodes=o,T[i].getSeriesGroups(o,r.length));V[i].seriesGroups=o,V[i].valueGroups=Array(o.length)}for(var e=this.hasCategories?e.children:[e],s=(I.forEachLeafNode(e,function(t,e,a){if(!t.isSubtotal){if(M.hasCategories){var i,r,o=a,s=L,n=_.last(o).objects,l=o[0];if(1<o.length){(r=new Array(o.length))[0]=l.levelValues[0].value;for(var c=l.identity.expr,u=1,d=o.length;u<d;u++)l=o[u],r[u]=l.levelValues[0].value,c=k.and(c,l.identity.expr);i=F(c)}else i=l.identity,r=_.map(l.levelValues,function(e){return e.value});for(var h=0,p=s.length;h<p;h++)s[h].identity.push(i),s[h].objects.push(n),s[h].values.push(r[h])}for(var g=V.map(function(e){return e.shouldReadScopedValues?I.getNodeScopedValues(t):t.values}),y=0;y<V.length;y++)for(var m=V[y],v=0;v<m.seriesGroups.length;v++){for(var S=m.seriesNodes&&m.seriesNodes[v],f=m.seriesGroups[v],b=T[y].ensureValueGroupAtSeriesIndex(m.valueGroups,v,S),x=[],C=0;C<f;C++){var w=v*f+C,D=T[y].createValueColumnForMeasure(S,P[y].values,m.requiredValueSources[m.shouldReadScopedValues?w:C],b.name,w),A=(M.hasSeries||(w=m.requiredValueSourcesIndices[w]),null==(A=null==g?void 0:g[y])?void 0:A[w]);_.isEmpty(m.requiredValueSources)||M.readValues(A,D,e),x.push(D)}b.values=x}}}),this.hasSeries&&this.hasCategories&&_.isEmpty(V.filter(function(e){return!_.isEmpty(e.requiredValueSources)}))),i=0;i<P.length;i++)y.data.DataViewTransform.setGrouped(P[i].values,V[i].valueGroups),_.isEmpty(V[i].requiredValueSources)&&(a[i]?s||(P[i].values=void 0):P[i]=void 0)},u.prototype.findUniqueFilteredValueSourcesAndIndices=function(a,i){if(_.isEmpty(a))return[[],[]];for(var r=[],o=[],s={},e=0;e<a.length;e++)!function(e){var t=a[e];!_.isEmpty(i)&&!_.some(i,function(e){return t.roles[e]})||s[t.queryName]||(r.push(e),o.push(t),s[t.queryName]=!0)}(e);return[o,r]},u.prototype.readCategories=function(){var e;this.matrix.rows;if(this.hasCategories)return this.fillCategoriesMetadata(e=[]),e},u.prototype.fillCategoriesMetadata=function(e){for(var t=this.matrix.rows.levels,a=1;a<t.length;a++)for(var i=0,r=t[a].sources;i<r.length;i++){var o=r[i];e.push({source:o,values:[],identity:[],objects:[]})}},u.prototype.convertComboFrame=function(e){var t=c.ComboChart.getRoleGroups();return this.convertFrameInternal(e,t)},u.prototype.createEmptyCategorical=function(e){var t;return(t=e.values).push.apply(t,(t=this.matrix.valueSources,(_.isEmpty(t)?[]:_.map(t,function(e){return{identity:void 0,values:[],source:e,objects:[]}}))||[])),{metadata:this.sourceDataView.metadata,categorical:e}},u.prototype.convertFrame=function(e){return this.convertFrameInternal(e)[0]},u.prototype.checkValueRolesInList=function(e,t){for(var a=0,i=t;a<i.length;a++){var r=function(t){if(_.some(e,function(e){return t.roles[e]}))return{value:!0}}(i[a]);if("object"==typeof r)return r.value}return!1},u.prototype.validateValueRoles=function(e){var t;_.isEmpty(e)||(this.checkValueRolesInList(e,this.matrix.valueSources),t=this.getValueSources(!0),t&&this.checkValueRolesInList(e,t))},u.prototype.isForColumnValues=function(e){var t=c.ComboChart.getRoleGroups()[0];return _.isEmpty(e)||0<_.intersection(e,t).length},u.prototype.convertFrameInternal=function(e,t){for(var a=this,i=[],r=this.matrix,o=[],s=(_.isEmpty(t)?o.push(!0):t.forEach(function(e){a.validateValueRoles(e),o.push(a.isForColumnValues(e))}),[]),n=_.isEmpty(t)?1:t.length,l=0;l<n;l++)s.push({categories:void 0,values:y.data.DataViewTransform.createValueColumns()});if(!this.hasCategories){for(var c=[],u=!0,l=0;l<s.length;l++)if(o[l]){if(!_.isEmpty(r.valueSources)&&this.hasRowChildren){u=!1;break}!this.hasSeries&&1!==s.length||(c[l]=this.createEmptyCategorical(s[l]))}else if(!_.isEmpty(this.getValueSources(this.hasSeries))){u=!1;break}if(u)return c}var d=this.readCategories();this.buildCategoricals(e,s,d,t,o);for(var h=0,p=s;h<p.length;h++){var g=p[h];g&&(g.categories=d,i.push({metadata:this.sourceDataView.metadata,categorical:g}))}return i},u.prototype.readValues=function(e,t,a){t.values||(t.values=[]),e?(t.values[a]=null==e.value?null:e.value,void 0!==e.highlight&&(t.highlights||(t.highlights=[]),t.highlights[a]=e.highlight),void 0!==e.objects&&(t.objects||(t.objects=[]),t.objects[a]=e.objects),void 0!==e.highlightObjects&&(t.highlightObjects||(t.highlightObjects=[]),t.highlightObjects[a]=e.highlightObjects)):t.values[a]=null},u.prototype.getDisplayNameFromAllFrames=function(){for(var e=new Array(this.frameCount),t=0;t<this.frameCount;t++){var a=this.getDisplayNameForFrame(t);e[t]=a}return e},u.prototype.getDisplayNameForFrame=function(e){var i=this,r=this.getFrameNode(e),e=this.getFrameSourceColumns(),o=new Array(e.length);return e.forEach(function(e,t){r.levelValues;var a=r.levelValues&&r.levelValues[t].value,e=new c.valueFormatter.VariantValueFormatter({column:e,formatStringPropId:i.formatStringPropId,nullsAreBlank:!0,trailingZeroes:!0});o[t]=e.format(a)}),o},u.prototype.getSubtotals=function(){var e=_.find(this.matrix.rows.root.children,function(e){return e.isSubtotal});if(e){for(var t=_.size(e.values),a=_.size(this.matrix.valueSources),i=t-a,r={},o=0;o<a;o++){var s,n=this.matrix.valueSources[o].roles,l=c.AxisHelper.normalizeNonFiniteNumber(e.values[i+o].value);for(s in n)r[s]=l}return r}},u.prototype.getTopLevelAggregates=function(e){for(var t={},a=0,i=this.sourceDataView.metadata.columns;a<i.length;a++){var r=i[a];if(r.roles&&r.aggregates)for(var o=0,s=e;o<s.length;o++){var n=s[o];r.roles[n]&&(t[n]=t[n]||[]).push(r.aggregates)}}return _.isEmpty(t)?void 0:t},c.DataViewMultipleReader=u}(powerbi=powerbi||{}),function(e){((e=e.powerbi||(e.powerbi={})).visuals||(e.visuals={})).importCartesianChartsModule=function(){}}(es6=es6||{}),function(Be){var Re;function e(e){this.options=e}Re=Be.visuals||(Be.visuals={}),e.prototype.convert=function(){var X,K,q,Z,$,J,Q,m,v,S,ee,te,ae,f,ie,e=this.options,P=e.dataView,n=e.style,re=e.interactivityService,L=e.shouldCalculateStacked,M=e.isComboChart,b=e.forecastDataView,t=e.anomalyDetectionDataView,x=e.supportsTotalLabels,a=e.tooltipsEnabled,oe=void 0===a||a,V=e.featureSwitches,T=e.multipleInfo,F=e.host,a=Re.CartesianHelper.getCategoryAxisProperties(P.metadata),I=Re.CartesianHelper.isScalar(this.options.isScalar,a),se=Re.CartesianHelper.getReverseStackOrder(a),ne=P.categorical,e=Re.CartesianHelper.getScalarKeyinfo(ne,I),k=e.category,O=e.useScalarKeys,le=e.scalarKeys,N=(O&&(($=Be.Prototype.inherit(k.source)).type={dateTime:!0}),Re.lineChartProps.general.formatString),e=Re.AxisHelper.getCategoryValueType(k.source,I),B=Re.AxisHelper.isDateTime(e),ce=k.values,R=[],H=[],ue=[],l=[],U=ne.values,j=!(!U||!U.source),c=Re.LineChart.getDefaultLineChartLabelSettings(n,M),de=Re.ColorHelper.create(n),he=(T&&(J=_.first(T.sources).metadata.queryName,Q=T.sources.map(function(e){return Re.buildValueDetailsForColumnValue(e.metadata,e.value,T.identity)}),m=(new Re.SelectionIdBuilder).withColumnIdentity(T.identity,J,Q).createSelectionId(),v=Re.FormattingStrategies.defaultFormatter(N),S=Re.DataViewConcatenateUtil.concatenateValues(_.map(T.sources,function(e){return v(e.value,e.metadata)}))),!(T&&T.isCoreMultiple)),z=M?["Y2"]:["Y","Y2"],E=Be.data.createDataViewCategoricalReaderAdvanced(P,{staticSeriesRoleNames:z,colorOptions:{visualStyle:n,valueRole:z[0],ignoreDefaultColor:M,ignoreDefaultCategoryColor:!0},formatStringProp:N,errorRangeProp:Re.ErrorObjectProps.errorRange}),e=(P.metadata&&P.metadata.objects&&(y=(ee=P.metadata.objects).labels,Re.DataLabelViewModel.updateLabelSettingsFromLabelsObjectWithLabelDensity(y,c,void 0,n,M)),Be.DataViewObjects.getValue(ee,Re.lineChartProps.lineStyles.showMarker,!1)),i=__assign(__assign({},c),{show:!1}),x=(x&&P.metadata&&P.metadata.objects&&(x=P.metadata.objects.totals)&&Re.DataLabelViewModel.updateLabelSettingsFromLabelsObject(x,i,!1,n,M),U&&(te=U.grouped()),L&&(ae=U&&0<U.length?_.times(U[0].values.length,function(){return 0}):[]),!1),W=E.data,G=E.columns,pe=W.hasCategories()?W.getCategoryCount():1,ge=W.getSeriesCount(),ye=this.allocateSeriesColors(E),u=E.objects.getStaticObjects(),me=Re.LineStyle.readFromStaticObjects(u,e,n),e=Be.DataViewObjects.getValue(u,Re.lineChartProps.dataPoint.transparency,Re.LineChart.DefaultAreaTransparency),ve=G.getAllValueMetadataColumnsForRole(z[0]),Se=(2===z.length&&(ve=__spreadArray(__spreadArray([],ve||[],!0),G.getAllValueMetadataColumnsForRole(z[1])||[],!0)),[]),Y=[],fe=[],be=(t&&I&&!L&&!M&&(ie=Re.AnomalyDetectionVisualPlugin.readDataView(t,P,n,N)),this.getSeriesName(E,z,se)),d=Re.CartesianChartConverter.getDefaultLineChartSeriesLabelSettings();if(_.some(z,function(e){return W.hasValues(e)})){for(var xe=E.columns.getSeriesCount(z[0]),x=!0,Ce=!1,we=(null==f&&(f=j?Re.converterHelper.formatFromMetadataColumn(W.getSeriesDisplayName(),G.getSeriesMetadataColumn(),N):void 0),d=Re.LineChart.getDefaultLineChartSeriesLabelSettings(n),P.metadata&&P.metadata.objects&&(y=(ee=P.metadata.objects).seriesLabels,Re.DataLabelViewModel.updateSeriesLabelSettingsFromLabelsObject(y,d,n,M),t=Re.LineChart.getDefaultLineChartSeriesWidthSettings(d.fontProperties,be),d.defaultSeriesWidth=d.defaultSeriesWidth?t:null,d.seriesMaximumWidth=d.defaultSeriesWidth?t:d.seriesMaximumWidth),c.fontProperties.color),C=i.fontProperties.color,w=function(e){for(var p=null!=V&&V.flipStackOrder&&se?ge-e-1:e,e=(xe<=p&&(Ce=!0),G.getValueColumnBySeries(p)),g=te&&te[p],y=fe[p]=e.source,m=[],t=y.queryName,t=Re.SelectionIdBuilder.builder().withSeries(U,g,!0).withMeasure(t).createSelectionId(),v=t.getKey(),a=ye[p],S=void 0,i=void 0,r=((E.data.hasSeries()||M)&&(r=null==(o=M&&!E.data.hasSeries()?E.objects.getValueMetadataObjectsBySeries(p):E.objects.getSeriesDataObjects(p))?void 0:o.labels,o=null==o?void 0:o.seriesLabels,(S=Be.Prototype.inherit(c)).show=c.show&&(null==(X=c.showByDefault)||X),r&&Re.DataLabelViewModel.updateLabelSettingsFromLabelsObjectWithLabelDensity(r,S,void 0,n,M),(i=Be.Prototype.inherit(d)).show=d.show&&(null==(X=d.showByDefault)||X),o)&&Re.DataLabelViewModel.updateSeriesLabelSettingsFromLabelsObject(o,i,n,M),y.objects),f=Re.UncertaintyHelper.convertErrorMetadata(r,n,a,p,__assign(__assign({},c),{show:!1}),{isCombo:M,staticObjects:u}),b=f.hasUncertainty,x=null!=S?S:c,o=null!=i?i:d,C=0<(null==(K=e.highlights)?void 0:K.length),r=Be.DataViewObjects.getValue(ee,Re.lineChartProps.lineStyles.showSeries,!0),w=Re.LineStyle.readFromSeriesObjects(E,me,p,r,n),D=-1,i=_.get(ie,p),A=void 0,s=(i&&(A=new Re.AnomalyDetectionVisualPlugin.AnomalyTooltipBuilder(F,i,y,N)),0);s<pe;s++)!function(a){var e,t,i,r,o,s,n,l,c=ce[a],u=O?null==(q=le.values[a])?void 0:q.min:c,d=Re.AxisHelper.normalizeNonFiniteNumber(C?W.getHighlightBySeries(a,p):W.getValueBySeries(a,p)),h=C?W.getHighlightFormatStringBySeries(a,p):W.getFormatStringBySeries(a,p);I&&(null==u||null==d)||B&&null!=c&&!(c instanceof Date)||(D++,null==d&&0<p)||(c=void 0,o=void(b&&(c=Re.UncertaintyHelper.convertCategoricalDataPoint(W,a,p,d))),t=e=void 0,oe&&(o=[],T&&(n=new Re.LazyTooltipBuilder,s=Re.FormattingStrategies.defaultFormatter(N),n.withMultipleColumnAndValues(T.sources.map(function(e){return e.metadata}),T.sources.map(function(e){return e.value}),!0,s),o.push.apply(o,n.getTooltipItems())),k.source&&(t=Re.CategoryLevelUtils.getCategoryLevels(P.categorical.categories,a,N),s=Re.CategoryLevelUtils.concatenateCategoryLevels(t),o.push({displayName:s.displayName,value:s.value})),n=function(e){return Re.converterHelper.formatFromMetadataColumn(e,y,N,!1,h)},!j||k.source&&k.source===U.source||o.push({displayName:U.source.displayName,value:Re.converterHelper.formatFromMetadataColumn(te[p].name,U.source,N)}),null!=d&&(s=f.tooltips,!b||!s.show||s.format!==Re.errorFormat.range||(s=Re.UncertaintyHelper.getTooltipItems(c,d,f,n,F,{overrideDisplayName:y.displayName}),_.isEmpty(s))?o.push({displayName:y.displayName,value:n(d)}):o.push(s[0])),b&&(M&&f.tooltips.format!==Re.errorFormat.range?o.push.apply(o,Re.UncertaintyHelper.getTooltipItems(c,d,f,n,F,{hideMarker:!0})):Re.UncertaintyHelper.setTooltipItems(c,d,f,n,F)),Re.TooltipBuilder.addTooltipMeasures(E,e=[],a,j?p:void 0,N),(s=null==A?void 0:A.getTooltipItems(a,h))&&e.push.apply(e,s),e=_.isEmpty(e)?void 0:e),n=new Re.SelectionIdBuilder,s=G.getCategoryColumn("Category"),i=null!=(q=ne.originalCategories)?q:[k],W.hasCategories()&&(n=n.withCategory(i,a,null==(Z=null==s?void 0:s.source)?void 0:Z.queryName,!0)),j&&(n=n.withSeries(U,g,!0)),s=(n=T?n.withColumnIdentity(T.identity,J,Q):n).withMeasure(y.queryName,G.getValueColumn(Ce?z[1]:z[0],p),a).createSelectionId(),n=k&&!_.isEmpty(k.identity)&&k.identity[a]?k.identity[a].key:a,Y[a]||(Y[a]={positive:0,negative:0,net:0,categoryValue:De.convertCategoryValue(u,B,O),categoryIndex:a,dynamicFormatString:h}),l=Math.abs(d),isNaN(l)||(d<0?(Y[a].net-=l,Y[a].net<Y[a].negative&&(Y[a].negative=Y[a].net)):(Y[a].net+=l,Y[a].net>Y[a].positive&&(Y[a].positive=Y[a].net))),l=Re.DataLabelUtil.determineDataLabelFillColor({defaultColor:we,seriesColor:null==S?void 0:S.fontProperties.color,categoricalDataReader:E,categoryIndex:a,seriesIndex:p}),r=null!=V&&V.measureDrivenDataLabels?Re.DataLabelUtil.extractDynamicLabel({categoricalDataReader:E,categoryIndex:a,seriesIndex:p,enabled:x.showDynamicLabels}):void 0,u={categoryValue:De.convertCategoryValue(u,B,O),value:d,categoryIndex:a,seriesIndex:p,tooltipInfo:o,selected:!1,identity:s,key:JSON.stringify({series:v,category:n}),labelFill:l.color,labelFormatString:h||y.format,labelSettings:x,uncertainty:c,additionalTooltipItems:e,hierarchyCategoryLevels:t,lineStyle:w,isY2:Ce,dynamicLabelValue:r},L&&(ae[a]+=d,u.stackedValue=ae[a]),o=Re.lineChartProps.dataPoint.fill,(s=k.objects&&k.objects[a])&&de.hasColorForProperty(s,o)&&(u.pointColor=de.getColorForProperty(s,o,void 0)),m[D]=u,R[a]||(R[a]=Re.CartesianHelper.extractCategoryFromDataPoint(u)),R[a]&&!R[a].hasData&&(R[a].hasData=null!=u.value),n=function(e){var t=(new Re.SelectionIdBuilder).withCategory(i,a,null==(t=null==k?void 0:k.source)?void 0:t.queryName,!0);return j||1!==ge||t.withMeasure(y.queryName),e&&T&&t.withColumnIdentity(T.identity,J,Q),t},W.hasCategories()&&(H[a]||(l=n(!1),H[a]=l.createSelectionId()),ue[a]||(c=n(!0),ue[a]=c.createSelectionId())))}(s);r=_.findIndex(ve,y),-1!==r&&(Se[r]?Se[r].usedInSeriesIndices.push(p):Se[r]={metadataColumn:y,usedInSeriesIndices:[p],valueSelector:(new Re.SelectionIdBuilder).withMeasure(y.queryName,e).createSelectionId()}),re&&re.applySelectionStateToData(_.filter(m,function(e){return null!=e})),i=n.isHighContrast?Re.ColorHelper.getThemeColor(n,Re.BackgroundColorName):a;(0<m.length||!he)&&l.push({seriesName:be[p],key:v,lineIndex:p,color:a,areaColor:i,xCol:O?$:k.source,yCol:y,data:m,identity:t,selected:!1,uncertainty:f,labelSettings:S,seriesSettings:o,type:y.type,lineStyle:w,isY2:Ce})},De=this,r=0;r<ge;r++)w(r);if(L&&F&&oe&&i.show)for(var D=F.getLocalizedString("Visual_Total"),A=[],r=0;r<ge;r++){var o=null!=V&&V.flipStackOrder&&se?ge-r-1:r;if(l[o])for(var Ae=l[o].data,Pe=fe[o],s=0;s<Ae.length;s++){var Le,h=l[o].data[s];h&&(Le=void 0,p=h.categoryIndex,h=Re.DataLabelUtil.determineTotalLabelFillColor({defaultColor:C,categoricalDataReader:E,categoryIndex:p,seriesIndex:o}),Y[p].labelFill=h.color,h=Re.DataLabelUtil.isAssignedColor(h)?h.color:C,i.fontProperties=Re.DataLabelUtil.updateFontPropertiesColor(h,i.fontProperties),A[p]||(A[p]={net:{displayName:D,value:Re.converterHelper.formatFromMetadataColumn(Y[p].net,Pe,N,!1)}}),Le=A[p].net,l[o].data[s].tooltipInfo||(l[o].data[s].tooltipInfo=[]),l[o].data[s].tooltipInfo.push(Le),l[o].data[s].additionalTooltipItems||(l[o].data[s].additionalTooltipItems=[]),l[o].data[s].additionalTooltipItems.push(Le))}}}if(b&&I&&!L&&!M)for(var Me=Re.ForecastHelper.readDataView(b,P,n),Ve=_.last(R),Te=0,Fe=Me;Te<Fe.length;Te++)for(var Ie=Fe[Te],p=Ve.categoryIndex,ke=0,Oe=Ie.points;ke<Oe.length;ke++){var _e,g=Oe[ke],Ne=(g.point.x=this.convertCategoryValue(g.point.x,B,O),g.upperBound.x=this.convertCategoryValue(g.upperBound.x,B,O),g.lowerBound.x=this.convertCategoryValue(g.lowerBound.x,B,O),g.point.x);Ne<=Ve.categoryValue||(p++,_e=Re.CategoryLevelUtils.getCategoryLevels(P.categorical.categories,p,N),R[p]||(R[p]={categoryIndex:p,categoryValue:Ne,hasData:null!=g.point.y,hierarchyCategoryLevels:_e}),H[p]||(H[p]=null),ue[p])||(ue[p]=null)}var y=!1,t=P.metadata&&P.metadata.dataReduction;return t&&t.categorical&&(t.categorical.metadata&&t.categorical.metadata.binnedLineSample||t.categorical.categories&&t.categorical.categories.binnedLineSample||t.categorical.values&&t.categorical.values.binnedLineSample)&&(y=!0),a=Re.CartesianHelper.getCategoryAxisProperties(P.metadata),null!=re&&re.applySelectionStateToData(l),{series:l,totals:Y,forecastLines:Me,anomalyDetections:ie,isScalar:I,dataLabelsSettings:c,totalLabelsSettings:i,seriesLabelSetings:d,hasDynamicSeries:j,hasY2Role:Be.data.DataRoleHelper.hasRoleInDataView(P,"Y2"),categoryMetadata:k.source,valuesMetadata:ve,valuesMetadataBySeries:Se,preferredCategoryWidth:Re.CartesianHelper.getPreferredCategoryWidth(a),scalarMetadata:$,scalarKeyCount:O?le.values.length:void 0,categories:ce,categoryData:R,seriesDisplayName:f,hasValues:x,categoryIdentities:H,multiplesCategoryIdentities:ue,lineStyle:me,binnedLineSamplingApplied:y,legendMarkerRendering:Be.DataViewObjects.getValue(u,Re.lineChartProps.legend.legendMarkerRendering,null!=V&&V.removeDefaultToCircleToggle?Re.legendMarkerRendering.markerCircleDefault:Re.legendMarkerRendering.markerOnly),matchLineColor:Be.DataViewObjects.getValue(u,Re.lineChartProps.legend.matchLineColor,!0),defaultToCircle:Be.DataViewObjects.getValue(u,Re.lineChartProps.legend.defaultToCircle,!0),isComboChart:M,multipleIdentity:m,multipleDisplayName:S,areaTransparency:e}},e.prototype.allocateSeriesColors=function(e){for(var t=e.data.getSeriesCount(),a=[],i=0;i<t;i++)a.push(e.colors.createBySeries(i,void 0,Re.ForegroundColorName));return a},e.prototype.getSeriesName=function(a,i,r){var o=this,s=a.data.getSeriesCount();return _.range(s).map(function(e){var t=null!=(t=o.options.featureSwitches)&&t.flipStackOrder&&r?s-e-1:e;return a.columns.hasDynamicSeries()?Re.valueFormatter.format(a.data.getSeriesName(t),a.objects.getSeriesFormatString(t)):a.columns.hasStaticSeries()?a.data.getSeriesName(t):a.data.getValueDisplayName(i[0])})},e.prototype.convertCategoryValue=function(e,t,a){return e&&(t||a)?e.epochTimeStamp:e},Re.LineChartConverter=e}(powerbi=powerbi||{}),function(e){(e.visuals||(e.visuals={})).initializeCartesianChartsFactoryES6=function(){e.visuals.setCreateCartesianChart(function(t){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createCartesianChart(t)})}),e.visuals.setCreateWebColumnChartAnimator(function(t){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createWebColumnChartAnimator(t)})}),e.visuals.setCreateRealTimeLineChartAnimator(function(t){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createRealTimeLineChartAnimator(t)})}),e.visuals.setCreateDashboardColumnChartAnimator(function(t){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createDashboardColumnChartAnimator(t)})}),e.visuals.setCreateCartesianChartBehaviorFactory(function(t,a){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createCartesianChartBehaviorFactory(t,a)})}),e.visuals.setCreateColumnChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createColumnChartWebBehaviorFactory()})}),e.visuals.setCreateDataDotChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createDataDotChartWebBehaviorFactory()})}),e.visuals.setCreateLineChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createLineChartWebBehaviorFactory()})}),e.visuals.setCreateScatterChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createScatterChartWebBehaviorFactory()})}),e.visuals.setCreateWaterfallChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createWaterfallChartWebBehaviorFactory()})}),e.visuals.setCreateScatterChartMobileBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createScatterChartMobileBehaviorFactory()})})}}(powerbi=powerbi||{}),function(Ve){Ve.waterfallConverterModuleFactory=function(){var r=Ve.data,d=Ve.visuals,Se=d.AxisHelper,fe=d.CartesianHelper,be=d.ColorHelper,xe=d.converterHelper,Ce=r.DataRoleHelper,we=d.ForegroundColorName,h=jsCommon.Lazy,De=Ve.visuals.SelectionId,Ae=r.Selector,o=r.SQExprBuilder,p=jsCommon.StringExtensions,Pe=Ve.visuals.WaterfallChart,Le=Ve.visuals.waterfallChartProps;function e(e){var B,R,t=e.dataView,o=e.hostServices,s=e.dataLabelSettings,n=e.sentimentColors,a=e.interactivityService,H=e.tooltipsEnabled,i=e.numberOfBreakdowns,r=t.matrix,l=!_.isEmpty(r.columns.levels)&&r.columns.levels[0].sources[0],c=!_.isEmpty(r.rows.levels)&&r.rows.levels[0].sources,U=_.findIndex(r.valueSources,function(e){return Ce.hasRole(e,"Y")}),u=r.valueSources[U],d=_.filter(r.valueSources,function(e){return Ce.hasRole(e,"Tooltips")}),h=[],p=[],g={current:0,min:0,max:0},j=0,y=null==(y=null==t?void 0:t.metadata)?void 0:y.objects,z=!0;if(l||(z=Ve.DataViewObjects.getValue(y,Le.valueAxis.totalsEnabled,!0)),l&&c&&u){var m=new Me(l,c,u),v=u.format,S=o.getLocalizedString("Waterfall_OtherLabel"),f=Pe.formatStringProp,b=r.rows.root.children,E=r.columns.root.children;if(!_.isEmpty(b)&&!_.isEmpty(E)){var W=b.length,G=E.length,Y=0,x=void 0,X=void 0,K=_.size(d)+1;0<W&&(j=_.size(b[0].values)/K-1);for(var i=Math.min(i,j),C=0;C<W;C++){for(var w=void 0,D=b[C],A=0<C?b[C-1]:void 0,q=_.map(D.levelValues,function(e){return e.value}),P=_.map(q,function(e,t){return xe.formatFromMetadataColumn(e,c[t],f)}).join(" "),Z=m.splitIdentity(D.identity.expr),$=[],J=_.size(D.values),L=0;L<J;L+=K){for(var M,Q=void 0,ee=void 0,te=void 0,ae=void 0,ie=[],re=[],V=0;V<K;V++)V===U?(M=D.values[L+V],Q=Se.normalizeNonFiniteNumber(M.value),te=Ve.DataViewObjects.getValue(M.objects,f),ae=Ve.DataViewObject.getFillColorByPropertyName(null==(M=M.objects)?void 0:M.labels,"color"),w=w||te,ee=A&&Se.normalizeNonFiniteNumber(A.values[L+V].value)):(ie.push(D.values[L+V].value),re.push(A&&A.values[L+V].value));var oe={key:L,currentValue:Q,previousValue:ee,difference:(Q||0)-(ee||0),column:E[L/K],currentTooltipValues:ie,previousTooltipValues:re,formatString:te};null!=ae&&(oe.labelColor=ae),$.push(oe)}var se,$=_.sortBy($,function(e){return-1*Math.abs(e.difference)}),T=_.chain($).filter(function(e){return!e.column.isSubtotal}).take(i).sortBy(function(e){return-1*e.difference}).value(),F=_.find($,function(e){return e.column.isSubtotal}),I=F.currentValue,k=F.previousValue;if(A){var O=_.sumBy(T,function(e){return e.currentValue}),ne=_.sumBy(T,function(e){return e.previousValue}),le=_.chain(T).map(function(e){return m.splitIdentity(e.column.identity.expr)}).flatten().value(),ce=i+1<G,N=0,ue=void 0,de=void 0;if(ce){var O=I-O,k=k-ne,N=O-k,ue=m.createBreakdownOtherIdentity(le,Z,X);if(H){for(var de=m.createBreakdownTooltip(P,x,S,O,k,N,f,o),he=[],pe=[],ge=0;ge<F.currentTooltipValues.length;ge++)!function(t){var e=F.currentTooltipValues[t],a=F.previousTooltipValues[t];_.isNumber(e)&&_.isNumber(a)&&(e=e-_.sumBy(T,function(e){return e.currentTooltipValues[t]}),a=a-_.sumBy(T,function(e){return e.previousTooltipValues[t]}),he.push(e-a),pe.push(a))}(ge);Pe.appendTooltipMeasures(he,void 0,de,d,f,o,pe,P,x)}}for(var ye=!1,me=0,ve=T;me<ve.length;me++)!function(a){ce&&N>a.difference&&!ye&&(ye=!0,h.push(Pe.createDataPoint(N,g.current,n,S,Y++,ue,de,s.fontProperties.color,v||w,3,{text:!0})),p.push(S),g=Pe.getNewPositionContext(g,N));var e,t=xe.formatFromMetadataColumn(a.column.value,l,f),i=m.splitIdentity(a.column.identity.expr),i=m.createBreakdownIdentity(Z,X,i),r=void 0;H&&(r=m.createBreakdownTooltip(P,x,t,a.currentValue,a.previousValue,a.difference,f,o),e=_.map(a.currentTooltipValues,function(e,t){return _.isNumber(e)?e-a.previousTooltipValues[t]:e}),Pe.appendTooltipMeasures(e,void 0,r,d,f,o,a.previousTooltipValues,P,x)),h.push(Pe.createDataPoint(a.difference,g.current,n,t,Y++,i,r,null!=(B=a.labelColor)?B:s.fontProperties.color,a.formatString||v,0,{text:!0})),p.push(t),g=Pe.getNewPositionContext(g,a.difference)}(oe=ve[me]);ce&&!ye&&(ye=!0,h.push(Pe.createDataPoint(N,g.current,n,S,Y++,ue,de,s.fontProperties.color,v||w,3,{text:!0})),p.push(S),g=Pe.getNewPositionContext(g,N))}z&&(le={dataMap:((ne={})[c[0].queryName]=[D.identity],ne),metadata:[u.queryName]},O=Ae.convertSelectorsByColumnToSelector(le),k=new De(O,!1,le),se=void 0,H&&(se=Pe.createCategoryTooltip(c,u,q,I,void 0,f),Pe.appendTooltipMeasures(F.currentTooltipValues,void 0,se,d,f,o)),h.push(Pe.createDataPoint(I,0,n,P,Y++,k,se,s.fontProperties.color,v||w,2,{text:!0})),p.push(P)),0===C&&(g={current:I,max:I,min:I}),x=P,X=Z}}}a&&a.applySelectionStateToData(h),e.style.isHighContrast&&(R={visible:!0,color:be.getThemeColor(e.style,we),width:fe.defaultLineStrokeWidth});a=fe.getCategoryAxisProperties(t.metadata,void 0),t=fe.getPreferredCategoryWidth(a),a=_.map(h,function(e){return function(){return e.identity}});return{series:[{data:h,type:u&&u.type}],categories:p,categoryIdentities:a,categoryMetadata:c[0],preferredCategoryWidth:t,valuesMetadata:r.valueSources,legend:Pe.createLegend(n,o,y,e.style,!0,z),hasHighlights:!1,positionMin:g.min,positionMax:g.max,dataLabelsSettings:s,sentimentColors:n,isBreakdown:!0,numberOfBreakdowns:i,totalBreakdownCategories:j,strokeSettings:R}}t.prototype.splitIdentity=function(e){return r.ScopeIdentityExtractor.getKeyValuePairs(e)},t.prototype.createBreakdownIdentity=function(e,t,a){var i,t={dataMap:((i={})[this.breakdownMetadata.queryName]=[r.createDataViewScopeIdentity(o.inValues(__spreadArray(__spreadArray([],_.map(e,function(e){return e.left}),!0),_.map(a,function(e){return e.left}),!0),[__spreadArray(__spreadArray([],_.map(t,function(e){return e.right}),!0),_.map(a,function(e){return e.right}),!0),__spreadArray(__spreadArray([],_.map(e,function(e){return e.right}),!0),_.map(a,function(e){return e.right}),!0)]))],i),metadata:[this.valueMetadata.queryName]},e=Ae.convertSelectorsByColumnToSelector(t);return new De(e,!1,t)},t.prototype.createBreakdownOtherIdentity=function(e,t,a){var e={dataMap:((i={})[this.breakdownMetadata.queryName]=[r.createDataViewScopeIdentity(o.not(o.inValues([this.breakdownMetadata.expr],_.map(e,function(e){return[e.right]}))))],i),metadata:[this.valueMetadata.queryName]},i=(e.dataMap[this.categoryMetadata[0].queryName]=[r.createDataViewScopeIdentity(o.inValues(_.map(t,function(e){return e.left}),[_.map(a,function(e){return e.right}),_.map(t,function(e){return e.right})]))],Ae.convertSelectorsByColumnToSelector(e));return new De(i,!1,e)},t.prototype.createBreakdownTooltip=function(e,t,a,i,r,o,s,n){var l,c=this,u=new d.LazyTooltipBuilder;return this.breakdownMetadata&&u.withLazyValue(new h(function(){return{displayName:c.breakdownMetadata.displayName,value:xe.formatFromMetadataColumn(a,c.breakdownMetadata,s)}})),this.valueMetadata&&(null!=r&&u.withLazyValue(new h(function(){return{displayName:"".concat(t," ").concat(c.valueMetadata.displayName),value:xe.formatFromMetadataColumn(r,c.valueMetadata,s,!1)}})),null!=i&&u.withLazyValue(new h(function(){return{displayName:"".concat(e," ").concat(c.valueMetadata.displayName),value:xe.formatFromMetadataColumn(i,c.valueMetadata,s,!1)}})),null!=o)&&(l=xe.formatFromMetadataColumn(o,this.valueMetadata,s,!1),l=Pe.createPercentTooltipValue(l,o,r),u.withLazyValue(new h(function(){return{displayName:p.format(n.getLocalizedString("Waterfall_BreakdownDifferenceTooltip"),c.valueMetadata.displayName),value:l}}))),u};var Me=t;function t(e,t,a){this.breakdownMetadata=e,this.categoryMetadata=t,this.valueMetadata=a}return{matrixConverter:e}}}(powerbi=powerbi||{}),function(e){var a;function t(e,t){switch(this.layerType=e){case 5:this.adapter=new a.ColumnChartLayerViewModelAdapter(t);break;case 0:this.adapter=new a.LineChartLayerViewModelAdapter(t);break;case 2:this.adapter=new a.ScatterChartLayerViewModelAdapter(t);break;case 3:this.adapter=new a.WaterfallChartLayerViewModelAdapter(t)}}a=e.visuals||(e.visuals={}),t.prototype.getData=function(){return this.adapter.getData()},t.prototype.getCartesianChartLayerType=function(){return this.layerType},t.prototype.addWarnings=function(e){return this.adapter.addWarnings(e)},a.CartesianLayerViewModelAdapter=t}(powerbi=powerbi||{}),function(e){var a;function t(e){this.smallMultiplesResponsive=e}a=e.visuals||(e.visuals={}),t.prototype.createCartesianAdapter=function(e){return this.isSmallMultiples()?new a.SmallMultiplesCartesianViewModelAdapter(e,this.smallMultiplesOptions,this.smallMultiplesResponsive):new a.CartesianViewModelAdapter(e)},t.prototype.createLayerAdapter=function(e,t){return this.isSmallMultiples()?new a.SmallMultiplesLayerViewModelAdapter(e,t,this.smallMultiplesResponsive):new a.CartesianLayerViewModelAdapter(e,t)},t.prototype.setSmallMultiplesOptions=function(e){this.smallMultiplesOptions=e},t.prototype.createSmallMultiplesAdapter=function(e){if(this.isSmallMultiples())return new a.SmallMultiplesViewModelAdapter(e,this.smallMultiplesResponsive)},t.prototype.isSmallMultiples=function(){return this.smallMultiplesOptions&&this.smallMultiplesOptions.isSmallMultiples},a.ResponsiveCartesianAdapterFactory=t}(powerbi=powerbi||{}),function(o){var t;function e(e){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper,this.originalData=e.data,this.dataView=e.dataView,this.viewport=e.viewport}t=o.visuals||(o.visuals={}),e.prototype.getData=function(){var e=this.originalData,e=t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(this.dataView,t.cartesianChartProps)?this.applyResponsiveChanges(this.viewport,e):e;return this.currentData=e},e.prototype.getCartesianChartLayerType=function(){return 5},e.prototype.addWarnings=function(e){var t,a=this.originalData,i=this.currentData;a&&i&&(t=this.responsiveFontHelper.getFontSizeSeriesLabelWarning(a,i),a=this.responsiveFontHelper.getFontSizeLabelWarning(a.totalLabelsSettings,i.totalLabelsSettings),t&&e.addForVisualObject("labels",t),a)&&e.addForVisualObject("totals",a)},e.prototype.applyResponsiveChanges=function(e,t){t=o.Prototype.inherit(t);return this.applyDataLabelFontSizesChanges(e,t),this.applySeriesDataLabelFontSizeChanges(e,t),this.applyTotalLabelFontSizesChanges(e,t),t},e.prototype.applyDataLabelFontSizesChanges=function(e,t){t.dataLabelsSettings=o.Prototype.inherit(t.dataLabelsSettings),this.updateLabelSettings(e,t.dataLabelsSettings)},e.prototype.applySeriesDataLabelFontSizeChanges=function(e,t){for(var a,i=t.series=o.Prototype.inherit(t.series),r=0;r<i.length;r++)i[r].labelSettings&&((a=i[r]=o.Prototype.inherit(i[r])).labelSettings=o.Prototype.inherit(a.labelSettings),this.updateLabelSettings(e,a.labelSettings))},e.prototype.applyTotalLabelFontSizesChanges=function(e,t){t.totalLabelsSettings&&(t.totalLabelsSettings=o.Prototype.inherit(t.totalLabelsSettings),this.updateLabelSettings(e,t.totalLabelsSettings))},e.prototype.updateLabelSettings=function(e,t){var a=t.fontProperties;t.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.fontProperties),a!==t.fontProperties&&(t.labelOverflow=!0)},t.ColumnChartLayerViewModelAdapter=e}(powerbi=powerbi||{}),function(o){var t;function e(e){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper,this.originalData=e.data,this.viewport=e.viewport,this.dataView=e.dataView}t=o.visuals||(o.visuals={}),e.prototype.getData=function(){var e=this.originalData,e=t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(this.dataView,t.cartesianChartProps)?this.applyResponsiveChanges(this.viewport,e):e;return this.currentData=e},e.prototype.getCartesianChartLayerType=function(){return 0},e.prototype.addWarnings=function(e){var t,a=this.originalData,i=this.currentData;a&&i&&(t=this.responsiveFontHelper.getFontSizeSeriesLabelWarning(a,i),a=this.responsiveFontHelper.getFontSizeLabelWarning(a.totalLabelsSettings,i.totalLabelsSettings),t&&e.addForVisualObject("labels",t),a)&&e.addForVisualObject("totals",a)},e.prototype.applyResponsiveChanges=function(e,t){t=o.Prototype.inherit(t);return this.applyDataLabelFontSizesChanges(e,t),this.applySeriesDataLabelFontSizeChanges(e,t),this.applyTotalLabelFontSizesChanges(e,t),t},e.prototype.applyDataLabelFontSizesChanges=function(e,t){t.dataLabelsSettings=o.Prototype.inherit(t.dataLabelsSettings),this.updateLabelSettings(e,t.dataLabelsSettings)},e.prototype.applySeriesDataLabelFontSizeChanges=function(e,t){for(var a,i=t.series=o.Prototype.inherit(t.series),r=0;r<i.length;r++)i[r].labelSettings&&((a=i[r]=o.Prototype.inherit(i[r])).labelSettings=o.Prototype.inherit(a.labelSettings),this.updateLabelSettings(e,a.labelSettings))},e.prototype.applyTotalLabelFontSizesChanges=function(e,t){t.totalLabelsSettings&&(t.totalLabelsSettings=o.Prototype.inherit(t.totalLabelsSettings),this.updateLabelSettings(e,t.totalLabelsSettings))},e.prototype.updateLabelSettings=function(e,t){t.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.fontProperties)},t.LineChartLayerViewModelAdapter=e}(powerbi=powerbi||{}),function(i){var t;function e(e){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper,this.originalData=e.data,this.viewport=e.viewport,this.dataView=e.dataView}t=i.visuals||(i.visuals={}),e.prototype.getData=function(){var e=this.originalData,e=t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(this.dataView,t.cartesianChartProps)?this.applyResponsiveChanges(this.viewport,e):e;return this.currentData=e},e.prototype.getCartesianChartLayerType=function(){return 2},e.prototype.addWarnings=function(e){var t=this.originalData,a=this.currentData;t&&a&&(t=this.responsiveFontHelper.getFontSizeLabelWarning(t.dataLabelsSettings,a.dataLabelsSettings))&&e.addForVisualObject("categoryLabels",t)},e.prototype.applyResponsiveChanges=function(e,t){t=i.Prototype.inherit(t);return this.applyDataLabelFontSizesChanges(e,t),t},e.prototype.applyDataLabelFontSizesChanges=function(e,t){t.dataLabelsSettings=i.Prototype.inherit(t.dataLabelsSettings);var a=t.dataLabelsSettings.fontProperties;t.dataLabelsSettings.fontProperties=this.responsiveFontHelper.adjustFontSize(e,a)},t.ScatterChartLayerViewModelAdapter=e}(powerbi=powerbi||{}),function(i){var t;function e(e){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper,this.originalData=e.data,this.viewport=e.viewport,this.dataView=e.dataView}t=i.visuals||(i.visuals={}),e.prototype.getData=function(){var e=this.originalData,e=t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(this.dataView,t.cartesianChartProps)?this.applyResponsiveChanges(this.viewport,e):e;return this.currentData=e},e.prototype.getCartesianChartLayerType=function(){return 3},e.prototype.addWarnings=function(e){var t=this.originalData,a=this.currentData;t&&a&&(t=this.responsiveFontHelper.getFontSizeLabelWarning(t.dataLabelsSettings,a.dataLabelsSettings))&&e.addForVisualObject("labels",t)},e.prototype.applyResponsiveChanges=function(e,t){t=i.Prototype.inherit(t);return this.applyDataLabelFontSizesChanges(e,t),t},e.prototype.applyDataLabelFontSizesChanges=function(e,t){t.dataLabelsSettings=i.Prototype.inherit(t.dataLabelsSettings);var a=t.dataLabelsSettings.fontProperties;t.dataLabelsSettings.fontProperties=this.responsiveFontHelper.adjustFontSize(e,a)},t.WaterfallChartLayerViewModelAdapter=e}(powerbi=powerbi||{}),function(e){var o;function r(e){var t=e.columns,e=e.rows;return{legendPositionHeight:120+30*e,legendPositionWidth:210+40*t,legendShowHeight:90+30*e,legendShowWidth:90+40*t,removeXAxisTitleHeight:165+30*e,removeXAxisHeight:120+30*e,removeYAxisTitleWidth:210+40*t,removeYAxisWidth:120+40*t}}function t(e,t,a){this.smallMultiplesOptions=t,this.smallMultiplesResponsive=a,this.cartesianData=e.cartesianData,this.dataView=e.dataView,this.isCoreMultiple=e.isCoreMultiple,this.responsiveFontHelper=new o.ResponsiveCartesianFontHelper}(o=e.visuals||(e.visuals={})).calculateSMCartesianAdapterBreakpoints=r,t.prototype.getData=function(){var e=this.cartesianData,t=this.smallMultiplesOptions.isSmallMultiples;return e=this.smallMultiplesResponsive&&t&&o.ViewModelAdapterUtils.getResponsiveVisualProperties(this.dataView,o.cartesianChartProps).responsive?this.applyResponsiveChanges(this.cartesianData,this.smallMultiplesOptions):e},t.prototype.enumerateObjectInstances=function(e,t,a){},t.prototype.getResponsiveSlice=function(e,t,a){},t.prototype.applyResponsiveChanges=function(e,t){var a=o.ViewModelAdapterUtils.cloneData(e),i=r(t),t=t.viewport;return this.applyAxesResponsiveChanges(i,t,a),this.applyLegendResponsiveChanges(i,t,a),this.applyFontSizeResponsiveChanges(t,a),this.isCoreMultiple&&o.CartesianViewModelAdapterUtils.updatePlotResponsiveWarnings(a,e),a},t.prototype.applyAxesResponsiveChanges=function(e,t,a){var i=t.height,t=t.width;i<e.removeXAxisTitleHeight&&(a.axesData.x.showAxisTitle=!1),i<e.removeXAxisHeight&&(a.axesData.x.show=!1,a.axesData.x.showAxisTitle=!1),t<e.removeYAxisTitleWidth&&(a.axesData.y.showAxisTitle=!1,a.axesData.y2.showAxisTitle=!1),t<e.removeYAxisWidth&&(a.axesData.y.show=!1,a.axesData.y2.show=!1,a.axesData.y.showAxisTitle=!1,a.axesData.y2.showAxisTitle=!1)},t.prototype.applyLegendResponsiveChanges=function(e,t,a){var i,r;a.legendData.show&&(i=t.height,t=t.width,r=a.legendData.position,(i<e.legendPositionHeight||t<e.legendPositionWidth)&&o.Legend.isLeftOrRight(r)&&(a.legendData.position=o.LegendPosition.Top),(i<e.legendShowHeight||t<e.legendShowWidth)&&(a.legendData.show=!1),a.legendData.useLargeArrowHitArea=!0)},t.prototype.applyFontSizeResponsiveChanges=function(e,t){t.legendData&&t.legendData.fontProperties&&(t.legendData.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.legendData.fontProperties));t=t.axesData;t.x.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.x.labelFontProperties),t.x.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.x.titleFontProperties),t.y.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y.labelFontProperties),t.y.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y.titleFontProperties),t.y2.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y2.labelFontProperties),t.y2.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y2.titleFontProperties)},o.SmallMultiplesCartesianViewModelAdapter=t}(powerbi=powerbi||{}),function(e){function t(e,t,a){this.layerType=e,this.smallMultiplesResponsive=a,this.layerData=t.data}e=e.visuals||(e.visuals={}),t.prototype.getData=function(){return this.smallMultiplesResponsive,this.layerData},t.prototype.getCartesianChartLayerType=function(){return this.layerType},t.prototype.addWarnings=function(e){},e.SmallMultiplesLayerViewModelAdapter=t}(powerbi=powerbi||{}),function(e){var s;function o(e,t,a){return d3.scaleLinear().range(t).domain(e).clamp(!0)(a)}function n(e){var t=e.rowCount,e=e.columnCount;return{showIconHeight:30*e,showIconWidth:40*t,showSubheaderHeight:80+50*t,gridlineRowUpperBreakpoint:120+52*t,gridlineRowLowerBreakpoint:120+32*t,gridlineColumnUpperBreakpoint:120+62*e,gridlineColumnLowerBreakpoint:120+42*e,removeGridLineHeight:32*t,removeGridLineWidth:42*e,paddingRowUpperBreakpoint:120+130*t,paddingRowLowerBreakpoint:120+30*t,paddingColumnUpperBreakpoint:120+140*e,paddingColumnLowerBreakpoint:120+40*e}}function t(e,t){this.smallMultiplesResponsive=t,this.multiplesLayout=e.multiplesLayout,this.multiplesSubheader=e.multiplesSubheader,this.dataView=e.dataView,this.viewport=e.viewport,this.responsiveFontHelper=new s.ResponsiveCartesianFontHelper}(s=e.visuals||(e.visuals={})).interpolateValueFromBreakpoints=o,s.calculateSmallMultiplesViewModelAdapterBreakpoints=n,t.prototype.getMultiplesLayout=function(e){var t=this.multiplesLayout;return t=this.smallMultiplesResponsive&&s.ViewModelAdapterUtils.getResponsiveVisualProperties(this.dataView,s.cartesianChartProps).responsive?this.applyResponsiveChanges(this.viewport,this.multiplesLayout,e):t},t.prototype.getMultiplesSubheader=function(e){var t=this.multiplesSubheader;return t=this.smallMultiplesResponsive&&s.ViewModelAdapterUtils.getResponsiveVisualProperties(this.dataView,s.cartesianChartProps).responsive?this.applySubheaderResponsiveChanges(this.viewport,t,e):t},t.prototype.enumerateObjectInstances=function(e,t,a){this.smallMultiplesResponsive&&a&&"general"===e.objectName&&this.enumerateGeneral(t,this.dataView)},t.prototype.enumerateGeneral=function(e,t){t={selector:null,properties:{responsive:s.ViewModelAdapterUtils.getResponsiveVisualProperties(t,s.cartesianChartProps).responsive},objectName:"general"};e.pushInstance(t)},t.prototype.getResponsiveSlice=function(e,t,a){if(t)return t=s.cartesianChartProps.general,e=s.ViewModelAdapterUtils.getResponsiveVisualProperties(e,s.cartesianChartProps),{item:new s.builder.SimpleFormattingSliceBuilder({uidBuilder:new s.builder.FormattingSliceUidBuilder(new s.builder.FormattingGroupUidBuilder(new s.builder.FormattingCardUidBuilder("visualPlaceholderCard"),"visualPlaceholderGroup"),"responsive"),control:new s.builder.ToggleSwitchBuilder({descriptor:t.responsive,value:e.responsive}).build(),localize:a}).build(),revertToDefaultDescriptors:[t.responsive]}},t.prototype.applyResponsiveChanges=function(e,t,a){var i=s.ViewModelAdapterUtils.cloneData(t),r=n(i);return this.applyIconResponsiveChanges(r,e,i),this.applyGridlinesResponsiveChanges(r,e,i),this.applyPaddingResponsiveChanges(r,e,i),this.updateResponsiveWarnings(i,t,a),i},t.prototype.applyIconResponsiveChanges=function(e,t,a){(t.height<e.showIconHeight||t.width<e.showIconWidth)&&(a.showIcon=!0)},t.prototype.applyGridlinesResponsiveChanges=function(e,t,a){var i=a.gridLineWidth,r=a.gridLineWidth;null!=a.gridLineWidth&&(t.height<e.removeGridLineHeight||t.width<e.removeGridLineWidth?a.gridLineWidth=0:t.height<=e.gridlineRowLowerBreakpoint||t.width<=e.gridlineColumnLowerBreakpoint?a.gridLineWidth=1:(t.height<e.gridlineRowUpperBreakpoint&&(r=Math.ceil(o([e.gridlineRowUpperBreakpoint,e.gridlineRowLowerBreakpoint],[a.gridLineWidth,1],t.height))),t.width<e.gridlineColumnUpperBreakpoint&&(i=Math.ceil(o([e.gridlineColumnUpperBreakpoint,e.gridlineColumnLowerBreakpoint],[a.gridLineWidth,1],t.width))),a.gridLineWidth=Math.min(i,r)))},t.prototype.applyPaddingResponsiveChanges=function(e,t,a){var i;(a.advancedPaddingOptions||0!==a.gridPadding)&&(t.height<e.paddingRowUpperBreakpoint&&(i=[e.paddingRowUpperBreakpoint,e.paddingRowLowerBreakpoint],a.rowPaddingOuter=a.rowPaddingOuter&&Math.ceil(o(i,[a.rowPaddingOuter,1],t.height)),a.rowPaddingInner=a.rowPaddingInner&&Math.ceil(o(i,[a.rowPaddingInner,1],t.height))),t.width<e.paddingColumnUpperBreakpoint)&&(i=[e.paddingColumnUpperBreakpoint,e.paddingColumnLowerBreakpoint],a.columnPaddingOuter=a.columnPaddingOuter&&Math.ceil(o(i,[a.columnPaddingOuter,1],t.width)),a.columnPaddingInner=a.columnPaddingInner&&Math.ceil(o(i,[a.columnPaddingInner,1],t.width)))},t.prototype.applySubheaderResponsiveChanges=function(e,t,a){var i=s.ViewModelAdapterUtils.cloneData(t),r=n(this.multiplesLayout);return e.height<r.showSubheaderHeight&&(i.show=!1),i.show&&i.fontProperties&&(i.fontProperties=this.responsiveFontHelper.adjustFontSize(e,i.fontProperties),i.height=i.fontProperties.size.px+i.margins.top+i.margins.bottom),this.updateSubheaderResponsiveWarnings(i,t,a),i},t.prototype.updateResponsiveWarnings=function(e,t,a){var i,r=a,o={};for(i in e.showIcon?o.subheader=new s.SmallMultiplesSubheadersNotRenderedWarning:(e.rowPaddingInner===t.rowPaddingInner&&e.rowPaddingOuter===t.rowPaddingOuter&&e.columnPaddingInner===t.columnPaddingInner&&e.columnPaddingOuter===t.columnPaddingOuter||(o.smallMultiplesLayout=new s.SmallMultiplesPaddingSizeWarning),e.gridLineWidth!==t.gridLineWidth&&(o.smallMultiplesLayout=new s.SmallMultiplesGridlinesSizeWarning)),o)r.addForVisualObject(i,{selector:null,warnings:[o[i]]})},t.prototype.updateSubheaderResponsiveWarnings=function(e,t,a){var i,r=a,o={};for(i in e.show!==t.show&&(o.subheader=new s.SmallMultiplesSubheadersNotRenderedWarning),_.isEqual(e.fontProperties.size,t.fontProperties.size)||(o.subheader=new s.SmallMultiplesSubheadersFontSizeWarning),o)r.addForVisualObject(i,{selector:null,warnings:[o[i]]})},s.SmallMultiplesViewModelAdapter=t}(powerbi=powerbi||{});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['cartesianVisuals.min.js'] || (this.parseTimeMarkers['cartesianVisuals.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
